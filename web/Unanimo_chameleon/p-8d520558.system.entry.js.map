{"version":3,"names":["actionListGroupCss","ChActionListGroupStyle0","EXPANDABLE_ID","ChActionListGroup","exports","_b","_buttonRef","set","this","_getExpandedValue","_a","_this","expandable","expanded","class_1","prototype","setFocus","__classPrivateFieldGet","focus","connectedCallback","el","setAttribute","ACTION_LIST_PARTS_DICTIONARY","GROUP","ACTION_LIST_GROUP_EXPORT_PARTS","render","hasContent","lazyLoad","call","h","Host","key","toString","class","action","disabled","part","tokenMap","ACTION_LIST_GROUP_PARTS_DICTIONARY","ACTION","SELECTED","selected","NOT_SELECTED","DISABLED","type","ref","__classPrivateFieldSet","caption","_e","CAPTION","downloading","_f","EXPANDABLE","EXPANDED","COLLAPSED","LAZY_LOADED","id","renderImg","cssClass","parts","src","imageType","alt","loading","SPACES_REGEX","addPartForAdditionalItems","additionalItems","index","length","additionalItem","add","trim","replaceAll","addPartForAdditionalModel","additionalModel","start","center","end","computeExportParts","additionalInfo","Set","BLOCKS_TO_CHECK","containsActionTypeActions","some","isActionTypeBlock","section","undefined","editingBlockInfo","align","push","computeActionTypeBlocks","editingBlocks","forEach","block","editingBlock","actionListItemCss","ChActionListItemStyle0","ACTION_TYPE_PARTS","fix","ACTION_LIST_ITEM_PARTS_DICTIONARY","ACTION_FIX","modify","ACTION_MODIFY","remove","ACTION_REMOVE","custom","ACTION_CUSTOM","ChActionListItem","_c","_additionalItemListenerDictionary","fixedChange","emit","itemId","value","fixed","editing","deleting","callback","_confirmActionsDictionary","translations","confirmModify","confirmDelete","_cancelActionsDictionary","cancelModify","cancelDelete","_editingSections","_deletingSections","_headerRef","_inputRef","_removeEditMode","shouldFocusHeader","commitEdition","newCaption","captionChange","_checkIfShouldRemoveEditMode","event","stopPropagation","code","KEY_CODES","ENTER","ESCAPE","preventDefault","_renderAdditionalItems","map","item","jsx","_renderAdditionalItem","additionalAction","hasImage","imgSrc","hasPseudoImage","imgType","pseudoImageStartClass","startPseudoImageTypeDictionary","_k","computedPseudoImage","_getComputedImage","imageTag","concat","ADDITIONAL_ITEM","ADDITIONAL_IMAGE","actionTypeIsFix","actionTypeIsCustom","accessibleName","classes","showOnHover","ADDITIONAL_ACTION","selectable","FIXED","NOT_FIXED","style","styles","onClick","_handleAdditionalItemClick","_l","_g","ADDITIONAL_TEXT","_h","imageTypeDictionary","_m","_j","_setExportParts","exportParts","size","ACTION_LIST_ITEM_EXPORT_PARTS","Array","from","join","_setActionTypeBlocks","_renderAdditionalInfo","zoneName","stretch","zoneNameWithPrefix","actionTypeSection","actionTypeAligns","editingSection","find","deletingSection","includes","_renderConfirmCancelButtons","title","ADDITIONAL_ITEM_CONFIRM","ACTION_ACCEPT","_acceptAction","ACTION_CANCEL","_cancelAction","getImagePathCallback","getControlRegisterProperty","DEFAULT_GET_IMAGE_PATH_CALLBACK","img","updateDirectionInImageCustomVar","class_2","additionalInfoChanged","ITEM","hasAdditionalInfo","stretchStart","blockStart","inlineCaption","blockEnd","stretchEnd","hasParts","NESTED","nested","NESTED_EXPANDABLE","nestedExpandable","SELECTABLE","NOT_SELECTABLE","EDITING","NOT_EDITING","autoFocus","EDIT_CAPTION","onKeyDown","ACTION_LIST_ITEM_TAG","ACTION_LIST_GROUP_TAG","ACTION_LIST_ITEM_SELECTOR","ACTION_LIST_GROUP_SELECTOR","getActionListOrGroupItemFromEvent","composedPath","tagName","toLowerCase","getActionListOrGroupItemIndex","items","findIndex","getParentArray","itemUIModel","root","parentItem","getActionListItemOrGroupInfo","flattenedModel","get","EDIT_KEY","F2","ACTION_LIST_ITEM_TAG_NAME","isActionListItem","element","getFocusedActionListItem","focusComposedPath","focusItemById","itemInfo","actionListRef","itemRef","shadowRoot","querySelector","ctrlKeyIsPressed","mouseEventModifierKey","click","getAndCheckItem","eventTarget","groupIsCollapsed","group","focusNextItemFirstLevel","startIndex","currentFocusedId","increment","firstLevelIndex","firstLevelSibling","anItemWasFocused","focusNextItemSecondLevel","keyboardDictionary","ARROW_UP","itemIndex","secondLevelIndex","ARROW_DOWN","_","actionListItem","editable","editableItems","actionListKeyboardNavigation","keyboardEventHandler","updateItemProperty","propertiesToUpdate","flattenedTreeModel","newSelectedItems","propertyName","propertyValue","delete","actionListDefaultTranslations","Object","freeze","setActionListSelectedItems","model","selectedItems","selectedItemsDiffer","currentSelectedItems","_i","currentSelectedItems_1","has","removeAllSelectedItemsExceptForTheLast","selectedItemsArray","__spreadArray","values","lastItemIndex","clear","selectedItemsChangeShouldBeEmitted","selection","flattenSubUIModel","sortModel","flattenActionListUIModel","actionListRenderCss","ChActionListRenderStyle0","DEFAULT_EDITABLE_ITEMS_VALUE","renderMapping","actionable","itemModel","actionListRenderState","additionalInformation","checkbox","checked","metadata","renderItem","separator","role","defaultRenderItem","FIRST_ITEM_GREATER_THAN_SECOND","SECOND_ITEM_GREATER_THAN_FIRST","defaultSortItemsCallback","subModel","sort","a","b","order","ChActionListRender","_d","_flattenedModel","Map","_selectedItems","_shouldUpdateModelAndSelection","_getItemsInfo","itemsId","actionListItemsInfo","_updateItemFix","newFixedValue","_sortModel","forceUpdate","_getItemOrGroupInfo","_updateAndEmitSelectedItems","_removeAllSelectedItems","_emitSelectedItemsChange","selectedItemId","selectedItemInfo","_handleItemClick","actionListItemOrGroup","_checkIfMustExpandCollapseGroup","itemClick","_handleItemSelection","itemWasSelected","singleSelectionMode","previousSelectedItemId","keys","previousSelectedItemInfo","selectedItemsInfo","selectedItemsChange","_removeItem","parentArray","itemToRemoveId","itemToRemoveIndex","removeElement","sortItemsCallback","_flattenUIModel","class_3","modelChanged","selectionChanged","addItem","groupParentId","parentGroup","getItemsInfo","removeItem","updateItemProperties","properties","onCaptionChange","modifyItemCaptionCallback","detail","oldCaption","then","catch","onFixedChange","fixItemCallback","acceptChange","onRemove","removeItemCallback","acceptRemove","adoptCommonThemes","adoptedStyleSheets","componentWillRender","SCROLLABLE_CLASS"],"sources":["src/components/action-list/internal/action-list-group/action-list-group.scss?tag=ch-action-list-group&encapsulation=shadow","src/components/action-list/internal/action-list-group/action-list-group.tsx","src/common/renders.tsx","src/components/action-list/internal/action-list-item/compute-exportparts.ts","src/components/action-list/internal/action-list-item/compute-editing-sections.ts","src/components/action-list/internal/action-list-item/action-list-item.scss?tag=ch-action-list-item&encapsulation=shadow","src/components/action-list/internal/action-list-item/action-list-item.tsx","src/components/action-list/utils.ts","src/components/action-list/keyboard-navigation.ts","src/components/action-list/update-item-property.ts","src/components/action-list/translations.ts","src/components/action-list/selections.ts","src/components/action-list/flatten-model.ts","src/components/action-list/action-list-render.scss?tag=ch-action-list-render&encapsulation=shadow","src/components/action-list/action-list-render.tsx"],"sourcesContent":["@import \"../../../../common/base\";\r\n@import \"../../../../common/icons\";\r\n\r\n@include button-reset();\r\n@include box-sizing();\r\n\r\n:host,\r\n.group {\r\n  display: grid;\r\n  grid-template-rows: min-content;\r\n}\r\n\r\n.action {\r\n  &::before {\r\n    content: \"\";\r\n    inline-size: var(--ch-action-list-group__expandable-button-size);\r\n    block-size: var(--ch-action-list-group__expandable-button-size);\r\n    background-color: currentColor;\r\n    -webkit-mask: no-repeat center /\r\n      var(--ch-action-list-group__expandable-button-image-size) $expandable-icon;\r\n  }\r\n\r\n  &--collapsed::before {\r\n    transform: rotate(-90deg); // TODO: Add RTL support\r\n  }\r\n}\r\n\r\n// - - - - - - - - - - - - - - - -\r\n//       Expandable content\r\n// - - - - - - - - - - - - - - - -\r\n.expandable {\r\n  display: grid;\r\n  grid-auto-rows: min-content;\r\n  position: relative;\r\n  padding: 0;\r\n  margin: 0;\r\n\r\n  &--lazy-loaded {\r\n    content-visibility: auto;\r\n    contain-intrinsic-size: auto 100px;\r\n  }\r\n}\r\n\r\n.expandable--collapsed {\r\n  display: none;\r\n  overflow: hidden;\r\n}\r\n","import {\r\n  Component,\r\n  Element,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Method,\r\n  Prop,\r\n  h\r\n} from \"@stencil/core\";\r\nimport { tokenMap } from \"../../../../common/utils\";\r\nimport {\r\n  ACTION_LIST_GROUP_EXPORT_PARTS,\r\n  ACTION_LIST_GROUP_PARTS_DICTIONARY,\r\n  ACTION_LIST_PARTS_DICTIONARY\r\n} from \"../../../../common/reserved-names\";\r\n\r\nconst EXPANDABLE_ID = \"expandable\";\r\n\r\n@Component({\r\n  tag: \"ch-action-list-group\",\r\n  styleUrl: \"action-list-group.scss\",\r\n  shadow: { delegatesFocus: true }\r\n})\r\nexport class ChActionListGroup {\r\n  #buttonRef: HTMLButtonElement;\r\n\r\n  @Element() el: HTMLChActionListGroupElement;\r\n\r\n  /**\r\n   * This attributes specifies the caption of the control\r\n   */\r\n  @Prop() readonly caption: string;\r\n\r\n  /**\r\n   * This attribute lets you specify if the element is disabled.\r\n   * If disabled, it will not fire any user interaction related event\r\n   * (for example, click event).\r\n   */\r\n  @Prop({ reflect: true }) readonly disabled: boolean = false;\r\n\r\n  /**\r\n   * This attribute lets you specify when items are being lazy loaded in the\r\n   * control.\r\n   */\r\n  @Prop({ mutable: true }) downloading = false;\r\n\r\n  /**\r\n   * If the item has a sub-tree, this attribute determines if the subtree is\r\n   * displayed.\r\n   */\r\n  @Prop() readonly expandable?: boolean;\r\n\r\n  /**\r\n   * If the item has a sub-tree, this attribute determines if the subtree is\r\n   * displayed.\r\n   */\r\n  @Prop() readonly expanded?: boolean;\r\n  // @Watch(\"expanded\")\r\n  // expandedChanged(isExpanded: boolean) {\r\n  //   // Wait until all properties are updated before lazy loading. Otherwise, the\r\n  //   // lazyLoad property could be updated just after the executing of the function\r\n  //   setTimeout(() => {\r\n  //     this.#lazyLoadItems(isExpanded);\r\n  //   });\r\n  // }\r\n\r\n  /**\r\n   * Determine if the items are lazy loaded when opening the first time the\r\n   * control.\r\n   */\r\n  @Prop({ mutable: true }) lazyLoad = false;\r\n\r\n  /**\r\n   * This attribute represents additional info for the control that is included\r\n   * when dragging the item.\r\n   */\r\n  @Prop() readonly metadata: string;\r\n\r\n  /**\r\n   * Specifies a set of parts to use in every DOM element of the control.\r\n   */\r\n  @Prop() readonly parts?: string;\r\n  // @Watch(\"parts\")\r\n  // partsChanged(newParts: string) {\r\n  //   this.#setExportParts(newParts);\r\n  // }\r\n\r\n  /**\r\n   * This attribute lets you specify if the item is selected\r\n   */\r\n  @Prop() readonly selected: boolean = false;\r\n\r\n  /**\r\n   * `true` to show the downloading spinner when lazy loading the sub items of\r\n   * the control.\r\n   */\r\n  @Prop() readonly showDownloadingSpinner: boolean = true;\r\n\r\n  // /**\r\n  //  * Fired when the item is being dragged.\r\n  //  */\r\n  // @Event() itemDragStart: EventEmitter<TreeViewItemDragStartInfo>;\r\n\r\n  /**\r\n   * Fired when the lazy control is expanded an its content must be loaded.\r\n   */\r\n  @Event() loadLazyContent: EventEmitter<string>;\r\n\r\n  /**\r\n   * Set the focus in the control if `expandable === true`.\r\n   */\r\n  @Method()\r\n  async setFocus() {\r\n    if (this.expandable && this.#buttonRef) {\r\n      this.#buttonRef.focus();\r\n    }\r\n  }\r\n\r\n  #getExpandedValue = (): boolean =>\r\n    this.expandable ? this.expanded ?? false : true;\r\n\r\n  connectedCallback() {\r\n    this.el.setAttribute(\"role\", \"listitem\");\r\n    this.el.setAttribute(\"part\", ACTION_LIST_PARTS_DICTIONARY.GROUP);\r\n    this.el.setAttribute(\"exportparts\", ACTION_LIST_GROUP_EXPORT_PARTS);\r\n  }\r\n\r\n  render() {\r\n    const hasContent = !this.lazyLoad;\r\n    const expanded = hasContent && this.#getExpandedValue();\r\n\r\n    return (\r\n      <Host>\r\n        {this.expandable ? (\r\n          <button\r\n            aria-controls={hasContent ? EXPANDABLE_ID : null}\r\n            aria-expanded={hasContent ? expanded.toString() : null}\r\n            class={{ action: true, \"action--collapsed\": !expanded }}\r\n            disabled={this.disabled}\r\n            part={tokenMap({\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.ACTION]: true,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.SELECTED]: this.selected,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.NOT_SELECTED]: !this.selected,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.DISABLED]: this.disabled\r\n            })}\r\n            type=\"button\"\r\n            ref={el => (this.#buttonRef = el)}\r\n          >\r\n            {this.caption}\r\n          </button>\r\n        ) : (\r\n          <span\r\n            // TODO: Test this case (accessibility)\r\n            // aria-controls={hasContent ? EXPANDABLE_ID : null}\r\n            // aria-expanded={hasContent ? expanded.toString() : null}\r\n            class=\"action\"\r\n            part={tokenMap({\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.CAPTION]: true,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.DISABLED]: this.disabled\r\n            })}\r\n          >\r\n            {this.caption}\r\n          </span>\r\n        )}\r\n\r\n        {hasContent && (\r\n          <ul\r\n            aria-busy={(!!this.downloading).toString()}\r\n            aria-live={this.downloading ? \"polite\" : null}\r\n            class={{\r\n              expandable: true,\r\n              \"expandable--collapsed\": !expanded,\r\n              \"expandable--lazy-loaded\": !this.downloading\r\n            }}\r\n            part={tokenMap({\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.EXPANDABLE]: true,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.EXPANDED]: expanded,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.COLLAPSED]: !expanded,\r\n              [ACTION_LIST_GROUP_PARTS_DICTIONARY.LAZY_LOADED]:\r\n                !this.downloading\r\n            })}\r\n            id={EXPANDABLE_ID}\r\n          >\r\n            <slot />\r\n          </ul>\r\n        )}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n","import { h } from \"@stencil/core\";\r\nimport { ImageRender } from \"./types\";\r\n\r\nexport const renderImg = (\r\n  cssClass: string,\r\n  parts: string,\r\n  src: string,\r\n  imageType: ImageRender\r\n) =>\r\n  imageType === \"img\" &&\r\n  src && (\r\n    <img\r\n      aria-hidden=\"true\"\r\n      class={cssClass}\r\n      part={parts}\r\n      alt=\"\"\r\n      src={src}\r\n      loading=\"lazy\"\r\n    />\r\n  );\r\n","import {\r\n  ActionListItemAdditionalBase,\r\n  ActionListItemAdditionalCustom,\r\n  ActionListItemAdditionalInformation,\r\n  ActionListItemAdditionalItem,\r\n  ActionListItemAdditionalModel\r\n} from \"../../types\";\r\n\r\nconst SPACES_REGEX = /\\s+/g;\r\n\r\nconst addPartForAdditionalItems = (\r\n  additionalItems: ActionListItemAdditionalItem[],\r\n  parts: Set<string>\r\n) => {\r\n  if (additionalItems == null) {\r\n    return;\r\n  }\r\n\r\n  // For let index = ... is the fastest for loop\r\n  for (let index = 0; index < additionalItems.length; index++) {\r\n    // Slots does not have parts\r\n    const additionalItem = additionalItems[index] as\r\n      | ActionListItemAdditionalBase\r\n      | ActionListItemAdditionalCustom;\r\n\r\n    if (additionalItem.part) {\r\n      // TODO: Add a test for this case\r\n      parts.add(additionalItem.part.trim().replaceAll(SPACES_REGEX, \",\"));\r\n    }\r\n  }\r\n};\r\n\r\nconst addPartForAdditionalModel = (\r\n  additionalModel: ActionListItemAdditionalModel | undefined,\r\n  parts: Set<string>\r\n) => {\r\n  if (additionalModel != null) {\r\n    addPartForAdditionalItems(additionalModel.start, parts);\r\n    addPartForAdditionalItems(additionalModel.center, parts);\r\n    addPartForAdditionalItems(additionalModel.end, parts);\r\n  }\r\n};\r\n\r\nexport const computeExportParts = (\r\n  additionalInfo: ActionListItemAdditionalInformation\r\n) => {\r\n  const parts: Set<string> = new Set();\r\n\r\n  addPartForAdditionalModel(additionalInfo[\"block-start\"], parts);\r\n  addPartForAdditionalModel(additionalInfo[\"block-end\"], parts);\r\n  addPartForAdditionalModel(additionalInfo[\"inline-caption\"], parts);\r\n  addPartForAdditionalModel(additionalInfo[\"stretch-start\"], parts);\r\n  addPartForAdditionalModel(additionalInfo[\"stretch-end\"], parts);\r\n\r\n  return parts;\r\n};\r\n","import {\r\n  ActionListItemAdditionalAction,\r\n  ActionListItemAdditionalInformation,\r\n  ActionListItemAdditionalInformationSection,\r\n  ActionListItemAdditionalItem,\r\n  ActionListItemAdditionalItemActionType,\r\n  ActionListItemAdditionalModel\r\n} from \"../../types\";\r\nimport { ActionListItemActionTypeBlockInfo } from \"./types\";\r\n\r\nconst BLOCKS_TO_CHECK: (keyof ActionListItemAdditionalInformation)[] = [\r\n  \"block-start\",\r\n  \"block-end\",\r\n  \"inline-caption\",\r\n  \"stretch-start\",\r\n  \"stretch-end\"\r\n];\r\n\r\nconst containsActionTypeActions = (\r\n  action: ActionListItemAdditionalItemActionType[\"type\"],\r\n  additionalItems?: ActionListItemAdditionalItem[]\r\n): boolean => {\r\n  if (additionalItems == null) {\r\n    return false;\r\n  }\r\n\r\n  return additionalItems.some(\r\n    additionalItem =>\r\n      (additionalItem as ActionListItemAdditionalAction).action &&\r\n      (additionalItem as ActionListItemAdditionalAction).action.type === action\r\n  );\r\n};\r\n\r\nconst isActionTypeBlock = (\r\n  action: ActionListItemAdditionalItemActionType[\"type\"],\r\n  section: ActionListItemAdditionalInformationSection,\r\n  additionalModel?: ActionListItemAdditionalModel\r\n): ActionListItemActionTypeBlockInfo | undefined => {\r\n  if (additionalModel == null) {\r\n    return undefined;\r\n  }\r\n\r\n  let editingBlockInfo: ActionListItemActionTypeBlockInfo | undefined;\r\n\r\n  if (containsActionTypeActions(action, additionalModel.start)) {\r\n    editingBlockInfo = { section: section, align: [\"start\"] };\r\n  }\r\n\r\n  if (containsActionTypeActions(action, additionalModel.center)) {\r\n    if (editingBlockInfo) {\r\n      editingBlockInfo.align.push(\"center\");\r\n    } else {\r\n      editingBlockInfo = { section: section, align: [\"center\"] };\r\n    }\r\n  }\r\n\r\n  if (containsActionTypeActions(action, additionalModel.end)) {\r\n    if (editingBlockInfo) {\r\n      editingBlockInfo.align.push(\"end\");\r\n    } else {\r\n      editingBlockInfo = { section: section, align: [\"end\"] };\r\n    }\r\n  }\r\n\r\n  return editingBlockInfo;\r\n};\r\n\r\nexport const computeActionTypeBlocks = (\r\n  action: ActionListItemAdditionalItemActionType[\"type\"],\r\n  additionalInfo?: ActionListItemAdditionalInformation\r\n): ActionListItemActionTypeBlockInfo[] | undefined => {\r\n  if (additionalInfo == null) {\r\n    return undefined;\r\n  }\r\n\r\n  let editingBlocks: ActionListItemActionTypeBlockInfo[] | undefined =\r\n    undefined;\r\n\r\n  BLOCKS_TO_CHECK.forEach(block => {\r\n    const editingBlock = isActionTypeBlock(\r\n      action,\r\n      block,\r\n      additionalInfo[block]\r\n    );\r\n\r\n    if (editingBlock) {\r\n      editingBlocks ??= [];\r\n      editingBlocks.push(editingBlock);\r\n    }\r\n  });\r\n\r\n  return editingBlocks;\r\n};\r\n","@import \"../../../../common/base\";\r\n@import \"../../../../common/icons\";\r\n\r\n@include button-reset();\r\n@include box-sizing();\r\n\r\n:host {\r\n  display: grid;\r\n  grid-template-rows: min-content;\r\n}\r\n\r\n.action {\r\n  display: grid;\r\n  grid-template:\r\n    \"stretch-start block-start stretch-end\" max-content\r\n    \"stretch-start inline-caption stretch-end\" max-content\r\n    \"stretch-start block-end stretch-end\" max-content / max-content 1fr max-content;\r\n}\r\n\r\n// TODO: Fix \"inline-caption: start\" items support\r\n.align-container {\r\n  display: grid;\r\n  grid-auto-flow: column;\r\n  // Don't add (grid-auto-columns: max-content), because it will break the align-end\r\n  white-space: break-spaces; // Support for line breaks, like \\n\r\n}\r\n\r\n// - - - - - - - - - - - - - - - - - - - -\r\n//         First level containers\r\n// - - - - - - - - - - - - - - - - - - - -\r\n.stretch-start {\r\n  grid-area: stretch-start;\r\n}\r\n\r\n.block-start {\r\n  grid-area: block-start;\r\n}\r\n\r\n.inline-caption {\r\n  grid-area: inline-caption;\r\n  align-items: center;\r\n  min-block-size: var(--ch-action-list-item__image-size);\r\n}\r\n\r\n.block-end {\r\n  grid-area: block-end;\r\n}\r\n\r\n.stretch-end {\r\n  grid-area: stretch-end;\r\n}\r\n\r\n.stretch-start,\r\n.stretch-end {\r\n  align-self: stretch;\r\n}\r\n\r\n// - - - - - - - - - - - - - - - - - - - -\r\n//         Second level containers\r\n// - - - - - - - - - - - - - - - - - - - -\r\n.align-start {\r\n  display: flex;\r\n  justify-self: flex-start;\r\n}\r\n\r\n.align-center {\r\n  display: flex;\r\n  justify-self: center;\r\n}\r\n\r\n.align-end {\r\n  display: flex;\r\n  justify-self: flex-end;\r\n}\r\n\r\n.valign-start {\r\n  display: flex;\r\n  align-self: self-start;\r\n}\r\n\r\n.valign-center {\r\n  display: flex;\r\n  align-self: center;\r\n}\r\n\r\n.valign-end {\r\n  display: flex;\r\n  align-self: self-end;\r\n}\r\n\r\n// - - - - - - - - - - - - - - - - - - - -\r\n//            Additional items\r\n// - - - - - - - - - - - - - - - - - - - -\r\n:host(:not(:hover):not(:focus-within)) .show-on-mouse-hover {\r\n  display: none;\r\n}\r\n\r\n.additional-item {\r\n  display: inline-grid;\r\n  grid-auto-columns: max-content;\r\n  grid-auto-flow: column;\r\n  align-items: center;\r\n}\r\n\r\n.fix,\r\n.modify,\r\n.remove,\r\n.confirm-action,\r\n.cancel-action {\r\n  &::before {\r\n    content: \"\";\r\n    display: inline-block;\r\n    inline-size: var(--ch-action-list-item__image-size);\r\n    block-size: var(--ch-action-list-item__image-size);\r\n    content-visibility: auto;\r\n    contain-intrinsic-size: auto var(--ch-action-list-item__image-size);\r\n    -webkit-mask: no-repeat center /\r\n      var(--ch-action-list-item__background-image-size) var(--ch-start-start);\r\n    background-color: var(--ch-action-list-item__action-color);\r\n  }\r\n}\r\n\r\n.fixed {\r\n  --ch-start-start: var(--ch-action-list-item__additional-item-fixed-image);\r\n}\r\n\r\n.not-fixed {\r\n  --ch-start-start: var(--ch-action-list-item__additional-item-not-fixed-image);\r\n}\r\n\r\n.modify {\r\n  --ch-start-start: var(--ch-action-list-item__additional-item-modify-image);\r\n}\r\n\r\n.remove {\r\n  --ch-start-start: var(--ch-action-list-item__additional-item-remove-image);\r\n}\r\n\r\n.confirm-action {\r\n  --ch-start-start: var(--ch-action-list-item__additional-item-confirm-image);\r\n}\r\n\r\n.cancel-action {\r\n  --ch-start-start: var(--ch-action-list-item__additional-item-cancel-image);\r\n}\r\n\r\n// - - - - - - - - - - - - - - - - - - - -\r\n//                 Images\r\n// - - - - - - - - - - - - - - - - - - - -\r\n@include images-without-pseudo-elements(\r\n  $image-path-custom-var: var(--ch-start-start),\r\n  $image-size-custom-var: var(--ch-action-list-item__image-size),\r\n  $background-image-size-custom-var:\r\n    var(--ch-action-list-item__background-image-size)\r\n);\r\n\r\n@include images-with-pseudo-elements(\r\n  $start-image-path-custom-var: var(--ch-start-start),\r\n  $end-image-path-custom-var: var(--ch-end-img),\r\n  $image-size-custom-var: var(--ch-action-list-item__image-size),\r\n  $background-image-size-custom-var:\r\n    var(--ch-action-list-item__background-image-size)\r\n);\r\n\r\n.additional-item.not-actionable {\r\n  --ch-start-start: var(--ch-start-img--base);\r\n\r\n  .action:active &.start-img--active {\r\n    --ch-start-start: var(--ch-start-img--active);\r\n  }\r\n\r\n  .action:focus &.start-img--focus {\r\n    --ch-start-start: var(--ch-start-img--focus);\r\n  }\r\n\r\n  .action:hover &.start-img--hover {\r\n    --ch-start-start: var(--ch-start-img--hover);\r\n  }\r\n\r\n  .action:disabled &.start-img--disabled {\r\n    --ch-start-start: var(--ch-start-img--disabled);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Element,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Prop,\r\n  Watch,\r\n  h\r\n} from \"@stencil/core\";\r\nimport {\r\n  ActionListImagePathCallback,\r\n  ActionListItemAdditionalAction,\r\n  ActionListItemAdditionalBase,\r\n  ActionListItemAdditionalCustom,\r\n  ActionListItemAdditionalInformation,\r\n  ActionListItemAdditionalInformationSection,\r\n  ActionListItemAdditionalItem,\r\n  ActionListItemAdditionalItemActionType,\r\n  ActionListItemAdditionalModel\r\n} from \"../../types\";\r\nimport { renderImg } from \"../../../../common/renders\";\r\nimport {\r\n  ACTION_LIST_ITEM_EXPORT_PARTS,\r\n  ACTION_LIST_ITEM_PARTS_DICTIONARY,\r\n  ACTION_LIST_PARTS_DICTIONARY,\r\n  imageTypeDictionary,\r\n  KEY_CODES,\r\n  startPseudoImageTypeDictionary\r\n} from \"../../../../common/reserved-names\";\r\nimport {\r\n  ActionListCaptionChangeEventDetail,\r\n  ActionListFixedChangeEventDetail,\r\n  ActionListItemActionTypeBlockInfo\r\n} from \"./types\";\r\nimport {\r\n  tokenMap,\r\n  updateDirectionInImageCustomVar\r\n} from \"../../../../common/utils\";\r\nimport { computeExportParts } from \"./compute-exportparts\";\r\nimport { computeActionTypeBlocks } from \"./compute-editing-sections\";\r\nimport { ActionListTranslations } from \"../../translations\";\r\nimport {\r\n  GxImageMultiState,\r\n  GxImageMultiStateStart\r\n} from \"../../../../common/types\";\r\nimport {\r\n  DEFAULT_GET_IMAGE_PATH_CALLBACK,\r\n  getControlRegisterProperty\r\n} from \"../../../../common/registry-properties\";\r\n\r\nconst ACTION_TYPE_PARTS = {\r\n  fix: ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION_FIX,\r\n  modify: ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION_MODIFY,\r\n  remove: ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION_REMOVE,\r\n  custom: ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION_CUSTOM\r\n} as const;\r\n\r\n@Component({\r\n  tag: \"ch-action-list-item\",\r\n  styleUrl: \"action-list-item.scss\",\r\n  shadow: { delegatesFocus: true }\r\n})\r\nexport class ChActionListItem {\r\n  #additionalItemListenerDictionary = {\r\n    fix: () =>\r\n      this.fixedChange.emit({ itemId: this.el.id, value: !this.fixed }),\r\n    remove: () => {\r\n      if (!this.editing) {\r\n        this.deleting = true;\r\n      }\r\n    },\r\n    custom: callback => callback(),\r\n    modify: () => {\r\n      if (!this.deleting) {\r\n        this.editing = true;\r\n      }\r\n    }\r\n  } satisfies {\r\n    [key in ActionListItemAdditionalItemActionType[\"type\"]]: (...args) => any;\r\n  };\r\n\r\n  #confirmActionsDictionary = {\r\n    // custom: () => this.translations.confirm,\r\n    modify: () => this.translations.confirmModify,\r\n    remove: () => this.translations.confirmDelete\r\n  } satisfies {\r\n    [key in Exclude<\r\n      ActionListItemAdditionalItemActionType[\"type\"],\r\n      \"fix\" | \"custom\"\r\n    >]: () => string;\r\n  };\r\n\r\n  #cancelActionsDictionary = {\r\n    // custom: () => this.translations.cancel,\r\n    modify: () => this.translations.cancelModify,\r\n    remove: () => this.translations.cancelDelete\r\n  } satisfies {\r\n    [key in Exclude<\r\n      ActionListItemAdditionalItemActionType[\"type\"],\r\n      \"fix\" | \"custom\"\r\n    >]: () => string;\r\n  };\r\n\r\n  #editingSections: ActionListItemActionTypeBlockInfo[] | undefined;\r\n  #deletingSections: ActionListItemActionTypeBlockInfo[] | undefined;\r\n\r\n  // Refs\r\n  #headerRef!: HTMLButtonElement;\r\n  #inputRef: HTMLChEditElement | undefined;\r\n\r\n  @Element() el: HTMLChActionListItemElement;\r\n\r\n  /**\r\n   *\r\n   */\r\n  @Prop() readonly additionalInfo?: ActionListItemAdditionalInformation;\r\n  @Watch(\"additionalInfo\")\r\n  additionalInfoChanged() {\r\n    this.#setExportParts();\r\n    this.#setActionTypeBlocks();\r\n  }\r\n\r\n  /**\r\n   * This attributes specifies the caption of the control.\r\n   */\r\n  @Prop() readonly caption: string;\r\n\r\n  /**\r\n   * Set this attribute if you want display a checkbox in the control.\r\n   */\r\n  @Prop() readonly checkbox: boolean = false;\r\n\r\n  /**\r\n   * Set this attribute if you want the checkbox to be checked by default.\r\n   * Only works if `checkbox = true`\r\n   */\r\n  @Prop({ reflect: true, mutable: true }) checked = false;\r\n\r\n  /**\r\n   * Set this attribute if you want to set a custom render for the control, by\r\n   * passing a slot.\r\n   */\r\n  @Prop() readonly customRender: boolean = false;\r\n\r\n  /**\r\n   * Set this property when the control is in delete mode.\r\n   */\r\n  @Prop({ mutable: true }) deleting = false;\r\n\r\n  /**\r\n   * This attribute lets you specify if the element is disabled.\r\n   * If disabled, it will not fire any user interaction related event\r\n   * (for example, click event).\r\n   */\r\n  @Prop({ reflect: true }) readonly disabled: boolean = false;\r\n\r\n  /**\r\n   * This attribute lets you specify when items are being lazy loaded in the\r\n   * control.\r\n   */\r\n  @Prop({ mutable: true }) downloading = false;\r\n\r\n  /**\r\n   * This property lets you specify if the edit operation is enabled in the\r\n   * control. If `true`, the control can edit its caption in place.\r\n   */\r\n  @Prop() readonly editable: boolean;\r\n\r\n  /**\r\n   * Set this property when the control is in edit mode.\r\n   */\r\n  @Prop({ mutable: true }) editing = false;\r\n\r\n  /**\r\n   *\r\n   */\r\n  @Prop() readonly fixed?: boolean = false;\r\n\r\n  /**\r\n   * This property specifies a callback that is executed when the path for an\r\n   * imgSrc needs to be resolved.\r\n   */\r\n  @Prop() readonly getImagePathCallback?: (\r\n    item: ActionListItemAdditionalBase\r\n  ) => GxImageMultiState | undefined;\r\n\r\n  /**\r\n   * `true` if the checkbox's value is indeterminate.\r\n   */\r\n  @Prop({ mutable: true }) indeterminate = false;\r\n\r\n  /**\r\n   * This attribute represents additional info for the control that is included\r\n   * when dragging the item.\r\n   */\r\n  @Prop() readonly metadata: string;\r\n\r\n  /**\r\n   * Specifies if the item is inside of a ch-action-list-group control.\r\n   */\r\n  @Prop() readonly nested: boolean = false;\r\n\r\n  /**\r\n   * Specifies if the item is inside of a ch-action-list-group control that\r\n   * is expandable.\r\n   */\r\n  @Prop() readonly nestedExpandable: boolean = false;\r\n\r\n  /**\r\n   * Specifies a set of parts to use in every DOM element of the control.\r\n   */\r\n  @Prop() readonly parts?: string;\r\n  // @Watch(\"parts\")\r\n  // partsChanged(newParts: string) {\r\n  //   this.#setExportParts(newParts);\r\n  // }\r\n\r\n  /**\r\n   * Specifies if the item can be selected.\r\n   */\r\n  @Prop() readonly selectable: boolean = false;\r\n\r\n  /**\r\n   * This attribute lets you specify if the item is selected\r\n   */\r\n  @Prop() readonly selected: boolean = false;\r\n\r\n  /**\r\n   * `true` to show the downloading spinner when lazy loading the sub items of\r\n   * the control.\r\n   */\r\n  @Prop() readonly showDownloadingSpinner: boolean = true;\r\n\r\n  /**\r\n   * Specifies the literals required for the control.\r\n   */\r\n  @Prop() readonly translations!: ActionListTranslations;\r\n\r\n  // /**\r\n  //  * Fired when the checkbox value of the control is changed.\r\n  //  */\r\n  // @Event() checkboxChange: EventEmitter<TreeViewItemCheckedInfo>;\r\n\r\n  // /**\r\n  //  * Fired when the item is being dragged.\r\n  //  */\r\n  // @Event() itemDragStart: EventEmitter<TreeViewItemDragStartInfo>;\r\n\r\n  /**\r\n   * Fired when the fixed value of the control is changed.\r\n   */\r\n  @Event({ composed: true })\r\n  captionChange: EventEmitter<ActionListCaptionChangeEventDetail>;\r\n\r\n  /**\r\n   * Fired when the control is asking to modify its caption\r\n   */\r\n  // TODO: Unify terms (modifyCaption in the Tree View)\r\n  @Event({ composed: true })\r\n  fixedChange: EventEmitter<ActionListFixedChangeEventDetail>;\r\n\r\n  /**\r\n   * Fired when the remove button was clicked in the control.\r\n   */\r\n  @Event({ composed: true }) remove: EventEmitter<string>;\r\n\r\n  /**\r\n   * Fired when the item is no longer being dragged.\r\n   */\r\n  @Event() itemDragEnd: EventEmitter;\r\n\r\n  #removeEditMode =\r\n    (shouldFocusHeader: boolean, commitEdition = false) =>\r\n    () => {\r\n      // When pressing the enter key in the input, the removeEditMode event is\r\n      // triggered twice (due to the headerRef.focus() triggering the onBlur\r\n      // event in the input), so we need to check if the edit mode was disabled\r\n      if (!this.editing) {\r\n        return;\r\n      }\r\n      this.editing = false;\r\n\r\n      const newCaption = this.#inputRef.value;\r\n\r\n      if (\r\n        commitEdition &&\r\n        newCaption.trim() !== \"\" &&\r\n        this.caption !== newCaption\r\n      ) {\r\n        this.captionChange.emit({\r\n          itemId: this.el.id,\r\n          newCaption: newCaption\r\n        });\r\n      }\r\n\r\n      if (shouldFocusHeader) {\r\n        this.#headerRef.focus();\r\n      }\r\n    };\r\n\r\n  #checkIfShouldRemoveEditMode = (event: KeyboardEvent) => {\r\n    event.stopPropagation();\r\n\r\n    if (event.code !== KEY_CODES.ENTER && event.code !== KEY_CODES.ESCAPE) {\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n    const commitEdition = event.code === KEY_CODES.ENTER;\r\n    this.#removeEditMode(true, commitEdition)();\r\n  };\r\n\r\n  #renderAdditionalItems = (additionalItems: ActionListItemAdditionalItem[]) =>\r\n    additionalItems.map(item =>\r\n      (item as ActionListItemAdditionalCustom).jsx\r\n        ? (item as ActionListItemAdditionalCustom).jsx()\r\n        : this.#renderAdditionalItem(\r\n            item as\r\n              | ActionListItemAdditionalBase\r\n              | ActionListItemAdditionalAction\r\n          )\r\n    );\r\n\r\n  #renderAdditionalItem = (\r\n    item: ActionListItemAdditionalBase | ActionListItemAdditionalAction\r\n  ) => {\r\n    const additionalAction = item as ActionListItemAdditionalAction;\r\n    const hasImage = !!item.imgSrc;\r\n    const hasPseudoImage = hasImage && item.imgType !== \"img\";\r\n    const pseudoImageStartClass = hasPseudoImage\r\n      ? startPseudoImageTypeDictionary[item.imgType ?? \"background\"]\r\n      : null;\r\n    const computedPseudoImage = hasPseudoImage\r\n      ? this.#getComputedImage(additionalAction)\r\n      : null;\r\n\r\n    const imageTag =\r\n      hasImage &&\r\n      renderImg(\r\n        \"img\",\r\n        item.part\r\n          ? `${ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM} ${ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_IMAGE} ${item.part}`\r\n          : `${ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM} ${ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_IMAGE}`,\r\n        item.imgSrc,\r\n        item.imgType\r\n      );\r\n\r\n    const action = additionalAction.action;\r\n\r\n    // Button\r\n    if (action) {\r\n      const actionTypeIsFix = action.type === \"fix\";\r\n      const actionTypeIsCustom = action.type === \"custom\";\r\n\r\n      return (\r\n        <button\r\n          key={additionalAction.id}\r\n          aria-label={additionalAction.accessibleName}\r\n          class={{\r\n            \"additional-item\": true,\r\n            [pseudoImageStartClass]: hasPseudoImage && actionTypeIsCustom,\r\n\r\n            // TODO: Add support for these classes\r\n            [computedPseudoImage?.classes]:\r\n              hasPseudoImage && actionTypeIsCustom && !!computedPseudoImage,\r\n            \"show-on-mouse-hover\":\r\n              (actionTypeIsFix && !this.fixed) ||\r\n              (!actionTypeIsFix && action.showOnHover),\r\n            [action.type]: true,\r\n            fixed: actionTypeIsFix && this.fixed,\r\n            \"not-fixed\": actionTypeIsFix && !this.fixed\r\n          }}\r\n          part={tokenMap({\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM]: true,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ACTION]: true,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.DISABLED]: this.disabled,\r\n\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTED]:\r\n              this.selectable && this.selected,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTED]:\r\n              this.selectable && !this.selected,\r\n\r\n            [ACTION_TYPE_PARTS[action.type] satisfies string]: true,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.FIXED]:\r\n              actionTypeIsFix && this.fixed,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_FIXED]:\r\n              actionTypeIsFix && !this.fixed,\r\n\r\n            [item.part]: !!item.part\r\n          })}\r\n          style={\r\n            hasPseudoImage && actionTypeIsCustom\r\n              ? computedPseudoImage?.styles\r\n              : null\r\n          }\r\n          disabled={this.disabled}\r\n          type=\"button\"\r\n          onClick={\r\n            !this.disabled\r\n              ? this.#handleAdditionalItemClick(\r\n                  action.type,\r\n                  actionTypeIsCustom ? action.callback : undefined\r\n                )\r\n              : undefined\r\n          }\r\n        >\r\n          {actionTypeIsCustom && imageTag}\r\n          {item.caption && item.caption}\r\n        </button>\r\n      );\r\n    }\r\n\r\n    // Span\r\n    if (item.caption) {\r\n      return (\r\n        <span\r\n          key={additionalAction.id ?? null}\r\n          class={{\r\n            \"additional-item not-actionable\": true,\r\n            [pseudoImageStartClass]: !!pseudoImageStartClass,\r\n            [computedPseudoImage?.classes]: !!computedPseudoImage\r\n          }}\r\n          part={tokenMap({\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM]: true,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_TEXT]: true,\r\n\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTED]:\r\n              this.selectable && this.selected,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTED]:\r\n              this.selectable && !this.selected,\r\n\r\n            [item.part]: !!item.part\r\n          })}\r\n          style={hasPseudoImage && computedPseudoImage?.styles}\r\n        >\r\n          {imageTag}\r\n          {item.caption}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    // Div with background or mask\r\n    if (hasPseudoImage) {\r\n      return (\r\n        <div\r\n          aria-hidden=\"true\"\r\n          class={{\r\n            \"additional-item not-actionable\": true,\r\n            [imageTypeDictionary[item.imgType ?? \"background\"]]: true,\r\n            [computedPseudoImage?.classes]: !!computedPseudoImage\r\n          }}\r\n          part={tokenMap({\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM]: true,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_IMAGE]: true,\r\n\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTED]:\r\n              this.selectable && this.selected,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTED]:\r\n              this.selectable && !this.selected,\r\n\r\n            [item.part]: !!item.part\r\n          })}\r\n          style={hasPseudoImage && computedPseudoImage?.styles}\r\n        ></div>\r\n      );\r\n    }\r\n\r\n    // Img\r\n    if (hasImage) {\r\n      return imageTag; // TODO: Add the \"additional-item\" class\r\n    }\r\n\r\n    return undefined;\r\n  };\r\n\r\n  #handleAdditionalItemClick =\r\n    (\r\n      type: ActionListItemAdditionalItemActionType[\"type\"],\r\n      callback?: (id: string) => void\r\n    ) =>\r\n    (event: MouseEvent) => {\r\n      event.stopPropagation();\r\n\r\n      if (callback) {\r\n        callback(this.el.id);\r\n      } else {\r\n        this.#additionalItemListenerDictionary[\r\n          // Only \"custom\" type has callbacks\r\n          type as Exclude<\r\n            ActionListItemAdditionalItemActionType[\"type\"],\r\n            \"custom\"\r\n          >\r\n        ]();\r\n      }\r\n    };\r\n\r\n  #setExportParts = () => {\r\n    let exportParts: string | undefined = undefined;\r\n\r\n    if (this.additionalInfo) {\r\n      const parts = computeExportParts(this.additionalInfo);\r\n\r\n      // Additional parts\r\n      if (parts.size > 0) {\r\n        exportParts = `${ACTION_LIST_ITEM_EXPORT_PARTS},${Array.from(\r\n          parts\r\n        ).join(\",\")}`;\r\n      }\r\n    }\r\n\r\n    this.el.setAttribute(\r\n      \"exportparts\",\r\n      exportParts ?? ACTION_LIST_ITEM_EXPORT_PARTS\r\n    );\r\n  };\r\n\r\n  #setActionTypeBlocks = () => {\r\n    this.#deletingSections = computeActionTypeBlocks(\r\n      \"remove\",\r\n      this.additionalInfo\r\n    );\r\n    this.#editingSections = computeActionTypeBlocks(\r\n      \"modify\",\r\n      this.additionalInfo\r\n    );\r\n  };\r\n\r\n  #renderAdditionalInfo = (\r\n    additionalModel: ActionListItemAdditionalModel,\r\n    zoneName: ActionListItemAdditionalInformationSection,\r\n    stretch = false\r\n  ) => {\r\n    if (!additionalModel) {\r\n      return;\r\n    }\r\n\r\n    const zoneNameWithPrefix = `item__${zoneName}` as const;\r\n\r\n    let actionTypeSection:\r\n      | Exclude<\r\n          ActionListItemAdditionalItemActionType[\"type\"],\r\n          \"fix\" | \"custom\"\r\n        >\r\n      | undefined;\r\n    let actionTypeAligns = undefined;\r\n\r\n    // Editing\r\n    if (\r\n      this.editing &&\r\n      this.#editingSections !== undefined &&\r\n      this.#editingSections.some(\r\n        editingSection => editingSection.section === zoneName\r\n      )\r\n    ) {\r\n      actionTypeSection = \"modify\";\r\n      actionTypeAligns = this.#editingSections.find(\r\n        editingSection => editingSection.section === zoneName\r\n      ).align;\r\n    }\r\n    // Deleting\r\n    else if (\r\n      this.deleting &&\r\n      this.#deletingSections !== undefined &&\r\n      this.#deletingSections.some(\r\n        deletingSection => deletingSection.section === zoneName\r\n      )\r\n    ) {\r\n      actionTypeSection = \"remove\";\r\n      actionTypeAligns = this.#deletingSections.find(\r\n        deletingSection => deletingSection.section === zoneName\r\n      ).align;\r\n    }\r\n\r\n    return (\r\n      <div\r\n        key={zoneNameWithPrefix}\r\n        class={`align-container ${zoneName}`}\r\n        part={zoneNameWithPrefix}\r\n      >\r\n        {additionalModel.start && (\r\n          <div\r\n            key={`${zoneNameWithPrefix}-start`}\r\n            class={stretch ? \"align-start valign-start\" : \"align-start\"}\r\n            part={`${zoneNameWithPrefix} start`}\r\n          >\r\n            {actionTypeSection && actionTypeAligns.includes(\"start\")\r\n              ? this.#renderConfirmCancelButtons(actionTypeSection)\r\n              : this.#renderAdditionalItems(additionalModel.start)}\r\n          </div>\r\n        )}\r\n        {additionalModel.center && (\r\n          <div\r\n            key={`${zoneNameWithPrefix}-center`}\r\n            class={stretch ? \"align-center valign-center\" : \"align-center\"}\r\n            part={`${zoneNameWithPrefix} center`}\r\n          >\r\n            {actionTypeSection && actionTypeAligns.includes(\"center\")\r\n              ? this.#renderConfirmCancelButtons(actionTypeSection)\r\n              : this.#renderAdditionalItems(additionalModel.center)}\r\n          </div>\r\n        )}\r\n        {additionalModel.end && (\r\n          <div\r\n            key={`${zoneNameWithPrefix}-end`}\r\n            class={stretch ? \"align-end valign-end\" : \"align-end\"}\r\n            part={`${zoneNameWithPrefix} end`}\r\n          >\r\n            {actionTypeSection && actionTypeAligns.includes(\"end\")\r\n              ? this.#renderConfirmCancelButtons(actionTypeSection)\r\n              : this.#renderAdditionalItems(additionalModel.end)}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  #renderConfirmCancelButtons = (\r\n    action: Exclude<\r\n      ActionListItemAdditionalItemActionType[\"type\"],\r\n      \"fix\" | \"custom\"\r\n    >\r\n  ) => [\r\n    <button\r\n      aria-label={this.#confirmActionsDictionary[action]()}\r\n      title={this.#confirmActionsDictionary[action]()}\r\n      class=\"confirm-action\"\r\n      part={tokenMap({\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM_CONFIRM]: true,\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION_ACCEPT]: true,\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.DISABLED]: this.disabled,\r\n\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTED]:\r\n          this.selectable && this.selected,\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTED]:\r\n          this.selectable && !this.selected\r\n      })}\r\n      disabled={this.disabled}\r\n      type=\"button\"\r\n      onClick={!this.disabled ? this.#acceptAction(action) : undefined}\r\n    ></button>,\r\n\r\n    <button\r\n      aria-label={this.#cancelActionsDictionary[action]()}\r\n      title={this.#cancelActionsDictionary[action]()}\r\n      class=\"cancel-action\"\r\n      part={tokenMap({\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.ADDITIONAL_ITEM_CONFIRM]: true,\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION_CANCEL]: true,\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.DISABLED]: this.disabled,\r\n\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTED]:\r\n          this.selectable && this.selected,\r\n        [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTED]:\r\n          this.selectable && !this.selected\r\n      })}\r\n      disabled={this.disabled}\r\n      type=\"button\"\r\n      onClick={!this.disabled ? this.#cancelAction : undefined}\r\n    ></button>\r\n  ];\r\n\r\n  #acceptAction =\r\n    (action: ActionListItemAdditionalItemActionType[\"type\"]) =>\r\n    (event: PointerEvent) => {\r\n      event.stopPropagation();\r\n\r\n      if (action === \"modify\") {\r\n        this.#removeEditMode(true, true)();\r\n      } else if (action === \"remove\") {\r\n        this.remove.emit(this.el.id);\r\n      }\r\n    };\r\n\r\n  #cancelAction = (event: PointerEvent) => {\r\n    event.stopPropagation();\r\n\r\n    this.editing = false;\r\n    this.deleting = false;\r\n  };\r\n\r\n  #getComputedImage = (\r\n    additionalItem: ActionListItemAdditionalBase\r\n  ): GxImageMultiStateStart | null => {\r\n    if (!additionalItem.imgSrc) {\r\n      return null;\r\n    }\r\n\r\n    // TODO: If we migrate this component to Lit, we should improve the\r\n    // efficiency of this lookup\r\n    const getImagePathCallback: ActionListImagePathCallback =\r\n      this.getImagePathCallback ??\r\n      getControlRegisterProperty(\r\n        \"getImagePathCallback\",\r\n        \"ch-action-list-render\"\r\n      ) ??\r\n      DEFAULT_GET_IMAGE_PATH_CALLBACK;\r\n\r\n    const img = getImagePathCallback(additionalItem);\r\n\r\n    return img\r\n      ? (updateDirectionInImageCustomVar(\r\n          img,\r\n          \"start\"\r\n        ) as GxImageMultiStateStart)\r\n      : null;\r\n  };\r\n\r\n  connectedCallback() {\r\n    this.el.setAttribute(\"role\", \"listitem\");\r\n    this.el.setAttribute(\"part\", ACTION_LIST_PARTS_DICTIONARY.ITEM);\r\n    this.#setExportParts();\r\n    this.#setActionTypeBlocks();\r\n  }\r\n\r\n  render() {\r\n    const additionalInfo = this.additionalInfo;\r\n    const hasAdditionalInfo = !!this.additionalInfo;\r\n\r\n    const stretchStart = hasAdditionalInfo && additionalInfo[\"stretch-start\"];\r\n    const blockStart = hasAdditionalInfo && additionalInfo[\"block-start\"];\r\n    const inlineCaption = hasAdditionalInfo && additionalInfo[\"inline-caption\"];\r\n    const blockEnd = hasAdditionalInfo && additionalInfo[\"block-end\"];\r\n    const stretchEnd = hasAdditionalInfo && additionalInfo[\"stretch-end\"];\r\n\r\n    const hasParts = !!this.parts;\r\n\r\n    return (\r\n      <Host aria-selected={this.selectable && this.selected ? \"true\" : null}>\r\n        <button\r\n          class=\"action\"\r\n          disabled={this.disabled}\r\n          part={tokenMap({\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.ACTION]: true,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NESTED]: this.nested,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NESTED_EXPANDABLE]:\r\n              this.nestedExpandable,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTABLE]: this.selectable,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTABLE]:\r\n              !this.selectable,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.SELECTED]:\r\n              this.selectable && this.selected,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_SELECTED]:\r\n              this.selectable && !this.selected,\r\n            [ACTION_LIST_ITEM_PARTS_DICTIONARY.DISABLED]: this.disabled\r\n          })}\r\n          type=\"button\"\r\n          ref={el => (this.#headerRef = el)}\r\n        >\r\n          {this.#renderAdditionalInfo(stretchStart, \"stretch-start\", true)}\r\n          {this.#renderAdditionalInfo(blockStart, \"block-start\")}\r\n\r\n          <div\r\n            key=\"item__inline-caption\"\r\n            class=\"align-container inline-caption\"\r\n            part={tokenMap({\r\n              \"item__inline-caption\": true,\r\n\r\n              [ACTION_LIST_ITEM_PARTS_DICTIONARY.EDITING]: this.editing,\r\n              [ACTION_LIST_ITEM_PARTS_DICTIONARY.NOT_EDITING]: !this.editing\r\n            })}\r\n          >\r\n            {this.editing ? (\r\n              <ch-edit\r\n                autoFocus\r\n                part={\r\n                  hasParts\r\n                    ? `${ACTION_LIST_ITEM_PARTS_DICTIONARY.EDIT_CAPTION} ${this.parts}`\r\n                    : ACTION_LIST_ITEM_PARTS_DICTIONARY.EDIT_CAPTION\r\n                }\r\n                disabled={this.disabled}\r\n                value={this.caption}\r\n                onKeyDown={\r\n                  !this.disabled ? this.#checkIfShouldRemoveEditMode : undefined\r\n                }\r\n                ref={el => (this.#inputRef = el)}\r\n              ></ch-edit>\r\n            ) : (\r\n              this.caption && (\r\n                <span part={ACTION_LIST_ITEM_PARTS_DICTIONARY.CAPTION}>\r\n                  {this.caption}\r\n                </span>\r\n              )\r\n            )}\r\n\r\n            {inlineCaption && [\r\n              inlineCaption.start && (\r\n                <div\r\n                  key=\"item__inline-caption-start\"\r\n                  class=\"align-start\"\r\n                  part=\"item__inline-caption start\"\r\n                >\r\n                  {this.#renderAdditionalItems(inlineCaption.start)}\r\n                </div>\r\n              ),\r\n              inlineCaption.end && (\r\n                <div\r\n                  key=\"item__inline-caption-end\"\r\n                  class=\"align-end\"\r\n                  part=\"item__inline-caption end\"\r\n                >\r\n                  {this.#renderAdditionalItems(inlineCaption.end)}\r\n                </div>\r\n              )\r\n            ]}\r\n          </div>\r\n\r\n          {this.#renderAdditionalInfo(blockEnd, \"block-end\")}\r\n          {this.#renderAdditionalInfo(stretchEnd, \"stretch-end\")}\r\n        </button>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n","import {\r\n  ActionListItemActionable,\r\n  ActionListItemGroup,\r\n  ActionListItemModelExtended,\r\n  ActionListItemModelExtendedGroup,\r\n  ActionListItemModelExtendedRoot,\r\n  ActionListModel\r\n} from \"./types\";\r\n\r\n// Tags\r\nexport const ACTION_LIST_ITEM_TAG = \"ch-action-list-item\";\r\nexport const ACTION_LIST_GROUP_TAG = \"ch-action-list-group\";\r\n\r\n// Selectors\r\nexport const ACTION_LIST_ITEM_SELECTOR = (id: string) =>\r\n  `${ACTION_LIST_ITEM_TAG}[id=\"${id}\"]`;\r\n\r\nexport const ACTION_LIST_GROUP_SELECTOR = (id: string) =>\r\n  `${ACTION_LIST_GROUP_TAG}[id=\"${id}\"]`;\r\n\r\nexport const getActionListOrGroupItemFromEvent = (\r\n  event: KeyboardEvent | PointerEvent\r\n): HTMLChActionListItemElement | HTMLChActionListGroupElement | undefined => {\r\n  event.stopPropagation();\r\n\r\n  return event.composedPath().find(el => {\r\n    const tagName = (el as HTMLElement).tagName?.toLowerCase();\r\n\r\n    return (\r\n      tagName === ACTION_LIST_ITEM_TAG || tagName === ACTION_LIST_GROUP_TAG\r\n    );\r\n  }) as HTMLChActionListItemElement | HTMLChActionListGroupElement | undefined;\r\n};\r\n\r\nexport const getActionListOrGroupItemIndex = (\r\n  item: ActionListItemActionable | ActionListItemGroup,\r\n  items: ActionListModel\r\n) =>\r\n  items.findIndex(\r\n    (el: ActionListItemActionable | ActionListItemGroup) =>\r\n      el.id && el.id === item.id\r\n  );\r\n\r\nexport const getParentArray = (itemUIModel: ActionListItemModelExtended) =>\r\n  (itemUIModel as ActionListItemModelExtendedRoot).root ??\r\n  (itemUIModel as ActionListItemModelExtendedGroup).parentItem.items;\r\n\r\nexport const getActionListItemOrGroupInfo = (\r\n  itemId: string,\r\n  flattenedModel: Map<string, ActionListItemModelExtended>\r\n) =>\r\n  flattenedModel.get(itemId).item as\r\n    | ActionListItemActionable\r\n    | ActionListItemGroup;\r\n","import { KEY_CODES } from \"../../common/reserved-names\";\r\nimport { ChameleonControlsTagName } from \"../../common/types\";\r\nimport { focusComposedPath, mouseEventModifierKey } from \"../common/helpers\";\r\nimport {\r\n  ActionListItemActionable,\r\n  ActionListItemGroup,\r\n  ActionListItemModelExtended,\r\n  ActionListItemModelExtendedGroup,\r\n  ActionListItemModelExtendedRoot,\r\n  ActionListModel\r\n} from \"./types\";\r\nimport {\r\n  ACTION_LIST_GROUP_SELECTOR,\r\n  ACTION_LIST_ITEM_SELECTOR,\r\n  getActionListOrGroupItemFromEvent,\r\n  getActionListOrGroupItemIndex\r\n} from \"./utils\";\r\n\r\nconst EDIT_KEY = KEY_CODES.F2;\r\nconst ACTION_LIST_ITEM_TAG_NAME =\r\n  \"ch-action-list-item\" satisfies ChameleonControlsTagName;\r\n\r\nconst isActionListItem = (element: HTMLElement) =>\r\n  element.tagName.toLowerCase() === ACTION_LIST_ITEM_TAG_NAME;\r\n\r\nconst getFocusedActionListItem = (): HTMLChActionListItemElement | undefined =>\r\n  focusComposedPath().find(isActionListItem) as HTMLChActionListItemElement;\r\n\r\nconst focusItemById = (\r\n  itemInfo: ActionListItemActionable | ActionListItemGroup,\r\n  actionListRef: HTMLChActionListRenderElement,\r\n  event: KeyboardEvent\r\n) => {\r\n  const itemRef = actionListRef.shadowRoot.querySelector(\r\n    itemInfo.type === \"actionable\"\r\n      ? ACTION_LIST_ITEM_SELECTOR(itemInfo.id)\r\n      : ACTION_LIST_GROUP_SELECTOR(itemInfo.id)\r\n  ) as HTMLChActionListItemElement | HTMLChActionListGroupElement;\r\n\r\n  const ctrlKeyIsPressed = mouseEventModifierKey(event);\r\n\r\n  if (itemInfo.type === \"group\") {\r\n    (itemRef as HTMLChActionListGroupElement).setFocus();\r\n\r\n    // Trigger item selection when the ctrl key is not pressed\r\n    if (!ctrlKeyIsPressed) {\r\n      // TODO: Update item selection\r\n    }\r\n  } else {\r\n    itemRef.focus();\r\n\r\n    // Trigger item selection when the ctrl key is not pressed\r\n    if (!ctrlKeyIsPressed) {\r\n      itemRef.click();\r\n    }\r\n  }\r\n};\r\n\r\nconst getAndCheckItem = (\r\n  event: KeyboardEvent,\r\n  flattenedModel: Map<string, ActionListItemModelExtended>\r\n) => {\r\n  event.preventDefault();\r\n  const eventTarget = getActionListOrGroupItemFromEvent(event);\r\n\r\n  return eventTarget ? flattenedModel.get(eventTarget.id) : undefined;\r\n};\r\n\r\nconst groupIsCollapsed = (group: ActionListItemGroup) =>\r\n  group.expandable && group.expanded !== true;\r\n\r\nconst focusNextItemFirstLevel = (\r\n  startIndex: number,\r\n  items: ActionListModel,\r\n  currentFocusedId: string,\r\n  actionListRef: HTMLChActionListRenderElement,\r\n  event: KeyboardEvent,\r\n  increment: 1 | -1 // Determine the ARROW/focus direction\r\n) => {\r\n  for (\r\n    let firstLevelIndex = startIndex;\r\n    0 <= firstLevelIndex && firstLevelIndex <= items.length;\r\n    firstLevelIndex += increment\r\n  ) {\r\n    const firstLevelSibling = items[firstLevelIndex];\r\n\r\n    if (\r\n      (firstLevelSibling.type === \"actionable\" &&\r\n        !firstLevelSibling.disabled) ||\r\n      // Group\r\n      (firstLevelSibling.type === \"group\" &&\r\n        !firstLevelSibling.disabled &&\r\n        ((firstLevelSibling.expandable &&\r\n          firstLevelSibling.id !== currentFocusedId &&\r\n          increment === 1) ||\r\n          groupIsCollapsed(firstLevelSibling)))\r\n    ) {\r\n      focusItemById(firstLevelSibling, actionListRef, event);\r\n      return;\r\n    }\r\n    // The group is either expandable and it's expanded or it's always expanded (expandable !== true)\r\n    if (\r\n      firstLevelSibling.type === \"group\" &&\r\n      !firstLevelSibling.disabled &&\r\n      !groupIsCollapsed(firstLevelSibling)\r\n    ) {\r\n      const anItemWasFocused = focusNextItemSecondLevel(\r\n        // Depending on the increment, its starts at the beginning or the end of the array\r\n        increment === 1 ? 0 : firstLevelSibling.items.length - 1,\r\n        firstLevelSibling.items,\r\n        actionListRef,\r\n        event,\r\n        increment\r\n      );\r\n\r\n      if (anItemWasFocused) {\r\n        return;\r\n      }\r\n\r\n      // Focus the parent group if any element of the second level can be focused,\r\n      // the parent is expandable (it means its focusable) and the focus direction is up\r\n      if (firstLevelSibling.expandable && increment === -1) {\r\n        focusItemById(firstLevelSibling, actionListRef, event);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Try to focus an item of a group level (second level).\r\n * @returns if an item was focused\r\n */\r\nfunction focusNextItemSecondLevel(\r\n  startIndex: number,\r\n  items: ActionListItemActionable[],\r\n  actionListRef: HTMLChActionListRenderElement,\r\n  event: KeyboardEvent,\r\n  increment: 1 | -1\r\n): boolean {\r\n  for (\r\n    let firstLevelIndex = startIndex;\r\n    0 <= firstLevelIndex && firstLevelIndex <= items.length - 1;\r\n    firstLevelIndex += increment\r\n  ) {\r\n    const firstLevelSibling = items[firstLevelIndex];\r\n\r\n    if (!firstLevelSibling.disabled) {\r\n      focusItemById(firstLevelSibling, actionListRef, event);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nconst keyboardDictionary = {\r\n  [KEY_CODES.ARROW_UP]: (\r\n    actionListRef: HTMLChActionListRenderElement,\r\n    flattenedModel: Map<string, ActionListItemModelExtended>,\r\n    event: KeyboardEvent\r\n  ) => {\r\n    const itemUIModel = getAndCheckItem(event, flattenedModel);\r\n    if (!itemUIModel) {\r\n      return;\r\n    }\r\n    const itemInfo = itemUIModel.item as\r\n      | ActionListItemActionable\r\n      | ActionListItemGroup;\r\n\r\n    // First level (root level)\r\n    if ((itemUIModel as ActionListItemModelExtendedRoot).root) {\r\n      const root = (itemUIModel as ActionListItemModelExtendedRoot).root;\r\n      const itemIndex = getActionListOrGroupItemIndex(itemInfo, root);\r\n\r\n      focusNextItemFirstLevel(\r\n        itemIndex - 1,\r\n        root,\r\n        itemInfo.id,\r\n        actionListRef,\r\n        event,\r\n        -1\r\n      );\r\n    }\r\n    // Second level (group level)\r\n    else {\r\n      const parentItem = (itemUIModel as ActionListItemModelExtendedGroup)\r\n        .parentItem;\r\n      const root = (\r\n        flattenedModel.get(parentItem.id) as ActionListItemModelExtendedRoot\r\n      ).root;\r\n\r\n      const secondLevelIndex = getActionListOrGroupItemIndex(\r\n        itemInfo,\r\n        parentItem.items\r\n      );\r\n\r\n      const anItemWasFocused = focusNextItemSecondLevel(\r\n        secondLevelIndex - 1,\r\n        parentItem.items,\r\n        actionListRef,\r\n        event,\r\n        -1\r\n      );\r\n\r\n      if (anItemWasFocused) {\r\n        return;\r\n      }\r\n\r\n      // Focus the parent group if any element of the second level can be focused\r\n      // and the parent is expandable (it means its focusable)\r\n      if (parentItem.expandable) {\r\n        focusItemById(parentItem, actionListRef, event);\r\n        return;\r\n      }\r\n\r\n      const firstLevelIndex = getActionListOrGroupItemIndex(parentItem, root);\r\n      focusNextItemFirstLevel(\r\n        firstLevelIndex - 1,\r\n        root,\r\n        itemInfo.id,\r\n        actionListRef,\r\n        event,\r\n        -1\r\n      );\r\n    }\r\n  },\r\n\r\n  [KEY_CODES.ARROW_DOWN]: (\r\n    actionListRef: HTMLChActionListRenderElement,\r\n    flattenedModel: Map<string, ActionListItemModelExtended>,\r\n    event: KeyboardEvent\r\n  ) => {\r\n    const itemUIModel = getAndCheckItem(event, flattenedModel);\r\n    if (!itemUIModel) {\r\n      return;\r\n    }\r\n    const itemInfo = itemUIModel.item as\r\n      | ActionListItemActionable\r\n      | ActionListItemGroup;\r\n\r\n    // First level (root level)\r\n    if ((itemUIModel as ActionListItemModelExtendedRoot).root) {\r\n      const root = (itemUIModel as ActionListItemModelExtendedRoot).root;\r\n      const itemIndex = getActionListOrGroupItemIndex(itemInfo, root);\r\n\r\n      focusNextItemFirstLevel(\r\n        itemInfo.type === \"group\" && !groupIsCollapsed(itemInfo)\r\n          ? itemIndex\r\n          : itemIndex + 1,\r\n        root,\r\n        itemInfo.id,\r\n        actionListRef,\r\n        event,\r\n        1\r\n      );\r\n    }\r\n    // Second level (group level)\r\n    else {\r\n      const parentItem = (itemUIModel as ActionListItemModelExtendedGroup)\r\n        .parentItem;\r\n      const root = (\r\n        flattenedModel.get(parentItem.id) as ActionListItemModelExtendedRoot\r\n      ).root;\r\n\r\n      const secondLevelIndex = getActionListOrGroupItemIndex(\r\n        itemInfo,\r\n        parentItem.items\r\n      );\r\n\r\n      const anItemWasFocused = focusNextItemSecondLevel(\r\n        secondLevelIndex + 1,\r\n        parentItem.items,\r\n        actionListRef,\r\n        event,\r\n        1\r\n      );\r\n\r\n      if (anItemWasFocused) {\r\n        return;\r\n      }\r\n\r\n      const firstLevelIndex = getActionListOrGroupItemIndex(parentItem, root);\r\n      focusNextItemFirstLevel(\r\n        firstLevelIndex + 1,\r\n        root,\r\n        itemInfo.id,\r\n        actionListRef,\r\n        event,\r\n        1\r\n      );\r\n    }\r\n  },\r\n\r\n  [EDIT_KEY]: (actionListRef, _, event) => {\r\n    const actionListItem = getFocusedActionListItem();\r\n\r\n    // TODO: Add support to edit items even if editable === undefined. This case\r\n    // applies when an item has a \"modify\" type action\r\n    if (\r\n      !actionListItem ||\r\n      (!actionListItem.editable && !actionListRef.editableItems) ||\r\n      actionListItem.editing ||\r\n      actionListItem.deleting ||\r\n      actionListItem.disabled\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n    actionListItem.editing = true;\r\n  }\r\n} satisfies {\r\n  [key: string]: (\r\n    actionListRef: HTMLChActionListRenderElement,\r\n    flattenedModel: Map<string, ActionListItemModelExtended>,\r\n    event: KeyboardEvent\r\n  ) => void;\r\n};\r\n\r\nexport const actionListKeyboardNavigation =\r\n  (\r\n    actionListRef: HTMLChActionListRenderElement,\r\n    flattenedModel: Map<string, ActionListItemModelExtended>\r\n  ) =>\r\n  (event: KeyboardEvent) => {\r\n    const keyboardEventHandler = keyboardDictionary[event.code];\r\n\r\n    if (keyboardEventHandler) {\r\n      keyboardEventHandler(actionListRef, flattenedModel, event);\r\n    }\r\n  };\r\n","import {\r\n  ActionListItemModel,\r\n  ActionListItemModelExtended,\r\n  ActionListItemType,\r\n  ActionListModel\r\n} from \"./types\";\r\nimport { getParentArray } from \"./utils\";\r\n\r\nexport const updateItemProperty = (\r\n  itemId: string,\r\n  propertiesToUpdate: Partial<ActionListItemModel> & {\r\n    type: ActionListItemType;\r\n  },\r\n  flattenedTreeModel: Map<string, ActionListItemModelExtended>,\r\n  newSelectedItems: Set<string>\r\n): ActionListModel | undefined => {\r\n  const itemUIModel = flattenedTreeModel.get(itemId);\r\n  if (!itemUIModel) {\r\n    return undefined;\r\n  }\r\n  const itemInfo = itemUIModel.item;\r\n\r\n  // Types doesn't match\r\n  if (propertiesToUpdate.type !== itemInfo.type) {\r\n    return undefined;\r\n  }\r\n\r\n  // Update properties\r\n  for (const propertyName in propertiesToUpdate) {\r\n    const propertyValue = propertiesToUpdate[propertyName];\r\n\r\n    if (propertyValue !== undefined) {\r\n      itemInfo[propertyName] = propertyValue;\r\n    }\r\n  }\r\n\r\n  if (propertiesToUpdate.type === \"separator\") {\r\n    return undefined;\r\n  }\r\n\r\n  // Accumulate selection/deselection\r\n  if (propertiesToUpdate.selected) {\r\n    newSelectedItems.add(itemId);\r\n  } else if (propertiesToUpdate.selected === false) {\r\n    newSelectedItems.delete(itemId);\r\n  }\r\n\r\n  return getParentArray(itemUIModel);\r\n};\r\n","export type ActionListTranslations = {\r\n  // confirm: string;\r\n  // cancel: string;\r\n  confirmDelete: string;\r\n  cancelDelete: string;\r\n  confirmModify: string;\r\n  cancelModify: string;\r\n\r\n  // pin: string;\r\n  // unpin: string;\r\n  // delete: string;\r\n  // modify: string;\r\n};\r\n\r\nexport const actionListDefaultTranslations = Object.freeze({\r\n  // confirm: \"Confirm\",\r\n  // cancel: \"Cancel\",\r\n\r\n  confirmDelete: \"Confirm delete\",\r\n  cancelDelete: \"Cancel delete\",\r\n  confirmModify: \"Confirm modification\",\r\n  cancelModify: \"Cancel modification\"\r\n\r\n  // pin: \"Pin\",\r\n  // unpin: \"Unpin\",\r\n  // delete: \"Delete\",\r\n  // modify: \"Modify\"\r\n}) satisfies Readonly<ActionListTranslations>;\r\n","import { ChActionListRender } from \"./action-list-render\";\r\nimport { ActionListItemModelExtended, ActionListModel } from \"./types\";\r\nimport { getActionListItemOrGroupInfo } from \"./utils\";\r\n\r\nexport const setActionListSelectedItems = (\r\n  model: ActionListModel,\r\n  selectedItems: Set<string>\r\n) => {\r\n  for (let index = 0; index < model.length; index++) {\r\n    const itemUIModel = model[index];\r\n\r\n    if (itemUIModel.type === \"actionable\" && itemUIModel.selected) {\r\n      selectedItems.add(itemUIModel.id);\r\n    } else if (itemUIModel.type === \"group\" && itemUIModel.items != null) {\r\n      setActionListSelectedItems(itemUIModel.items, selectedItems);\r\n    }\r\n  }\r\n};\r\n\r\nexport const selectedItemsDiffer = (\r\n  currentSelectedItems: Set<string>,\r\n  newSelectedItems: Set<string>\r\n): boolean => {\r\n  if (currentSelectedItems.size !== newSelectedItems.size) {\r\n    return true;\r\n  }\r\n\r\n  // Check if every item is on both Sets\r\n  for (const key of currentSelectedItems) {\r\n    if (!newSelectedItems.has(key)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\nconst removeAllSelectedItemsExceptForTheLast = (\r\n  selectedItems: Set<string>,\r\n  flattenedModel: Map<string, ActionListItemModelExtended>\r\n) => {\r\n  const selectedItemsArray = [...selectedItems.values()];\r\n  const lastItemIndex = selectedItems.size - 1;\r\n\r\n  // Deselect all items except the last\r\n  for (let index = 0; index < lastItemIndex; index++) {\r\n    const itemId = selectedItemsArray[index];\r\n    getActionListItemOrGroupInfo(itemId, flattenedModel).selected = false;\r\n  }\r\n\r\n  // Create a new Set with only the last item\r\n  selectedItems.clear();\r\n  selectedItems.add(selectedItemsArray[lastItemIndex]);\r\n};\r\n\r\nexport const selectedItemsChangeShouldBeEmitted = (\r\n  currentSelectedItems: Set<string>,\r\n  newSelectedItems: Set<string>,\r\n  flattenedModel: Map<string, ActionListItemModelExtended>,\r\n  selection: ChActionListRender[\"selection\"]\r\n): boolean => {\r\n  if (selection === \"single\") {\r\n    if (newSelectedItems.size > 1) {\r\n      removeAllSelectedItemsExceptForTheLast(newSelectedItems, flattenedModel);\r\n      return true;\r\n    }\r\n    if (selectedItemsDiffer(currentSelectedItems, newSelectedItems)) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n  if (selectedItemsDiffer(currentSelectedItems, newSelectedItems)) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n","import {\r\n  ActionListItemActionable,\r\n  ActionListItemGroup,\r\n  ActionListItemModelExtended,\r\n  ActionListModel\r\n} from \"./types\";\r\n\r\nconst flattenSubUIModel = (\r\n  model: ActionListItemActionable[],\r\n  parentItem: ActionListItemGroup,\r\n  flattenedModel: Map<string, ActionListItemModelExtended>,\r\n  sortModel: (model: ActionListModel) => void\r\n) => {\r\n  if (!model) {\r\n    return;\r\n  }\r\n\r\n  // Traditional for loop is the faster \"for\"\r\n  for (let index = 0; index < model.length; index++) {\r\n    const itemInfo = model[index];\r\n    flattenedModel.set(itemInfo.id, {\r\n      item: itemInfo,\r\n      parentItem: parentItem\r\n    });\r\n  }\r\n\r\n  sortModel(model);\r\n};\r\n\r\nexport const flattenActionListUIModel = (\r\n  model: ActionListModel,\r\n  flattenedModel: Map<string, ActionListItemModelExtended>,\r\n  sortModel: (model: ActionListModel) => void\r\n) => {\r\n  flattenedModel.clear();\r\n\r\n  if (!model) {\r\n    return;\r\n  }\r\n\r\n  // Traditional for loop is the faster \"for\"\r\n  for (let index = 0; index < model.length; index++) {\r\n    const itemInfo = model[index];\r\n\r\n    // Group\r\n    if (itemInfo.type === \"group\") {\r\n      flattenedModel.set(itemInfo.id, { item: itemInfo, root: model });\r\n      flattenSubUIModel(itemInfo.items, itemInfo, flattenedModel, sortModel);\r\n    }\r\n    // Actionable\r\n    else if (itemInfo.type === \"actionable\") {\r\n      flattenedModel.set(itemInfo.id, { item: itemInfo, root: model });\r\n    }\r\n  }\r\n\r\n  sortModel(model);\r\n};\r\n","@import \"../../common/base\";\r\n@import \"../../common/icons\";\r\n\r\n@include box-sizing();\r\n\r\n:host {\r\n  /**\r\n   * @prop --ch-action-list-item__image-size:\r\n   * Specifies the box size that contains the images for the additional images.\r\n   * @default #{$default-decorative-image-size}\r\n   */\r\n  --ch-action-list-item__image-size: #{$default-decorative-image-size};\r\n\r\n  /**\r\n   * @prop --ch-action-list-item__background-image-size:\r\n   * Specifies the image size of the additional images.\r\n   * @default 100%\r\n   */\r\n  --ch-action-list-item__background-image-size: 100%;\r\n\r\n  /**\r\n   * @prop --ch-action-list-group__expandable-button-size:\r\n   * Specifies the box size that contains the expandable button image.\r\n   * @default #{$default-decorative-image-size}\r\n   */\r\n  --ch-action-list-group__expandable-button-size: #{$default-decorative-image-size};\r\n\r\n  /**\r\n   * @prop --ch-action-list-group__expandable-button-image-size:\r\n   * Specifies the image size of the expandable button.\r\n   * @default 100%\r\n   */\r\n  --ch-action-list-group__expandable-button-image-size: 100%;\r\n\r\n  --ch-action-list-item__additional-item-fixed-image: #{$unpin-outlined};\r\n  --ch-action-list-item__additional-item-not-fixed-image: #{$pin-outlined};\r\n  --ch-action-list-item__additional-item-remove-image: #{$remove};\r\n  --ch-action-list-item__additional-item-modify-image: #{$edit};\r\n  --ch-action-list-item__additional-item-confirm-image: #{$confirm-icon};\r\n  --ch-action-list-item__additional-item-cancel-image: #{$close-icon};\r\n\r\n  --ch-action-list-item__action-color: currentColor;\r\n\r\n  display: grid;\r\n  grid-auto-rows: max-content;\r\n  block-size: 100%;\r\n  overflow: auto;\r\n  contain: size;\r\n}\r\n\r\n.separator {\r\n  display: grid;\r\n  block-size: 1px;\r\n  background-color: currentColor;\r\n}\r\n","import {\r\n  Component,\r\n  Element,\r\n  Host,\r\n  h,\r\n  Prop,\r\n  State,\r\n  Listen,\r\n  Watch,\r\n  forceUpdate,\r\n  Event,\r\n  EventEmitter,\r\n  Method\r\n  // EventEmitter\r\n} from \"@stencil/core\";\r\nimport {\r\n  ActionListImagePathCallback,\r\n  ActionListItemActionable,\r\n  ActionListItemGroup,\r\n  ActionListItemModel,\r\n  ActionListItemModelExtended,\r\n  ActionListItemModelExtendedGroup,\r\n  ActionListItemModelExtendedRoot,\r\n  ActionListItemModelMap,\r\n  ActionListItemType,\r\n  ActionListModel\r\n} from \"./types\";\r\nimport {\r\n  ActionListTranslations,\r\n  ChActionListItemCustomEvent\r\n} from \"../../components\";\r\nimport {\r\n  ActionListCaptionChangeEventDetail,\r\n  ActionListFixedChangeEventDetail\r\n} from \"./internal/action-list-item/types\";\r\nimport { mouseEventModifierKey } from \"../common/helpers\";\r\nimport { removeElement } from \"../../common/array\";\r\nimport { SCROLLABLE_CLASS } from \"../../common/reserved-names\";\r\nimport { adoptCommonThemes } from \"../../common/theme\";\r\nimport { actionListKeyboardNavigation } from \"./keyboard-navigation\";\r\nimport {\r\n  ACTION_LIST_ITEM_TAG,\r\n  getActionListItemOrGroupInfo,\r\n  getActionListOrGroupItemFromEvent,\r\n  getParentArray\r\n} from \"./utils\";\r\nimport { updateItemProperty } from \"./update-item-property\";\r\nimport { actionListDefaultTranslations } from \"./translations\";\r\nimport {\r\n  selectedItemsChangeShouldBeEmitted,\r\n  setActionListSelectedItems\r\n} from \"./selections\";\r\nimport { flattenActionListUIModel } from \"./flatten-model\";\r\n\r\nconst DEFAULT_EDITABLE_ITEMS_VALUE = true;\r\n// const DEFAULT_ORDER_VALUE = 0;\r\n\r\n// const defaultGetImagePath: ActionListImagePathCallback = (imgSrc: string) =>\r\n//   imgSrc;\r\n\r\nconst renderMapping: {\r\n  [key in ActionListItemType]: (\r\n    itemModel: ActionListItemModelMap[key],\r\n    actionRenderState: ChActionListRender,\r\n    disabled?: boolean,\r\n    nested?: boolean,\r\n    nestedExpandable?: boolean\r\n  ) => any;\r\n} = {\r\n  actionable: (\r\n    itemModel,\r\n    actionListRenderState,\r\n    disabled: boolean,\r\n    nested = false,\r\n    nestedExpandable = false\r\n  ) => (\r\n    <ch-action-list-item\r\n      key={itemModel.id}\r\n      id={itemModel.id}\r\n      additionalInfo={itemModel.additionalInformation}\r\n      caption={itemModel.caption}\r\n      checkbox={itemModel.checkbox ?? actionListRenderState.checkbox}\r\n      checked={itemModel.checked ?? actionListRenderState.checked}\r\n      disabled={\r\n        disabled === true\r\n          ? true\r\n          : itemModel.disabled ?? actionListRenderState.disabled\r\n      }\r\n      editable={itemModel.editable ?? actionListRenderState.editableItems}\r\n      fixed={itemModel.fixed}\r\n      getImagePathCallback={actionListRenderState.getImagePathCallback}\r\n      metadata={itemModel.metadata}\r\n      nested={nested}\r\n      nestedExpandable={nestedExpandable}\r\n      selectable={actionListRenderState.selection !== \"none\"}\r\n      selected={itemModel.selected}\r\n      translations={actionListRenderState.translations}\r\n    ></ch-action-list-item>\r\n  ),\r\n  group: (itemModel, actionListRenderState) => (\r\n    <ch-action-list-group\r\n      key={itemModel.id}\r\n      id={itemModel.id}\r\n      caption={itemModel.caption}\r\n      disabled={itemModel.disabled ?? actionListRenderState.disabled}\r\n      expandable={itemModel.expandable}\r\n      expanded={itemModel.expanded}\r\n      selected={itemModel.selected}\r\n    >\r\n      {itemModel.items?.map(item =>\r\n        actionListRenderState.renderItem(\r\n          item,\r\n          actionListRenderState,\r\n          itemModel.disabled,\r\n          true,\r\n          itemModel.expandable\r\n        )\r\n      )}\r\n    </ch-action-list-group>\r\n  ),\r\n  separator: () => (\r\n    <div\r\n      role=\"separator\"\r\n      aria-hidden=\"true\"\r\n      class=\"separator\"\r\n      part=\"separator\"\r\n    ></div>\r\n  )\r\n};\r\n\r\nconst defaultRenderItem = (\r\n  itemModel: ActionListItemModel,\r\n  actionListRenderState: ChActionListRender,\r\n  disabled?: boolean,\r\n  nested?: boolean,\r\n  nestedExpandable?: boolean\r\n) =>\r\n  itemModel.type === \"actionable\"\r\n    ? renderMapping.actionable(\r\n        itemModel as any, // THIS IS A WA\r\n        actionListRenderState,\r\n        disabled,\r\n        nested,\r\n        nestedExpandable\r\n      )\r\n    : renderMapping[itemModel.type](\r\n        itemModel as any, // THIS IS A WA\r\n        actionListRenderState\r\n      );\r\n\r\nconst FIRST_ITEM_GREATER_THAN_SECOND = -1;\r\nconst SECOND_ITEM_GREATER_THAN_FIRST = 0;\r\n\r\nconst defaultSortItemsCallback = (subModel: ActionListItemModel[]): void => {\r\n  subModel.sort((a, b) => {\r\n    // Rules:\r\n    //   - Checks fixed value.\r\n    //   - If can't decide, checks \"order\" value.\r\n    //   - If can't decide, checks \"caption\" value.\r\n\r\n    // Both, \"a\" and \"b\" are fixed\r\n    if (a.type === \"actionable\" && b.type === \"actionable\") {\r\n      if (a.fixed && !b.fixed) {\r\n        return FIRST_ITEM_GREATER_THAN_SECOND;\r\n      }\r\n\r\n      if (!a.fixed && b.fixed) {\r\n        return SECOND_ITEM_GREATER_THAN_FIRST;\r\n      }\r\n    }\r\n    // Only \"a\" is fixed\r\n    else if (a.type === \"actionable\" && a.fixed) {\r\n      return FIRST_ITEM_GREATER_THAN_SECOND;\r\n    }\r\n    // Only \"b\" is fixed\r\n    else if (b.type === \"actionable\" && b.fixed) {\r\n      return SECOND_ITEM_GREATER_THAN_FIRST;\r\n    }\r\n\r\n    if (a.order < b.order) {\r\n      return FIRST_ITEM_GREATER_THAN_SECOND;\r\n    }\r\n\r\n    if (a.order > b.order) {\r\n      return SECOND_ITEM_GREATER_THAN_FIRST;\r\n    }\r\n\r\n    return a.type === \"actionable\" &&\r\n      b.type === \"actionable\" &&\r\n      a.caption <= b.caption\r\n      ? FIRST_ITEM_GREATER_THAN_SECOND\r\n      : SECOND_ITEM_GREATER_THAN_FIRST;\r\n  });\r\n};\r\n\r\n@Component({\r\n  tag: \"ch-action-list-render\",\r\n  styleUrl: \"action-list-render.scss\",\r\n  shadow: true\r\n})\r\nexport class ChActionListRender {\r\n  #flattenedModel: Map<string, ActionListItemModelExtended> = new Map();\r\n  // #additionalItemsParts: Set<string> | undefined;\r\n  #selectedItems: Set<string> | undefined = undefined;\r\n\r\n  #shouldUpdateModelAndSelection = false;\r\n\r\n  @Element() el: HTMLChActionListRenderElement;\r\n\r\n  @State() expanded: boolean = true;\r\n\r\n  /**\r\n   * This property lets you specify if the tree is waiting to process the drop\r\n   * of items.\r\n   */\r\n  @State() waitDropProcessing = false;\r\n\r\n  /**\r\n   * Set this attribute if you want display a checkbox in all items by default.\r\n   */\r\n  @Prop() readonly checkbox: boolean = false;\r\n\r\n  /**\r\n   * Set this attribute if you want the checkbox to be checked in all items by\r\n   * default.\r\n   * Only works if `checkbox = true`\r\n   */\r\n  @Prop() readonly checked: boolean = false;\r\n\r\n  /**\r\n   * This attribute lets you specify if all items are disabled.\r\n   * If disabled, action list items will not fire any user interaction related\r\n   * event (for example, `selectedItemsChange` event).\r\n   */\r\n  @Prop() readonly disabled: boolean = false;\r\n\r\n  /**\r\n   * This attribute lets you specify if the edit operation is enabled in all\r\n   * items by default. If `true`, the items can edit its caption in place.\r\n   */\r\n  @Prop() readonly editableItems: boolean = DEFAULT_EDITABLE_ITEMS_VALUE;\r\n\r\n  /**\r\n   * Callback that is executed when and item requests to be fixed/unfixed.\r\n   * If the callback is not defined, the item will be fixed/unfixed without\r\n   * further confirmation.\r\n   */\r\n  @Prop() readonly fixItemCallback?: (\r\n    itemInfo: ActionListItemActionable,\r\n    newFixedValue: boolean\r\n  ) => Promise<boolean>;\r\n\r\n  /**\r\n   * This property specifies a callback that is executed when the path for an\r\n   * imgSrc needs to be resolved.\r\n   */\r\n  @Prop() readonly getImagePathCallback?: ActionListImagePathCallback;\r\n\r\n  /**\r\n   * This property lets you define the model of the control.\r\n   */\r\n  @Prop() readonly model: ActionListModel = [];\r\n  @Watch(\"model\")\r\n  modelChanged() {\r\n    this.#shouldUpdateModelAndSelection = true;\r\n  }\r\n\r\n  // /**\r\n  //  * This property lets you determine the expression that will be applied to the\r\n  //  * filter.\r\n  //  * Only works if `filterType = \"caption\" | \"metadata\"`.\r\n  //  */\r\n  // @Prop() readonly filter: string;\r\n  // @Watch(\"filter\")\r\n  // filterChanged() {\r\n  //   if (this.filterType === \"caption\" || this.filterType === \"metadata\") {\r\n  //     this.#scheduleFilterProcessing();\r\n  //   }\r\n  // }\r\n\r\n  // /**\r\n  //  * This property lets you determine the debounce time (in ms) that the\r\n  //  * control waits until it processes the changes to the filter property.\r\n  //  * Consecutive changes to the `filter` property between this range, reset the\r\n  //  * timeout to process the filter.\r\n  //  * Only works if `filterType = \"caption\" | \"metadata\"`.\r\n  //  */\r\n  // @Prop() readonly filterDebounce: number = 250;\r\n  // @Watch(\"filterDebounce\")\r\n  // filterDebounceChanged() {\r\n  //   if (this.filterType === \"caption\" || this.filterType === \"metadata\") {\r\n  //     this.#scheduleFilterProcessing();\r\n  //   }\r\n  // }\r\n\r\n  // /**\r\n  //  * This property lets you determine the list of items that will be filtered.\r\n  //  * Only works if `filterType = \"list\"`.\r\n  //  */\r\n  // @Prop() readonly filterList: string[] = [];\r\n  // @Watch(\"filterList\")\r\n  // filterListChanged() {\r\n  //   // Use a Set to efficiently check for ids\r\n  //   this.#filterListAsSet = new Set(this.filterList);\r\n\r\n  //   if (this.filterType === \"list\") {\r\n  //     this.#scheduleFilterProcessing();\r\n  //   }\r\n  // }\r\n\r\n  // /**\r\n  //  * This property lets you determine the options that will be applied to the\r\n  //  * filter.\r\n  //  */\r\n  // @Prop() readonly filterOptions: TreeViewFilterOptions = {};\r\n  // @Watch(\"filterOptions\")\r\n  // filterOptionsChanged() {\r\n  //   this.#scheduleFilterProcessing();\r\n  // }\r\n\r\n  // /**\r\n  //  * This attribute lets you define what kind of filter is applied to items.\r\n  //  * Only items that satisfy the filter predicate will be displayed.\r\n  //  *\r\n  //  * | Value       | Details                                                                                        |\r\n  //  * | ----------- | ---------------------------------------------------------------------------------------------- |\r\n  //  * | `checked`   | Show only the items that have a checkbox and are checked.                                      |\r\n  //  * | `unchecked` | Show only the items that have a checkbox and are not checked.                                  |\r\n  //  * | `caption`   | Show only the items whose `caption` satisfies the regex determinate by the `filter` property.  |\r\n  //  * | `metadata`  | Show only the items whose `metadata` satisfies the regex determinate by the `filter` property. |\r\n  //  * | `list`      | Show only the items that are contained in the array determinate by the `filterList` property.  |\r\n  //  * | `none`      | Show all items.                                                                                |\r\n  //  */\r\n  // @Prop() readonly filterType: TreeViewFilterType = \"none\";\r\n  // @Watch(\"filterType\")\r\n  // filterTypeChanged() {\r\n  //   this.#scheduleFilterProcessing();\r\n  // }\r\n\r\n  // /**\r\n  //  * This property specifies a callback that is executed when the path for an\r\n  //  * item image needs to be resolved. With this callback, there is no need to\r\n  //  * re-implement item rendering (`renderItem` property) just to change the\r\n  //  * path used for the images.\r\n  //  */\r\n  // @Prop() readonly getImagePathCallback: TreeViewImagePathCallback =\r\n  //   defaultGetImagePath;\r\n\r\n  /**\r\n   * Callback that is executed when a item request to modify its caption.\r\n   */\r\n  @Prop() readonly modifyItemCaptionCallback: (\r\n    actionListItemId: string,\r\n    newCaption: string\r\n  ) => Promise<void>;\r\n\r\n  /**\r\n   * This property allows us to implement custom rendering of tree items.\r\n   */\r\n  @Prop() readonly renderItem: (\r\n    itemModel: ActionListItemModel,\r\n    actionListRenderState: ChActionListRender,\r\n    disabled?: boolean,\r\n    nested?: boolean,\r\n    nestedExpandable?: boolean\r\n  ) => any = defaultRenderItem;\r\n\r\n  /**\r\n   * Callback that is executed when and item requests to be removed.\r\n   * If the callback is not defined, the item will be removed without further\r\n   * confirmation.\r\n   */\r\n  @Prop() readonly removeItemCallback?: (\r\n    itemInfo: ActionListItemActionable\r\n  ) => Promise<boolean>;\r\n\r\n  /**\r\n   * Specifies the type of selection implemented by the control.\r\n   */\r\n  @Prop() readonly selection: \"single\" | \"multiple\" | \"none\" = \"none\";\r\n  @Watch(\"selection\")\r\n  selectionChanged() {\r\n    this.#shouldUpdateModelAndSelection = true;\r\n  }\r\n\r\n  /**\r\n   * Callback that is executed when the treeModel is changed to order its items.\r\n   */\r\n  @Prop() readonly sortItemsCallback: (subModel: ActionListModel) => void =\r\n    defaultSortItemsCallback;\r\n\r\n  // /**\r\n  //  * Fired when the checked items change.\r\n  //  * This event does take into account the currently filtered items.\r\n  //  */\r\n  // @Event() checkedItemsChange: EventEmitter<\r\n  //   Map<string, TreeViewItemModelExtended>\r\n  // >;\r\n\r\n  /**\r\n   * Specifies the literals required for the control.\r\n   */\r\n  @Prop() readonly translations: ActionListTranslations =\r\n    actionListDefaultTranslations;\r\n\r\n  /**\r\n   * Fired when the selected items change and `selection !== \"none\"`\r\n   */\r\n  @Event() selectedItemsChange: EventEmitter<ActionListItemModelExtended[]>;\r\n\r\n  /**\r\n   * Fired when an item is clicked and `selection === \"none\"`.\r\n   * Applies for items that have `type === \"actionable\"` or\r\n   * (`type === \"group\"` and `expandable === true`)\r\n   */\r\n  @Event() itemClick: EventEmitter<ActionListItemModelExtended>;\r\n\r\n  /**\r\n   * Adds an item in the control.\r\n   *\r\n   * If the item already exists, the operation is canceled.\r\n   *\r\n   * If the `groupParentId` property is specified the item is added in the\r\n   * group determined by `groupParentId`. It only works if the item to add\r\n   * has `type === \"actionable\"`\r\n   */\r\n  @Method()\r\n  async addItem(\r\n    itemInfo: ActionListItemModel,\r\n    groupParentId?: string\r\n  ): Promise<void> {\r\n    // Already exists\r\n    if (this.#flattenedModel.get(itemInfo.id)) {\r\n      return;\r\n    }\r\n\r\n    if (groupParentId) {\r\n      const parentGroup = this.#flattenedModel.get(groupParentId);\r\n\r\n      // The parent group does not exists or it isn't a group\r\n      if (\r\n        !parentGroup ||\r\n        parentGroup.item.type !== \"group\" ||\r\n        itemInfo.type !== \"actionable\"\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      parentGroup.item.items.push(itemInfo);\r\n      this.#flattenedModel.set(itemInfo.id, {\r\n        item: itemInfo,\r\n        parentItem: parentGroup.item\r\n      });\r\n\r\n      // Sort items in parent model\r\n      this.#sortModel(parentGroup.item.items);\r\n    }\r\n    // Item is placed at the root\r\n    else {\r\n      this.model.push(itemInfo);\r\n      this.#flattenedModel.set(itemInfo.id, {\r\n        item: itemInfo,\r\n        root: this.model\r\n      });\r\n\r\n      // Sort items in parent model\r\n      this.#sortModel(this.model);\r\n    }\r\n\r\n    forceUpdate(this);\r\n  }\r\n\r\n  /**\r\n   * Given a list of ids, it returns an array of the items that exists in the\r\n   * given list.\r\n   */\r\n  @Method()\r\n  async getItemsInfo(\r\n    itemsId: string[]\r\n  ): Promise<ActionListItemModelExtended[]> {\r\n    return this.#getItemsInfo(itemsId);\r\n  }\r\n\r\n  /**\r\n   * Remove the item and all its descendants from the control.\r\n   */\r\n  @Method()\r\n  async removeItem(itemId: string) {\r\n    const itemUIModel = this.#flattenedModel.get(itemId);\r\n\r\n    if (!itemUIModel) {\r\n      return;\r\n    }\r\n\r\n    // Remove all descendants\r\n    if (itemUIModel.item.type === \"group\") {\r\n      const items = itemUIModel.item.items;\r\n\r\n      items.forEach(item => {\r\n        this.#flattenedModel.delete(item.id);\r\n      });\r\n    }\r\n\r\n    this.#removeItem(itemUIModel);\r\n  }\r\n\r\n  #getItemsInfo = (itemsId: string[]): ActionListItemModelExtended[] => {\r\n    const actionListItemsInfo: ActionListItemModelExtended[] = [];\r\n\r\n    itemsId.forEach(itemId => {\r\n      const itemUIModel = this.#flattenedModel.get(itemId);\r\n\r\n      if (itemUIModel) {\r\n        actionListItemsInfo.push(itemUIModel);\r\n      }\r\n    });\r\n\r\n    return actionListItemsInfo;\r\n  };\r\n\r\n  /**\r\n   * Given an itemId and the properties to update, it updates the properties\r\n   * of the items in the list.\r\n   */\r\n  @Method()\r\n  async updateItemProperties(\r\n    itemId: string,\r\n    properties: Partial<ActionListItemModel> & { type: ActionListItemType }\r\n  ) {\r\n    // Set to check if there are new selected items\r\n    const newSelectedItems = new Set(this.#selectedItems);\r\n\r\n    const parentArray = updateItemProperty(\r\n      itemId,\r\n      properties,\r\n      this.#flattenedModel,\r\n      newSelectedItems\r\n    );\r\n\r\n    if (parentArray !== undefined) {\r\n      this.#sortModel(parentArray);\r\n    }\r\n\r\n    if (\r\n      selectedItemsChangeShouldBeEmitted(\r\n        this.#selectedItems,\r\n        newSelectedItems,\r\n        this.#flattenedModel,\r\n        this.selection\r\n      )\r\n    ) {\r\n      this.#selectedItems = newSelectedItems;\r\n      this.#emitSelectedItemsChange();\r\n    }\r\n\r\n    forceUpdate(this);\r\n  }\r\n\r\n  @Listen(\"captionChange\")\r\n  onCaptionChange(\r\n    event: ChActionListItemCustomEvent<ActionListCaptionChangeEventDetail>\r\n  ) {\r\n    if (!this.modifyItemCaptionCallback) {\r\n      return;\r\n    }\r\n    event.stopPropagation();\r\n\r\n    const itemRef = event\r\n      .composedPath()\r\n      .find(\r\n        el =>\r\n          (el as HTMLElement).tagName &&\r\n          (el as HTMLElement).tagName?.toLowerCase() === ACTION_LIST_ITEM_TAG\r\n      ) as HTMLChActionListItemElement;\r\n    if (!itemRef) {\r\n      return;\r\n    }\r\n\r\n    const itemId = event.detail.itemId;\r\n    const itemUIModel = this.#flattenedModel.get(itemId);\r\n    const itemInfo = itemUIModel.item as ActionListItemActionable;\r\n    const newCaption = event.detail.newCaption;\r\n    const oldCaption = itemInfo.caption;\r\n\r\n    // Optimistic UI: Update the caption in the UI Model before the change is\r\n    // completed in the server\r\n    itemInfo.caption = newCaption;\r\n    itemRef.caption = newCaption;\r\n\r\n    this.modifyItemCaptionCallback(itemId, newCaption)\r\n      .then(() => {\r\n        // Sort items in parent model\r\n        this.#sortModel(getParentArray(itemUIModel));\r\n\r\n        // Update filters\r\n        // this.#scheduleFilterProcessing();\r\n\r\n        // Force re-render\r\n        forceUpdate(this);\r\n      })\r\n      .catch(() => {\r\n        // TODO: Should we do something with the error message?\r\n        itemRef.caption = oldCaption;\r\n        itemInfo.caption = oldCaption;\r\n      });\r\n  }\r\n\r\n  @Listen(\"fixedChange\")\r\n  onFixedChange(\r\n    event: ChActionListItemCustomEvent<ActionListFixedChangeEventDetail>\r\n  ) {\r\n    const detail = event.detail;\r\n\r\n    const itemUIModel = this.#flattenedModel.get(detail.itemId);\r\n    const itemInfo = itemUIModel.item as ActionListItemActionable;\r\n\r\n    if (!this.fixItemCallback) {\r\n      this.#updateItemFix(itemUIModel, itemInfo, detail.value);\r\n      return;\r\n    }\r\n\r\n    this.fixItemCallback(itemInfo, detail.value).then(acceptChange => {\r\n      if (acceptChange) {\r\n        this.#updateItemFix(itemUIModel, itemInfo, detail.value);\r\n      }\r\n    });\r\n  }\r\n\r\n  #updateItemFix = (\r\n    itemUIModel: ActionListItemModelExtended,\r\n    itemInfo: ActionListItemActionable,\r\n    newFixedValue: boolean\r\n  ) => {\r\n    itemInfo.fixed = newFixedValue;\r\n\r\n    // Sort items in parent model\r\n    this.#sortModel(getParentArray(itemUIModel));\r\n\r\n    // Queue a re-render to update the fixed binding and the order of the items\r\n    forceUpdate(this);\r\n  };\r\n\r\n  @Listen(\"remove\")\r\n  onRemove(event: ChActionListItemCustomEvent<string>) {\r\n    const itemUIModel = this.#flattenedModel.get(event.detail);\r\n\r\n    if (!this.removeItemCallback) {\r\n      this.#removeItem(itemUIModel);\r\n\r\n      return;\r\n    }\r\n\r\n    this.removeItemCallback(itemUIModel.item as ActionListItemActionable).then(\r\n      acceptRemove => {\r\n        if (acceptRemove) {\r\n          this.#removeItem(itemUIModel);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  #getItemOrGroupInfo = (itemId: string) =>\r\n    getActionListItemOrGroupInfo(itemId, this.#flattenedModel);\r\n\r\n  #updateAndEmitSelectedItems = (selection: \"single\" | \"multiple\" | \"none\") => {\r\n    if (selection === \"none\") {\r\n      this.#removeAllSelectedItems();\r\n      this.#selectedItems = undefined;\r\n    }\r\n    // Create the set to allocate the selected items, if necessary\r\n    else {\r\n      // First render. Do not check to emit selectedItemsChange event.\r\n      if (!this.#selectedItems) {\r\n        this.#selectedItems = new Set();\r\n\r\n        // TODO: Add a unit test for \"?? []\"\r\n        setActionListSelectedItems(this.model ?? [], this.#selectedItems);\r\n        return;\r\n      }\r\n\r\n      const newSelectedItems = new Set<string>();\r\n      setActionListSelectedItems(this.model ?? [], newSelectedItems);\r\n\r\n      if (\r\n        selectedItemsChangeShouldBeEmitted(\r\n          this.#selectedItems,\r\n          newSelectedItems,\r\n          this.#flattenedModel,\r\n          this.selection\r\n        )\r\n      ) {\r\n        this.#selectedItems = newSelectedItems;\r\n        forceUpdate(this);\r\n        this.#emitSelectedItemsChange();\r\n      }\r\n    }\r\n  };\r\n\r\n  #removeAllSelectedItems = () => {\r\n    if (this.#selectedItems) {\r\n      this.#selectedItems.forEach(selectedItemId => {\r\n        const selectedItemInfo = this.#getItemOrGroupInfo(selectedItemId);\r\n        selectedItemInfo.selected = false;\r\n      });\r\n\r\n      this.#selectedItems.clear();\r\n    }\r\n  };\r\n\r\n  #handleItemClick = (event: PointerEvent) => {\r\n    const actionListItemOrGroup = getActionListOrGroupItemFromEvent(event);\r\n\r\n    if (\r\n      !actionListItemOrGroup ||\r\n      (actionListItemOrGroup as HTMLChActionListItemElement).editing\r\n    ) {\r\n      return;\r\n    }\r\n    const itemInfo = this.#getItemOrGroupInfo(actionListItemOrGroup.id);\r\n    this.#checkIfMustExpandCollapseGroup(itemInfo);\r\n\r\n    if (itemInfo.type === \"group\" && !itemInfo.expandable) {\r\n      return;\r\n    }\r\n    this.itemClick.emit(this.#flattenedModel.get(itemInfo.id));\r\n  };\r\n\r\n  #checkIfMustExpandCollapseGroup = (\r\n    itemInfo: ActionListItemActionable | ActionListItemGroup\r\n  ) => {\r\n    // Toggle the expanded/collapsed in the group on click\r\n    if (\r\n      itemInfo.type === \"group\" &&\r\n      itemInfo.expandable &&\r\n      !itemInfo.disabled\r\n    ) {\r\n      itemInfo.expanded = !itemInfo.expanded;\r\n      forceUpdate(this);\r\n    }\r\n  };\r\n\r\n  #handleItemSelection = (event: PointerEvent) => {\r\n    const actionListItemOrGroup = getActionListOrGroupItemFromEvent(event);\r\n\r\n    if (\r\n      !actionListItemOrGroup ||\r\n      (actionListItemOrGroup as HTMLChActionListItemElement).editing\r\n    ) {\r\n      return;\r\n    }\r\n    const itemId = actionListItemOrGroup.id;\r\n    const itemInfo = this.#getItemOrGroupInfo(itemId);\r\n\r\n    const ctrlKeyIsPressed = mouseEventModifierKey(event);\r\n    const itemWasSelected = this.#selectedItems.has(itemId);\r\n    const singleSelectionMode = this.selection === \"single\";\r\n\r\n    // - - - - - - - - - - Single selection - - - - - - - - - -\r\n    if (singleSelectionMode) {\r\n      if (!ctrlKeyIsPressed) {\r\n        this.#checkIfMustExpandCollapseGroup(itemInfo);\r\n      }\r\n\r\n      // Nothing to update in the UI\r\n      if (itemWasSelected && !ctrlKeyIsPressed) {\r\n        return;\r\n      }\r\n      const previousSelectedItemId: string | undefined = [\r\n        ...this.#selectedItems.keys()\r\n      ][0];\r\n\r\n      // Remove the previous selected item\r\n      if (previousSelectedItemId) {\r\n        this.#selectedItems.clear();\r\n\r\n        const previousSelectedItemInfo = this.#getItemOrGroupInfo(\r\n          previousSelectedItemId\r\n        );\r\n        previousSelectedItemInfo.selected = false;\r\n      }\r\n\r\n      // If the item was not selected, add it to the Set. If the item was\r\n      // selected, the previous if removes the item\r\n      if (!itemWasSelected) {\r\n        this.#selectedItems.add(itemId);\r\n      }\r\n\r\n      itemInfo.selected = !itemWasSelected;\r\n      this.#emitSelectedItemsChange();\r\n      forceUpdate(this);\r\n      return;\r\n    }\r\n\r\n    // - - - - - - - - - - Multiple selection - - - - - - - - - -\r\n    if (ctrlKeyIsPressed) {\r\n      // The item was selected, deselect the item\r\n      if (itemWasSelected) {\r\n        this.#selectedItems.delete(itemId);\r\n      }\r\n      // Otherwise, select the item\r\n      else {\r\n        this.#selectedItems.add(itemId);\r\n      }\r\n\r\n      itemInfo.selected = !itemWasSelected;\r\n    } else {\r\n      this.#checkIfMustExpandCollapseGroup(itemInfo);\r\n\r\n      // Remove the selection from all items\r\n      this.#removeAllSelectedItems();\r\n\r\n      this.#selectedItems.add(itemId);\r\n      itemInfo.selected = true;\r\n    }\r\n\r\n    this.#emitSelectedItemsChange();\r\n    forceUpdate(this);\r\n  };\r\n\r\n  #emitSelectedItemsChange = () => {\r\n    const selectedItemsInfo = this.#getItemsInfo([\r\n      ...this.#selectedItems.keys()\r\n    ]);\r\n    this.selectedItemsChange.emit(selectedItemsInfo);\r\n  };\r\n\r\n  #removeItem = (itemUIModel: ActionListItemModelExtended) => {\r\n    const parentArray =\r\n      (itemUIModel as ActionListItemModelExtendedRoot).root ??\r\n      (itemUIModel as ActionListItemModelExtendedGroup).parentItem.items;\r\n    const itemToRemoveId = itemUIModel.item.id;\r\n\r\n    const itemToRemoveIndex = parentArray.findIndex(\r\n      el => el.id === itemToRemoveId\r\n    );\r\n\r\n    // In some situations, the user could remove the item before the\r\n    // \"removeItemCallback\" promise is resolved\r\n    if (itemToRemoveIndex > -1) {\r\n      // Remove the UI model from the previous parent. The equality function\r\n      // must be by index, not by object reference\r\n      removeElement(parentArray, itemToRemoveIndex);\r\n    }\r\n\r\n    this.#flattenedModel.delete(itemToRemoveId);\r\n\r\n    // Queue a re-render\r\n    forceUpdate(this);\r\n  };\r\n\r\n  #sortModel = (model: ActionListModel) => {\r\n    if (this.sortItemsCallback) {\r\n      this.sortItemsCallback(model);\r\n    }\r\n  };\r\n\r\n  #flattenUIModel = (model: ActionListModel) =>\r\n    flattenActionListUIModel(model, this.#flattenedModel, this.#sortModel);\r\n\r\n  // #processAdditionalItemParts = () => {\r\n  //   this.#additionalItemsParts = undefined;\r\n\r\n  //   this.#additionalItemsParts ??= new Set();\r\n  // }\r\n\r\n  connectedCallback() {\r\n    adoptCommonThemes(this.el.shadowRoot.adoptedStyleSheets);\r\n    this.#flattenUIModel(this.model);\r\n\r\n    this.#updateAndEmitSelectedItems(this.selection);\r\n    this.el.setAttribute(\"role\", \"list\");\r\n  }\r\n\r\n  // Don't turn it into the componentWillUpdate lifecycle method.\r\n  // For some reason, the componentWillUpdate lifecycle method is not\r\n  // dispatched when an Angular page (with SSR) is served from the server, but\r\n  // when navigating in the SPA, the componentWillUpdate method works\r\n  componentWillRender() {\r\n    if (this.#shouldUpdateModelAndSelection) {\r\n      this.#shouldUpdateModelAndSelection = false;\r\n\r\n      this.#flattenUIModel(this.model);\r\n      this.#updateAndEmitSelectedItems(this.selection);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host\r\n        aria-multiselectable={this.selection === \"multiple\" ? \"true\" : null}\r\n        class={SCROLLABLE_CLASS}\r\n        onClick={\r\n          this.selection === \"none\"\r\n            ? this.#handleItemClick\r\n            : this.#handleItemSelection\r\n        }\r\n        onKeyDown={actionListKeyboardNavigation(this.el, this.#flattenedModel)}\r\n      >\r\n        {this.model?.map(item =>\r\n          this.renderItem(item, this, false, false, false)\r\n        )}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}