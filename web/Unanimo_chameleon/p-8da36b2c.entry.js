import{h as t,r as e,g as i,f as s,H as a}from"./p-7af91c05.js";import{r as n}from"./p-23a9d308.js";import{m as o,t as r}from"./p-6d91f415.js";import{a as d}from"./p-a859514b.js";import"./p-e7a788ef.js";const l=t=>()=>o(t);const c=t=>t==="complete"||t===undefined?"false":"true";const p=t=>t?`assistant-content ${t}`:"assistant-content";const h=(t,e)=>()=>{const i=new Blob([t.plainText],{type:"text/plain"});const s=window.URL.createObjectURL(i);e.anchor.href=s;e.anchor.download="Answer.txt";e.anchor.click();setTimeout((()=>{window.URL.revokeObjectURL(s)}))};const u=(e,i)=>s=>t("div",null,t("div",{class:"code-block__header",part:"code-block__header"},s.language,t("div",{class:"code-block__header-actions",part:"code-block__header-actions"},t("button",{"aria-label":e.isMobile?i.text.copyCodeButton:undefined,class:"code-block__copy-code-button",part:"code-block__copy-code-button",type:"button",onClick:l(s.plainText)},!e.isMobile&&i.text.copyCodeButton),e.hyperlinkToDownloadFile&&t("button",{"aria-label":i.accessibleName.downloadCodeButton,title:i.accessibleName.downloadCodeButton,class:"code-block__download-code-button",part:"code-block__download-code-button",onClick:h(s,e.hyperlinkToDownloadFile)}))),t("ch-code",{class:"code-block__content",language:s.language,lastNestedChildClass:s.lastNestedChildClass,showIndicator:s.showIndicator,value:s.plainText}));const g=e=>typeof e.content==="string"?e.content:t("div",{class:"message-with-images",part:"message-with-images"},t("span",{part:"message-with-images__text"},e.content[0].text),e.content.slice(1).map((e=>t("img",{"aria-hidden":"true",class:!e.image_url.url?"file-skeleton":undefined,part:e.image_url.url?"message-with-images__image":"message-with-images__image file-skeleton",src:e.image_url.url,alt:"",loading:"lazy"}))));const m=(e,i)=>{const s=typeof i.content==="string"?i.content:i.content.message;const a=i.content.files??null;const n=e.translations;return t("div",{"aria-live":"polite","aria-busy":c(i.status),class:"assistant-content",part:p(i.status)},i.status==="waiting"?t("div",{class:"assistant-loading",part:"assistant-loading"},s):[t("ch-markdown-viewer",{renderCode:e.renderCode??u(e,n),showIndicator:i.status==="streaming",theme:e.markdownTheme,value:s}),a&&t("div",{class:"assistant-files",part:"assistant-files"},n.text.sourceFiles,a.map((e=>t("a",{href:e.url,target:"_blank",part:"assistant-file"},e.caption))))],(i.status==="complete"||!i.status)&&t("button",{"aria-label":n.accessibleName.copyResponseButton,title:n.accessibleName.copyResponseButton,part:"copy-response-button",type:"button",onClick:l(s)}))};const f=(e,i)=>t("ch-markdown-viewer",{renderCode:e.renderCode??u(e,e.translations),theme:e.markdownTheme,value:i.content});const b=t=>e=>{if(e.role==="assistant"){return m(t,e)}return e.role==="user"?g(e):f(t,e)};const x=':where(button,a){all:unset;display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer}button:disabled{pointer-events:none}*,::after,::before{-webkit-box-sizing:border-box;box-sizing:border-box}h1,h2,h3,h4,h5,h6,p{font:inherit;margin:0;padding:0;color:inherit}:host{display:grid;grid-template-rows:1fr -webkit-max-content;grid-template-rows:1fr max-content}:host(.ch-chat--additional-content){grid-template-rows:1fr -webkit-max-content -webkit-max-content;grid-template-rows:1fr max-content max-content}.assistant-content,.user-content{contain:paint}.message-with-images{display:grid}img{display:block;max-inline-size:100%}.assistant-loading{display:grid;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;-ms-flex-align:center;align-items:center}.assistant-files{grid-area:2/2;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:center;align-items:center}.file-skeleton{position:relative}.file-skeleton::before,.file-skeleton::after{content:"";display:-ms-inline-flexbox;display:inline-flex}.stop-generating-answer-button{grid-area:input-wrapper;position:absolute;inset-block-start:0;justify-self:center;-webkit-transform:translateY(-100%);transform:translateY(-100%)}.images-to-upload{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.send-container{display:grid;grid-template:"input-wrapper send-or-audio" 1fr/1fr -webkit-max-content;grid-template:"input-wrapper send-or-audio" 1fr/1fr max-content;position:relative;-ms-flex-align:end;align-items:end}.send-container--file-uploading{grid-template:"upload-image input-wrapper send-or-audio" 1fr/max-content 1fr -webkit-max-content;grid-template:"upload-image input-wrapper send-or-audio" 1fr/max-content 1fr max-content}.send-input-wrapper{grid-area:input-wrapper}.send-or-audio-button{grid-area:send-or-audio}.spinner-loading{-webkit-animation:infinite-rotate 0.875s linear 0s infinite;animation:infinite-rotate 0.875s linear 0s infinite}@-webkit-keyframes infinite-rotate{100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes infinite-rotate{100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes gx-skeleton-load{to{-webkit-transform:translateX(192%);transform:translateX(192%)}}@keyframes gx-skeleton-load{to{-webkit-transform:translateX(192%);transform:translateX(192%)}}.processing-animation{content:"";-webkit-margin-start:auto;margin-inline-start:auto;display:block;background-image:url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6"><path d="M3 6C4.65685 6 6 4.65685 6 3C6 1.34315 4.65685 0 3 0C1.34315 0 0 1.34315 0 3C0 4.65685 1.34315 6 3 6Z" fill="%23939498"/></svg>\'), url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6"><path d="M3 6C4.65685 6 6 4.65685 6 3C6 1.34315 4.65685 0 3 0C1.34315 0 0 1.34315 0 3C0 4.65685 1.34315 6 3 6Z" fill="%23939498"/></svg>\'), url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6"><path d="M3 6C4.65685 6 6 4.65685 6 3C6 1.34315 4.65685 0 3 0C1.34315 0 0 1.34315 0 3C0 4.65685 1.34315 6 3 6Z" fill="%23939498"/></svg>\');inline-size:20px;block-size:16px;background-position:left, center, right;background-size:4px, 4px, 4px;background-repeat:no-repeat;-webkit-animation:ellipsis 1s infinite linear;animation:ellipsis 1s infinite linear}@-webkit-keyframes ellipsis{0%{background-size:6px, 4px, 4px}25%{background-size:4px, 6px, 4px}50%{background-size:4px, 4px, 6px}75%{background-size:4px, 6px, 4px}100%{background-size:6px, 4px, 4px}}@keyframes ellipsis{0%{background-size:6px, 4px, 4px}25%{background-size:4px, 6px, 4px}50%{background-size:4px, 4px, 6px}75%{background-size:4px, 6px, 4px}100%{background-size:6px, 4px, 4px}}';const w=x;const k="Enter";const y=class{constructor(t){e(this,t);this.imagesToUpload=[];this.uploadingImagesToTheServer=0;this.virtualItems=[];this.callbacks=undefined;this.disabled=false;this.generatingResponse=false;this.hyperlinkToDownloadFile=undefined;this.imageUpload=false;this.isMobile=false;this.items=[];this.loadingState="initial";this.markdownTheme="ch-markdown-viewer";this.renderCode=undefined;this.showAdditionalContent=false;this.theme=undefined;this.translations={accessibleName:{clearChat:"Clear chat",copyResponseButton:"Copy assistant response",downloadCodeButton:"Download code",imagePicker:"Select images",removeUploadedImage:"Remove uploaded image",sendButton:"Send",sendInput:"Message",stopGeneratingAnswerButton:"Stop generating answer"},placeholder:{sendInput:"Ask me a question..."},text:{stopGeneratingAnswerButton:"Stop generating answer",copyCodeButton:"Copy code",processing:`Processing...`,sourceFiles:"Source files:"}};this.renderItem=undefined}#t;#e;#i;get el(){return i(this)}async addNewMessage(t){this.#s(t)}async focusChatInput(){this.#t?.focus()}async setChatInputMessage(t){if(this.#t){this.#t.value=t}}async updateChatMessage(t,e,i){if(this.items.length===0||!this.items[t]){return}this.#a(t,e,i);s(this)}async updateLastMessage(t,e){if(this.items.length===0){return}this.#a(this.items.length-1,t,e);this.virtualItems[this.virtualItems.length-1]=this.items.at(-1);s(this)}#s=async t=>{if(this.items.length===0){this.items.push(t);s(this)}else{await this.#i.addItems("end",t)}};#n=t=>typeof t.content==="string"?t.content:t.content.message;#a=(t,e,i)=>{if(i==="concat"){const i=this.#n(this.items[t])+this.#n(e);if(typeof e.content==="string"){e.content=i}else{e.content.message=i}}const s=this.items[t].id;this.items[t]=Object.assign({id:s},e)};#o=t=>{if(t.key!==k||t.shiftKey){return}t.preventDefault();this.#r()};#d=async t=>{this.#t.value="";this.#t.click();if(this.#e){this.#e.scrollTop=this.#e.scrollHeight}await this.#s(t)};#r=async()=>{if(!this.#t.value||this.disabled||this.loadingState==="initial"||this.loadingState==="loading"||this.generatingResponse||this.uploadingImagesToTheServer>0){return}if(!this.imageUpload||this.imagesToUpload.length===0){const t={id:`${(new Date).getTime()}`,role:"user",content:this.#t.value};await this.#d(t);this.callbacks?.sendChatToLLM(this.items);s(this);return}this.uploadingImagesToTheServer=this.imagesToUpload.length;const t=[{type:"text",text:this.#t.value}];this.imagesToUpload.forEach(((e,i)=>{t.push({type:"image_url",image_url:{url:""}});this.callbacks?.uploadImage(e.file).then((e=>{t[i+1]={type:"image_url",image_url:{url:e}};this.uploadingImagesToTheServer--;if(this.uploadingImagesToTheServer===0){this.callbacks?.sendChatToLLM(this.items)}})).catch((()=>{this.uploadingImagesToTheServer--;if(this.uploadingImagesToTheServer===0){this.callbacks?.sendChatToLLM(this.items)}}))}));const e={id:`${(new Date).getTime()}`,role:"user",content:t};await this.#d(e);this.imagesToUpload=[]};#l=t=>{t.stopPropagation();this.callbacks?.stopGeneratingAnswer()};#c=t=>e=>{const i=e.target;const a=i.nextElementSibling??i.previousElementSibling;a?.focus();n(this.imagesToUpload,t);s(this)};#p=t=>()=>{URL.revokeObjectURL(t)};#h=t=>{this.virtualItems=t.detail.virtualItems};#u=()=>this.loadingState==="all-records-loaded"&&this.items.length===0?t("slot",{name:"empty-chat"}):t("ch-smart-grid",{dataProvider:this.loadingState==="more-data-to-fetch",loadingState:this.virtualItems.length===0?"initial":this.loadingState,inverseLoading:true,itemsCount:this.virtualItems.length,onInfiniteThresholdReached:this.#g,ref:t=>this.#e=t},t("ch-virtual-scroller",{role:"row",slot:"grid-content",class:"grid-content",part:"content",inverseLoading:true,items:this.items,itemsCount:this.items.length,onVirtualItemsChanged:this.#h,ref:t=>this.#i=t},this.virtualItems.map(this.#m)));#m=e=>e.role!=="system"&&t("ch-smart-grid-cell",{key:e.id,cellId:e.id,part:r({[`message ${e.role}`]:true,[e.parts]:!!e.parts,[e.status]:e.role==="assistant"})},this.renderItem?this.renderItem(e):b(this.el)(e));#g=()=>{this.loadingState="loading";setTimeout((()=>{const t=this.items.length;const e=Array.from({length:20},((e,i)=>i%2===0?{id:`index: ${i-t}`,role:"user",content:`index: ${i-t}`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`}:{id:`index: ${i-t}`,role:"assistant",content:`\nindex: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`+`index: ${i-t}\n`}));this.#i.addItems("start",...e);this.loadingState="more-data-to-fetch"}),10)};connectedCallback(){d(this.el.shadowRoot.adoptedStyleSheets)}render(){const e=this.translations.text;const i=this.translations.accessibleName;const s=this.showAdditionalContent&&this.loadingState!=="initial"&&!(this.items.length===0&&this.loadingState==="all-records-loaded");return t(a,{key:"5132bf18a4d65c8f89bc15eff0326ddb2adf7cf4",class:s?"ch-chat--additional-content":undefined},this.theme&&t("ch-theme",{key:"fdd66de7e914d3bfd7608506d8611221ded140d5",model:this.theme}),this.loadingState==="initial"?t("div",{class:"loading-chat",slot:"empty-chat"}):this.#u(),s&&t("slot",{key:"0477dc93373a3410bf080dbb4c0876c2e0b51122",name:"additional-content"}),t("div",{key:"52d0120573c101093206005308c764a00fbacdea",class:{"send-container":true,"send-container--file-uploading":this.imageUpload},part:"send-container"},this.generatingResponse&&this.callbacks?.stopGeneratingAnswer&&t("button",{key:"58cea186731ac8c977bf7093a1c145da64cd6c36","aria-label":i.stopGeneratingAnswerButton!==e.stopGeneratingAnswerButton&&(i.stopGeneratingAnswerButton??e.stopGeneratingAnswerButton),class:"stop-generating-answer-button",part:"stop-generating-answer-button",type:"button",onClick:this.#l},e.stopGeneratingAnswerButton),t("div",{key:"d6eea397778eaaf813504aab0bd254085a629ab7",class:"send-input-wrapper",part:"send-input-wrapper"},this.imagesToUpload.length>0&&t("div",{key:"760ea791646e9e068df9aa2dec7feb28139a88da",class:"images-to-upload",part:"images-to-upload"},this.imagesToUpload.map(((e,s)=>t("button",{key:e.src,"aria-label":i.removeUploadedImage,title:i.removeUploadedImage,part:"remove-image-to-upload-button",type:"button",onClick:this.#c(s)},t("img",{part:"image-to-upload","aria-hidden":"true",src:e.src,alt:"",loading:"lazy",onLoad:this.#p(e.src)}))))),t("ch-edit",{key:"cee370c7f2015958ec10245be23a105c6df34b65",accessibleName:i.sendInput,autoGrow:true,hostParts:"send-input",multiline:true,placeholder:this.translations.placeholder.sendInput,onKeyDown:this.#o,ref:t=>this.#t=t})),t("button",{key:"ab31794fe001ccad7e32ec318fa46b9bdd6f756d","aria-label":i.sendButton,title:i.sendButton,class:"send-or-audio-button",part:"send-button",disabled:this.disabled,type:"button",onClick:this.loadingState!=="initial"?this.#r:undefined})))}};y.style=w;export{y as ch_chat};
//# sourceMappingURL=p-8da36b2c.entry.js.map