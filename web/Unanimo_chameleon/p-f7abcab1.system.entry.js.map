{"version":3,"names":["textblockCss","ChTextblockStyle0","AVAILABLE_SIZE_CUSTOM_VAR","DISPLAYED_LINES_CUSTOM_VAR","LINE_HEIGHT_CUSTOM_VAR","ChTextBlock","exports","_a","_currentAvailableHeight","set","this","_availableHeight","_contentHeight","_lineHeight","_totalLines","_displayedLines","_resizeObserver","_syncWithRAF","_contentRef","_htmlContentRef","_lineMeasuringRef","_getContentRef","_this","format","__classPrivateFieldGet","_calculateDisplayedLines","contentRef","call","currentContentHeight","scrollHeight","currentLineHeight","getBoundingClientRect","height","__classPrivateFieldSet","contentOverflows","currentDisplayedLines","Math","max","trunc","currentTotalLines","style","setProperty","concat","_setResizeObserverIfNecessary","SyncWithRAF","ResizeObserver","entries","textBlockEntry","find","el","target","contentBoxSize","blockSize","perform","observe","box","_disconnectResizeObserver","_b","disconnect","undefined","_c","cancel","_autoGrowRender","caption","h","_noAutoGrowRender","class","ref","characterToMeasureLineHeight","class_1","prototype","contentOverflowsChanged","newValue","overflowingContentChange","emit","autoGrowChanged","newAutoGrow","formatChanged","componentDidRender","autoGrow","showTooltipOnOverflow","disconnectedCallback","render","Host","title"],"sources":["src/components/textblock/textblock.scss?tag=ch-textblock&encapsulation=shadow","src/components/textblock/textblock.tsx"],"sourcesContent":["@import \"../../common/_base\";\r\n\r\n@include box-sizing();\r\n@include typography-reset();\r\n\r\n:host {\r\n  --ch-textblock-displayed-lines: 1;\r\n  --ch-textblock-line-height: 1px;\r\n\r\n  display: inline-grid;\r\n  grid-auto-rows: max-content;\r\n  position: relative;\r\n  text-align: start; // Default alignment which supports RTL\r\n\r\n  // Enter support\r\n  white-space: break-spaces;\r\n}\r\n\r\n:host(.ch-textblock--no-auto-grow) {\r\n  contain: size;\r\n}\r\n\r\n// Used to measure the line height, in order to make the lines clampable\r\n.line-measure {\r\n  position: absolute;\r\n  pointer-events: none;\r\n  visibility: hidden;\r\n}\r\n\r\n// - - - - - - - - - - - - - - - - - - - -\r\n//           Auto Grow disabled\r\n// - - - - - - - - - - - - - - - - - - - -\r\n.content,\r\n.html-content {\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: var(--ch-textblock-displayed-lines);\r\n  overflow: hidden;\r\n  max-block-size: calc(\r\n    var(--ch-textblock-displayed-lines) * var(--ch-textblock-line-height)\r\n  );\r\n}\r\n\r\n.html-content {\r\n  max-block-size: var(--ch-textblock-available-size);\r\n}\r\n","import {\r\n  Component,\r\n  ComponentInterface,\r\n  Element,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Prop,\r\n  State,\r\n  Watch,\r\n  h\r\n} from \"@stencil/core\";\r\n\r\nimport { SyncWithRAF } from \"../../common/sync-with-frames\";\r\n\r\nconst AVAILABLE_SIZE_CUSTOM_VAR = \"--ch-textblock-available-size\";\r\nconst DISPLAYED_LINES_CUSTOM_VAR = \"--ch-textblock-displayed-lines\";\r\nconst LINE_HEIGHT_CUSTOM_VAR = \"--ch-textblock-line-height\";\r\n\r\n/**\r\n * @status developer-preview\r\n *\r\n * @slot - The slot for the HTML content.\r\n */\r\n@Component({\r\n  shadow: true,\r\n  styleUrl: \"textblock.scss\",\r\n  tag: \"ch-textblock\"\r\n})\r\nexport class ChTextBlock implements ComponentInterface {\r\n  #currentAvailableHeight: number = -1;\r\n  #availableHeight: number = -1;\r\n  #contentHeight: number = -1;\r\n  #lineHeight: number = -1;\r\n\r\n  #totalLines: number = -1;\r\n  #displayedLines: number = -1;\r\n\r\n  #resizeObserver: ResizeObserver | undefined;\r\n  #syncWithRAF: SyncWithRAF | undefined; // Allocated at runtime to save resources\r\n\r\n  // Refs\r\n  #contentRef: HTMLElement | undefined;\r\n  #htmlContentRef: HTMLElement | undefined;\r\n  #lineMeasuringRef: HTMLElement | undefined;\r\n\r\n  @State() contentOverflows = false;\r\n  @Watch(\"contentOverflows\")\r\n  contentOverflowsChanged(newValue: boolean) {\r\n    this.overflowingContentChange.emit(newValue);\r\n  }\r\n\r\n  @Element() el: HTMLChTextblockElement;\r\n\r\n  /**\r\n   * This property defines if the control size will grow automatically, to\r\n   * adjust to its content size.\r\n   *\r\n   * If `false` the overflowing content will be displayed with an ellipsis.\r\n   * This ellipsis takes into account multiple lines.\r\n   */\r\n  @Prop() readonly autoGrow: boolean = false;\r\n  @Watch(\"autoGrow\")\r\n  autoGrowChanged(newAutoGrow: boolean) {\r\n    if (newAutoGrow) {\r\n      this.#disconnectResizeObserver();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Specifies the content to be displayed when the control has `format = text`.\r\n   */\r\n  @Prop() readonly caption: string;\r\n\r\n  /**\r\n   * Specifies the character used to measure the line height\r\n   */\r\n  @Prop() readonly characterToMeasureLineHeight: string = \"A\";\r\n\r\n  /**\r\n   * It specifies the format that will have the textblock control.\r\n   *\r\n   *  - If `format` = `HTML`, the textblock control works as an HTML div and\r\n   *    the innerHTML will be taken from the default slot.\r\n   *\r\n   *  - If `format` = `text`, the control works as a normal textblock control\r\n   *    and it is affected by most of the defined properties.\r\n   */\r\n  @Prop() readonly format: \"text\" | \"HTML\" = \"text\";\r\n  @Watch(\"format\")\r\n  formatChanged() {\r\n    // Avoid memory leaks, since the containerRef variable will be destroyed\r\n    this.#disconnectResizeObserver();\r\n  }\r\n\r\n  /**\r\n   * `true` to display a tooltip when the caption overflows the size of the\r\n   * container.\r\n   *\r\n   * Only works if `format = text` and `autoGrow = false`.\r\n   */\r\n  @Prop() readonly showTooltipOnOverflow: boolean = false;\r\n\r\n  /**\r\n   * Fired when the displayed lines overflows the control's content.\r\n   * If `true`, the current content overflows the control.\r\n   */\r\n  @Event() overflowingContentChange: EventEmitter<boolean>;\r\n\r\n  #getContentRef = () =>\r\n    this.format === \"HTML\" ? this.#htmlContentRef : this.#contentRef;\r\n\r\n  #calculateDisplayedLines = () => {\r\n    // - - - - - - - - - - - - - DOM read operations - - - - - - - - - - - - -\r\n    if (this.#currentAvailableHeight === 0) {\r\n      return;\r\n    }\r\n\r\n    const contentRef = this.#getContentRef();\r\n\r\n    const currentContentHeight = contentRef.scrollHeight;\r\n    const currentLineHeight =\r\n      this.#lineMeasuringRef.getBoundingClientRect().height;\r\n\r\n    // Nothing has change\r\n    if (\r\n      this.#availableHeight === this.#currentAvailableHeight &&\r\n      this.#contentHeight === currentContentHeight &&\r\n      this.#lineHeight === currentLineHeight\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // Store new values\r\n    this.#availableHeight = this.#currentAvailableHeight;\r\n    this.#contentHeight = currentContentHeight;\r\n    this.#lineHeight = currentLineHeight;\r\n\r\n    this.contentOverflows = this.#currentAvailableHeight < currentContentHeight;\r\n\r\n    // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n    // Calculate how many lines can display the control without overflowing\r\n    // the content\r\n    const currentDisplayedLines = Math.max(\r\n      Math.trunc(this.#currentAvailableHeight / currentLineHeight),\r\n      1\r\n    );\r\n\r\n    // Calculate the total lines displayed by the control, even if they\r\n    // overflow the content\r\n    const currentTotalLines = Math.max(\r\n      Math.trunc(currentContentHeight / currentLineHeight),\r\n      1\r\n    );\r\n\r\n    // Update the line-height value even if the displayed lines didn't change\r\n    contentRef.style.setProperty(\r\n      LINE_HEIGHT_CUSTOM_VAR,\r\n      `${currentLineHeight}px`\r\n    );\r\n\r\n    if (this.format === \"HTML\") {\r\n      contentRef.style.setProperty(\r\n        AVAILABLE_SIZE_CUSTOM_VAR,\r\n        `${this.#availableHeight}px`\r\n      );\r\n    }\r\n\r\n    // Nothing has change\r\n    if (\r\n      this.#displayedLines === currentDisplayedLines &&\r\n      this.#totalLines === currentTotalLines\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // Store new values\r\n    this.#displayedLines = currentDisplayedLines;\r\n    this.#totalLines = currentTotalLines;\r\n\r\n    contentRef.style.setProperty(\r\n      DISPLAYED_LINES_CUSTOM_VAR,\r\n      `${currentDisplayedLines}`\r\n    );\r\n  };\r\n\r\n  #setResizeObserverIfNecessary = () => {\r\n    if (this.#resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    this.#syncWithRAF = new SyncWithRAF();\r\n\r\n    this.#resizeObserver = new ResizeObserver(entries => {\r\n      const textBlockEntry = entries.find(el => el.target === this.el);\r\n\r\n      if (textBlockEntry) {\r\n        this.#currentAvailableHeight =\r\n          textBlockEntry.contentBoxSize[0].blockSize;\r\n      }\r\n\r\n      this.#syncWithRAF.perform(this.#calculateDisplayedLines);\r\n    });\r\n\r\n    const contentRef = this.#getContentRef();\r\n\r\n    this.#resizeObserver.observe(contentRef);\r\n    this.#resizeObserver.observe(this.#lineMeasuringRef);\r\n    this.#resizeObserver.observe(this.el, { box: \"content-box\" });\r\n  };\r\n\r\n  #disconnectResizeObserver = () => {\r\n    this.#resizeObserver?.disconnect();\r\n    this.#resizeObserver = undefined;\r\n\r\n    this.#syncWithRAF?.cancel();\r\n    this.#syncWithRAF = undefined;\r\n\r\n    // Reset values. Necessary when alternating between autoGrow values\r\n    this.#currentAvailableHeight = -1;\r\n    this.#availableHeight = -1;\r\n    this.#contentHeight = -1;\r\n    this.#lineHeight = -1;\r\n    this.#totalLines = -1;\r\n    this.#displayedLines = -1;\r\n  };\r\n\r\n  #autoGrowRender = () => (this.format === \"text\" ? this.caption : <slot />);\r\n\r\n  #noAutoGrowRender = () => [\r\n    <div class=\"line-measure\" ref={el => (this.#lineMeasuringRef = el)}>\r\n      {this.characterToMeasureLineHeight}\r\n    </div>,\r\n\r\n    this.format === \"text\" ? (\r\n      <p class=\"content\" ref={el => (this.#contentRef = el)}>\r\n        {this.caption}\r\n      </p>\r\n    ) : (\r\n      <div class=\"html-content\" ref={el => (this.#htmlContentRef = el)}>\r\n        <slot />\r\n      </div>\r\n    )\r\n  ];\r\n\r\n  componentDidRender() {\r\n    if (!this.autoGrow) {\r\n      this.#setResizeObserverIfNecessary();\r\n\r\n      if (this.showTooltipOnOverflow && this.format === \"text\") {\r\n        this.#syncWithRAF.perform(this.#calculateDisplayedLines);\r\n      }\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.#disconnectResizeObserver();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host\r\n        // role={this.format === \"Text\" && !this.lineClamp ? \"paragraph\" : null}\r\n        class={!this.autoGrow ? \"ch-textblock--no-auto-grow\" : undefined}\r\n        title={\r\n          this.showTooltipOnOverflow &&\r\n          this.format === \"text\" &&\r\n          !this.autoGrow &&\r\n          this.contentOverflows\r\n            ? this.caption\r\n            : undefined\r\n        }\r\n      >\r\n        {this.autoGrow ? this.#autoGrowRender() : this.#noAutoGrowRender()}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}