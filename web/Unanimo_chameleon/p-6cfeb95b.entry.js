import{r as t,c as e,g as s,h as i,H as n}from"./p-7af91c05.js";import{b as r}from"./p-79129d9d.js";import{f as h,m as l,a as o,b as c,M as a}from"./p-5f934da7.js";class d extends HTMLElement{parentGrid;static get observedAttributes(){return["selected","marked"]}constructor(){super()}connectedCallback(){this.addEventListener("cellCaretClicked",this.cellCaretClickedHandler);if(this.selected||this.marked){this.grid.syncRowState(this)}}attributeChangedCallback(t,e,s){if(t==="selected"){this.selected=s!==null?s!=="false":false}if(t==="marked"){this.marked=s!==null?s!=="false":false}this.grid?.syncRowState(this)}get grid(){return this.parentGrid??this.loadParentGrid()}get rowId(){return this.getAttribute("rowid")??""}get highlighted(){return this.hasAttribute("highlighted")}set highlighted(t){const e=this.grid.rowHighlightedClass?.split(" ");if(t===true){this.setAttribute("highlighted","");if(this.grid.rowHighlightedClass){this.classList.add(...e)}}else{this.removeAttribute("highlighted");if(this.grid.rowHighlightedClass){this.classList.remove(...e)}}}get selected(){return this.hasAttribute("selected")}set selected(t){const e=this.grid.rowSelectedClass?.split(" ");if(t===true){if(!this.hasAttribute("selected")){this.setAttribute("selected","")}if(this.grid.rowSelectedClass){this.classList.add(...e)}}else{this.removeAttribute("selected");if(this.grid.rowSelectedClass){this.classList.remove(...e)}}}get marked(){return this.hasAttribute("marked")}set marked(t){const e=this.grid.rowMarkedClass?.split(" ");if(t===true){if(!this.hasAttribute("marked")){this.setAttribute("marked","")}if(this.grid.rowMarkedClass){this.classList.add(...e)}}else{this.removeAttribute("marked");if(this.grid.rowMarkedClass){this.classList.remove(...e)}}}get focused(){return this.hasAttribute("focused")}set focused(t){const e=this.grid.rowFocusedClass?.split(" ");if(t===true){this.setAttribute("focused","");if(this.grid.rowFocusedClass){this.classList.add(...e)}}else{this.removeAttribute("focused");if(this.grid.rowFocusedClass){this.classList.remove(...e)}}}get hasChildRows(){return!!this.querySelector("ch-grid-rowset")}get collapsed(){return this.hasAttribute("collapsed")}set collapsed(t){const e=this.collapsed!==t;if(t){this.setAttribute("collapsed","")}else{this.removeAttribute("collapsed")}if(e){this.dispatchEvent(new CustomEvent("rowCollapsedChanged",{bubbles:true,composed:true,detail:{rowId:this.rowId,collapsed:t}}))}}get leaf(){return this.hasAttribute("leaf")}set leaf(t){if(t===true){this.setAttribute("leaf","")}else{this.removeAttribute("leaf")}}getCell(t){return this.querySelector(`:scope > ch-grid-cell:nth-of-type(${t.physicalOrder})`)}isVisible(){return Array.from(this.querySelectorAll(":scope > ch-grid-cell")).some((t=>t.isVisible()))}ensureVisible(){this.dispatchEvent(new CustomEvent("rowEnsureVisible",{bubbles:true,composed:true}))}getBoundingClientRect(){let t;if(!this.firstElementChild){t=new DOMRect}else if(this.firstElementChild===this.lastElementChild){t=this.firstElementChild.getBoundingClientRect()}else{const e=this.firstElementChild.getBoundingClientRect();const s=this.lastElementChild.getBoundingClientRect();t=new DOMRect(e.x,e.y,s.x-e.x+s.width,s.y-e.y+s.height)}return t}cellCaretClickedHandler(t){const e=t.currentTarget;if(e.hasChildRows){this.collapsed=!this.collapsed}t.stopPropagation()}loadParentGrid(){this.parentGrid=this.closest("ch-grid");return this.parentGrid}}if(!customElements.get("ch-grid-row")){customElements.define("ch-grid-row",d)}class u extends HTMLElement{computedLevel=0;grid;constructor(){super()}connectedCallback(){this.addEventListener("rowsetLegendClicked",this.rowsetLegendClickedHandler);this.defineLevel()}get collapsed(){return this.hasAttribute("collapsed")}set collapsed(t){if(t){this.setAttribute("collapsed","")}else{this.removeAttribute("collapsed")}}get level(){if(!this.computedLevel){this.computeLevel()}return this.computedLevel}getBoundingClientRect(){let t;const e=parseInt(this.style.getPropertyValue("padding-top"));const s=parseInt(this.style.getPropertyValue("padding-bottom"));if(!this.firstElementChild){const e=this.grid.shadowRoot.querySelector(".main").getBoundingClientRect();t=new DOMRect(e.x,e.y,e.width,0)}else if(this.firstElementChild===this.lastElementChild){const i=this.firstElementChild.getBoundingClientRect();t=new DOMRect(i.x,i.y-e,i.x+i.width,i.y+i.height+e+s)}else{const i=this.firstElementChild.getBoundingClientRect();const n=this.lastElementChild.getBoundingClientRect();t=new DOMRect(i.x,i.y-e,n.x-i.x+n.width,n.y-i.y+n.height+e+s)}return t}rowsetLegendClickedHandler(t){t.stopPropagation();this.collapsed=!this.collapsed}defineLevel(){this.style.setProperty("--level",this.level.toString())}computeLevel(){this.computedLevel=this.getParentRowset()?.level??0;if(this.hasLegend()||this.isNestedRow()){this.computedLevel++}}hasLegend(){return this.firstElementChild?.tagName==="CH-GRID-ROWSET-LEGEND"}isNestedRow(){return this.parentElement.tagName==="CH-GRID-ROW"}getParentRowset(){const t=this.parentElement.closest("ch-grid-rowset, ch-grid");if(t.tagName==="CH-GRID-ROWSET"){return t}return undefined}}if(!customElements.get("ch-grid-rowset")){customElements.define("ch-grid-rowset",u)}var f;(function(t){t["Plain"]="plain";t["Rich"]="rich";t["TreeNode"]="node"})(f||(f={}));class g extends HTMLElement{cellType=f.Plain;caret;drag;action;selector;selectorLabel;rowDrag;rowSelector;rowActions;static get observedAttributes(){return["cell-type","row-drag","row-selector","row-actions"]}constructor(){super();this.defineFocusHandler()}connectedCallback(){if(this.cellType!==f.Plain){this.define()}}attributeChangedCallback(t,e,s){if(t==="cell-type"){this.cellType=s}if(t==="row-drag"){this.cellType=f.Rich;this.rowDrag=s!==null?s!=="false":false}if(t==="row-selector"){this.cellType=f.Rich;this.rowSelector=s!==null?s!=="false":false}if(t==="row-actions"){this.cellType=f.Rich;this.rowActions=s!==null?s!=="false":false}}get type(){return this.cellType}set type(t){if(this.cellType!==t){this.cellType=t;this.define()}}get grid(){return this.closest("ch-grid")}get column(){const t=Array.prototype.indexOf.call(this.row.querySelectorAll(`:scope > ch-grid-cell`),this);return this.grid.querySelector(`ch-grid-column:nth-of-type(${t+1})`)}get row(){return this.parentElement}get cellId(){return this.getAttribute("cellid")??""}get selected(){return this.hasAttribute("selected")}set selected(t){if(t===true){this.setAttribute("selected","")}else{this.removeAttribute("selected")}}get focused(){return this.hasAttribute("focused")}set focused(t){if(t===true){this.setAttribute("focused","")}else{this.removeAttribute("focused")}}isVisible(){return this.offsetParent!==null}ensureVisible(){this.dispatchEvent(new CustomEvent("cellEnsureVisible",{bubbles:true,composed:true}))}setSelectorChecked(t){this.selector.checked=t;if(this.selector.checked){this.selector.setAttribute("part","selector checked")}else{this.selector.setAttribute("part","selector")}}defineFocusHandler(){this.addEventListener("focusin",(()=>{if(!this.rowSelector){this.dispatchEvent(new CustomEvent("cellFocused",{bubbles:true,composed:true}))}}))}caretMouseDownHandler(t){t.stopPropagation();this.dispatchEvent(new CustomEvent("cellCaretClicked",{bubbles:true,composed:true}))}selectorClickHandler(t){t.stopPropagation();this.dispatchEvent(new CustomEvent("cellSelectorClicked",{bubbles:true,composed:true,detail:{checked:this.selector.checked,range:t.shiftKey}}))}selectorLabelClickHandler(t){if(!t.shiftKey){t.stopPropagation()}}dragMouseDownHandler(t){t.preventDefault();t.stopPropagation();this.dispatchEvent(new CustomEvent("rowDragStarted",{bubbles:true,composed:true,detail:{row:this.row}}))}actionClickHandler(){this.dispatchEvent(new CustomEvent("cellRowActionClicked",{bubbles:true,composed:true}))}define(){switch(this.cellType){case f.Rich:this.defineRich();break;case f.TreeNode:this.defineTreeNode();break}}defineRich(){let t="";if(!this.shadowRoot||this.shadowRoot.innerHTML===""){this.attachShadow({mode:"open"});if(this.rowDrag){t+=`\n          <div part="drag-icon"></div>\n        `}if(this.rowSelector){t+=`\n          <style>label {display:flex}</style>\n          <label part="selector-label">\n            <input type="checkbox" part="selector">\n          </label>\n        `}if(this.rowActions){t+=`\n          <button part="actions-icon"></button>\n        `}this.shadowRoot.innerHTML=`\n        ${t}\n        <slot></slot>\n      `;if(this.rowDrag){this.drag=this.shadowRoot.querySelector("[part='drag-icon']");this.drag.addEventListener("mousedown",this.dragMouseDownHandler.bind(this))}if(this.rowActions){this.action=this.shadowRoot.querySelector("[part='actions-icon']");this.action.addEventListener("click",this.actionClickHandler.bind(this))}if(this.rowSelector){this.selector=this.shadowRoot.querySelector("[part='selector']");this.selector.addEventListener("mousedown",(t=>t.stopPropagation()));this.selector.addEventListener("touchend",(t=>t.stopPropagation()));this.selector.addEventListener("click",this.selectorClickHandler.bind(this));this.selectorLabel=this.shadowRoot.querySelector("[part='selector-label']");this.selectorLabel.addEventListener("mousedown",(t=>t.stopPropagation()));this.selectorLabel.addEventListener("touchend",(t=>t.stopPropagation()));this.selectorLabel.addEventListener("click",this.selectorLabelClickHandler.bind(this))}}}defineTreeNode(){if(!this.shadowRoot||this.shadowRoot.innerHTML===""){this.attachShadow({mode:"open"});this.shadowRoot.innerHTML=`\n        <style>:host::before {content: none !important}</style>\n        <div part="indent"></div>\n        <div part="caret"></div>\n        <input type="checkbox" part="node-selector" hidden>\n        <div part="node-icon"></div>\n        <slot></slot>\n      `;this.caret=this.shadowRoot.querySelector("[part='caret']");this.caret.addEventListener("mousedown",this.caretMouseDownHandler.bind(this))}}}if(!customElements.get("ch-grid-cell")){customElements.define("ch-grid-cell",g)}class m{column;columns;isRTL;lastTargetOrder=0;constructor(t,e,s){this.isRTL=s;this.columns=e.map((t=>({element:t,rect:t.getBoundingClientRect(),translateX:0,order:t.order})));this.column=this.columns.find((e=>e.element.columnId===t));this.columns.forEach(this.setColumnHiddenRect.bind(this))}dragging(t){const e=this.column.element.order;const s=this.column.element.freeze;let i=0;let n=false;this.column.translateX=0;this.columns.filter((t=>t.element.freeze===s)).forEach((s=>{const n=s.element.order;const r=e>n?1:-1;const h=(e>n?1:-1)*(this.isRTL?-1:1);if(s.rect.left<t&&t<s.rect.right&&n!==e){this.swapColumnPosition(s,h);s.order=s.element.order+r;i=n}else if(t<s.rect.left&&(this.isRTL?n>e:n<e)){this.swapColumnPosition(s,h);s.order=s.element.order+r;if(!i||(this.isRTL?n>i:n<i)){i=n}}else if(t>s.rect.right&&(this.isRTL?n<e:n>e)){this.swapColumnPosition(s,h);s.order=s.element.order+r;if(!i||(this.isRTL?n<i:n>i)){i=n}}else if(n!==e){this.resetColumnPosition(s)}}));this.column.order=i?i:this.column.element.order;n=i!==this.lastTargetOrder;this.lastTargetOrder=i;return n}dragEnd(){this.columns.forEach((t=>{t.element.order=t.order;t.translateX=0}))}getColumnStyle(t){return{[`--ch-grid-column-${t.physicalOrder}-transform`]:`translateX(${this.columns.find((e=>e.element===t)).translateX}px)`}}getColumnsFirstLast(){let t;let e;this.columns.forEach((s=>{if(!s.element.hidden&&(!t||s.order<t.order)){t=s}if(!s.element.hidden&&(!e||s.order>e.order)){e=s}}));return{columnFirst:t.element,columnLast:e.element}}swapColumnPosition(t,e){t.translateX=this.column.rect.width*e;this.column.translateX+=t.rect.width*(e*-1)}resetColumnPosition(t){t.translateX=0;t.order=t.element.order}setColumnHiddenRect(t){if(t.element.hidden){const e=this.getPreviousSiblingVisible(t)||this.getNextSiblingVisible(t);t.rect=new DOMRect(t.element.order<e.element.order?e.rect.left:e.rect.right,e.rect.y,0,e.rect.height)}}getPreviousSiblingVisible(t){let e;this.columns.forEach((s=>{if(!s.element.hidden&&s.element.order<t.element.order&&(!e||s.element.order>e.element.order)){e=s}}));return e}getNextSiblingVisible(t){let e;this.columns.forEach((s=>{if(!s.element.hidden&&s.element.order>t.element.order&&(!e||s.element.order<e.element.order)){e=s}}));return e}}class w{manager;columnsetObserver=new MutationObserver(this.reloadColumns.bind(this));columnResizeObserver=new ResizeObserver(this.resizeColumnHandler.bind(this));columns;columnsDisplay=[];columnsWidth=[];constructor(t){this.manager=t;this.columns=Array.from(this.manager.grid.querySelectorAll("ch-grid-column"));this.observeColumnset();this.defineColumns(this.columns);this.defineColumnsVariables();this.adjustFreezeOrder();this.adjustBaseLayer()}getColumn(t){return this.columns.find((e=>e.columnId===t))}getColumns(t=false){if(t){return this.columns.sort(this.fnSortByOrder)}return this.columns}getColumnsFirstLast(){let t;let e;this.columns.forEach((s=>{if(!s.hidden&&(!t||s.order<t.order)){t=s}if(!s.hidden&&(!e||s.order>e.order)){e=s}}));return{columnFirst:t,columnLast:e}}getColumnSelector(){return this.columns.find((t=>t.columnType==="rich"&&t.richRowSelector))}adjustFreezeOrder(){const t=this.columns.filter((t=>t.freeze==="start")).sort(this.fnSortByOrder);const e=this.columns.filter((t=>t.freeze!=="start"&&t.freeze!=="end")).sort(this.fnSortByOrder);const s=this.columns.filter((t=>t.freeze==="end")).sort(this.fnSortByOrder);let i=1;t.forEach((t=>t.order=i++));e.forEach((t=>t.order=i++));s.forEach((t=>t.order=i++))}defineColumns(t){t.forEach((t=>{this.defineColumnId(t);this.defineColumnIndex(t);this.defineColumnOrder(t);this.defineColumnSize(t);this.defineColumnDisplayObserver(t);this.defineColumnResizeObserver(t);this.defineColumnType(t)}))}defineColumnId(t){t.columnId||=this.getColumnUniqueId()}defineColumnIndex(t){t.physicalOrder=this.columns.indexOf(t)+1}defineColumnOrder(t){t.order||=t.physicalOrder}defineColumnSize(t){t.size||="auto"}defineColumnDisplayObserver(t){if(t.displayObserverClass&&!t.hidden){const e=this.columnsDisplay.push(document.createElement("ch-grid-column-display"))-1;this.columnsDisplay[e].setAttribute("slot","column-display");this.columnsDisplay[e].setAttribute("class",t.displayObserverClass);this.columnsDisplay[e].column=t;this.manager.grid.appendChild(this.columnsDisplay[e])}}defineColumnResizeObserver(t){this.columnResizeObserver.observe(t,{box:"border-box"})}defineColumnType(t){switch(t.columnType){case"tree":this.manager.grid.querySelectorAll(`ch-grid-cell:nth-child(${t.physicalOrder})`).forEach((t=>{t.type=f.TreeNode}));break;case"rich":this.manager.grid.querySelectorAll(`ch-grid-cell:nth-child(${t.physicalOrder})`).forEach((e=>{e.rowDrag=t.richRowDrag;e.rowSelector=t.richRowSelector;e.rowActions=t.richRowActions;e.type=f.Rich}));break}}defineColumnsVariables(){const t=this.manager.grid.getRootNode();const e=t.querySelector("#ch-grid-columns-variables");if(!e||parseInt(e.getAttribute("data-columns"))<this.columns.length){let s="";for(let t=1;t<=this.columns.length;t++){s+=`ch-grid-column:nth-child(${t}), ch-grid-cell:nth-child(${t}) {\n                        display: var(--ch-grid-column-${t}-display, flex);\n                        grid-column: var(--ch-grid-column-${t}-position, ${t});\n                        margin-inline-start: var(--ch-grid-column-${t}-margin-start);\n                        border-inline-start: var(--ch-grid-column-${t}-border-start);\n                        padding-inline-start: var(--ch-grid-column-${t}-padding-start);\n                        margin-inline-end: var(--ch-grid-column-${t}-margin-end);\n                        border-inline-end: var(--ch-grid-column-${t}-border-end);\n                        padding-inline-end: var(--ch-grid-column-${t}-padding-end);\n                        left: var(--ch-grid-column-${t}-left-freeze);\n                        right: var(--ch-grid-column-${t}-right-freeze);\n                    }\n                    ch-grid-column:nth-child(${t}) {\n                      transform: var(--ch-grid-column-${t}-transform);\n                      z-index: calc(var(--ch-grid-column-${t}-z-index-freeze, 0) + var(--ch-grid-column-z-index-head, 0)  + var(--ch-grid-column-z-index-active, 0));\n                    }\n                    ch-grid-cell:nth-child(${t}) {\n                      transform: var(--ch-grid-virtual-scroller-position,) var(--ch-grid-column-${t}-transform,);\n                      z-index: calc(var(--ch-grid-column-${t}-z-index-freeze, 0) + var(--ch-grid-cell-z-index-active, 0));\n                    }\n                    ch-grid-cell:nth-child(${t})::before {\n                      content: var(--ch-grid-column-${t}-content);\n                    }\n                `}const i=`@layer ch-grid {\n        ${s}\n      }`;if(e){e.setAttribute("data-columns",this.columns.length.toString());e.innerHTML=i}else if(t instanceof Document){t.head.insertAdjacentHTML("beforeend",`<style id="ch-grid-columns-variables" data-columns="${this.columns.length}">${i}</style>`)}else if(t instanceof ShadowRoot){const e=document.createElement("style");e.id="ch-grid-columns-variables";e.dataset.columns=this.columns.length.toString();e.innerText=i;t.appendChild(e)}}}undefineColumns(t){t.forEach((t=>{this.columnResizeObserver.unobserve(t);this.columnsDisplay.filter((e=>e.column===t)).forEach((t=>{t.remove()}))}))}observeColumnset(){this.columnsetObserver.observe(this.manager.grid.querySelector("ch-grid-columnset"),{childList:true})}reloadColumns(){const t=Array.from(this.manager.grid.querySelectorAll("ch-grid-column"));const e=t.filter((t=>!this.columns.includes(t)));const s=this.columns.filter((e=>!t.includes(e)));if(e.length||s.length){this.columns=t;this.undefineColumns(s);this.defineColumns(e);this.defineColumnsVariables();this.adjustOrders();this.adjustBaseLayer()}}resizeColumnHandler(t){for(const e of t){const t=e.target;this.columnsWidth[t.physicalOrder-1]=e.contentRect.width}this.manager.setColumnWidthVariables(this.columnsWidth)}getColumnUniqueId(){const t=Date.now().toString(36)+Math.random().toString(36).substring(2);return`ch-grid-column-auto-${t}`}adjustOrders(){this.columns.forEach(((t,e)=>t.physicalOrder=e+1));[...this.columns].sort(this.fnSortByOrder).forEach(((t,e)=>{t.order=e+1}))}adjustBaseLayer(){this.manager.setBaseLayer(this.columns.length)}fnSortByOrder(t,e){if(t.order<e.order){return-1}if(t.order>e.order){return 1}return 0}}class b{manager;rangeStart;rangeValue;lastSelected;lastRowMarked;selectionStateNone={rowFocused:null,rowsSelected:[],cellFocused:null,cellSelected:null};touch;selecting;selectingRow;selectingCell;constructor(t){this.manager=t}touchStart(t){this.touch={clientX:t.touches[0].clientX,clientY:t.touches[0].clientY}}isTouchEndSelection(t){return Math.abs(this.touch.clientX-t.changedTouches[0].clientX)<10&&Math.abs(this.touch.clientY-t.changedTouches[0].clientY)<10&&t.cancelable}select(t,e,s,i,n,r,h,l){const o=this.manager.grid;if(o.keyboardNavigationMode==="none"&&o.rowSelectionMode==="none"){return this.selectionStateNone}if(o.rowSelectionMode==="none"){i=false}if(o.rowSelectionMode!=="multiple"){n=false;r=false}if(!e){return t}let{rowFocused:c,rowsSelected:a,cellFocused:d,cellSelected:u}=t;c=e;d=s;if(r){if(!this.rangeStart){if(h==="focus"){this.rangeStart=t.rowFocused;this.rangeValue=n?!t.rowFocused.selected:true}else if(h==="last-selected"){this.rangeStart=this.lastSelected??t.rowFocused;this.rangeValue=n?this.lastSelected.selected:true}}const i=this.manager.getRowsRange(this.rangeStart??e,e);if(this.rangeValue){if(n){a=Array.from(new Set(a.concat(i)))}else{a=this.preserveInstanceIfSame(i,t.rowsSelected)}u=s||e.getCell(u?.column||this.manager.getFirstColumn())}else{a=a.filter((t=>!i.includes(t)));u=null}}else if(n){this.rangeStart=null;this.lastSelected=e;if(a.includes(e)){a=a.filter((t=>t!==e));u=t.cellSelected?.row===e?null:u}else{a=[...a,e];u=s||e.getCell(u?.column||this.manager.getFirstColumn())}}else if(i){this.rangeStart=null;this.lastSelected=e;if(!(l&&t.rowsSelected.includes(e))){a=this.preserveInstanceIfSame([e],t.rowsSelected)}u=s||e.getCell(u?.column||this.manager.getFirstColumn())}else{this.rangeStart=null}return{rowFocused:c,rowsSelected:a,cellFocused:d,cellSelected:u}}selectAll(t,e=true){if(this.manager.grid.rowSelectionMode==="none"){return this.selectionStateNone}const s=this.manager.getRows();let i=t.rowFocused;let n=t.rowsSelected;let r=t.cellFocused;let h=t.cellSelected;i??=this.manager.getFirstRow();r??=i?.getCell(t.cellFocused?.column||this.manager.getFirstColumn());if(e){n=s;h=r}else{n=[];h=null}return{rowFocused:i,rowsSelected:n,cellFocused:r,cellSelected:h}}selectSet(t,e,s,i=true){let n=true;if(this.manager.grid.rowSelectionMode==="none"){return this.selectionStateNone}if(this.manager.grid.rowSelectionMode!=="multiple"){n=false}let r=t.rowFocused;let h=t.rowsSelected;let l=t.cellFocused;let o=t.cellSelected;r=e;l=s;if(i){if(n){h=h.includes(e)?h:[...h,e]}else{h=h.includes(e)?h:[e]}o=s}else{h=!h.includes(e)?h:h.filter((t=>t!==e));o=null}return{rowFocused:r,rowsSelected:h,cellFocused:l,cellSelected:o}}moveFirstRow(t,e,s,i){const n=this.manager.getFirstRow();if(n){return this.select(t,n,n.getCell(t.cellFocused.column),e,i,s,"focus",false)}return t}movePreviousRow(t,e,s,i){const n=this.manager.getPreviousRow(t.rowFocused);if(n){return this.select(t,n,n.getCell(t.cellFocused.column),e,i,s,"focus",false)}return t}moveNextRow(t,e,s,i){const n=this.manager.getNextRow(t.rowFocused);if(n){return this.select(t,n,n.getCell(t.cellFocused.column),e,i,s,"focus",false)}return t}moveLastRow(t,e,s,i){const n=this.manager.getLastRow();if(n){return this.select(t,n,n.getCell(t.cellFocused.column),e,i,s,"focus",false)}return t}movePreviousPageRow(t,e,s,i){const n=this.manager.getRows();const r=this.manager.getRowsPerPage();const h=n[Math.max(n.indexOf(t.rowFocused)-r,0)];if(h){return this.select(t,h,h.getCell(t.cellFocused.column),e,i,s,"focus",false)}return t}moveNextPageRow(t,e,s,i){const n=this.manager.getRows();const r=this.manager.getRowsPerPage();const h=n[Math.min(n.indexOf(t.rowFocused)+r,n.length-1)];if(h){return this.select(t,h,h.getCell(t.cellFocused.column),e,i,s,"focus",false)}return t}movePreviousCell(t,e,s){const i=this.manager.getPreviousCell(t.cellFocused);if(i){return this.select(t,t.rowFocused,i,e,false,s,"focus",false)}return t}moveNextCell(t,e,s){const i=this.manager.getNextCell(t.cellFocused);if(i){return this.select(t,t.rowFocused,i,e,false,s,"focus",false)}return t}markRow(t,e,s,i){if(t){if(s){const e=!t.marked;const s=this.manager.getRowsRange(this.lastRowMarked??t,t);this.lastRowMarked=t;if(e){return i.concat(s.filter((t=>!i.includes(t))))}return i.filter((t=>!s.includes(t)))}this.lastRowMarked=t;if(e&&!i.includes(t)){return i.concat([t])}if(!e&&i.includes(t)){return i.filter((e=>e!==t))}}return i}markRows(t,e,s){const i=s.includes(t)?s:[t];if(i.some((t=>!t.marked))){return Array.from(new Set(e.concat(i)))}return e.filter((t=>!i.includes(t)))}markAllRows(t=true){if(t){return this.manager.getRows()}return[]}syncRowSelector(t,e=[],s){const i=this.manager.columns.getColumnSelector();if(i?.richRowSelectorMode===s){const s=i.physicalOrder-1;e?.filter((e=>!t.includes(e))).forEach((t=>{t.marked=false;const e=t.children[s];e.setSelectorChecked(false)}));t?.forEach((t=>{t.marked=i.richRowSelectorMode==="mark";const e=t.children[s];e.setSelectorChecked(true)}));this.syncColumnSelector(t.length,i)}}syncColumnSelector(t,e){e??=this.manager.columns.getColumnSelector();if(t===0){e.richRowSelectorState=""}else if(t===this.manager.getRows().length){e.richRowSelectorState="checked"}else{e.richRowSelectorState="indeterminate"}}preserveInstanceIfSame(t,e){return t.length===e.length&&t.every((t=>e.includes(t)))?e:t}}class p{manager;row;rowIndex;rowShadow;dragMouseMoveFn=this.dragMouseMoveHandler.bind(this);constructor(t){this.manager=t}dragStart(t){this.row=t;this.rowIndex=this.manager.getGridRowIndex(t);this.defineListeners();this.createRowShadow();this.floatRow();this.updateRowPosition()}dragMouseMoveHandler(t){const e=t.target;const s=e.closest("ch-grid-row");if(s&&s.parentElement===this.row.parentElement&&s.grid===this.manager.grid){const t=this.manager.getGridRowIndex(s);const e=t+2;const i=this.rowIndex<t?-1:1;if(this.rowShadow.style.getPropertyValue("--row-shadow-row-start")!==`${e}`){this.rowShadow.style.setProperty("--row-shadow-row-start",`${e}`)}else{this.rowShadow.style.setProperty("--row-shadow-row-start",`${e+i}`)}this.updateRowPosition()}}dragMouseUpHandler(){document.removeEventListener("mousemove",this.dragMouseMoveFn);const t=parseInt(this.rowShadow.style.getPropertyValue("--row-shadow-row-start"));const e=this.manager.grid.querySelectorAll("ch-grid-row").item(t-2);if(t<this.rowIndex+2){e.before(this.row)}if(t>this.rowIndex+2){e.after(this.row)}this.unfloatRow();this.rowShadow.remove();this.row=null;this.rowShadow=null}defineListeners(){document.addEventListener("mousemove",this.dragMouseMoveFn,{passive:true});document.addEventListener("mouseup",this.dragMouseUpHandler.bind(this),{once:true})}createRowShadow(){const t=this.manager.getRowHeight(this.row);this.rowShadow=document.createElement("div");this.rowShadow.style.display="contents";this.manager.getColumnsWidth().forEach((e=>{const s=document.createElement("div");s.style.opacity="0";s.style.minWidth=e;s.style.height=`${t}px`;s.style.gridRowStart="var(--row-shadow-row-start)";this.rowShadow.append(s)}))}floatRow(){const t=this.manager.getColumnsWidth();const e=this.manager.gridLayout.clientWidth;this.row.before(this.rowShadow);this.row.setAttribute("dragging","");this.row.style.width=`${e}px`;this.row.querySelectorAll(":scope > ch-grid-cell").forEach(((e,s)=>{const i=parseInt(this.manager.gridLayout.style.getPropertyValue(`--ch-grid-column-${s+1}-position`));if(!e.hidden){e.style.width=t[i-1];e.style.order=`${i}`}}))}unfloatRow(){this.row.removeAttribute("dragging");this.row.style.width="";this.row.querySelectorAll(":scope > ch-grid-cell").forEach((t=>{t.style.width="";t.style.order=""}))}updateRowPosition(){const t=this.rowShadow.children[0].getBoundingClientRect();this.row.style.top=`${t.top}px`;this.row.style.left=`${t.left}px`}}class k{manager;showOnRowHover;showOnRowActions;showOnRowContext;constructor(t){this.manager=t;this.manager.grid.querySelectorAll("ch-grid-row-actions")?.forEach((t=>{if(t.showOnRowHover){this.showOnRowHover=t}if(t.showOnRowActions){this.showOnRowActions=t}if(t.showOnRowContext){this.showOnRowContext=t}}))}}class v{manager;column;columnWidthStart;columnSizeStart;columnAfter;columnAfterWidthStart;columnAfterSizeStart;dragDirection;resizingFn;resizeEndFn;constructor(t,e,s){this.manager=t;this.dragDirection=s?-1:1;if(this.manager.grid.columnResizeMode==="splitter"){this.resizingFn=this.resizingSplitter;this.resizeEndFn=this.resizeEndSplitter}else{this.resizingFn=this.resizingSingle;this.resizeEndFn=null}this.column=this.manager.columns.getColumn(e);this.columnWidthStart=this.column.getBoundingClientRect().width;this.columnSizeStart=this.parseCSSValue(this.column.size);this.columnAfter=this.manager.getNextColumn(this.column);this.columnAfterWidthStart=this.columnAfter?.getBoundingClientRect().width;this.columnAfterSizeStart=this.parseCSSValue(this.columnAfter.size)}resizing(t){this.resizingFn(t)}resizeEnd(){if(this.resizeEndFn){this.resizeEndFn()}}resizingSingle=t=>{const e=this.columnWidthStart-t*this.dragDirection;if(e>=0){this.column.size=`minmax(min-content, ${e}px)`}};resizingSplitter=t=>{const e=this.columnWidthStart-t*this.dragDirection;if(e>=0){if(this.columnSizeStart){this.column.size=this.convertUnit(this.columnSizeStart,this.columnWidthStart,e)}else{this.column.size=`minmax(min-content, ${e}px)`}}if(this.columnAfter){const e=this.columnAfterWidthStart+t*this.dragDirection;if(e>=0){if(this.columnAfterSizeStart){this.columnAfter.size=this.convertUnit(this.columnAfterSizeStart,this.columnAfterWidthStart,e)}else{this.columnAfter.size=`minmax(min-content, ${e}px)`}}}};resizeEndSplitter(){const t=this.column.getBoundingClientRect().width;this.column.size=this.convertUnit(this.columnSizeStart,this.columnWidthStart,t);if(this.columnAfter){const e=this.columnAfterWidthStart-(t-this.columnWidthStart);this.columnAfter.size=this.convertUnit(this.columnSizeStart,this.columnWidthStart,e)}}parseCSSValue(t){const e=t.match(/([+-]?[\d.]+)([\w%]+)/);if(e){const t=parseFloat(e[1]);const s=e[2];return{number:t,unit:s}}return null}convertUnit(t,e,s){return`${s*t.number/e}${t.unit}`}}var y;(function(t){t[t["BASE_LAYER"]=0]="BASE_LAYER";t[t["COLUMNS_WIDTH"]=1]="COLUMNS_WIDTH"})(y||(y={}));class C{styleSheet=new CSSStyleSheet;gridLayoutElement;columnDragManager;columnResizeManager;rowDragManager;grid;selection;columns;rowActions;constructor(t){this.grid=t;this.styleSheet.insertRule(`:host {}`,y.BASE_LAYER);this.styleSheet.insertRule(".main {}",y.COLUMNS_WIDTH);this.grid.shadowRoot.adoptedStyleSheets.push(this.styleSheet);r(this.grid.shadowRoot.adoptedStyleSheets);this.columns=new w(this);this.selection=new b(this);this.rowActions=new k(this)}get gridLayout(){return this.gridLayoutElement}componentDidLoad(t){this.gridLayoutElement=t}getColumns(){return this.columns.getColumns()}getColumnsWidth(){return getComputedStyle(this.gridLayout).gridTemplateColumns.split(" ")}getColumnsetHeight(){const t=getComputedStyle(this.gridLayout).gridTemplateRows.split(" ");return parseInt(t[0])||0}getFirstColumn(){return this.columns.getColumnsFirstLast().columnFirst}getFirstRow(){return this.grid.querySelector("ch-grid-row")}getScrollOffsetTop(){return this.gridLayout.offsetTop+this.getColumnsetHeight()}getScrollOffsetLeft(){return this.columns.getColumns(true).reduce(((t,e)=>e.freeze==="start"&&!e.hidden?t+e.offsetWidth:t),0)}getScrollOffsetRight(){return this.columns.getColumns(true).reduce(((t,e)=>e.freeze==="end"&&!e.hidden?t+e.offsetWidth:t),0)}getPreviousRow(t){const e=this.getRows();const s=e.indexOf(t);return e.slice(0,s).reverse().find((t=>t.isVisible()))}getNextRow(t){const e=this.getRows();const s=e.indexOf(t);return e.slice(s+1).find((t=>t.isVisible()))}getLastRow(){const t=this.getRows();return t.reverse().find((t=>t.isVisible()))}getPreviousColumn(t){return this.columns.getColumns().reduce(((e,s)=>s.order<t.order&&!s.hidden&&(!e||s.order>e.order)?s:e),null)}getNextColumn(t){return this.columns.getColumns().reduce(((e,s)=>s.order>t.order&&!s.hidden&&(!e||s.order<e.order)?s:e),null)}getPreviousCell(t){const e=this.getPreviousColumn(t.column);if(e){return t.row.querySelector(`:scope > ch-grid-cell:nth-of-type(${e.physicalOrder})`)}}getNextCell(t){const e=this.getNextColumn(t.column);if(e){return t.row.querySelector(`:scope > ch-grid-cell:nth-of-type(${e.physicalOrder})`)}}getGridRowIndex(t){return Array.prototype.indexOf.call(this.grid.querySelectorAll("ch-grid-row, ch-grid-rowset-legend"),t)}getRowsetRowIndex(t){return Array.prototype.indexOf.call(t.parentElement.children,t)}getRowHeight(t){const e=getComputedStyle(this.gridLayout).gridTemplateRows.split(" ");const s=this.getGridRowIndex(t)+1;return parseInt(e[s])||0}getRowsPerPage(){const t=this.gridLayout.clientHeight;const e=this.getColumnsetHeight();const s=this.getRowHeight(this.getFirstRow());return Math.floor((t-e)/s)}getRow(t){return this.grid.querySelector(`ch-grid-row[rowid="${t}"]`)}getRows(t="all"){const e=Array.from(this.grid.querySelectorAll(`ch-grid-row`));if(t==="visible"){return e.filter((t=>t.isVisible()))}return e}getRowsRange(t,e){const s=this.getRows();const i=s.indexOf(t);const n=s.indexOf(e);return s.slice(Math.min(i,n),Math.max(i,n)+1).filter((t=>t.isVisible()))}getRowEventTarget(t){return t.composedPath().find((t=>t.tagName==="CH-GRID-ROW"))}isRowActionsEventTarget(t){return t.composedPath().find((t=>t.tagName==="CH-GRID-ROW-ACTIONS"))!=null}getCell(t,e,s){if(t){return this.grid.querySelector(`ch-grid-cell[cellid="${t}"]`)}if(e&&s){const t=this.getRow(e);const i=this.columns.getColumn(s);if(t&&i){return t.getCell(i)}}}getCellEventTarget(t){return t.composedPath().find((t=>t.tagName==="CH-GRID-CELL"))}columnDragStart(t){this.columnDragManager=new m(t,this.columns.getColumns(),this.isRTLDirection())}columnDragging(t){return this.columnDragManager.dragging(t)}columnDragEnd(){this.columnDragManager.dragEnd();this.columnDragManager=null}columnResizeStart(t){this.columnResizeManager=new v(this,t,this.isRTLDirection())}columnResizing(t){this.columnResizeManager.resizing(t)}columnResizeEnd(){this.columnResizeManager.resizeEnd();this.columnResizeManager=null}rowDragStart(t){this.rowDragManager=new p(this);this.rowDragManager.dragStart(t)}getGridStyle(){return{display:"grid",...this.getGridTemplateColumns(),...this.getRowBoxSimulationStyle(),...this.getDragTransitionStyle(),...this.getColumnsStyle()}}setBaseLayer(t){this.styleSheet.deleteRule(y.BASE_LAYER);this.styleSheet.insertRule(`:host { --ch-grid-base-layer: ${t}; }`,y.BASE_LAYER)}setColumnWidthVariables(t){this.styleSheet.deleteRule(y.COLUMNS_WIDTH);this.styleSheet.insertRule(`.main { ${t.map(((t,e)=>`--ch-grid-column-${e+1}-width:${t}px;`)).join("\n")} }`,y.COLUMNS_WIDTH)}ensureRowVisible(t){let e=t.parentElement.closest("ch-grid-row, ch-grid-rowset");const{columnFirst:s}=this.columns.getColumnsFirstLast();while(e){e.collapsed=false;e=e.parentElement.closest("ch-grid-row, ch-grid-rowset")}if(t.children[s.physicalOrder]){this.ensureVisible(t.children[s.physicalOrder])}}ensureCellVisible(t){let e=t.closest("ch-grid-row, ch-grid-rowset");while(!t.isVisible()&&e){e.collapsed=false;e=e.parentElement.closest("ch-grid-row, ch-grid-rowset")}if(!t.isVisible()){t.column.hidden=false}this.ensureVisible(t)}ensureVisible(t){const e=["start","end"].includes(t.column.freeze);const s=this.gridLayout;const i=this.getScrollOffsetTop();const n=this.getScrollOffsetLeft();const r=this.getScrollOffsetRight();if(s.scrollTop+i>t.offsetTop){s.scrollBy({top:(s.scrollTop-t.offsetTop+i)*-1})}else if(s.scrollTop+s.offsetHeight<t.offsetTop+t.offsetHeight){s.scrollBy({top:t.offsetTop+t.offsetHeight-(s.scrollTop+s.offsetHeight)})}else if(s.scrollLeft+n>t.offsetLeft&&!e){s.scrollBy({left:(s.scrollLeft-t.offsetLeft+n)*-1})}else if(s.scrollLeft+s.clientWidth-r<t.offsetLeft+t.offsetWidth&&!e){s.scrollBy({left:t.offsetLeft+t.offsetWidth-(s.scrollLeft+s.clientWidth-r)})}}getGridTemplateColumns(){return{"grid-template-columns":this.columns.getColumns().map((t=>`var(--ch-grid-column-${t.physicalOrder}-size)`)).join(" ")}}getRowBoxSimulationStyle(){const{columnFirst:t,columnLast:e}=this.columnDragManager?this.columnDragManager.getColumnsFirstLast():this.columns.getColumnsFirstLast();if(!t||!e){return null}return{[`--ch-grid-column-${t.physicalOrder}-margin-start`]:"var(--ch-grid-fallback, inherit)",[`--ch-grid-column-${t.physicalOrder}-border-start`]:"var(--ch-grid-fallback, inherit)",[`--ch-grid-column-${t.physicalOrder}-padding-start`]:"var(--ch-grid-fallback, inherit)",[`--ch-grid-column-${e.physicalOrder}-margin-end`]:"var(--ch-grid-fallback, inherit)",[`--ch-grid-column-${e.physicalOrder}-border-end`]:"var(--ch-grid-fallback, inherit)",[`--ch-grid-column-${e.physicalOrder}-padding-end`]:"var(--ch-grid-fallback, inherit)"}}getDragTransitionStyle(){return{"--column-drag-transition-duration":this.columnDragManager?".2s":"0s"}}getColumnsStyle(){return this.columns.getColumns().reduce(((t,e)=>({...t,...this.getColumnStyle(e)})),{})}getColumnStyle(t){return{...this.getColumnSizeStyle(t),...this.getColumnOrderStyle(t),...this.getColumnDisplayStyle(t),...this.getColumnFreezeStyle(t),...this.getColumnDraggingStyle(t),...this.getColumnIndentStyle(t)}}getColumnSizeStyle(t){return{[`--ch-grid-column-${t.order}-size`]:t.hidden?"0px":t.size}}getColumnOrderStyle(t){return{[`--ch-grid-column-${t.physicalOrder}-position`]:t.order.toString()}}getColumnFreezeStyle(t){switch(t.freeze){case"start":return this.getColumnFreezeStartStyle(t);case"end":return this.getColumnFreezeEndStyle(t)}}getColumnFreezeStartStyle(t){const e=["0px"];for(let s=1;s<t.order;s++){e.push(`var(--ch-grid-column-${s}-width)`)}return{[`--ch-grid-column-${t.physicalOrder}-left-freeze`]:`calc(${e.join(" + ")})`,[`--ch-grid-column-${t.physicalOrder}-z-index-freeze`]:"var(--ch-grid-column-freeze-layer)"}}getColumnFreezeEndStyle(t){const e=["0px"];for(let s=this.columns.getColumns().length;s>t.order;s--){e.push(`var(--ch-grid-column-${s}-width)`)}return{[`--ch-grid-column-${t.physicalOrder}-right-freeze`]:`calc(${e.join(" + ")})`,[`--ch-grid-column-${t.physicalOrder}-z-index-freeze`]:"var(--ch-grid-column-freeze-layer)"}}getColumnDisplayStyle(t){return t.hidden?{[`--ch-grid-column-${t.physicalOrder}-display`]:"none"}:null}getColumnDraggingStyle(t){return this.columnDragManager?this.columnDragManager.getColumnStyle(t):null}getColumnIndentStyle(t){return{[`--ch-grid-column-${t.physicalOrder}-content`]:t.order===1?"''":"none"}}isRTLDirection(){return getComputedStyle(this.grid).direction==="rtl"}}const S=":host{display:-ms-flexbox;display:flex;position:relative;-ms-flex-direction:column;flex-direction:column;inline-size:100%;--ch-grid-cell-active-layer:calc(var(--ch-grid-base-layer) * 1);--ch-grid-column-header-layer:calc(var(--ch-grid-base-layer) * 2);--ch-grid-column-freeze-layer:calc(var(--ch-grid-base-layer) * 4);--ch-grid-column-active-layer:calc(var(--ch-grid-base-layer) * 8);--ch-grid-settings-layer:calc(var(--ch-grid-base-layer) * 16)}.main{display:none;grid-auto-flow:dense;grid-auto-rows:-webkit-max-content;grid-auto-rows:max-content;overflow-x:auto;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;block-size:100%}";const x=S;const H=class{constructor(s){t(this,s);this.selectionChanged=e(this,"selectionChanged",7);this.rowMarkingChanged=e(this,"rowMarkingChanged",7);this.cellSelectionChanged=e(this,"cellSelectionChanged",7);this.rowClicked=e(this,"rowClicked",7);this.rowDoubleClicked=e(this,"rowDoubleClicked",7);this.rowEnterPressed=e(this,"rowEnterPressed",7);this.rowContextMenu=e(this,"rowContextMenu",7);this.rowFocused=undefined;this.cellFocused=undefined;this.rowHighlighted=undefined;this.rowsMarked=[];this.rowsSelected=[];this.cellSelected=undefined;this.gridStyle=undefined;this.rowSelectionMode="single";this.keyboardNavigationMode="select";this.rowHighlightEnabled="auto";this.rowSelectedClass=undefined;this.rowHighlightedClass=undefined;this.rowFocusedClass=undefined;this.rowMarkedClass=undefined;this.allowColumnReorder=true;this.columnResizeMode="single";this.localization=undefined}manager;gridLayoutElement;settingsUI;get el(){return s(this)}rowFocusedHandler(t,e){if(t){t.focused=true}if(e){e.focused=false}}cellFocusedHandler(t,e){if(t){t.focused=true}if(e){e.focused=false}}rowHighlightedHandler(t,e){if(t){t.highlighted=true}if(e){e.highlighted=false}if(t){this.manager.rowActions.showOnRowHover?.openRowHover(t)}else{this.manager.rowActions.showOnRowHover?.close()}}rowsMarkedHandler(t,e){this.manager.selection.syncRowSelector(t,e,"mark");this.rowMarkingChanged.emit(this.getChangedEventDetail(t,e))}rowsSelectedHandler(t,e){if(e){e.filter((e=>!t.includes(e))).forEach((t=>t.selected=false))}if(t){t.forEach((t=>t.selected=true))}this.manager.selection.syncRowSelector(t,e,"select");this.selectionChanged.emit(this.getChangedEventDetail(t,e))}cellSelectedHandler(t,e){if(t){t.selected=true}if(e){e.selected=false}this.cellSelectionChanged.emit({cellId:this.cellSelected?this.cellSelected.cellId:null,rowId:this.cellSelected?this.cellSelected.row.rowId:null,columnId:this.cellSelected?this.cellSelected.column.columnId:null})}selectionChanged;rowMarkingChanged;cellSelectionChanged;rowClicked;rowDoubleClicked;rowEnterPressed;rowContextMenu;componentWillLoad(){this.manager=new C(this.el);this.gridStyle=this.manager.getGridStyle()}componentDidLoad(){this.manager.componentDidLoad(this.gridLayoutElement)}componentShouldUpdate(t,e,s){if(s==="rowFocused"||s==="rowHighlighted"||s==="rowSelected"||s==="rowsMarked"||s==="cellSelected"){return false}}focusHandler(){if(this.keyboardNavigationMode!=="none"){this.rowFocused||=this.rowsSelected[0]??this.manager.getFirstRow();this.cellFocused=this.rowFocused?.getCell(this.cellSelected?.column||this.manager.getFirstColumn());if(this.keyboardNavigationMode==="select"){this.selectByKeyboardEvent(false,false,"focus")}}}blurHandler(t){if(!t.composedPath().includes(this.el)){this.rowFocused=null;this.cellFocused=null}}cellFocusedEventHandler(t){const e=t.target;if(this.rowSelectionMode!=="none"&&!e.selected){this.setCellSelected(e)}}windowKeyDownHandler(t){if(h()[0]===this.el&&[" ","+","-","Home","End","PageUp","PageDown","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)){t.preventDefault()}}keyDownHandler(t){if(h()[0]===this.el&&this.keyboardNavigationMode!=="none"){const e=t.shiftKey;const s=l(t);switch(t.key){case" ":this.spacePressedEvent(l(t),t.shiftKey);break;case"+":this.setRowCollapsed(this.rowFocused,false);break;case"-":this.setRowCollapsed(this.rowFocused,true);break;case"Home":this.moveByKeyboardEvent(this.manager.selection.moveFirstRow,e,s);break;case"End":this.moveByKeyboardEvent(this.manager.selection.moveLastRow,e,s);break;case"PageUp":this.moveByKeyboardEvent(this.manager.selection.movePreviousPageRow,e,s);break;case"PageDown":this.moveByKeyboardEvent(this.manager.selection.moveNextPageRow,e,s);break;case"ArrowUp":this.moveByKeyboardEvent(this.manager.selection.movePreviousRow,e,s);break;case"ArrowDown":this.moveByKeyboardEvent(this.manager.selection.moveNextRow,e,s);break;case"ArrowLeft":this.moveByKeyboardEvent(this.manager.selection.movePreviousCell,e,s);break;case"ArrowRight":this.moveByKeyboardEvent(this.manager.selection.moveNextCell,e,s);break;case"Enter":this.enterPressedHandler();break}}}mouseMoveHandler(t){if(this.rowHighlightEnabled==="auto"&&this.rowSelectionMode!=="none"||this.rowHighlightEnabled===true){this.rowHighlighted=this.manager.getRowEventTarget(t)||(this.manager.isRowActionsEventTarget(t)?this.rowHighlighted:null)}t:{if(this.manager.selection.selecting){if(h()[0]!==this.el){this.stopSelecting();break t}const e=this.manager.getRowEventTarget(t);const s=this.manager.getCellEventTarget(t);if(e&&(this.manager.selection.selectingRow!==e||this.manager.selection.selectingCell!==s)){const i=l(t);const n=c(t,a.RIGHT);this.selectByPointerEvent(e,s,i&&!n,!n,n);this.manager.selection.selectingRow=e;this.manager.selection.selectingCell=s}}}}mouseLeaveHandler(){this.rowHighlighted&&=null}mouseDownHandler(t){const e=this.manager.getRowEventTarget(t);const s=this.manager.getCellEventTarget(t);if(e){this.manager.selection.selecting=true;this.selectByPointerEvent(e,s,l(t),t.shiftKey,t.button===o.RIGHT)}}mouseUpHandler(){if(this.manager.selection.selecting){this.stopSelecting()}}clickHandler(t){const e=this.manager.getRowEventTarget(t);const s=this.manager.getCellEventTarget(t);if(e){this.emitRowClicked(e,s)}}dblclickHandler(t){const e=this.manager.getRowEventTarget(t);const s=this.manager.getCellEventTarget(t);if(e){this.rowDoubleClicked.emit({rowId:e.rowId,cellId:s?.cellId,columnId:s?.column.columnId})}}touchstartHandler(t){this.manager.selection.touchStart(t)}touchendHandler(t){if(t.cancelable){t.preventDefault()}if(this.manager.selection.isTouchEndSelection(t)){const e=this.manager.columns.getColumnSelector();const s=this.manager.getRowEventTarget(t);const i=this.manager.getCellEventTarget(t);if(s){this.selectByPointerEvent(s,i,e?.richRowSelectorMode!=="select",false,false);this.emitRowClicked(s,i)}}}contextmenuHandler(t){let e;if(t.target===this.el&&t.button===o.KEY_SHORTCUT){e=this.rowFocused}else{e=this.manager.getRowEventTarget(t)}if(e){const s=this.cellSelected?.row===e?this.cellSelected:null;const i=this.rowContextMenu.emit({rowId:e.rowId,cellId:s?.cellId,columnId:s?.column.columnId,selectedRowsId:this.rowsSelected.map((t=>t.rowId)),clientX:t.clientX,clientY:t.clientY});this.manager.rowActions.showOnRowContext?.openRowContext(t.clientX,t.clientY);if(i.defaultPrevented||this.manager.rowActions.showOnRowContext){t.preventDefault()}}}columnSelectorClickedHandler(t){const e=this.manager.columns.getColumnSelector();if(e?.richRowSelectorMode==="select"){this.selectAll(t.detail.checked)}else if(e?.richRowSelectorMode==="mark"){this.rowsMarked=this.manager.selection.markAllRows(t.detail.checked)}}cellSelectorClickedHandler(t){const e=this.manager.columns.getColumnSelector();if(e?.richRowSelectorMode==="select"){this.selectByPointerEvent(this.manager.getRowEventTarget(t),this.manager.getCellEventTarget(t),true,t.detail.range,false)}else if(e?.richRowSelectorMode==="mark"){this.rowsMarked=this.manager.selection.markRow(this.manager.getRowEventTarget(t),t.detail.checked,t.detail.range,this.rowsMarked)}}cellRowActionClickedHandler(t){const e=t.target;this.manager.rowActions.showOnRowActions?.openRowActions(e)}columnStyleChangedHandler(){if(this.manager){this.gridStyle=this.manager.getGridStyle()}}columnFreezeChangedHandler(){this.manager.columns.adjustFreezeOrder()}columnResizeStartedHandler(t){this.manager.columnResizeStart(t.detail.columnId)}columnResizingHandler(t){this.manager.columnResizing(t.detail.deltaWidth)}columnResizeFinishedHandler(){this.manager.columnResizeEnd()}columnDragStartHandler(t){this.manager.columnDragStart(t.detail.columnId)}columnDraggingHandler(t){if(this.manager.columnDragging(t.detail.positionX)){this.gridStyle=this.manager.getGridStyle()}}columnDragEndHandler(){this.manager.columnDragEnd();this.gridStyle=this.manager.getGridStyle()}rowDragStartHandler(t){this.manager.rowDragStart(t.detail.row)}rowEnsureVisibleHandler(t){this.manager.ensureRowVisible(t.target)}cellEnsureVisibleHandler(t){this.manager.ensureCellVisible(t.target)}settingsShowClickedHandler(){this.settingsUI.show=true}settingsCloseClickedHandler(){this.settingsUI.show=false}async getFocusedRow(){return this.rowFocused?.rowId}async getHoveredRow(){return this.rowHighlighted?.rowId}async getSelectedRows(){return this.rowsSelected.map((t=>t.rowId))}async getMarkedRows(){return this.rowsMarked.map((t=>t.rowId))}async getFocusedCell(){return{cellId:this.cellFocused?this.cellFocused.cellId:null,rowId:this.cellFocused?this.cellFocused.row.rowId:null,columnId:this.cellFocused?this.cellFocused.column.columnId:null}}async getSelectedCell(){return{cellId:this.cellSelected?this.cellSelected.cellId:null,rowId:this.cellSelected?this.cellSelected.row.rowId:null,columnId:this.cellSelected?this.cellSelected.column.columnId:null}}async selectRow(t,e=true){const s=this.manager.getRow(t);if(s){const{rowFocused:t,rowsSelected:i,cellFocused:n,cellSelected:r}=this.manager.selection.selectSet({rowFocused:this.rowFocused,rowsSelected:this.rowsSelected,cellFocused:this.cellFocused,cellSelected:this.cellSelected},s,null,e);this.rowFocused=t;this.rowsSelected=i;this.cellFocused=n;this.cellSelected=r;t?.ensureVisible()}}async selectAllRows(t=true){this.selectAll(t)}async selectCell(t,e,s,i=true){const n=this.manager.getCell(t,e,s);if(n){this.setCellSelected(n,i)}}async markRow(t,e=true){const s=this.manager.columns.getColumnSelector();const i=this.manager.getRow(t);if(i&&s?.richRowSelectorMode==="mark"){this.rowsMarked=this.manager.selection.markRow(i,e,false,this.rowsMarked)}}async markAllRows(t=true){const e=this.manager.columns.getColumnSelector();if(e?.richRowSelectorMode==="mark"){this.rowsMarked=this.manager.selection.markAllRows(t)}}async expandRow(t){this.setRowCollapsed(this.manager.getRow(t),false)}async collapseRow(t){this.setRowCollapsed(this.manager.getRow(t),true)}async rowEnsureVisible(t){const e=this.manager.getRow(t);if(e){this.manager.ensureRowVisible(e)}}async cellEnsureVisible(t){const e=this.manager.getCell(t);if(e){this.manager.ensureCellVisible(e)}}async getPreviousRow(){const t=this.cellSelected?.row;if(t){return this.manager.getPreviousRow(t)?.rowId||null}}async getNextRow(){const t=this.cellSelected?.row;if(t){return this.manager.getNextRow(t)?.rowId||null}}async getPreviousCell(){const t=this.manager.getPreviousCell(this.cellSelected);return{cellId:t?t.cellId:null,rowId:t?t.row.rowId:null,columnId:t?t.column.columnId:null}}async getNextCell(){const t=this.manager.getNextCell(this.cellSelected);return{cellId:t?t.cellId:null,rowId:t?t.row.rowId:null,columnId:t?t.column.columnId:null}}async syncRowState(t){const e=t;const s=this.manager.columns.getColumnSelector();if(this.rowSelectionMode!=="none"){this.syncRowStateSelected(e)}if(s?.richRowSelectorMode==="mark"){this.syncRowStateMarked(e)}if(s){this.syncRowStateSelector(e,s);if(s.richRowSelectorMode==="select"){this.manager.selection.syncColumnSelector(this.rowsSelected.length,s)}else if(s.richRowSelectorMode==="mark"){this.manager.selection.syncColumnSelector(this.rowsMarked.length,s)}}}syncRowStateSelected(t){if(t.selected&&this.rowSelectionMode==="single"){this.rowsSelected[0]=t}if(t.selected&&this.rowSelectionMode==="multiple"&&!this.rowsSelected.includes(t)){this.rowsSelected.push(t)}if(!t.selected){const e=this.rowsSelected.indexOf(t);if(e!==-1){this.rowsSelected.splice(e,1)}}}syncRowStateMarked(t){if(t.marked&&!this.rowsMarked.includes(t)){this.rowsMarked.push(t)}if(!t.marked){const e=this.rowsMarked.indexOf(t);if(e!==-1){this.rowsMarked.splice(e,1)}}}syncRowStateSelector(t,e){const s=t.getCell(e);const i=e.richRowSelectorMode==="select"&&t.selected||e.richRowSelectorMode==="mark"&&t.marked;s.setSelectorChecked(i)}getChangedEventDetail(t,e){return{rowsId:t.map((t=>t.rowId)),addedRowsId:t.filter((t=>!e.includes(t))).map((t=>t.rowId)),removedRowsId:e.filter((e=>!t.includes(e))).map((t=>t.rowId)),unalteredRowsId:t.filter((t=>e.includes(t))).map((t=>t.rowId))}}enterPressedHandler(){if(this.rowFocused){this.rowEnterPressed.emit({rowId:this.rowFocused.rowId,cellId:this.cellFocused?this.cellFocused.cellId:null,columnId:this.cellFocused?this.cellFocused.column.columnId:null})}}spacePressedEvent(t,e){if(this.keyboardNavigationMode==="focus"){this.selectByKeyboardEvent(t,e,"last-selected")}else if(this.keyboardNavigationMode==="select"){this.markByKeyboardEvent()}this.emitRowClicked(this.rowFocused,this.cellFocused)}markByKeyboardEvent(){const t=this.manager.columns.getColumnSelector();if(t?.richRowSelectorMode==="mark"){this.rowsMarked=this.manager.selection.markRows(this.rowFocused,this.rowsMarked,this.rowsSelected)}}selectByKeyboardEvent(t,e,s){const{rowFocused:i,rowsSelected:n,cellFocused:r,cellSelected:h}=this.manager.selection.select({rowFocused:this.rowFocused,rowsSelected:this.rowsSelected,cellFocused:this.cellFocused,cellSelected:this.cellSelected},this.rowFocused,this.cellFocused,true,t,e,s,false);this.rowFocused=i;this.rowsSelected=n;this.cellFocused=r;this.cellSelected=h;(r||i)?.ensureVisible()}selectByPointerEvent(t,e,s,i,n){const{rowFocused:r,rowsSelected:h,cellFocused:l,cellSelected:o}=this.manager.selection.select({rowFocused:this.rowFocused,rowsSelected:this.rowsSelected,cellFocused:this.cellFocused,cellSelected:this.cellSelected},t,e,true,s,i,"last-selected",n);this.rowFocused=r;this.rowsSelected=h;this.cellFocused=l;this.cellSelected=o;(l||r)?.ensureVisible()}moveByKeyboardEvent(t,e,s){const{rowFocused:i,rowsSelected:n,cellFocused:r,cellSelected:h}=t.call(this.manager.selection,{rowFocused:this.rowFocused,rowsSelected:this.rowsSelected,cellFocused:this.cellFocused,cellSelected:this.cellSelected},this.rowSelectionMode!=="none"&&this.keyboardNavigationMode==="select",this.rowSelectionMode==="multiple"?e:false,this.rowSelectionMode==="multiple"?e&&s:false);this.rowFocused=i;this.rowsSelected=n;this.cellFocused=r;this.cellSelected=h;(r||i)?.ensureVisible()}selectAll(t=true){const{rowFocused:e,rowsSelected:s,cellFocused:i,cellSelected:n}=this.manager.selection.selectAll({rowFocused:this.rowFocused,rowsSelected:this.rowsSelected,cellFocused:this.cellFocused,cellSelected:this.cellSelected},t);this.rowFocused=e;this.rowsSelected=s;this.cellFocused=i;this.cellSelected=n;(i||e)?.ensureVisible()}setRowCollapsed(t,e){if(t&&e){if(t&&t.hasChildRows){t.collapsed=true}}else if(t&&!e){t.collapsed=false}}setCellSelected(t,e=true){const{rowFocused:s,rowsSelected:i,cellFocused:n,cellSelected:r}=this.manager.selection.selectSet({rowFocused:this.rowFocused,rowsSelected:this.rowsSelected,cellFocused:this.cellFocused,cellSelected:this.cellSelected},t.row,t,e);this.rowFocused=s;this.rowsSelected=i;this.cellFocused=n;this.cellSelected=r;(n||s)?.ensureVisible()}emitRowClicked(t,e){this.rowClicked.emit({rowId:t.rowId,cellId:e?.cellId,columnId:e?.column.columnId})}stopSelecting(){this.manager.selection.selecting=false;this.manager.selection.selectingRow=null;this.manager.selection.selectingCell=null}renderSettings(){return i("ch-grid-settings",{grid:this.el,ref:t=>this.settingsUI=t,exportparts:"\r\n          mask:settings-mask,\r\n          window:settings-window,\r\n          header:settings-header,\r\n          caption:settings-caption,\r\n          close:settings-close,\r\n          main:settings-main,\r\n          footer:settings-footer\r\n        "},i("slot",{name:"settings"},i("ch-grid-settings-columns",{part:"settings-columns",columns:[...this.manager.getColumns()],exportparts:"\r\n              column:settings-columns-item,\r\n              column-label:settings-columns-label,\r\n              column-visible:settings-columns-visible,\r\n              column-visible-checked:settings-columns-visible-checked\r\n            "})))}render(){return i(n,{key:"cd96751d436e4ca439dd2c8f147e64f258f5c94d",tabindex:this.keyboardNavigationMode!=="none"?"0":false},i("header",{key:"da5a5b8211a143c19af6d4343cf2b9010d245293",part:"header"},i("slot",{key:"ab0cf53dd0b6aa4152b845203b3f9d910f38072d",name:"header"})),i("section",{key:"d8cd61c871930738fd185da01994658feb8a98ba",class:"main",style:this.gridStyle,part:"main",ref:t=>this.gridLayoutElement=t},i("slot",{key:"58ef4a05979505708ade5527c5472bea1a8fe741"})),i("aside",{key:"302df69291be22814e804a3a918c1aeddcd3be99"},this.renderSettings(),i("slot",{key:"60b6b9e1d4ee69e6c8868bcc43660a3015b0a55e",name:"column-display"}),i("slot",{key:"ea86dd5a0ea9bf6c0ddca21c67f3e0c263780437",name:"row-actions"})),i("footer",{key:"982cfbe800f2aac0f918c3dd967ee7e1d1aab025",part:"footer"},i("slot",{key:"f00328c344c6882a39cf66a4261f48e569c81ab2",name:"footer"})))}static get watchers(){return{rowFocused:["rowFocusedHandler"],cellFocused:["cellFocusedHandler"],rowHighlighted:["rowHighlightedHandler"],rowsMarked:["rowsMarkedHandler"],rowsSelected:["rowsSelectedHandler"],cellSelected:["cellSelectedHandler"]}}};H.style=x;const R="@layer ch-grid {\n  ch-grid-action-refresh[disabled] {\n    pointer-events: none;\n  }\n}";const $=R;const z=class{constructor(s){t(this,s);this.refreshClicked=e(this,"refreshClicked",7);this.disabled=undefined}refreshClicked;pressedHandler(t){if(!t.key||t.key==="Enter"||t.key===" "){this.refreshClicked.emit();t.stopPropagation()}}render(){return i(n,{key:"603a2d5b8b40fdfbecbc461d55b982f21695b3ec",role:"button",tabindex:"0",disabled:this.disabled})}};z.style=$;const I="@layer ch-grid {\n  ch-grid-action-settings[disabled] {\n    pointer-events: none;\n  }\n}";const E=I;const F=class{constructor(s){t(this,s);this.settingsShowClicked=e(this,"settingsShowClicked",7);this.disabled=undefined}settingsShowClicked;pressedHandler(t){if(!t.key||t.key==="Enter"||t.key===" "){this.settingsShowClicked.emit();t.stopPropagation()}}render(){return i(n,{key:"06de6fab2a8c4ef69e9cd640122981c270fae4b0",role:"button",tabindex:"0",disabled:this.disabled})}};F.style=E;const D="";const M=D;const A=class{constructor(e){t(this,e)}get el(){return s(this)}};A.style=M;const L=":host{display:-ms-flexbox;display:flex;position:-webkit-sticky;position:sticky;top:0;grid-row:1}:host{background-color:inherit;-webkit-margin-before:inherit;margin-block-start:inherit;-webkit-margin-after:inherit;margin-block-end:inherit;-webkit-border-before:inherit;border-block-start:inherit;-webkit-border-after:inherit;border-block-end:inherit;-webkit-padding-before:inherit;padding-block-start:inherit;-webkit-padding-after:inherit;padding-block-end:inherit;-webkit-transition:-webkit-transform var(--column-drag-transition-duration, 0.2s);transition:-webkit-transform var(--column-drag-transition-duration, 0.2s);transition:transform var(--column-drag-transition-duration, 0.2s);transition:transform var(--column-drag-transition-duration, 0.2s), -webkit-transform var(--column-drag-transition-duration, 0.2s)}:host{--ch-grid-column-z-index-head:var(--ch-grid-column-header-layer)}:host([show-settings]),:host([resizing]){--ch-grid-column-z-index-active:var(--ch-grid-column-active-layer)}:host([sort-direction=asc]) .bar .sort .sort-asc{visibility:visible}:host([sort-direction=desc]) .bar .sort .sort-desc{visibility:visible}.bar{list-style-type:none;margin:0;padding:0;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.bar .selector{overflow:hidden;-ms-flex-order:0;order:0}.bar .selector:not([hidden]){display:-ms-flexbox;display:flex}.bar .name{display:-ms-flexbox;display:flex;overflow:hidden;-ms-flex-order:1;order:1}.bar .name .name-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.bar .sort{position:relative;-ms-flex-align:center;align-items:center;-ms-flex-order:2;order:2}.bar .sort:not([hidden]){display:-ms-flexbox;display:flex}.bar .sort .sort-asc{visibility:hidden;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.bar .sort .sort-desc{position:absolute;visibility:hidden;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.bar .settings{-ms-flex-order:3;order:3}.bar .resize{-ms-flex-item-align:stretch;align-self:stretch;-webkit-margin-start:auto;margin-inline-start:auto;-ms-flex-order:4;order:4}@-webkit-keyframes column-sort{0%{opacity:0}10%{opacity:1}90%{opacity:1}100%{opacity:0}}@keyframes column-sort{0%{opacity:0}10%{opacity:1}90%{opacity:1}100%{opacity:0}}";const P=L;const O=class{constructor(s){t(this,s);this.columnHiddenChanged=e(this,"columnHiddenChanged",7);this.columnSizeChanging=e(this,"columnSizeChanging",7);this.columnSizeChanged=e(this,"columnSizeChanged",7);this.columnOrderChanged=e(this,"columnOrderChanged",7);this.columnSortChanged=e(this,"columnSortChanged",7);this.columnFreezeChanged=e(this,"columnFreezeChanged",7);this.columnDragStarted=e(this,"columnDragStarted",7);this.columnDragging=e(this,"columnDragging",7);this.columnDragEnded=e(this,"columnDragEnded",7);this.columnSelectorClicked=e(this,"columnSelectorClicked",7);this.columnId=undefined;this.columnType="plain";this.columnIconUrl=undefined;this.columnImage=undefined;this.columnImageSet=undefined;this.columnName=undefined;this.columnNameHidden=undefined;this.columnTooltip=undefined;this.columnNamePosition="text";this.richRowDrag=undefined;this.richRowSelector=undefined;this.richRowSelectorMode="select";this.richRowSelectorState="";this.richRowActions=undefined;this.displayObserverClass=undefined;this.freeze=undefined;this.hidden=false;this.hideable=true;this.order=undefined;this.physicalOrder=undefined;this.size=undefined;this.resizable=true;this.resizing=undefined;this.sortable=true;this.settingable=true;this.sortDirection=undefined;this.showSettings=false}dragging=false;dragMouseMoveFn=this.dragMouseMoveHandler.bind(this);dragMouseMoveStartPositionX;get el(){return s(this)}freezeHandler(){this.columnFreezeChanged.emit({columnId:this.columnId,freeze:this.freeze})}hiddenHandler(){this.columnHiddenChanged.emit({columnId:this.columnId,hidden:this.hidden})}orderHandler(){this.columnOrderChanged.emit({columnId:this.columnId,order:this.order})}sizeHandler(){this.columnSizeChanging.emit({columnId:this.columnId,size:this.size})}sortDirectionHandler(){if(this.sortDirection){this.columnSortChanged.emit({columnId:this.columnId,sortDirection:this.sortDirection})}}columnHiddenChanged;columnSizeChanging;columnSizeChanged;columnOrderChanged;columnSortChanged;columnFreezeChanged;columnDragStarted;columnDragging;columnDragEnded;columnSelectorClicked;componentDidLoad(){this.el.addEventListener("mousedown",this.mousedownHandler.bind(this))}clickHandler(){if(!this.dragging){if(this.sortable){this.sortDirection=this.sortDirection==="asc"?"desc":"asc"}}else{this.dragging=false}}columnResizeStartedHandler(){this.resizing=true}columnResizeFinishedHandler(){this.resizing=false;this.columnSizeChanged.emit({columnId:this.columnId,size:this.size})}allowColumnReorder(){return this.el.closest("ch-grid").allowColumnReorder}mousedownHandler(t){t.preventDefault();t.stopPropagation();if(this.allowColumnReorder()){this.dragMouseDownHandler(t);document.addEventListener("mousemove",this.dragMouseMoveFn,{passive:true});document.addEventListener("mouseup",this.dragMouseUpHandler.bind(this),{once:true})}}dragMouseDownHandler(t){this.dragMouseMoveStartPositionX=t.pageX;this.columnDragStarted.emit({columnId:this.columnId})}dragMouseMoveHandler(t){if(this.dragging||Math.abs(this.dragMouseMoveStartPositionX-t.pageX)>5){this.dragging=true;this.columnDragging.emit({columnId:this.columnId,positionX:t.pageX,direction:t.movementX>0?"right":"left"})}}dragMouseUpHandler(){document.removeEventListener("mousemove",this.dragMouseMoveFn);this.columnDragEnded.emit({columnId:this.columnId})}settingsMouseDownHandler(t){t.stopPropagation()}settingsClickHandler=t=>{t.stopPropagation();this.showSettings=true};selectorClickHandler=t=>{const e=t.target;this.richRowSelectorState=e.checked?"checked":"";this.columnSelectorClicked.emit({checked:e.checked});t.stopPropagation()};selectorTouchEndHandler=t=>{t.stopPropagation()};render(){return i(n,{key:"3aee8128bad28f75b9473248c8a9df1a463819a0"},i("ul",{key:"97a162c0625e0fa68e6b9852a1c8863c103fa8db",class:"bar",part:"bar"},this.renderSelector(),this.renderName(),this.renderSort(),this.renderSettings(),this.renderResize()),i("ch-grid-column-settings",{key:"a99d2de72421ec66bdbc602152efc70ddfd6a131",column:this.el,onMouseDown:this.settingsMouseDownHandler,show:this.showSettings,exportparts:"\r\n            mask:settings-mask,\r\n            window:settings-window,\r\n            header:settings-header,\r\n            caption:settings-caption,\r\n            close:settings-close,\r\n            main:settings-main,\r\n            footer:settings-footer\r\n          "},i("slot",{key:"75b662aac4aae92bcba7df3e5521ba361fd25010",name:"settings"})))}renderSelector(){return i("li",{class:"selector",part:"bar-selector",hidden:!(this.columnType==="rich"&&this.richRowSelector)},i("label",{part:"selector-label"},i("input",{type:"checkbox",part:["selector",this.richRowSelectorState].filter((t=>t!=="")).join(" "),onClick:this.selectorClickHandler,onTouchEnd:this.selectorTouchEndHandler,checked:this.richRowSelectorState==="checked",indeterminate:this.richRowSelectorState==="indeterminate"})))}renderName(){return i("li",{class:"name",part:"bar-name",title:this.columnTooltip||(this.columnNamePosition==="title"?this.columnName:null)},this.columnIconUrl||this.columnImage||this.columnImageSet?i("img",{class:"name-icon",part:"bar-name-icon",src:this.columnImage||this.columnIconUrl,srcSet:this.columnImageSet}):i("div",{class:"name-icon",part:"bar-name-icon"}),i("span",{class:"name-text",part:"bar-name-text",hidden:this.columnNameHidden||this.columnNamePosition!=="text"},this.columnName))}renderSort(){return i("li",{class:"sort",part:"bar-sort",hidden:!this.sortable},i("div",{class:"sort-asc",part:"bar-sort-ascending"}),i("div",{class:"sort-desc",part:"bar-sort-descending"}))}renderSettings(){return i("li",{class:"settings",part:"bar-settings",hidden:!this.settingable},i("button",{class:"button",part:"bar-settings-button",onClick:this.settingsClickHandler}))}renderResize(){return i("li",{class:"resize",part:"bar-resize",hidden:!this.resizable},i("ch-grid-column-resize",{column:this.el,class:"resize-split",part:"bar-resize-split"}))}static get watchers(){return{freeze:["freezeHandler"],hidden:["hiddenHandler"],order:["orderHandler"],size:["sizeHandler"],sortDirection:["sortDirectionHandler"]}}};O.style=P;const T="@layer ch-grid {\n  ch-grid-columnset {\n    display: contents;\n  }\n}\n@layer ch-grid {\n  ch-grid-row {\n    display: contents;\n  }\n  ch-grid-row[collapsed] > ch-grid-rowset {\n    display: none;\n  }\n  ch-grid-row:is([leaf=false], :has(> ch-grid-rowset)) > ch-grid-cell::part(caret) {\n    visibility: visible;\n  }\n  ch-grid-row[dragging] {\n    display: -ms-flexbox;\n    display: flex;\n    position: fixed;\n    pointer-events: none;\n    -webkit-box-shadow: rgba(0, 0, 0, 0.7) 0px 5px 15px;\n    box-shadow: rgba(0, 0, 0, 0.7) 0px 5px 15px;\n    z-index: 1000;\n    -webkit-transition: top var(--row-drag-transition-duration, 0.1s);\n    transition: top var(--row-drag-transition-duration, 0.1s);\n  }\n}\n@layer ch-grid {\n  ch-grid-rowset {\n    display: contents;\n  }\n  ch-grid-rowset[collapsed] > :not(ch-grid-rowset-legend) {\n    display: none;\n  }\n}\n@layer ch-grid {\n  ch-grid-cell {\n    position: -webkit-sticky;\n    position: sticky;\n    grid-column: var(--grid-column);\n    -webkit-transition: -webkit-transform var(--column-drag-transition-duration, 0.2s);\n    transition: -webkit-transform var(--column-drag-transition-duration, 0.2s);\n    transition: transform var(--column-drag-transition-duration, 0.2s);\n    transition: transform var(--column-drag-transition-duration, 0.2s), -webkit-transform var(--column-drag-transition-duration, 0.2s);\n  }\n  ch-grid-cell[selected] {\n    --ch-grid-cell-z-index-active: var(--ch-grid-cell-active-layer);\n  }\n  ch-grid-cell,\n  ch-grid-row[selected] > ch-grid-cell,\n  ch-grid-row[highlighted] > ch-grid-cell {\n    background-color: inherit;\n    -webkit-margin-before: inherit;\n    margin-block-start: inherit;\n    -webkit-margin-after: inherit;\n    margin-block-end: inherit;\n    -webkit-border-before: inherit;\n    border-block-start: inherit;\n    -webkit-border-after: inherit;\n    border-block-end: inherit;\n    -webkit-padding-before: inherit;\n    padding-block-start: inherit;\n    -webkit-padding-after: inherit;\n    padding-block-end: inherit;\n  }\n  ch-grid-cell:before {\n    -webkit-margin-start: calc(var(--indent) * var(--level));\n    margin-inline-start: calc(var(--indent) * var(--level));\n  }\n  ch-grid-cell::part(indent) {\n    width: calc(var(--indent) * var(--level));\n  }\n  ch-grid-cell::part(caret) {\n    visibility: hidden;\n  }\n}";const _=T;const V=class{constructor(e){t(this,e)}get el(){return s(this)}columnSortChangedHandler(t){const e=Array.from(this.el.querySelectorAll("ch-grid-column"));e.forEach((e=>{if(e.columnId!==t.detail.columnId){e.sortDirection=null}}))}};V.style=_;const N=":host{display:-ms-flexbox;display:flex}";const G=N;const U=class{constructor(s){t(this,s);this.activePageChanged=e(this,"activePageChanged",7);this.pageNavigationRequested=e(this,"pageNavigationRequested",7);this.activePage=1;this.totalPages=1;this.hasNextPage=false}elPages;elFirst;elPrevious;elNext;elLast;get el(){return s(this)}activePageHandler(){this.activePageChanged.emit({activePage:this.activePage})}activePageChanged;pageNavigationRequested;componentWillLoad(){this.loadElements()}navigateClickedHandler(t){t.stopPropagation();this.navigate(t.detail.type)}pageChangedHandler(t){t.stopPropagation();this.navigate("goto",t.detail.page)}keyDownHandler(t){switch(t.key){case"Home":this.navigate("first");break;case"PageUp":this.navigate("previous");break;case"PageDown":this.navigate("next");break;case"End":this.navigate("last");break}}navigate(t,e){const s=!e||e!==this.activePage;switch(t){case"first":this.first();this.elFirst?.focus();break;case"previous":this.previous();this.elPrevious?.focus();break;case"next":this.next();this.elNext?.focus();break;case"last":this.last();this.elLast?.focus();break;case"goto":this.goto(e);break}if(s){this.pageNavigationRequested.emit({type:t,page:e})}}first(){this.activePage=1}previous(){this.activePage=Math.max(this.activePage-1,1)}next(){this.activePage=this.totalPages<0?this.activePage+1:Math.min(this.activePage+1,this.totalPages)}last(){this.activePage=this.totalPages}goto(t){this.activePage=Math.max(Math.min(t,this.totalPages),1)}loadElements(){this.elPages=this.el.querySelector("ch-paginator-pages");this.el.querySelectorAll("ch-paginator-navigate").forEach((t=>{switch(t.type){case"first":this.elFirst=t;break;case"previous":this.elPrevious=t;break;case"next":this.elNext=t;break;case"last":this.elLast=t;break}}))}render(){if(this.elPages){this.elPages.totalPages=this.totalPages;this.elPages.page=this.activePage}if(this.elFirst){this.elFirst.disabled=this.activePage===1}if(this.elPrevious){this.elPrevious.disabled=this.activePage===1}if(this.elNext){this.elNext.disabled=this.activePage===this.totalPages||this.totalPages<0&&!this.hasNextPage}if(this.elLast){this.elLast.disabled=this.activePage===this.totalPages||this.totalPages<0&&!this.hasNextPage}}static get watchers(){return{activePage:["activePageHandler"]}}};U.style=G;const B="ch-paginator-navigate[disabled]{pointer-events:none}";const W=B;const q=class{constructor(s){t(this,s);this.navigateClicked=e(this,"navigateClicked",7);this.type=undefined;this.disabled=undefined}navigateClicked;pressedHandler(t){if(!t.key||t.key==="Enter"||t.key===" "){this.navigateClicked.emit({type:this.type});t.stopPropagation()}}render(){return i(n,{key:"623d05355f954d28390fcf08d5ba60d6476ee57d",role:"button",tabindex:"0",disabled:this.disabled})}};q.style=W;const j="button{all:unset}.pages{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;list-style-type:none;margin:0;padding:0}";const X=j;const K=class{constructor(s){t(this,s);this.pageChanged=e(this,"pageChanged",7);this.page=1;this.totalPages=1;this.maxSize=9;this.renderFirstLastPages=true;this.textDots="..."}buttonActive;get el(){return s(this)}pageHandler(){this.pageChanged.emit({page:this.page})}maxSizeHandler(){this.validateMaxSize()}renderFirstLastPagesHandler(){this.validateMaxSize()}pageChanged;componentDidUpdate(){if(document.activeElement===this.el){this.buttonActive.focus()}}keyDownHandler(t){switch(t.key){case"ArrowLeft":this.page=Math.max(this.page-1,1);break;case"ArrowRight":this.page=Math.min(this.page+1,this.totalPages);break}}focusHandler(){this.buttonActive.focus()}clickHandler=t=>{const e=t.target;this.page=parseInt(e.value)};getItems(){const t=Math.ceil((this.maxSize-1)/2);const e=Math.floor((this.maxSize-1)/2);let s,i;let n,r;if(this.maxSize===0||this.maxSize>=this.totalPages){i=this.fillStart(false);s=this.page-1;n=this.totalPages-this.page;r=this.fillEnd(false)}else if(this.page<=t&&this.page<this.totalPages-e){i=this.fillStart(false);s=this.page-1;r=this.fillEnd(true);n=e-r.length+(t-s)}else if(this.page>t&&this.page<this.totalPages-e){i=this.fillStart(true);s=t-i.length;r=this.fillEnd(true);n=e-r.length}else if(this.page>t&&this.page>=this.totalPages-e){r=this.fillEnd(false);n=this.totalPages-this.page;i=this.fillStart(true);s=t-i.length+e-n}const h=i.concat(this.getRangeItems(this.page-s,this.page-1)).concat([this.page]).concat(this.getRangeItems(this.page+1,this.page+n)).concat(r);return{items:h,activeIndex:i.length+s}}fillStart(t){if(t){return this.renderFirstLastPages?[1,this.textDots]:[this.textDots]}return[]}fillEnd(t){if(t){return this.renderFirstLastPages?[this.textDots,this.totalPages]:[this.textDots]}return[]}getRangeItems(t,e){return Array.from({length:e-t+1},((e,s)=>t+s))}validateMaxSize(){if(this.maxSize>0){if(!this.renderFirstLastPages&&this.maxSize<3){this.maxSize=3}else if(this.renderFirstLastPages&&this.maxSize<5){this.maxSize=5}}}render(){const{items:t,activeIndex:e}=this.getItems();return i("ol",{key:"32c76fb8d13de418f768de418bcd9cedf515f529",part:"pages",class:"pages"},t.map(((t,s)=>{if(typeof t==="number"){return i("li",null,i("button",{part:`page button ${s===e?"active":""}`,value:t,onClick:this.clickHandler,ref:t=>this.buttonActive=s===e?t:this.buttonActive},t))}return i("li",null,i("button",{part:"page button dots",disabled:true},t))})))}static get watchers(){return{page:["pageHandler"],maxSize:["maxSizeHandler"],renderFirstLastPages:["renderFirstLastPagesHandler"]}}};K.style=X;var Y;(function(t){t[t["EDIT"]=1]="EDIT";t[t["RADIO"]=4]="RADIO";t[t["COMBO"]=5]="COMBO";t[t["CHECK"]=7]="CHECK"})(Y||(Y={}));var J;(function(t){t[t["NUMBER"]=0]="NUMBER";t[t["CHAR"]=1]="CHAR";t[t["DATE"]=2]="DATE";t[t["DATETIME"]=3]="DATETIME";t[t["VARCHAR"]=5]="VARCHAR";t[t["LONGVARCHAR"]=6]="LONGVARCHAR";t[t["BOOLEAN"]=7]="BOOLEAN"})(J||(J={}));const Q="";const Z=Q;const tt=class{constructor(s){t(this,s);this.columnSettingsChanged=e(this,"columnSettingsChanged",7);this.column=undefined;this.buttonApplyText=undefined;this.buttonResetText=undefined;this.equal=undefined;this.less=undefined;this.greater=undefined}filterEnum=[];inputEqual;inputLess;inputGreater;get el(){return s(this)}columnSettingsChanged;componentWillLoad(){if(Array.isArray(this.column.FilterEnum)&&this.column.FilterEnum.length>0){this.filterEnum=this.column.FilterEnum}}applyClickHandler=()=>{this.equal=this.getControlValue(this.inputEqual);this.less=this.getControlValue(this.inputLess);this.greater=this.getControlValue(this.inputGreater);this.columnSettingsChanged.emit({column:this.column,equal:this.equal,less:this.less,greater:this.greater})};resetClickHandler=()=>{this.equal="";this.less="";this.greater="";this.columnSettingsChanged.emit({column:this.column,equal:this.equal,less:this.less,greater:this.greater})};getControlValue(t){const e=t?.value??"";let s=this.column.gxControl.dataType;if(s===J.DATETIME&&this.column.FilterDateTimeAsDate===-1){s=J.DATE}switch(s){case J.DATE:return gx.date.ctod(e,"Y4MD").toString();case J.DATETIME:return gx.date.ctot(e,"Y4MD").toString();default:return e}}toControlValue(t){let e=this.column.gxControl.dataType;if(!t){return""}if(e===J.DATETIME&&this.column.FilterDateTimeAsDate===-1){e=J.DATE}switch(e){case J.DATE:return this.convertGxDateToISO(gx.date.ctod(t),false);case J.DATETIME:return this.convertGxDateToISO(gx.date.ctot(t),true);default:return t}}convertGxDateToISO(t,e){const s=t=>t.toString().padStart(2,"0");const i=t.Value;if(gx.date.isNullDate(i)){return""}if(e){return`${i.getFullYear()}-${s(i.getMonth()+1)}-${s(i.getDate())}T${s(i.getHours())}:${s(i.getMinutes())}`}return`${i.getFullYear()}-${s(i.getMonth()+1)}-${s(i.getDate())}`}getFilterInputType(t){switch(t){case J.BOOLEAN:return"checkbox";case J.CHAR:case J.VARCHAR:case J.LONGVARCHAR:return"text";case J.DATE:return"date";case J.DATETIME:return"datetime-local";case J.NUMBER:return"number";default:return"text"}}renderColumnFilterControl(t,e,s,n,r,h){const l=t.replace("input","").toLowerCase();if(this.filterEnum.length>0){e=Y.COMBO;n=this.filterEnum.map((t=>[t.Value,t.Description]))}if(s===J.DATETIME&&this.column.FilterDateTimeAsDate===-1){s=J.DATE}switch(e){case Y.EDIT:case Y.CHECK:return i("label",{part:`label ${l}`},r,i("input",{type:this.getFilterInputType(s),value:this.toControlValue(h),ref:e=>this[t]=e,part:`field ${l}`}));case Y.COMBO:return i("label",{part:`label ${l}`},r,i("select",{ref:e=>this[t]=e,part:`field ${l}`},n.map((([t,e])=>i("option",{value:t,selected:t===h},e)))))}}render(){return i(n,{key:"440e22234ffdaf7163d6c878b95ef4f1624ead40"},i("fieldset",{key:"8e6072058705456f20aee428bd78159ffa05ffe0",part:"main"},i("caption",{key:"3eeb8625f59cf56da3eb6fa39a35a1a0613cffa6",part:"caption"},this.column.FilterCaption),this.column.FilterMode==="single"&&this.renderColumnFilterControl("inputEqual",this.column.gxControl.type,this.column.gxControl.dataType,this.column.gxControl.possibleValues,this.column.FilterLabelEqual,this.equal),this.column.FilterMode==="range"&&this.renderColumnFilterControl("inputGreater",this.column.gxControl.type,this.column.gxControl.dataType,this.column.gxControl.possibleValues,this.column.FilterLabelGreater,this.greater),this.column.FilterMode==="range"&&this.renderColumnFilterControl("inputLess",this.column.gxControl.type,this.column.gxControl.dataType,this.column.gxControl.possibleValues,this.column.FilterLabelLess,this.less)),i("section",{key:"666aad1cdffa725f00d7c0176fd0a2105009bbd4",part:"footer"},i("button",{key:"b6acdd91c0c2bc6ca1aef18e20e1a8ad514e602f",part:"button reset",onClick:this.resetClickHandler},this.buttonResetText),i("button",{key:"97515de3c243b8990f7ec0895c41b5453dab8373",part:"button apply",onClick:this.applyClickHandler},this.buttonApplyText)))}};tt.style=Z;export{H as ch_grid,z as ch_grid_action_refresh,F as ch_grid_action_settings,A as ch_grid_actionbar,O as ch_grid_column,V as ch_grid_columnset,U as ch_paginator,q as ch_paginator_navigate,K as ch_paginator_pages,tt as gx_grid_chameleon_column_filter};
//# sourceMappingURL=p-6cfeb95b.entry.js.map