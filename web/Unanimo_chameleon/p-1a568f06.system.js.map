{"version":3,"names":["checkIfIsLastNestedChild","element","lastNestedChild","codeToJSXDictionary","lastNestedChildClass","className","properties","addLastNestedChildClass","highlightJSClasses","join","undefined","h","class","_c","renderCodeChildren","text","value","children","map","child","type","findLastNestedChild","elementWithChildren","lastChild","at","length","parseCodeToJSX","code","language","shouldFindLastNestedChild","__awaiter","_this","actualLanguage","getActualLanguageWithoutAlias","registerLanguage","sent","tree","parseCodeToHAST","renderedCode","lastNestedChildIsRoot","codeCss","ChCodeStyle0","ChCode","exports","_a","_lastNestedChildIsRoot","set","this","_getLanguageOrDefault","_parseCodeToJSX","__classPrivateFieldGet","call","showIndicator","class_1","prototype","connectedCallback","adoptCommonThemes","el","shadowRoot","adoptedStyleSheets","componentWillRender","renderResult","JSXCodeBlock","__classPrivateFieldSet","render","addLastNestedChildClassInHost","Host","key","SCROLLABLE_CLASS","_d","concat","part","linkDefinitions","Map","linkDefinitionPromises","getLinkDefinition","id","linkDefinition","get","definitionRequest","promise","resolver","definitionPromise","Promise","resolve","setLinkDefinition","url","pendingPromise","clearLinkDefinitions","clear","HEADING_ID_REGEX","LAST_NESTED_CHILD_CLASS","HTMLToJSX","isLastNestedChildClass","checkAndGetLastNestedChildClass","depthToHeading","content","classes","tableAlignmentDictionary","left","center","right","tableRender","table","metadata","tableHeadRow","tableBodyRows","slice","columnCount","headCellPromises","tableCell","mdASTtoJSX","bodyCellPromises","forEach","tableHead","push","allSettled","tableHeadContent","tableBodyContent","headCells","jsx","bodyCells","alignments","align","alignment","index","rowIndex","cellIndex","renderDictionary","blockquote","break","codeRender","lang","plainText","definition","identifier","delete","emphasis","footnoteDefinition","footnoteReference","heading","match","headingId","replace","depth","html","rawHTML","module","import","rawHTMLToJSX","allowDangerousHtml","image","src","alt","title","loading","imageReference","inlineCode","link","includes","href","linkReference","referenceType","label","list","ordered","start","listItem","paragraph","strong","thematicBreak","yaml","root","childrenLength","asyncJSX","Array","renderedContent","markdownToJSX","markdown","mdAST","markdownToMdAST","JSX","defaultCodeRender","options","markdownViewerCss","ChMarkdownViewerStyle0","ChMarkdownViewer","_b","_JSXTree","class_2","renderCode","rawHtml","apply","_e","theme","avoidFlashOfUnstyledContent","model"],"sources":["src/components/code/internal/code-highlight.tsx","src/components/code/code.scss?tag=ch-code&encapsulation=shadow","src/components/code/code.tsx","src/components/markdown-viewer/parsers/link-resolver.ts","src/components/markdown-viewer/parsers/markdown-to-jsx.tsx","src/components/markdown-viewer/parsers/code-render.tsx","src/components/markdown-viewer/markdown-viewer.scss?tag=ch-markdown-viewer&encapsulation=shadow","src/components/markdown-viewer/markdown-viewer.tsx"],"sourcesContent":["import { h } from \"@stencil/core\";\r\nimport { Element as HElement, Text as HText, Root as HRoot } from \"hast\";\r\n\r\nimport {\r\n  getActualLanguageWithoutAlias,\r\n  parseCodeToHAST,\r\n  registerLanguage\r\n} from \"@genexus/markdown-parser/dist/parse-code.js\";\r\nimport { CodeToJSX } from \"./types\";\r\n\r\ntype LastNestedChild = HRoot | HElement | undefined;\r\n\r\nconst checkIfIsLastNestedChild = (\r\n  element: HElement,\r\n  lastNestedChild: LastNestedChild\r\n): boolean => element === lastNestedChild;\r\n\r\nconst codeToJSXDictionary = {\r\n  element: (\r\n    element: HElement,\r\n    lastNestedChildClass: string,\r\n    lastNestedChild: LastNestedChild\r\n  ) => {\r\n    const className = element.properties.className as string[];\r\n\r\n    const addLastNestedChildClass = checkIfIsLastNestedChild(\r\n      element,\r\n      lastNestedChild\r\n    );\r\n    const highlightJSClasses = className ? className.join(\" \") : undefined;\r\n\r\n    return (\r\n      <span\r\n        class={{\r\n          [highlightJSClasses]: !!highlightJSClasses,\r\n          [lastNestedChildClass]: addLastNestedChildClass\r\n        }}\r\n      >\r\n        {renderCodeChildren(element, lastNestedChildClass, lastNestedChild)}\r\n      </span>\r\n    );\r\n  },\r\n\r\n  text: (element: HText) => element.value\r\n};\r\n\r\nfunction renderCodeChildren(\r\n  element: HRoot | HElement,\r\n  lastNestedChildClass: string,\r\n  lastNestedChild: LastNestedChild\r\n) {\r\n  return element.children.map(child =>\r\n    codeToJSXDictionary[child.type](\r\n      child,\r\n      lastNestedChildClass,\r\n      lastNestedChild\r\n    )\r\n  );\r\n}\r\n\r\nconst findLastNestedChild = (elementWithChildren: HRoot | HElement) => {\r\n  const lastChild = elementWithChildren.children.at(-1);\r\n\r\n  // The last element have children. We must check its sub children\r\n  if ((lastChild as HElement).children?.length > 0) {\r\n    return findLastNestedChild(lastChild as HElement);\r\n  }\r\n\r\n  return elementWithChildren;\r\n};\r\n\r\nexport const parseCodeToJSX: CodeToJSX = async (\r\n  code: string,\r\n  language: string,\r\n  shouldFindLastNestedChild: boolean,\r\n  lastNestedChildClass: string\r\n): Promise<{ renderedCode: any; lastNestedChildIsRoot: boolean }> => {\r\n  const actualLanguage = getActualLanguageWithoutAlias(language);\r\n\r\n  // Register the language\r\n  await registerLanguage(actualLanguage);\r\n\r\n  const tree: HRoot = parseCodeToHAST(actualLanguage, code);\r\n\r\n  // Find last nested child\r\n  const lastNestedChild: LastNestedChild = shouldFindLastNestedChild\r\n    ? findLastNestedChild(tree)\r\n    : undefined;\r\n\r\n  return {\r\n    renderedCode: renderCodeChildren(\r\n      tree,\r\n      lastNestedChildClass,\r\n      lastNestedChild\r\n    ),\r\n    lastNestedChildIsRoot: tree === lastNestedChild\r\n  };\r\n};\r\n",":host {\r\n  /**\r\n   * @prop --ch-code__addition:\r\n   * Specifies the color for the addition tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__addition: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__attr:\r\n   * Specifies the color for the attr tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__attr: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__attribute:\r\n   * Specifies the color for the attribute tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__attribute: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__built-in:\r\n   * Specifies the color for the built-in tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__built-in: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__bullet:\r\n   * Specifies the color for the bullet tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__bullet: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__class:\r\n   * Specifies the color for the class tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__class: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__code:\r\n   * Specifies the color for the code tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__code: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__comment:\r\n   * Specifies the color for the comment tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__comment: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__deletion:\r\n   * Specifies the color for the deletion tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__deletion: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__doctag:\r\n   * Specifies the color for the doctag tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__doctag: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__formula:\r\n   * Specifies the color for the formula tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__formula: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__function:\r\n   * Specifies the color for the function tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__function: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__function-variable:\r\n   * Specifies the color for the function variable tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__function-variable: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__keyword:\r\n   * Specifies the color for the keyword tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__keyword: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__link:\r\n   * Specifies the color for the link tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__link: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__literal:\r\n   * Specifies the color for the literal tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__literal: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__meta:\r\n   * Specifies the color for the meta tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__meta: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__meta__keyword:\r\n   * Specifies the color for the keyword tokens inside the meta token.\r\n   * @default currentColor\r\n   */\r\n  --ch-code__meta__keyword: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__meta__string:\r\n   * Specifies the color for the string tokens inside the meta token.\r\n   * @default currentColor\r\n   */\r\n  --ch-code__meta__string: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__name:\r\n   * Specifies the color for the name tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__name: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__number:\r\n   * Specifies the color for the number tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__number: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__operator:\r\n   * Specifies the color for the operator tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__operator: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__regexp:\r\n   * Specifies the color for the regexp tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__regexp: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__quote:\r\n   * Specifies the color for the quote tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__quote: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__selector-attr:\r\n   * Specifies the color for the selector-attr tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__selector-attr: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__selector-class:\r\n   * Specifies the color for the selector-class tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__selector-class: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__selector-id:\r\n   * Specifies the color for the selector-id tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__selector-id: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__selector-pseudo:\r\n   * Specifies the color for the selector-pseudo tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__selector-pseudo: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__selector-tag:\r\n   * Specifies the color for the selector-tag tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__selector-tag: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__string:\r\n   * Specifies the color for the string tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__string: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__subst:\r\n   * Specifies the color for the substitution tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__subst: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__symbol:\r\n   * Specifies the color for the symbol tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__symbol: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__tag:\r\n   * Specifies the color for the tag tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__tag: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__template-tag:\r\n   * Specifies the color for the template-tag tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__template-tag: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__template-variable:\r\n   * Specifies the color for the template-variable tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__template-variable: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__title:\r\n   * Specifies the color for the title tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__title: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__title-class:\r\n   * Specifies the color for the title-class tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__title-class: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__title-class-inherited:\r\n   * Specifies the color for the title-class-inherited tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__title-class-inherited: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__title-function:\r\n   * Specifies the color for the title-function tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__title-function: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__type:\r\n   * Specifies the color for the type tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__type: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__variable:\r\n   * Specifies the color for the variable tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__variable: currentColor;\r\n\r\n  /**\r\n   * @prop --ch-code__variable-language:\r\n   * Specifies the color for the variable-language tokens\r\n   * @default currentColor\r\n   */\r\n  --ch-code__variable-language: currentColor;\r\n\r\n  --ch-code-indicator-color: currentColor;\r\n  --ch-code-inline-size: 1.125ch;\r\n  --ch-code-block-size: 1em;\r\n\r\n  display: grid;\r\n  grid-template-columns: 1fr;\r\n  grid-template-rows: 1fr;\r\n  font-family: monospace;\r\n  white-space: pre;\r\n  overflow: auto;\r\n}\r\n\r\ncode {\r\n  font: inherit;\r\n  contain: inline-size;\r\n}\r\n\r\n.hljs {\r\n  &-addition {\r\n    color: var(--ch-code__addition);\r\n  }\r\n\r\n  &-attr {\r\n    color: var(--ch-code__attr);\r\n  }\r\n\r\n  &-attribute {\r\n    color: var(--ch-code__attribute);\r\n  }\r\n\r\n  // Must be placed before the \"built_in\" selector\r\n  &-subst {\r\n    color: var(--ch-code__subst);\r\n  }\r\n\r\n  &-built_in {\r\n    color: var(--ch-code__built-in);\r\n  }\r\n\r\n  &-bullet {\r\n    color: var(--ch-code__bullet);\r\n  }\r\n\r\n  &-class {\r\n    color: var(--ch-code__class);\r\n  }\r\n\r\n  &-code {\r\n    color: var(--ch-code__code);\r\n  }\r\n\r\n  &-comment {\r\n    color: var(--ch-code__comment);\r\n  }\r\n\r\n  &-deletion {\r\n    color: var(--ch-code__deletion);\r\n  }\r\n\r\n  &-doctag {\r\n    color: var(--ch-code__doctag);\r\n  }\r\n\r\n  &-formula {\r\n    color: var(--ch-code__formula);\r\n  }\r\n\r\n  &-function {\r\n    color: var(--ch-code__function);\r\n  }\r\n\r\n  &-function.variable_ {\r\n    color: var(--ch-code__function-variable);\r\n  }\r\n\r\n  &-keyword {\r\n    color: var(--ch-code__keyword);\r\n  }\r\n\r\n  &-link {\r\n    color: var(--ch-code__link);\r\n  }\r\n\r\n  &-literal {\r\n    color: var(--ch-code__literal);\r\n  }\r\n\r\n  &-meta {\r\n    color: var(--ch-code__meta);\r\n  }\r\n\r\n  &-meta &-keyword {\r\n    color: var(--ch-code__meta__keyword);\r\n  }\r\n\r\n  &-meta &-string {\r\n    color: var(--ch-code__meta__string);\r\n  }\r\n\r\n  &-name {\r\n    color: var(--ch-code__name);\r\n  }\r\n\r\n  &-number {\r\n    color: var(--ch-code__number);\r\n  }\r\n\r\n  &-operator {\r\n    color: var(--ch-code__operator);\r\n  }\r\n\r\n  &-regexp {\r\n    color: var(--ch-code__regexp);\r\n  }\r\n\r\n  &-quote {\r\n    color: var(--ch-code__quote);\r\n  }\r\n\r\n  &-selector-attr {\r\n    color: var(--ch-code__selector-attr);\r\n  }\r\n\r\n  &-selector-class {\r\n    color: var(--ch-code__selector-class);\r\n  }\r\n\r\n  &-selector-id {\r\n    color: var(--ch-code__selector-id);\r\n  }\r\n\r\n  &-selector-pseudo {\r\n    color: var(--ch-code__selector-pseudo);\r\n  }\r\n\r\n  &-selector-tag {\r\n    color: var(--ch-code__selector-tag);\r\n  }\r\n\r\n  &-string {\r\n    color: var(--ch-code__string);\r\n  }\r\n\r\n  &-symbol {\r\n    color: var(--ch-code__symbol);\r\n  }\r\n\r\n  &-tag {\r\n    color: var(--ch-code__tag);\r\n  }\r\n\r\n  &-template-tag {\r\n    color: var(--ch-code__template-tag);\r\n  }\r\n\r\n  &-template-variable {\r\n    color: var(--ch-code__template-variable);\r\n  }\r\n\r\n  &-title {\r\n    color: var(--ch-code__title);\r\n\r\n    &.class_ {\r\n      color: var(--ch-code__title-class);\r\n\r\n      &.inherited__ {\r\n        color: var(--ch-code__title-class-inherited);\r\n      }\r\n    }\r\n\r\n    &.function_ {\r\n      color: var(--ch-code__title-function);\r\n    }\r\n  }\r\n\r\n  &-type {\r\n    color: var(--ch-code__type);\r\n  }\r\n\r\n  &-variable {\r\n    color: var(--ch-code__variable);\r\n  }\r\n\r\n  &-variable.language_ {\r\n    color: var(--ch-code__variable-language);\r\n  }\r\n}\r\n\r\n// TODO: Simplify this animation\r\n:host(.ch-code-show-indicator) .last-nested-child::after,\r\n:host(.ch-code-show-indicator):empty::after {\r\n  content: \"\";\r\n  display: inline-flex;\r\n  inline-size: var(--ch-code-inline-size);\r\n  block-size: var(--ch-code-block-size);\r\n  background-color: var(--ch-code-indicator-color);\r\n  transform: translateY(0.125em);\r\n  animation: twinkle 0.75s linear infinite;\r\n}\r\n\r\n@keyframes twinkle {\r\n  60% {\r\n    opacity: 1;\r\n  }\r\n\r\n  75% {\r\n    opacity: 0;\r\n  }\r\n}\r\n","import { Component, Element, Host, Prop, State, h } from \"@stencil/core\";\r\nimport { adoptCommonThemes } from \"../../common/theme\";\r\nimport { SCROLLABLE_CLASS } from \"../../common/reserved-names\";\r\nimport { parseCodeToJSX } from \"./internal/code-highlight\";\r\n\r\n/**\r\n * A control to highlight code blocks.\r\n * - It supports code highlight by parsing the incoming code string to [hast](https://github.com/micromark/micromark-extension-gfm) using [lowlight](lowlight). After that, it implements a reactivity layer by implementing its own render for the hast.\r\n *\r\n * - It also supports all programming languages from [highlight.js](https://github.com/highlightjs/highlight.js).\r\n *\r\n * - When the code highlighting is needed at runtime, the control will load on demand the code parser and the programming language needed to parse the code.\r\n */\r\n@Component({\r\n  shadow: true,\r\n  styleUrl: \"code.scss\",\r\n  tag: \"ch-code\"\r\n})\r\nexport class ChCode {\r\n  #lastNestedChildIsRoot: boolean = true;\r\n\r\n  @Element() el: HTMLChCodeElement;\r\n\r\n  @State() JSXCodeBlock: any;\r\n\r\n  /**\r\n   * Specifies the code language to highlight.\r\n   */\r\n  @Prop() readonly language?: string | undefined;\r\n\r\n  /**\r\n   *\r\n   */\r\n  @Prop() readonly lastNestedChildClass: string = \"last-nested-child\";\r\n\r\n  /**\r\n   * Specifies if an indicator is displayed in the last element rendered.\r\n   * Useful for streaming scenarios where a loading indicator is needed.\r\n   */\r\n  @Prop() readonly showIndicator: boolean = false;\r\n\r\n  /**\r\n   * Specifies the code string to highlight.\r\n   */\r\n  @Prop() readonly value?: string | undefined;\r\n\r\n  #getLanguageOrDefault = () => this.language || \"plaintext\";\r\n\r\n  #parseCodeToJSX = () =>\r\n    parseCodeToJSX(\r\n      this.value,\r\n      this.#getLanguageOrDefault(),\r\n      this.showIndicator,\r\n      this.lastNestedChildClass\r\n    );\r\n\r\n  connectedCallback() {\r\n    adoptCommonThemes(this.el.shadowRoot.adoptedStyleSheets);\r\n  }\r\n\r\n  async componentWillRender() {\r\n    if (this.value) {\r\n      const renderResult = await this.#parseCodeToJSX();\r\n\r\n      this.JSXCodeBlock = renderResult.renderedCode;\r\n      this.#lastNestedChildIsRoot = renderResult.lastNestedChildIsRoot;\r\n    } else {\r\n      this.JSXCodeBlock = \"\";\r\n      this.#lastNestedChildIsRoot = true;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const addLastNestedChildClassInHost =\r\n      this.showIndicator && this.#lastNestedChildIsRoot;\r\n\r\n    const language = this.#getLanguageOrDefault();\r\n\r\n    return (\r\n      <Host\r\n        class={{\r\n          \"ch-code-show-indicator\": this.showIndicator,\r\n          [SCROLLABLE_CLASS]: true\r\n        }}\r\n      >\r\n        <code\r\n          class={{\r\n            [`hljs language-${language}`]: true,\r\n            [this.lastNestedChildClass]: addLastNestedChildClassInHost\r\n          }}\r\n          part={`code language-${language}`}\r\n        >\r\n          {this.JSXCodeBlock}\r\n        </code>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n","const linkDefinitions = new Map<string, string>();\r\n\r\nconst linkDefinitionPromises = new Map<\r\n  string,\r\n  { promise: Promise<string>; resolver: (url: string) => void }\r\n>();\r\n\r\nexport const getLinkDefinition = (id: string): Promise<string> | string => {\r\n  // See if we already have the definition\r\n  const linkDefinition = linkDefinitions.get(id);\r\n\r\n  if (linkDefinition !== undefined) {\r\n    return linkDefinition;\r\n  }\r\n\r\n  // See if we already have a Promise for this definition\r\n  const definitionRequest = linkDefinitionPromises.get(id);\r\n\r\n  if (definitionRequest !== undefined) {\r\n    return definitionRequest.promise;\r\n  }\r\n\r\n  let resolver: (value: string | PromiseLike<string>) => void;\r\n\r\n  // Create the promise and store the resolver to resolve the promise when the\r\n  // definition is encounter in the parser\r\n  const definitionPromise = new Promise<string>(resolve => {\r\n    resolver = resolve;\r\n\r\n    // TODO: Should resolve after 10s or so to avoid dead lock?\r\n  });\r\n\r\n  linkDefinitionPromises.set(id, {\r\n    promise: definitionPromise,\r\n    resolver: resolver\r\n  });\r\n\r\n  return definitionPromise;\r\n};\r\n\r\nexport const setLinkDefinition = (id: string, url: string) => {\r\n  // Store the url\r\n  linkDefinitions.set(id, url);\r\n\r\n  // See if are pending Promises to be resolved\r\n  const pendingPromise = linkDefinitionPromises.get(id);\r\n\r\n  if (pendingPromise !== undefined) {\r\n    pendingPromise.resolver(url);\r\n  }\r\n};\r\n\r\nexport const clearLinkDefinitions = () => {\r\n  linkDefinitions.clear();\r\n  linkDefinitionPromises.clear();\r\n};\r\n","import { h } from \"@stencil/core\";\r\nimport { AlignType, Code, Html, Root, Table } from \"mdast\";\r\nimport { markdownToMdAST } from \"@genexus/markdown-parser\";\r\n\r\nimport {\r\n  ElementsWithChildren,\r\n  ElementsWithoutCustomRender,\r\n  MarkdownViewerToJSXCommonMetadata\r\n} from \"./types\";\r\nimport { rawHTMLToJSX } from \"./raw-html-to-jsx\";\r\nimport {\r\n  clearLinkDefinitions,\r\n  getLinkDefinition,\r\n  setLinkDefinition\r\n} from \"./link-resolver\";\r\n\r\n/**\r\n * Regex to match the id of the heading.\r\n *\r\n * @input `\"# Hello, world {#something} \"`\r\n * @output `something`\r\n */\r\nconst HEADING_ID_REGEX = /\\{#(.*?)\\}/;\r\n\r\nexport const LAST_NESTED_CHILD_CLASS = \"last-nested-child\";\r\n\r\n// Lazy load the code parser implementation\r\nlet HTMLToJSX: typeof rawHTMLToJSX;\r\nlet lastNestedChild: Root | ElementsWithChildren | Code | Html;\r\n\r\nconst isLastNestedChildClass = (element: ElementsWithChildren | Code | Html) =>\r\n  element === lastNestedChild;\r\n\r\nconst checkAndGetLastNestedChildClass = (\r\n  element: ElementsWithChildren\r\n): typeof LAST_NESTED_CHILD_CLASS | undefined =>\r\n  isLastNestedChildClass(element) ? LAST_NESTED_CHILD_CLASS : undefined;\r\n\r\nconst depthToHeading = {\r\n  1: (content: any, classes: string | null, id?: string) => (\r\n    <h1 class={classes} id={id}>\r\n      {content}\r\n    </h1>\r\n  ),\r\n  2: (content: any, classes: string | null, id?: string) => (\r\n    <h2 class={classes} id={id}>\r\n      {content}\r\n    </h2>\r\n  ),\r\n  3: (content: any, classes: string | null, id?: string) => (\r\n    <h3 class={classes} id={id}>\r\n      {content}\r\n    </h3>\r\n  ),\r\n  4: (content: any, classes: string | null, id?: string) => (\r\n    <h4 class={classes} id={id}>\r\n      {content}\r\n    </h4>\r\n  ),\r\n  5: (content: any, classes: string | null, id?: string) => (\r\n    <h5 class={classes} id={id}>\r\n      {content}\r\n    </h5>\r\n  ),\r\n  6: (content: any, classes: string | null, id?: string) => (\r\n    <h6 class={classes} id={id}>\r\n      {content}\r\n    </h6>\r\n  )\r\n} as const;\r\n\r\nconst tableAlignmentDictionary: { [key in AlignType]: string } = {\r\n  left: \"ch-markdown-table-column-start\",\r\n  center: \"ch-markdown-table-column-center\",\r\n  right: \"ch-markdown-table-column-end\"\r\n};\r\n\r\nconst tableRender = async (\r\n  table: Table,\r\n  metadata: MarkdownViewerToJSXCommonMetadata\r\n) => {\r\n  const tableHeadRow = table.children[0];\r\n  const tableBodyRows = table.children.slice(1);\r\n  const columnCount = tableHeadRow.children.length;\r\n\r\n  // Head cell promises\r\n  const headCellPromises = tableHeadRow.children.map(tableCell =>\r\n    mdASTtoJSX(tableCell, metadata)\r\n  );\r\n\r\n  const bodyCellPromises = [];\r\n\r\n  // Body cell promises\r\n  tableBodyRows.forEach(tableHead => {\r\n    tableHead.children.forEach(tableCell => {\r\n      bodyCellPromises.push(mdASTtoJSX(tableCell, metadata));\r\n    });\r\n  });\r\n\r\n  // Wait for all results to be completed in parallel\r\n  const tableHeadContent = await Promise.allSettled(headCellPromises);\r\n  const tableBodyContent = await Promise.allSettled(bodyCellPromises);\r\n\r\n  // Return the JSX array\r\n  const headCells = tableHeadContent.map(\r\n    jsx => (jsx as PromiseFulfilledResult<any>).value\r\n  );\r\n  const bodyCells = tableBodyContent.map(\r\n    jsx => (jsx as PromiseFulfilledResult<any>).value\r\n  );\r\n\r\n  const alignments = table.align.map(\r\n    alignment => tableAlignmentDictionary[alignment]\r\n  );\r\n\r\n  return (\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          {tableHeadRow.children.map((tableCell, index) => (\r\n            <th\r\n              class={{\r\n                [alignments[index]]: !!alignments[index],\r\n                [LAST_NESTED_CHILD_CLASS]: tableCell === lastNestedChild\r\n              }}\r\n            >\r\n              {headCells[index]}\r\n            </th>\r\n          ))}\r\n        </tr>\r\n      </thead>\r\n\r\n      <tbody>\r\n        {tableBodyRows.map((tableHead, rowIndex) => (\r\n          <tr>\r\n            {tableHead.children.map((tableCell, cellIndex) => (\r\n              <td\r\n                class={{\r\n                  [alignments[cellIndex]]: !!alignments[cellIndex],\r\n                  [LAST_NESTED_CHILD_CLASS]: tableCell === lastNestedChild\r\n                }}\r\n              >\r\n                {bodyCells[columnCount * rowIndex + cellIndex]}\r\n              </td>\r\n            ))}\r\n          </tr>\r\n        ))}\r\n      </tbody>\r\n    </table>\r\n  );\r\n};\r\n\r\nexport const renderDictionary: {\r\n  [key in keyof ElementsWithoutCustomRender]: (\r\n    element: ElementsWithoutCustomRender[key],\r\n    metadata: MarkdownViewerToJSXCommonMetadata\r\n  ) => Promise<any> | any;\r\n} = {\r\n  blockquote: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return (\r\n      <blockquote class={checkAndGetLastNestedChildClass(element)}>\r\n        {content}\r\n      </blockquote>\r\n    );\r\n  }, // TODO: Check if code can be inside this tag\r\n\r\n  break: () => <br />,\r\n\r\n  code: (element, metadata) =>\r\n    metadata.codeRender({\r\n      lastNestedChildClass: metadata.lastNestedChildClass,\r\n      language: element.lang,\r\n      plainText: element.value,\r\n      showIndicator: metadata.showIndicator && isLastNestedChildClass(element)\r\n    }),\r\n\r\n  definition: element => setLinkDefinition(element.identifier, element.url),\r\n\r\n  delete: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return (\r\n      <del class={checkAndGetLastNestedChildClass(element)}>{content}</del>\r\n    );\r\n  }, // TODO: Check if code can be inside this tag\r\n\r\n  emphasis: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return <em class={checkAndGetLastNestedChildClass(element)}>{content}</em>;\r\n  }, // TODO: Check if code can be inside this tag\r\n\r\n  footnoteDefinition: () => \"\",\r\n\r\n  footnoteReference: () => \"\",\r\n\r\n  heading: async (element, metadata) => {\r\n    // Check if the heading has an id\r\n    const lastChild = element.children.at(-1);\r\n    let headingId: string;\r\n\r\n    if (lastChild?.type === \"text\") {\r\n      const match = lastChild.value.match(HEADING_ID_REGEX);\r\n\r\n      if (match && match.length > 1) {\r\n        headingId = match[1];\r\n\r\n        // Remove markdown id from the header text\r\n        lastChild.value = lastChild.value.replace(`{#${headingId}}`, \"\");\r\n      }\r\n    }\r\n\r\n    // Render the content after the heading id processing\r\n    const content = await mdASTtoJSX(element, metadata);\r\n    const classes = checkAndGetLastNestedChildClass(element);\r\n\r\n    return depthToHeading[element.depth](content, classes, headingId); // TODO: Add anchor icon at the start of the heading\r\n  },\r\n\r\n  html: async (element, metadata) => {\r\n    if (metadata.rawHTML && !HTMLToJSX) {\r\n      // Load the parser implementation\r\n      HTMLToJSX = (await import(\"./raw-html-to-jsx\")).rawHTMLToJSX;\r\n    }\r\n\r\n    return metadata.rawHTML\r\n      ? HTMLToJSX(\r\n          element.value,\r\n          metadata.allowDangerousHtml,\r\n          // TODO: Add unit tests for these cases\r\n          metadata.showIndicator && isLastNestedChildClass(element)\r\n        )\r\n      : element.value;\r\n  },\r\n\r\n  image: element => (\r\n    <img\r\n      src={element.url}\r\n      alt={element.alt}\r\n      title={element.title}\r\n      loading=\"lazy\"\r\n    />\r\n  ),\r\n\r\n  imageReference: () => \"\",\r\n\r\n  inlineCode: element => <code class=\"hljs\">{element.value}</code>,\r\n\r\n  link: async (element, metadata) => {\r\n    // Sanitize scripts\r\n    if (element.url.includes(\"javascript:\")) {\r\n      return;\r\n    }\r\n\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return (\r\n      <a\r\n        aria-label={element.title || null}\r\n        title={element.title || null}\r\n        class={checkAndGetLastNestedChildClass(element)}\r\n        href={element.url}\r\n      >\r\n        {content}\r\n      </a>\r\n    );\r\n  }, // TODO: Sanitize href?\r\n\r\n  linkReference: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n    let url = \"\";\r\n\r\n    // TODO: Implement the rest of alternatives for \"referenceType\"\r\n    if (element.referenceType === \"shortcut\") {\r\n      url = await getLinkDefinition(element.identifier);\r\n    }\r\n\r\n    // TODO: It's unnecessary to set aria-label when referenceType === \"shortcut\"\r\n    // TODO: The title is not supported well. See \"An Example Putting the Parts Together\" section in markdown.html\r\n\r\n    // Sanitize scripts\r\n    if (url.includes(\"javascript:\")) {\r\n      return;\r\n    }\r\n\r\n    return (\r\n      <a\r\n        aria-label={element.label || null}\r\n        class={checkAndGetLastNestedChildClass(element)}\r\n        href={url}\r\n      >\r\n        {content}\r\n      </a>\r\n    );\r\n  },\r\n\r\n  list: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return element.ordered ? (\r\n      <ol\r\n        class={checkAndGetLastNestedChildClass(element)}\r\n        start={element.start}\r\n      >\r\n        {content}\r\n      </ol> // TODO: Implement spread  // TODO: Check if code can be inside this tag\r\n    ) : (\r\n      <ul class={checkAndGetLastNestedChildClass(element)}>{content}</ul> // TODO: Implement spread  // TODO: Check if code can be inside this tag\r\n    );\r\n  },\r\n\r\n  listItem: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return <li class={checkAndGetLastNestedChildClass(element)}>{content}</li>;\r\n  }, // TODO: Implement spread  // TODO: Check if code can be inside this tag\r\n\r\n  paragraph: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return <p class={checkAndGetLastNestedChildClass(element)}>{content}</p>;\r\n  }, // TODO: Check if code can be inside this tag\r\n\r\n  strong: async (element, metadata) => {\r\n    const content = await mdASTtoJSX(element, metadata);\r\n\r\n    return (\r\n      <strong class={checkAndGetLastNestedChildClass(element)}>\r\n        {content}\r\n      </strong>\r\n    );\r\n  }, // TODO: Check if code can be inside this tag\r\n\r\n  table: tableRender, // TODO: Check if code can be inside this tag\r\n\r\n  text: element => element.value,\r\n\r\n  thematicBreak: () => <hr />,\r\n\r\n  yaml: () => \"\"\r\n} as const;\r\n\r\nconst findLastNestedChild = (\r\n  elementWithChildren: ElementsWithChildren | Root\r\n) => {\r\n  const lastChild = elementWithChildren.children.at(-1);\r\n\r\n  // The last element have children. We must check its sub children\r\n  if ((lastChild as ElementsWithChildren).children?.length > 0) {\r\n    return findLastNestedChild(lastChild as ElementsWithChildren);\r\n  }\r\n\r\n  if (lastChild.type === \"code\" || lastChild.type === \"html\") {\r\n    return lastChild;\r\n  }\r\n\r\n  return elementWithChildren;\r\n};\r\n\r\n/**\r\n * Converts markdown abstract syntax tree (mdast) into JSX.\r\n */\r\nasync function mdASTtoJSX(\r\n  root: ElementsWithChildren | Root,\r\n  metadata: MarkdownViewerToJSXCommonMetadata\r\n) {\r\n  const childrenLength = root.children.length;\r\n  const asyncJSX = new Array(childrenLength);\r\n\r\n  // Get the async JSX\r\n  for (let index = 0; index < childrenLength; index++) {\r\n    const child = root.children[index];\r\n\r\n    asyncJSX.push(renderDictionary[child.type](child, metadata));\r\n  }\r\n\r\n  // Wait for all results to be completed in parallel\r\n  const renderedContent = await Promise.allSettled(asyncJSX);\r\n\r\n  // Return the JSX array\r\n  return renderedContent.map(jsx => (jsx as PromiseFulfilledResult<any>).value);\r\n}\r\n\r\nexport const markdownToJSX = async (\r\n  markdown: string,\r\n  metadata: MarkdownViewerToJSXCommonMetadata\r\n) => {\r\n  const mdAST: Root = markdownToMdAST(markdown);\r\n\r\n  // First, find the last nested child. Useful to set a marker in the element\r\n  // that accomplish this condition\r\n  lastNestedChild = findLastNestedChild(mdAST);\r\n\r\n  // Render the markdown as JSX\r\n  const JSX = await mdASTtoJSX(mdAST, metadata);\r\n\r\n  // Clear all definitions used to render the current markdown, so the next\r\n  // render does not have old information\r\n  clearLinkDefinitions();\r\n\r\n  return JSX;\r\n};\r\n","import { h } from \"@stencil/core\";\r\nimport { MarkdownViewerCodeRender } from \"./types\";\r\n\r\nexport const defaultCodeRender: MarkdownViewerCodeRender = options => (\r\n  <ch-code\r\n    language={options.language}\r\n    lastNestedChildClass={options.lastNestedChildClass}\r\n    showIndicator={options.showIndicator}\r\n    value={options.plainText}\r\n  ></ch-code>\r\n);\r\n","@import \"../../common/base\";\r\n\r\n@include button-reset();\r\n@include box-sizing();\r\n@include typography-reset();\r\n\r\n:host {\r\n  --ch-markdown-viewer-indicator-color: currentColor;\r\n  --ch-markdown-viewer-inline-size: 1.125ch;\r\n  --ch-markdown-viewer-block-size: 1em;\r\n\r\n  display: grid;\r\n  grid-auto-rows: max-content;\r\n}\r\n\r\n// TODO: Simplify this animation\r\n:host(.ch-markdown-viewer-show-indicator) .last-nested-child::after,\r\n:host(.ch-markdown-viewer-show-indicator):empty::after {\r\n  content: \"\";\r\n  display: inline-flex;\r\n  inline-size: var(--ch-markdown-viewer-inline-size);\r\n  block-size: var(--ch-markdown-viewer-block-size);\r\n  background-color: var(--ch-markdown-viewer-indicator-color);\r\n  transform: translateY(0.125em);\r\n  animation: twinkle 0.75s linear infinite;\r\n}\r\n\r\n.ch-markdown-table-column-start {\r\n  text-align: start;\r\n}\r\n\r\n.ch-markdown-table-column-center {\r\n  text-align: center;\r\n}\r\n\r\n.ch-markdown-table-column-end {\r\n  text-align: end;\r\n}\r\n\r\nblockquote {\r\n  margin-inline: 0;\r\n}\r\n\r\nhr {\r\n  block-size: 1px;\r\n  margin: unset;\r\n  padding: unset;\r\n  border: unset;\r\n  background-color: currentColor;\r\n}\r\n\r\ntable {\r\n  display: block;\r\n  overflow: auto;\r\n  word-break: normal;\r\n  border-spacing: 0px;\r\n  border-collapse: collapse;\r\n}\r\n\r\nch-code {\r\n  --ch-code-indicator-color: var(--ch-markdown-viewer-indicator-color);\r\n  --ch-code-inline-size: var(--ch-markdown-viewer-inline-size);\r\n  --ch-code-block-size: var(--ch-markdown-viewer-block-size);\r\n}\r\n\r\n@keyframes twinkle {\r\n  60% {\r\n    opacity: 1;\r\n  }\r\n\r\n  75% {\r\n    opacity: 0;\r\n  }\r\n}\r\n","import { Component, Element, Host, Prop, h } from \"@stencil/core\";\r\nimport {\r\n  LAST_NESTED_CHILD_CLASS,\r\n  markdownToJSX\r\n} from \"./parsers/markdown-to-jsx\";\r\nimport { MarkdownViewerCodeRender } from \"./parsers/types\";\r\nimport { defaultCodeRender } from \"./parsers/code-render\";\r\n\r\n/**\r\n * A control to render markdown syntax. It supports GitHub Flavored Markdown\r\n * (GFM) and code highlighting.\r\n *  - It parses the incoming markdown to [mdast](https://github.com/syntax-tree/mdast) using [micromark](https://github.com/micromark/micromark) via [mdast-util-from-markdown](https://github.com/syntax-tree/mdast-util-from-markdown).\r\n *\r\n * - After that, it implements a reactivity layer by implementing its own render for the mdast. With this, changes to the input markdown only update the portion of the DOM that changes.\r\n *\r\n * - It supports Github Flavored Markdown (GFM) by using [mdast-util-gfm](https://github.com/syntax-tree/mdast-util-gfm) and [micromark-extension-gfm](https://github.com/micromark/micromark-extension-gfm).\r\n *\r\n * - It supports code highlight by parsing the incomming code of the markdown to [hast](https://github.com/micromark/micromark-extension-gfm) using [lowlight](lowlight). After that, it implements a reactivity layer by implementing its own render for the hast.\r\n *\r\n * - It also supports all programming languages from [highlight.js](https://github.com/highlightjs/highlight.js).\r\n *\r\n * - When the code highlighting is needed at runtime, the control will load on demand the code parser and the programming language needed to parse the code.\r\n */\r\n@Component({\r\n  shadow: true,\r\n  styleUrl: \"markdown-viewer.scss\",\r\n  tag: \"ch-markdown-viewer\"\r\n})\r\nexport class ChMarkdownViewer {\r\n  #JSXTree: any;\r\n\r\n  @Element() el: HTMLChMarkdownViewerElement;\r\n\r\n  // /**\r\n  //  * `true` to render potentially dangerous user content when rendering HTML\r\n  //  * with the option `rawHtml === true`\r\n  //  */\r\n  // @Prop() readonly allowDangerousHtml: boolean = false;\r\n\r\n  /**\r\n   * `true` to visually hide the contents of the root node while the control's\r\n   * style is not loaded. Only works if the `theme` property is set.\r\n   */\r\n  @Prop() readonly avoidFlashOfUnstyledContent: boolean = false;\r\n\r\n  /**\r\n   * `true` to render raw HTML with sanitization.\r\n   */\r\n  @Prop() readonly rawHtml: boolean = false;\r\n\r\n  /**\r\n   * This property allows us to implement custom rendering for the code blocks.\r\n   */\r\n  @Prop() readonly renderCode?: MarkdownViewerCodeRender | undefined;\r\n\r\n  /**\r\n   * Specifies if an indicator is displayed in the last element rendered.\r\n   * Useful for streaming scenarios where a loading indicator is needed.\r\n   */\r\n  @Prop() readonly showIndicator: boolean = false;\r\n\r\n  /**\r\n   * Specifies the theme to be used for rendering the control.\r\n   * If `undefined`, no theme will be applied.\r\n   */\r\n  @Prop() readonly theme: string | undefined = \"ch-markdown-viewer\";\r\n\r\n  /**\r\n   * Specifies the markdown string to parse.\r\n   */\r\n  @Prop() readonly value?: string | undefined;\r\n\r\n  async componentWillRender() {\r\n    if (!this.value) {\r\n      return;\r\n    }\r\n\r\n    this.#JSXTree = await markdownToJSX(this.value, {\r\n      allowDangerousHtml: true, // Allow dangerous in this version\r\n      codeRender: this.renderCode ?? defaultCodeRender,\r\n      lastNestedChildClass: LAST_NESTED_CHILD_CLASS,\r\n      rawHTML: this.rawHtml,\r\n      showIndicator: this.showIndicator\r\n    });\r\n  }\r\n\r\n  render() {\r\n    if (!this.value) {\r\n      return \"\";\r\n    }\r\n\r\n    return (\r\n      <Host\r\n        class={\r\n          this.showIndicator ? \"ch-markdown-viewer-show-indicator\" : undefined\r\n        }\r\n      >\r\n        {this.theme && (\r\n          <ch-theme\r\n            key=\"theme\"\r\n            avoidFlashOfUnstyledContent={this.avoidFlashOfUnstyledContent}\r\n            model={this.theme}\r\n          ></ch-theme>\r\n        )}\r\n        {this.#JSXTree}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}