import{r as t,c as s,g as e,h as i,H as n}from"./p-7af91c05.js";import{e as r}from"./p-6d91f415.js";import{S as o}from"./p-2a2bca47.js";const l=t=>t.hasAttribute("data-did-load")&&t.style.display!=="none";const c=(t,s)=>{const e=t.getBoundingClientRect();const i=s.x;const n=s.x+s.width;const o=s.y;const l=s.y+s.height;const c=e.x;const h=e.x+e.width;const a=e.y;const d=e.y+e.height;return(r(i,c,n)||r(i,h,n))&&(r(o,a,l)||r(o,d,l))};const h=(t,s,e)=>{const i=s;const n=s+e.height;const o=t.offsetTop;const l=t.offsetTop+t.height;return r(i,o,n)||r(i,l,n)};const a=t=>t===undefined||t.length===0;const d=t=>[...t.querySelectorAll(":scope>ch-smart-grid-cell")];const u=(t,s,e)=>{const i=[];const n=new Set;for(let s=t.startIndex;s<=t.endIndex;s++){const t=e[s];n.add(t.id)}t.renderedCells.forEach((t=>{if(!n.has(t.cellId)&&l(t)&&t.style.display!=="none"){const{offsetTop:e,offsetLeft:n}=t;const r=t.getBoundingClientRect();i.push(t);s.set(t.cellId,{width:r.width,height:r.height,offsetTop:e,offsetLeft:n})}}));return i};const f=(t,s,e)=>{const i=d(t);const n=s.getBoundingClientRect();const o=i.length-1;let h=e?o:0;const a=e?-1:1;while(r(0,h,o)){const t=i[h];if(l(t)){if(!c(t,n)){return true}}else{return false}h+=a}return true};const v={type:"waiting-for-cells-to-render"};const p=(t,s,e,i,n,o,l)=>{let a="";let d=0;e.forEach(((t,s)=>{const e=t.offsetTop+t.height;const i=e<=n;if(i&&d<=e){d=e;a=s}}));const u=s.findIndex((t=>t.id===a));const f=Math.max(0,u+1-i);const v=s.length-1;let p=u+1;let m=0;let g=0;if(l){return{startIndex:f,endIndex:v,renderedCells:t,type:"index"}}while(r(0,p,v)&&g<i){const i=s[p].id;const r=e.get(i);if(r){const t=h(r,n,o);if(!t){g++}}else{const s=t[m];const e=c(s,o);if(!e){g++}m++}p++}p=Math.min(v,p+i-1);return{startIndex:f,endIndex:p,renderedCells:t,type:"index"}};const m=(t,s)=>s<=t;const g=(t,s)=>t<=s;const x=(t,s,e,i)=>{const n=e.length-1;const r=t===1?n-s:s;const o=t===1?g:m;let l=t===1?0:n;let h=s;while(o(l,r)){const s=e[l];if(c(s,i)){break}h--;l+=t}return h};const C=(t,s,e,i,n,r,o,c)=>{const h=d(t);const a=h.every(l);if(!a){return v}const u=s.getBoundingClientRect();const f=s.scrollTop;const m=h[1];const g=n>0&&m.style.display!=="none"&&f<m.offsetTop;if(g){return p(h,e,i,o,f,u,c)}const C=h.at(-2);const b=r>0&&C.style.display!=="none"&&C.offsetTop+C.getBoundingClientRect().height<f;if(b){return p(h,e,i,o,f,u,c)}const y=x(1,o,h,u);const I=c?e.length-1:x(-1,o,h,u);return{startShift:y,endShift:I,renderedCells:h,type:"shift"}};const b=':host{--ch-virtual-scroll__scroll-start-size:0px;--ch-virtual-scroll__scroll-end-size:0px;--ch-virtual-scroll__scroll-start-display:none;--ch-virtual-scroll__scroll-end-display:none;display:grid;grid-auto-rows:-webkit-max-content;grid-auto-rows:max-content}:host(.ch-virtual-scroller--content-not-loaded){opacity:0;pointer-events:none}:host(.ch-virtual-scroller--content-loaded) ::slotted(ch-smart-grid-cell:not([data-did-load])){position:absolute;pointer-events:none;visibility:hidden}:host(.ch-virtual-scroller--virtual-scroll)::before{content:"";display:var(--ch-virtual-scroll__scroll-start-display);block-size:calc(var(--ch-virtual-scroll__scroll-start-size));inline-size:0px;pointer-events:none}:host(.ch-virtual-scroller--virtual-scroll)::after{content:"";display:var(--ch-virtual-scroll__scroll-end-display);block-size:calc(var(--ch-virtual-scroll__scroll-end-size));inline-size:0px;pointer-events:none}';const y=b;const I="--ch-virtual-scroll__scroll-";const w=`${I}start-size`;const _=`${I}start-display`;const z=`${I}end-size`;const S=`${I}end-display`;const k=class{constructor(e){t(this,e);this.virtualItemsChanged=s(this,"virtualItemsChanged",7);this.virtualScrollerDidLoad=s(this,"virtualScrollerDidLoad",7);this.waitingForContent=true;this.bufferAmount=5;this.initialRenderViewportItems=10;this.inverseLoading=false;this.items=undefined;this.itemsCount=undefined;this.mode="virtual-scroll"}#t=0;#s=0;#e=0;#i=0;#n=true;#r=false;#o;#l=new o;#c;#h;#a;get el(){return e(this)}waitingForContentChanged(){this.#d()}itemsChanged(t){this.#u();this.#f(t)}virtualItemsChanged;virtualScrollerDidLoad;async addItems(t,...s){if(t==="start"){this.items.unshift(...s);const t=s.length;this.#t+=t;this.#s+=t}else{this.items.push(...s)}this.#v()}#p=t=>{this.#e=0;this.#i=0;const s=this.items;const e=this.#c;const i=s.length-1;const n=Math.max(0,this.#t-1);const r=Math.min(i,this.#s+1);const o=e.get(s[n].id);const l=e.get(s[r].id);if(o){this.#e=o.offsetTop+o.height}const c=Math.max(1,this.#t);for(let t=c;t<this.#s;t++){const i=s[t].id;const n=e.get(i);if(n){this.#e+=n.height}}if(this.#s===i){const t=s[this.#s].id;const i=e.get(t);if(i){this.#e+=i.height}}else if(l){let t=0;e.forEach((s=>{t=Math.max(t,s.offsetTop+s.height)}));this.#i=t-l.offsetTop}t?.forEach((t=>{t.style.display="none"}));this.el.style.setProperty(w,`${this.#e}px`);this.el.style.setProperty(_,this.#e===0?"none":"block");this.el.style.setProperty(z,`${this.#i}px`);this.el.style.setProperty(S,this.#i===0?"none":"block")};#v=()=>{if(this.#n){this.#l.perform(this.#m)}};#m=()=>{const t=C(this.el,this.#a,this.items,this.#c,this.#e,this.#i,this.bufferAmount,this.inverseLoading);if(t.type==="waiting-for-cells-to-render"){this.#r=true;return}this.#r=false;if(t.type==="shift"){if(t.startShift===0&&t.endShift===0){return}this.#g(t.startShift,t.endShift,t.renderedCells)}else{const{startIndex:s,endIndex:e}=t;if(this.#t===s&&this.#s===e){return}const i=u(t,this.#c,this.items);this.#t=s;this.#s=e;this.#x(i)}};#x=t=>{this.#p(t);const s=this.items.slice(this.#t,this.#s+1);this.virtualItemsChanged.emit({startIndex:this.#t,endIndex:this.#s,totalItems:this.items.length,virtualItems:s})};#u=()=>{this.#e=0;this.#i=0;if(this.inverseLoading){const t=this.items.length-1;this.#t=t;this.#s=t}else{this.#t=0;this.#s=0}if(this.mode==="virtual-scroll"){this.#c=new Map}};#f=t=>{if(a(t)){this.#x();return}const s=this.initialRenderViewportItems+this.bufferAmount;if(this.inverseLoading){this.#g(s,0)}else{this.#g(0,s)}};#g=(t,s,e)=>{const i=this.mode==="lazy-render"?Math.max(0,t):t;const n=this.mode==="lazy-render"?Math.max(0,s):s;if(i===0&&n===0){return}const r=Math.min(this.#s+n,this.items.length-1);const o=Math.max(0,this.#t-i);if(this.#t===o&&this.#s===r&&this.items.length>1){return}this.#t=o;this.#s=r;const l=this.mode==="virtual-scroll"&&e!==undefined&&e.length>0?u({endIndex:this.#s,startIndex:this.#t,renderedCells:e,type:"index"},this.#c,this.items):[];this.#x(l)};#d=()=>{this.#o=new AbortController;requestAnimationFrame((()=>{this.#a.addEventListener("scroll",this.#v,{passive:true,signal:this.#o.signal});this.#h=new ResizeObserver(this.#v);this.#h.observe(this.#a)}))};#C=t=>{if(this.waitingForContent){this.#b()}else{this.#y(t.detail)}};#b=()=>this.#l.perform((()=>{const t=!f(this.el,this.#a,this.inverseLoading);if(!t){requestAnimationFrame((()=>{this.virtualScrollerDidLoad.emit();this.waitingForContent=t}))}}));#y=t=>{this.#c.delete(t);this.#p();if(this.#r){this.#v()}};connectedCallback(){this.el.addEventListener("smartCellDidLoad",this.#C);this.#u()}componentDidLoad(){this.#a=this.el.closest("ch-smart-grid");this.#f(this.items)}disconnectedCallback(){this.#h?.disconnect();this.#h=undefined;this.#l.cancel();this.#l=undefined;this.#o.abort()}render(){return i(n,{key:"2be1c9ea6851f174f8d31dd250b882a74bd37294",class:{"ch-virtual-scroller--content-not-loaded":this.waitingForContent,"ch-virtual-scroller--content-loaded":!this.waitingForContent,"ch-virtual-scroller--virtual-scroll":!this.waitingForContent&&this.mode==="virtual-scroll"}},i("slot",{key:"ce7acec855305ae5cf06b4ba3a53f066d2b3799e",onSlotchange:this.waitingForContent?this.#b:undefined}))}static get watchers(){return{waitingForContent:["waitingForContentChanged"],items:["itemsChanged"]}}};k.style=y;export{k as ch_virtual_scroller};
//# sourceMappingURL=p-f5df913e.entry.js.map