import{r as t,g as i,h as s,H as e,c as n}from"./p-7af91c05.js";import{S as a}from"./p-625020d1.js";import{a as h}from"./p-a859514b.js";import"./p-e7a788ef.js";const r=t=>{let i=t;while(i!==null&&i!==window.document.documentElement){const s=window.getComputedStyle(t).overflowY;if(s==="auto"||s==="scroll"){return[i.tagName==="ch-smart-grid"?"ch-smart-grid":"other",i]}i=i.parentElement}return["window",window.document.documentElement]};const o=":host{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;text-align:center;block-size:0;inline-size:100%;pointer-events:none}:host(.loading){block-size:auto}";const d=o;const l=2;const c=class{constructor(i){t(this,i);this.dataProvider=false;this.disabled=false;this.infiniteThresholdReachedCallback=undefined;this.loadingState=undefined;this.position="bottom";this.threshold="150px"}#t=0;#i=0;#s=0;#e;#n;#a;#h;#r;#o="other";get el(){return i(this)}dataProviderChanged(t){if(t){requestAnimationFrame(this.#d)}else{this.#l()}}disabledChanged(t){if(t){this.#l()}else{requestAnimationFrame(this.#d)}}loadingStateChanged(t){this.#c();if(t==="initial"){this.#t=0;this.#i=0;this.#s=0}}thresholdChanged(){this.#c()}async complete(){}#f=()=>this.loadingState==="more-data-to-fetch";#c=()=>{this.#l();requestAnimationFrame(this.#d)};#g=()=>{if(this.loadingState!=="loading"){this.loadingState="loading";this.infiniteThresholdReachedCallback()}};#d=()=>{if(!this.dataProvider||this.disabled){return}requestAnimationFrame((()=>{if(!this.#f()||this.#e){return}const t={root:this.#r,rootMargin:this.threshold};this.#e=new IntersectionObserver((t=>{if(t[0].isIntersecting){this.#g()}}),t);this.#e.observe(this.el)}))};#m=()=>{this.#a??=new AbortController;this.#r.addEventListener("scroll",this.#u,{capture:true,passive:true,signal:this.#a.signal})};#u=()=>{this.#s=this.#r.scrollTop;this.#i=this.#r.scrollHeight};#p=()=>{if(this.#o==="window"||this.position!=="top"){return}requestAnimationFrame(this.#m);const t=this.#h.querySelector("[slot='grid-content']");t.scrollTop=t.scrollHeight+l;this.#n=new ResizeObserver(this.#b);this.#n.observe(t);this.#n.observe(this.#r)};#b=()=>{const t=this.#r.clientHeight;const i=this.#r.scrollHeight;const s=this.#t===this.#i&&t<i;if(s){const s=i-t+l;this.#t=t;this.#i=i;this.#r.scrollTop=s;this.#s=s;return}const e=this.#i<=this.#t+this.#s+l;if(this.dataProvider||e){const s=i-this.#i;const n=t<this.#t?this.#t-t:0;const a=this.#s+s+n+(e?l:0);this.#r.scrollTop=a;this.#s=a}this.#t=t;this.#i=i};#w=()=>{this.#n?.disconnect();this.#n=undefined;this.#a.abort()};#l=()=>{this.#e?.disconnect();this.#e=undefined};componentDidLoad(){this.#h=this.el.getRootNode().host;const t=r(this.#h);this.#o=t[0];this.#r=t[1];this.#p();requestAnimationFrame(this.#d)}disconnectedCallback(){this.#l();this.#w()}render(){return s(e,{key:"43a43b63927d81c2f8bee9404e859f16183f937e",class:this.loadingState==="loading"?"loading":undefined,"aria-hidden":"true"},this.loadingState==="loading"&&s("slot",{key:"26f162903111002e6dcfddc59a1255d8a4b0cbf0"}))}static get watchers(){return{dataProvider:["dataProviderChanged"],disabled:["disabledChanged"],loadingState:["loadingStateChanged"],threshold:["thresholdChanged"]}}};c.style=d;const f=":host{display:grid;grid-template-rows:1fr;grid-template-columns:1fr}:host(.ch-smart-grid--loaded-render-delay){opacity:0;pointer-events:none}:host(.ch-smart-grid--inverse-loading){grid-template-rows:-webkit-max-content 1fr;grid-template-rows:max-content 1fr}:host(.ch-smart-grid--data-provider){grid-template-rows:1fr -webkit-max-content;grid-template-rows:1fr max-content}:host(.ch-scrollable){contain:strict;overflow:auto;overflow-anchor:none}::slotted([slot=grid-content]){display:grid;grid-auto-rows:-webkit-max-content;grid-auto-rows:max-content}";const g=f;const m="ch-smart-grid--loaded-render-delay";const u=class{constructor(i){t(this,i);this.infiniteThresholdReached=n(this,"infiniteThresholdReached",3);this.infiniteScrollEnabled=true;this.accessibleName=undefined;this.autoGrow=false;this.dataProvider=false;this.inverseLoading=false;this.itemsCount=undefined;this.loadingState="initial";this.threshold="10px"}#v=false;get el(){return i(this)}infiniteThresholdReached;handleVirtualItemsChanged(t){const{startIndex:i,endIndex:s,totalItems:e}=t.detail;this.infiniteScrollEnabled=this.inverseLoading&&i===0||!this.inverseLoading&&s===e-1}#C=()=>{this.loadingState="loading";this.infiniteThresholdReached.emit()};#x=()=>{if(this.inverseLoading){this.#v=true;this.el.classList.add(m)}};#S=()=>{this.#v=false;this.el.removeEventListener("virtualScrollerDidLoad",this.#S);requestAnimationFrame((()=>{this.el.classList.remove(m)}))};connectedCallback(){h(this.el.shadowRoot.adoptedStyleSheets);this.#x();if(this.inverseLoading&&!this.autoGrow){this.el.addEventListener("virtualScrollerDidLoad",this.#S)}}componentDidRender(){if(!this.#v){return}if(this.inverseLoading&&this.autoGrow){this.#S()}}render(){const t=this.loadingState==="initial";const i=this.itemsCount>0;return s(e,{key:"bd5eb40adad1f218aaaf5392b3120075258e8906","aria-label":this.accessibleName||undefined,"aria-live":"polite","aria-busy":t||this.loadingState==="loading"?"true":"false",class:{"ch-smart-grid--inverse-loading":i&&this.inverseLoading,"ch-smart-grid--data-provider":i&&this.dataProvider&&!this.inverseLoading,[a]:!this.autoGrow}},t?s("slot",{name:"grid-initial-loading-placeholder"}):[i&&this.inverseLoading&&s("ch-infinite-scroll",{dataProvider:this.dataProvider,disabled:!this.infiniteScrollEnabled,infiniteThresholdReachedCallback:this.#C,loadingState:this.loadingState,position:"top",threshold:this.threshold}),s("slot",{name:i?"grid-content":"grid-content-empty"}),i&&this.dataProvider&&!this.inverseLoading&&s("ch-infinite-scroll",{dataProvider:true,disabled:!this.infiniteScrollEnabled,infiniteThresholdReachedCallback:this.#C,loadingState:this.loadingState,threshold:this.threshold})])}};u.style=g;const p="smart-grid-cell{display:-ms-flexbox;display:flex}";const b=p;const w=class{constructor(i){t(this,i);this.smartCellDidLoad=n(this,"smartCellDidLoad",7);this.cellId=undefined}get el(){return i(this)}smartCellDidLoad;connectedCallback(){this.el.setAttribute("role","gridcell")}componentDidLoad(){this.smartCellDidLoad.emit(this.cellId);this.el.setAttribute("data-did-load","true")}};w.style=b;export{c as ch_infinite_scroll,u as ch_smart_grid,w as ch_smart_grid_cell};
//# sourceMappingURL=p-7611852e.entry.js.map