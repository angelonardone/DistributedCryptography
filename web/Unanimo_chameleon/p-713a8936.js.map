{"version":3,"names":["tagsToSanitize","Set","LAST_SEMICOLON_AND_SPACES_IN_INLINE_STYLE","SEMICOLON_AND_SPACES","COLON_AND_SPACES","getStyleObjectFromString","inlineStyle","formattedStyle","replace","propertiesWithValues","split","styleObject","forEach","propertyAndValue","separatedPropertyAndValue","renderDictionary","comment","element","showIndicator","lastElementChild","properties","has","tagName","href","includes","key","startsWith","style","undefined","className","class","join","htmlFor","for","isLastElementChild","LAST_NESTED_CHILD_CLASS","h","renderChildren","text","value","doctype","children","map","child","type","findLastNestedChild","elementWithChildren","lastChild","at","length","rawHTMLToJSX","htmlString","allowDangerousHtml","hast","fromHTMLStringToHast","fragment"],"sources":["src/components/markdown-viewer/parsers/raw-html-to-jsx.tsx"],"sourcesContent":["import { h } from \"@stencil/core\";\r\nimport { fromHTMLStringToHast } from \"@genexus/markdown-parser/dist/parse-html.js\";\r\n// import { Root, RootContent, RootContentMap } from \"hast\";\r\nimport { Element as HElement, Root, RootContentMap } from \"hast\";\r\nimport { LAST_NESTED_CHILD_CLASS } from \"./markdown-to-jsx\";\r\n\r\nconst tagsToSanitize = new Set([\r\n  \"base\",\r\n  \"body\",\r\n  \"embed\",\r\n  \"head\",\r\n  \"html\",\r\n  \"iframe\",\r\n  \"link\",\r\n  \"meta\",\r\n  \"object\",\r\n  \"script\",\r\n  \"style\",\r\n  \"svg\",\r\n  \"title\"\r\n]);\r\n\r\nconst LAST_SEMICOLON_AND_SPACES_IN_INLINE_STYLE = /\\s*;\\s*$/;\r\nconst SEMICOLON_AND_SPACES = /\\s*;\\s*/;\r\nconst COLON_AND_SPACES = /\\s*:\\s*/;\r\n\r\nconst getStyleObjectFromString = (\r\n  inlineStyle: string\r\n): { [key in string]: string } => {\r\n  // Remove last \" ;   \"\r\n  const formattedStyle = inlineStyle.replace(\r\n    LAST_SEMICOLON_AND_SPACES_IN_INLINE_STYLE,\r\n    \"\"\r\n  );\r\n\r\n  // [\"background-color: red\", \"color: black\", ...]\r\n  const propertiesWithValues = formattedStyle.split(SEMICOLON_AND_SPACES);\r\n  const styleObject = {};\r\n\r\n  propertiesWithValues.forEach(propertyAndValue => {\r\n    const separatedPropertyAndValue = propertyAndValue.split(COLON_AND_SPACES);\r\n    styleObject[separatedPropertyAndValue[0]] = separatedPropertyAndValue[1];\r\n  });\r\n\r\n  return styleObject;\r\n};\r\n\r\nconst renderDictionary: {\r\n  [key in keyof RootContentMap]: (\r\n    element: RootContentMap[key],\r\n    showIndicator: boolean,\r\n    lastElementChild: HElement | undefined\r\n  ) => any;\r\n} = {\r\n  comment: () => \"\",\r\n  element: (element, showIndicator, lastElementChild) => {\r\n    const properties = element.properties;\r\n\r\n    // Minimal sanitization\r\n    if (\r\n      tagsToSanitize.has(element.tagName) ||\r\n      (element.tagName === \"a\" &&\r\n        (properties.href as string)?.includes(\"javascript:\"))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // Remove native attr listeners\r\n    for (const key in properties) {\r\n      if (key.startsWith(\"on\")) {\r\n        delete properties[key];\r\n      }\r\n    }\r\n\r\n    // Parse style to an object\r\n    if (properties.style !== undefined) {\r\n      properties.style = getStyleObjectFromString(\r\n        properties.style as string\r\n      ) as any;\r\n    }\r\n\r\n    if (properties.className !== undefined) {\r\n      properties.class = (properties.className as string[]).join(\" \");\r\n      delete properties.className;\r\n    }\r\n\r\n    if (properties.htmlFor) {\r\n      properties.for = properties.htmlFor;\r\n      delete properties.htmlFor;\r\n    }\r\n\r\n    // Indicator for streaming\r\n    const isLastElementChild = showIndicator && element === lastElementChild;\r\n    if (isLastElementChild) {\r\n      properties.class = properties.class\r\n        ? `${properties.class} ${LAST_NESTED_CHILD_CLASS}`\r\n        : LAST_NESTED_CHILD_CLASS;\r\n    }\r\n\r\n    return (\r\n      <element.tagName {...properties}>\r\n        {renderChildren(element, showIndicator, lastElementChild)}\r\n      </element.tagName>\r\n    );\r\n  },\r\n  text: element => element.value,\r\n  doctype: () => \"\"\r\n};\r\n\r\nfunction renderChildren(\r\n  element: Root | HElement,\r\n  showIndicator: boolean,\r\n  lastElementChild: HElement | undefined\r\n) {\r\n  return element.children.map(child =>\r\n    renderDictionary[child.type](child, showIndicator, lastElementChild)\r\n  );\r\n}\r\n\r\nconst findLastNestedChild = (elementWithChildren: HElement) => {\r\n  const lastChild = elementWithChildren.children.at(-1) as HElement;\r\n\r\n  // The last element have children. We must check its sub children\r\n  if (lastChild.children?.length > 0) {\r\n    return findLastNestedChild(lastChild);\r\n  }\r\n\r\n  return elementWithChildren;\r\n};\r\n\r\nexport const rawHTMLToJSX = (\r\n  htmlString: string,\r\n  allowDangerousHtml: boolean,\r\n  showIndicator: boolean\r\n) => {\r\n  const hast: Root = fromHTMLStringToHast(htmlString, allowDangerousHtml, {\r\n    fragment: true\r\n  });\r\n\r\n  const lastElementChild =\r\n    hast.children.at(-1).type === \"element\"\r\n      ? findLastNestedChild(hast.children.at(-1) as HElement)\r\n      : undefined;\r\n\r\n  // Render the hast as JSX\r\n  return renderChildren(hast, showIndicator, lastElementChild);\r\n};\r\n"],"mappings":"4MAMA,MAAMA,EAAiB,IAAIC,IAAI,CAC7B,OACA,OACA,QACA,OACA,OACA,SACA,OACA,OACA,SACA,SACA,QACA,MACA,UAGF,MAAMC,EAA4C,WAClD,MAAMC,EAAuB,UAC7B,MAAMC,EAAmB,UAEzB,MAAMC,EACJC,IAGA,MAAMC,EAAiBD,EAAYE,QACjCN,EACA,IAIF,MAAMO,EAAuBF,EAAeG,MAAMP,GAClD,MAAMQ,EAAc,GAEpBF,EAAqBG,SAAQC,IAC3B,MAAMC,EAA4BD,EAAiBH,MAAMN,GACzDO,EAAYG,EAA0B,IAAMA,EAA0B,EAAE,IAG1E,OAAOH,CAAW,EAGpB,MAAMI,EAMF,CACFC,QAAS,IAAM,GACfC,QAAS,CAACA,EAASC,EAAeC,KAChC,MAAMC,EAAaH,EAAQG,WAG3B,GACEpB,EAAeqB,IAAIJ,EAAQK,UAC1BL,EAAQK,UAAY,KAClBF,EAAWG,MAAiBC,SAAS,eACxC,CACA,M,CAIF,IAAK,MAAMC,KAAOL,EAAY,CAC5B,GAAIK,EAAIC,WAAW,MAAO,QACjBN,EAAWK,E,EAKtB,GAAIL,EAAWO,QAAUC,UAAW,CAClCR,EAAWO,MAAQtB,EACjBe,EAAWO,M,CAIf,GAAIP,EAAWS,YAAcD,UAAW,CACtCR,EAAWU,MAASV,EAAWS,UAAuBE,KAAK,YACpDX,EAAWS,S,CAGpB,GAAIT,EAAWY,QAAS,CACtBZ,EAAWa,IAAMb,EAAWY,eACrBZ,EAAWY,O,CAIpB,MAAME,EAAqBhB,GAAiBD,IAAYE,EACxD,GAAIe,EAAoB,CACtBd,EAAWU,MAAQV,EAAWU,MAC1B,GAAGV,EAAWU,SAASK,IACvBA,C,CAGN,OACEC,EAACnB,EAAQK,QAAO,IAAKF,GAClBiB,EAAepB,EAASC,EAAeC,GACxB,EAGtBmB,KAAMrB,GAAWA,EAAQsB,MACzBC,QAAS,IAAM,IAGjB,SAASH,EACPpB,EACAC,EACAC,GAEA,OAAOF,EAAQwB,SAASC,KAAIC,GAC1B5B,EAAiB4B,EAAMC,MAAMD,EAAOzB,EAAeC,IAEvD,CAEA,MAAM0B,EAAuBC,IAC3B,MAAMC,EAAYD,EAAoBL,SAASO,IAAI,GAGnD,GAAID,EAAUN,UAAUQ,OAAS,EAAG,CAClC,OAAOJ,EAAoBE,E,CAG7B,OAAOD,CAAmB,E,MAGfI,EAAe,CAC1BC,EACAC,EACAlC,KAEA,MAAMmC,EAAaC,EAAqBH,EAAYC,EAAoB,CACtEG,SAAU,OAGZ,MAAMpC,EACJkC,EAAKZ,SAASO,IAAI,GAAGJ,OAAS,UAC1BC,EAAoBQ,EAAKZ,SAASO,IAAI,IACtCpB,UAGN,OAAOS,EAAegB,EAAMnC,EAAeC,EAAiB,S"}