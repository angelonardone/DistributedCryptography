import{h as t,r as e,c as i,g as s,f as o,H as n}from"./p-7af91c05.js";import{f as r}from"./p-5f934da7.js";import{C as a,d as h}from"./p-625020d1.js";import{t as c,u as l,i as d}from"./p-6d91f415.js";import{g as u}from"./p-ebac9feb.js";import{g as m,a as b}from"./p-f26e989b.js";import"./p-bb7b9247.js";const g=(t,e,i)=>i?t.includes(e):t.toLowerCase().includes(e.toLowerCase());const p=(t,e,i)=>i?.regularExpression?t.match(e)!==null:g(t,e,i?.matchCase);const f=(t,e)=>!e.filter||p(t.caption??t.value,e.filter,e.options);const x=(t,e)=>e.options?.hideMatchesAndShowNonMatches===true?!f(t,e):f(t,e);const v=(t,e,i)=>{let s=false;const o=t.items;if(o!=null){for(let t=0;t<o.length;t++){const n=o[t];const r=v(n,e,i);s||=r}}const n=s||x(t,e);if(n){i.add(t)}return n};const _="__";const k=(t,e,i)=>i?`${t}${_}${e}`:`${e}`;const y=(t,e)=>{const i=t.split(_);const s=e[Number(i[0])];if(i.length===2&&s.items!=null){return s.items[Number(i[1])]}return s};const w=t=>{if(!t){return undefined}if(t.start&&t.end){return{...t.start.styles,...t.end.styles}}return t.start?.styles??t.end.styles};const C=(e,i,s,o,n,r,h)=>(l,d)=>{if(s&&!n.has(l)){return}const u=!!l.startImgSrc||!!l.endImgSrc?r.get(l.value):undefined;const m=!!u?.start;const b=!!u?.end;const g=m?`img--start start-img-type--${l.startImgType??"background"} ${u.start.classes}`:undefined;const p=b?`img--end end-img-type--${l.endImgType??"background"} ${u.end.classes}`:undefined;const f=i||l.disabled;const x=l;const v=l.value===o?.value;const _=k(h,d,e);return x.items!=null?t("div",{key:`__group__${l.value}`,"aria-controls":x.expandable?`${d}__content`:null,"aria-expanded":x.expandable?(!!x.expanded).toString():null,"aria-labelledby":d.toString(),role:"group",class:"group",part:c({[l.value]:true,[a.GROUP]:true,[a.DISABLED]:f})},x.expandable?t("button",{id:_,class:{group__header:true,"group--expandable":true,"group--collapsed":!x.expanded,disabled:f},part:c({[l.value]:true,[a.GROUP_HEADER]:true,[a.EXPANDABLE]:true,[a.DISABLED]:f,[a.EXPANDED]:x.expanded,[a.COLLAPSED]:!x.expanded}),style:w(u),disabled:f,type:"button"},t("span",{class:{"group__header-caption":true,[g]:m,[p]:b},part:`${a.GROUP_HEADER_CAPTION} ${l.value}`},l.caption??l.value)):t("span",{id:d.toString(),class:{group__header:true,disabled:f,[g]:m,[p]:b},part:c({[l.value]:true,[a.GROUP_HEADER]:true,[a.DISABLED]:f}),style:w(u)},l.caption??l.value),t("div",{key:`__content__${l.value}`,id:x.expandable?`${d}__content`:null,class:{group__content:true,"group__content--collapsed":x.expandable&&!x.expanded},part:`${a.GROUP_CONTENT} ${l.value}`},(!x.expandable||x.expanded)&&x.items.map(C(true,f,s,o,n,r,_)))):t("button",{key:l.value,id:_,role:"option","aria-selected":v,tabindex:"-1",class:{leaf:true,disabled:f,selected:v,[g]:m,[p]:b},part:c({[l.value]:true,[a.ITEM]:true,[a.NESTED]:e,[a.DISABLED]:f,[a.SELECTED]:v}),style:w(u),disabled:f,type:"button"},l.caption??l.value)};const z=(e,i)=>e.items!=null?t("optgroup",{label:e.caption??e.value},e.items.map((t=>z(t,i)))):t("option",{key:e.value,value:e.value,disabled:e.disabled,selected:e.value===i},e.caption??e.value);const I=t=>{let e="";let i=0;t.forEach((t=>{const s=t.items;if(t.caption.length>i){e=t.caption;i=t.caption.length}if(s!=null){s.forEach((t=>{if(t.caption.length>i){e=t.caption;i=t.caption.length}}))}}));return e};const L=(t,e,i)=>{e.clear();i.clear();if(t==null){return}t.forEach(((t,s)=>{const o={item:t,index:{type:"first-level",firstLevelIndex:s}};e.set(t.value,o);if(t.caption){i.set(t.caption,o)}t.items?.forEach(((t,o)=>{const n={item:t,index:{type:"nested",firstLevelIndex:s,secondLevelIndex:o}};e.set(t.value,n);if(t.caption){i.set(t.caption,n)}}))}))};const $=t=>{const e=t.composedPath();for(let t=0;t<e.length;t++){const i=e[t];const s=i.tagName?.toLowerCase();if(s==="ch-popover"){return true}if(s==="ch-combo-box-render"){return false}}return false};const A=(t,e)=>{t.stopPropagation();let i=t.target;if(i.tagName?.toLowerCase()==="span"){i=i.parentElement}if(i.tagName?.toLowerCase()!=="button"){return undefined}const s=i.id;return y(s,e)};const E=(t,e)=>t&&(t.value===e.value||t.caption&&t.caption===e.caption);const F=(t,e)=>{for(let i=0;i<e.length;i++){const s=e[i];if(E(s,t)){return true}}return false};const M=(t,e)=>{if(!t||!e){return false}for(let i=0;i<e.length;i++){const s=e[i];if(E(s,t)){return true}if(s.items!=null&&F(t,s.items)){return true}}return false};const T={type:"not-exists"};const D=(t,e)=>0<=e&&e<t.length;const V=(t,e)=>{if(!e){return T}return t.get(e.value)?.index??T};const O=(t,e,i,s,o)=>{if(e.type==="not-exists"){return T}const n=e.firstLevelIndex;if(e.type==="nested"){let r=e.secondLevelIndex+i;const a=t[n].items;while(D(a,r)&&(a[r].disabled||s&&!o.has(a[r]))){r+=i}if(D(a,r)){return{type:"nested",firstLevelIndex:n,secondLevelIndex:r}}}let r=n+i;while(D(t,r)&&(t[r].disabled||s&&!o.has(t[r]))){r+=i}if(!D(t,r)){return T}const a=t[r].items;if(a!=null){return O(t,{type:"nested",firstLevelIndex:r,secondLevelIndex:i===1?-1:a.length},i,s,o)}return{type:"first-level",firstLevelIndex:r}};const j=(t,e,i)=>{const s=i(t,e);return s?l(s,e):undefined};const P=(t,e,i)=>{for(let s=0;s<t.length;s++){const o=t[s];let n;if(o.startImgSrc){const t=j(o,"start",e);n={start:t}}if(o.endImgSrc){const t=j(o,"end",e);if(n){n.end=t}else{n={end:t}}}if(n){i.set(o.value,n)}if(o.items!=null){P(o.items,e,i)}}};const B=(t,e)=>{if(!t){return undefined}const i=new Map;P(t,e,i);return i};const N='input,select,textarea{padding:0;margin:0;background-color:unset;border:unset;color:unset;font:unset;outline:unset}:where(button,a){all:unset;display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer}button:disabled{pointer-events:none}*,::after,::before{-webkit-box-sizing:border-box;box-sizing:border-box}:host{--ch-combo-box-group__expandable-button-size:0.875em;--ch-combo-box-group__expandable-button-image-size:0.875em;--ch-combo-box-item__image-size:0.875em;--ch-combo-box-item__background-image-size:100%;--ch-combo-box__picker:url(\'data:image/svg+xml,<svg width="8" height="12" viewBox="0 0 8 12" xmlns="http://www.w3.org/2000/svg"><path d="M4.16669 0.666626L7.66669 4.66663H0.666687L4.16669 0.666626ZM4.16669 11.3333L0.666687 7.33329H7.66669L4.16669 11.3333Z"/></svg>\');--ch-combo-box__picker-color:currentColor;--ch-combo-box__picker-size:0.875em;--ch-combo-box__picker-image-size:100%;--ch-combo-box-item-gap:0px;--ch-combo-box-separation:0px;--ch-combo-box-separation-x:var(--ch-combo-box-separation);--ch-combo-box-separation-y:var(--ch-combo-box-separation);display:inline-grid;grid-template-columns:1fr -webkit-max-content;grid-template-columns:1fr max-content;grid-template-rows:-webkit-max-content 1fr;grid-template-rows:max-content 1fr;-ms-flex-align:center;align-items:center}:host::after{grid-row:1/3;grid-column:2;inline-size:var(--ch-combo-box__picker-size);block-size:var(--ch-combo-box__picker-size);-webkit-mask:var(--ch-combo-box__picker) 50% 50%/var(--ch-combo-box__picker-image-size) var(--ch-combo-box__picker-image-size) no-repeat;-webkit-margin-start:var(--ch-combo-box-item-gap);margin-inline-start:var(--ch-combo-box-item-gap);background-color:var(--ch-combo-box__picker-color);pointer-events:none}:host(.ch-combo-box--normal){cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}:host(.ch-combo-box--normal)::after{content:""}:host(.ch-combo-box--suggest){--ch-combo-box__picker-size:0px;cursor:text}:host(.ch-disabled){pointer-events:none}.input-container{grid-row:2/3;outline:unset}.invisible-text{visibility:hidden;pointer-events:none;block-size:0;overflow:hidden}select{all:unset;display:grid;overflow:hidden;grid-row:2/3}.value{display:inline-grid;-ms-flex-align:center;align-items:center;inline-size:100%}.value--readonly{pointer-events:none;text-overflow:ellipsis}ch-popover{--ch-popover-separation-x:var(--ch-combo-box-separation-x);--ch-popover-separation-y:var(--ch-combo-box-separation-y);cursor:auto}ch-popover:not(.hydrated){opacity:0}.leaf,.group__header,.group__header-caption,.input-container{display:-ms-flexbox;display:flex;gap:var(--ch-combo-box-item-gap);-ms-flex-align:center;align-items:center;-ms-flex:1;flex:1}.group{display:grid;grid-template-rows:-webkit-max-content 1fr;grid-template-rows:max-content 1fr}.group--expandable::before{content:"";inline-size:var(--ch-combo-box-group__expandable-button-size);block-size:var(--ch-combo-box-group__expandable-button-size);background-color:currentColor;-webkit-mask:url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" fill="none"><path d="M16.5 5L8.7 12.7L1 5" stroke="%23000" stroke-width="1.2" stroke-linecap="round"/></svg>\') 50% 50%/var(--ch-combo-box-group__expandable-button-image-size) var(--ch-combo-box-group__expandable-button-image-size) no-repeat}.group--collapsed::before{-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.group__content{display:grid;grid-auto-rows:-webkit-max-content;grid-auto-rows:max-content}.group__content--collapsed{display:none}.img--start::before,.img--end::after{content:"";display:block;inline-size:var(--ch-combo-box-item__image-size);block-size:var(--ch-combo-box-item__image-size);min-inline-size:var(--ch-combo-box-item__image-size);pointer-events:none}.img--start{--ch-combo-box-item-start-img:var(--ch-start-img--base)}.img--start.selected.start-img--selected{--ch-combo-box-item-start-img:var(--ch-start-img--selected)}.group__header:hover>.img--start.start-img--hover{--ch-combo-box-item-start-img:var(--ch-start-img--hover)}.group__header:active>.img--start.start-img--active{--ch-combo-box-item-start-img:var(--ch-start-img--active)}:host(:focus) .img--start.input-container.start-img--focus{--ch-combo-box-item-start-img:var(--ch-start-img--focus)}:host(:not(.ch-disabled):hover) .img--start.input-container.start-img--hover{--ch-combo-box-item-start-img:var(--ch-start-img--hover)}.img--start.disabled.start-img--disabled,.disabled>.img--start.start-img--disabled,:host(.ch-disabled) .img--start.start-img--disabled{--ch-combo-box-item-start-img:var(--ch-start-img--disabled)}.img--end{--ch-combo-box-item-end-img:var(--ch-end-img--base)}.img--end::after{-webkit-margin-start:auto;margin-inline-start:auto}.img--end.selected.end-img--selected{--ch-combo-box-item-end-img:var(--ch-end-img--selected)}.group__header:hover>.img--end.end-img--hover{--ch-combo-box-item-end-img:var(--ch-end-img--hover)}.group__header:active>.img--end.end-img--active{--ch-combo-box-item-end-img:var(--ch-end-img--active)}.img--end.disabled.end-img--disabled,.disabled>.img--end.end-img--disabled{--ch-combo-box-item-end-img:var(--ch-end-img--disabled)}.start-img-type--background::before{background:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-start-img)}.end-img-type--background::after{background:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-end-img)}.start-img-type--mask::before{-webkit-mask:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-start-img);background-color:currentColor}.end-img-type--mask::after{-webkit-mask:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-end-img);background-color:currentColor}';const R=N;const W=`button[part*='${a.SELECTED}']`;const H=d();const S=(t,e)=>({base:e==="start"?t.startImgSrc:t.endImgSrc});const U=class{constructor(t){e(this,t);this.input=i(this,"input",7);this.change=i(this,"change",7);if(t.$hostElement$["s-ei"]){this.internals=t.$hostElement$["s-ei"]}else{this.internals=t.$hostElement$.attachInternals();t.$hostElement$["s-ei"]=this.internals}this.activeDescendant=undefined;this.expanded=false;this.accessibleName=undefined;this.disabled=false;this.getImagePathCallback=undefined;this.hostParts=undefined;this.model=[];this.multiple=false;this.name=undefined;this.placeholder=undefined;this.popoverInlineAlign="inside-start";this.readonly=false;this.resizable=false;this.suggest=false;this.suggestDebounce=250;this.suggestOptions={};this.value=undefined}#t;#e;#i;#s=new Map;#o=new Map;#n;#r=false;#a;#h;#c=(t,e,i,s,o)=>{t.preventDefault();const n=e.type==="not-exists"?O(this.model,{type:"first-level",firstLevelIndex:i===1?-1:this.model.length},i,s,o):O(this.model,e,i,s,o);if(n.type==="not-exists"){return}const r=n.type==="first-level"?this.model[n.firstLevelIndex]:this.model[n.firstLevelIndex].items[n.secondLevelIndex];if(this.activeDescendant!==r){this.activeDescendant=r}};#l={ArrowUp:t=>this.#c(t,V(this.#s,this.activeDescendant),-1,this.suggest&&!this.#d(),this.#h),ArrowDown:t=>this.#c(t,V(this.#s,this.activeDescendant),1,this.suggest&&!this.#d(),this.#h),Home:t=>this.#c(t,{type:"first-level",firstLevelIndex:-1},1,this.suggest&&!this.#d(),this.#h),End:t=>this.#c(t,{type:"first-level",firstLevelIndex:this.model.length},-1,this.suggest&&!this.#d(),this.#h),Enter:()=>{if(this.expanded){this.el.focus()}this.expanded=!this.expanded},Space:t=>{t.preventDefault();this.expanded||=true},Tab:t=>{if(this.expanded){t.preventDefault();this.el.focus();this.expanded=false}}};#u={ArrowUp:t=>{if(this.expanded){this.#l.ArrowUp(t)}else{this.expanded=true}},ArrowDown:t=>{if(this.expanded){this.#l.ArrowDown(t)}else{this.expanded=true}},Enter:t=>this.#m(t),Tab:t=>this.#m(t)};#b;#g;handleExpandedChange(t){if(t&&!H){this.#p();this.#f();if(this.suggest){this.#x()}}else{this.#n=undefined}}internals;get el(){return s(this)}modelChanged(t){this.#v(this.model);L(t,this.#s,this.#o);if(this.expanded){this.#p()}this.#_(this.value)}suggestChanged(){this.#x()}suggestDebounceChanged(){if(this.suggest){this.#x()}}suggestOptionsChanged(){this.#x()}valueChanged(t){this.#_(t);if(this.suggest){this.#x()}}input;change;#v=t=>{this.#e=I(t)};#k=()=>this.getImagePathCallback??u("getImagePathCallback","ch-combo-box-render")??S;#p=()=>{this.#n=B(this.model,this.#k())};#x=()=>{this.#r=true};#y=()=>{this.#h.clear();const t={filter:this.value,options:this.suggestOptions};for(let e=0;e<this.model.length;e++){const i=this.model[e];v(i,t,this.#h)}if(!this.#h.has(this.activeDescendant)){this.activeDescendant=undefined}};#w=()=>{if(!this.suggest){this.#h=undefined;return}const t=this.#d();if(!t){this.#h??=new Set;this.#y()}};#C=()=>this.#o.get(this.value)??this.#s.get(this.value);#z=()=>{const t=this.activeDescendant;if(t?.value!==this.value){clearTimeout(this.#a);this.value=this.suggest?t.caption??t.value:t.value;this.input.emit(this.value);this.#I()}};#m=t=>{if(!this.expanded){return}this.expanded=false;this.el.focus();t.preventDefault();if(this.activeDescendant){this.#z();return}if(!this.suggestOptions?.strict){clearTimeout(this.#a);this.value=this.#b.value;this.input.emit(this.value);this.#I();return}const e=this.#C();if(e){this.#I()}else{clearTimeout(this.#a);this.value=this.#i;this.input.emit(this.value);this.#I()}};#L=t=>{t.preventDefault();this.value=this.#g.value;this.activeDescendant=this.#s.get(this.activeDescendant.value)?.item;this.input.emit(this.value)};#$=t=>{if(!this.suggest){const e=this.#l[t.code];if(!e){return}e(t);if(!this.expanded){this.#z()}}else{const e=this.#u[t.code];if(e){e(t)}}};#A=t=>{t.stopPropagation();this.expanded=false;if(r().includes(this.el)){this.el.focus()}if(this.suggest){if(this.suggestOptions.strict){clearTimeout(this.#a);this.value=this.#i;this.input.emit(this.value)}this.#I()}else{this.#z()}};#I=()=>this.change.emit(this.value);#E=t=>{t.stopPropagation();this.expanded=true;clearTimeout(this.#a);if(this.suggestDebounce>0){this.#a=setTimeout((()=>{this.value=this.#b.value;this.input.emit(this.value)}),this.suggestDebounce)}else{this.value=this.#b.value;this.input.emit(this.value)}};#F=t=>{const e=t.detail===0;if(e||this.expanded&&$(t)){return}t.stopPropagation();this.expanded=!this.expanded};#M=t=>{const e=A(t,this.model);if(!e){return}const i=e;if(i.items!=null){if(!i.expandable){return}i.expanded=!i.expanded}else{this.activeDescendant=e;this.expanded=false;this.#z()}o(this)};#T=t=>{const e=A(t,this.model);if(e&&e.items==null){this.activeDescendant=e;o(this)}};#d=()=>this.suggestOptions.alreadyProcessed===true;#D=()=>!this.suggest||!this.expanded||this.suggestOptions.renderActiveItemIconOnExpand;#_=t=>{if(!this.expanded){this.#i=t}this.#f();this.internals.setFormValue(t)};#f=()=>{if(!this.activeDescendant||!this.expanded){this.activeDescendant=this.#C()?.item}const t=this.suggest&&!this.#d();if(!t&&!M(this.activeDescendant,this.model)){this.activeDescendant=undefined}};#V=()=>t("select",{"aria-label":this.#t??this.accessibleName,disabled:this.disabled,onChange:!this.disabled&&this.#L,ref:t=>this.#g=t},!this.activeDescendant&&t("option",{disabled:true,selected:true,value:""},this.placeholder),this.model.map((t=>z(t,this.value))));connectedCallback(){this.#v(this.model);L(this.model,this.#s,this.#o);this.#_(this.value);const t=this.internals.labels;this.#t=m(t);b(this.el,"ch-combo-box-render",t,this.#t,this.accessibleName)}componentWillRender(){if(this.#r){this.#w();this.#r=false}}componentDidRender(){if(this.expanded){const t=this.el.shadowRoot.querySelector(W);if(t){requestAnimationFrame((()=>{t.focus();this.#b.focus()}))}}}render(){const e=this.suggest;const i=!this.disabled&&!e;const s=!this.readonly&&!this.disabled;const o=e?this.#C()?.item:this.activeDescendant;const r=o?.startImgSrc&&this.#D()?j(o,"start",this.#k()):undefined;const a=r?`img--start start-img-type--${o.startImgType??"background"} ${r.classes}`:undefined;const l=this.#C()?.item.value;const d=e?this.value:this.activeDescendant?.caption;return t(n,{key:"e4f66c0649cb22ceb7279ab6f5cbcbe780760e4f",class:{"ch-disabled":this.disabled,"ch-combo-box--normal":!e,"ch-combo-box--suggest":e},part:c({[l]:!!l,[h.PLACEHOLDER]:!d,[this.hostParts]:!!this.hostParts}),onKeyDown:!H&&s&&this.#$,onClickCapture:s&&(!e||!this.expanded)&&this.#F},H?this.#V():[t("span",{class:"invisible-text"},this.#e||this.placeholder),t("div",{key:"combobox",role:"combobox","aria-label":this.#t??this.accessibleName,tabindex:i?"0":null,class:{"input-container":true,disabled:this.disabled||o?.disabled,[a]:!!a},style:r?.styles},t("input",{"aria-controls":"popover","aria-disabled":i?"false":null,"aria-expanded":this.expanded.toString(),"aria-haspopup":"true",autocomplete:"off",class:{value:true,"value--readonly":!e},disabled:this.disabled||!e,placeholder:this.placeholder,readOnly:this.readonly||!e,value:d,onInputCapture:e&&s&&this.#E,ref:t=>this.#b=t})),this.expanded&&s&&t("ch-popover",{key:"popover",id:"popover",role:"listbox","aria-hidden":"false",part:"window",actionById:true,actionElement:this.el,blockAlign:"outside-end",inlineAlign:this.popoverInlineAlign,closeOnClickOutside:true,show:true,popover:"manual",resizable:this.resizable,inlineSizeMatch:"action-element-as-minimum",overflowBehavior:"add-scroll",positionTry:"flip-block",onClick:this.#M,onMouseOver:this.#T,onPopoverClosed:this.#A},this.model.map(C(false,this.disabled,e&&!this.#d(),this.activeDescendant,this.#h,this.#n,"")))])}static get delegatesFocus(){return true}static get formAssociated(){return true}static get watchers(){return{expanded:["handleExpandedChange"],model:["modelChanged"],suggest:["suggestChanged"],suggestDebounce:["suggestDebounceChanged"],suggestOptions:["suggestOptionsChanged"],value:["valueChanged"]}}};U.style=R;export{U as ch_combo_box_render};
//# sourceMappingURL=p-d4360078.entry.js.map