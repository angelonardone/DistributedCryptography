import{r as t,c as e,g as s,f as i,h as n,H as o}from"./p-7af91c05.js";import{e as r,R as a,t as h,a as c}from"./p-6d91f415.js";import{i as l,D as d,e as u}from"./p-def48074.js";import{T as f,F as p,L as g,g as m}from"./p-625020d1.js";import{r as b}from"./p-23a9d308.js";const w="--ch-flexible-layout-drop-area-block-start";const x="--ch-flexible-layout-drop-area-block-end";const y="--ch-flexible-layout-drop-area-inline-start";const I="--ch-flexible-layout-drop-area-inline-end";const v=30;const C=100-v;const S=.5;const W=(t,e,s)=>t.style.setProperty(e,`${s}px`);const k=(t,e)=>e?t.left+t.width*S:t.left;const V=(t,e,s)=>s?t.width-e.right:t.width-(e.left+e.width*S);const L={"block-start":(t,e)=>[e.top,t.height-(e.top+e.height*S),e.left,t.width-e.right],"block-end":(t,e)=>[e.top+e.height*S,t.height-(e.top+e.height),e.left,t.width-e.right],"inline-start":(t,e,s)=>[e.top,t.height-(e.top+e.height),k(e,s),V(t,e,s)],"inline-end":(t,e,s)=>[e.top,t.height-(e.top+e.height),k(e,!s),V(t,e,!s)],center:(t,e)=>[e.top,t.height-(e.top+e.height),e.left,t.width-e.right]};let R;let P;const D=(t,e,s)=>i=>{i.stopPropagation();const n=document.documentElement.getBoundingClientRect();const o=t.mainView.getBoundingClientRect();const a=i.clientX;const h=i.clientY;const c=s?o.width-(a-o.left):a-o.left;const l=h-o.top;const d=c/o.width*100;const u=l/o.height*100;let f;if(u<=v&&r(u,d,100-u)){f="block-start"}else if(d>=C&&r(100-d,u,d)){f="inline-end"}else if(d<=v&&r(d,u,100-d)){f="inline-start"}else if(u>=C&&r(100-u,d,u)){f="block-end"}else{f="center"}if(P===t.viewId&&R===f){return}R=f;P=t.viewId;const p=L[f](n,o,s);W(e,w,p[0]);W(e,x,p[1]);W(e,y,p[2]);W(e,I,p[3])};const T=t=>{R=undefined;P=undefined;t.removeAttribute("style")};const j=()=>R===undefined?undefined:{dropAreaTarget:R,viewIdTarget:P};const B=(t,e,s)=>{const i=t.id;const n=t.type;if(n==="single-content"){const o=t.widget;e.add(o.id);s.set(i,{parentLeafId:i,info:o});return{id:i,type:n,widget:o}}let o=t.selectedWidgetId;const r=t.widgets;r.forEach((t=>{if(t.wasRendered||o===t.id){t.wasRendered=true;e.add(t.id)}s.set(t.id,{parentLeafId:i,info:t})}));if(o==null&&r.length>0){const s=r[l(t.tabListPosition??d)?r.length-1:0];o=s.id;s.wasRendered=true;e.add(o)}return{id:i,closeButton:t.closeButton,disabled:t.disabled,dragOutside:t.dragOutside,selectedWidgetId:o,showCaptions:t.showCaptions??true,sortable:t.sortable,tabListPosition:t.tabListPosition,tabButtonHidden:t.tabButtonHidden??false,type:n,widgets:r}};const O=(t,e)=>{if(t.dragBar?.part){e.add(t.dragBar?.part)}};const $=(t,e,s,i,n)=>{const o={item:t,parentItem:e,leafInfo:B(t,i,n)};s.set(t.id,o)};const E=(t,e,s,i,n,o)=>{t.forEach((t=>{if(t.items!=null){const r=t;const a={item:r,parentItem:o};e.set(r.id,a);s.add(r.id);E(r.items,e,s,i,n,r)}else{$(t,o,e,i,n)}O(t,s)}))};const A=(t,e,s,i,n)=>E(t.items,e,s,i,n,a);const M=(t,e)=>t.get(e).leafInfo;const _=":host{display:contents}.droppable-area{width:auto;height:auto;padding:0;margin:0;border:unset;color:unset;inset-block:var(--ch-flexible-layout-drop-area-block-start) var(--ch-flexible-layout-drop-area-block-end);left:var(--ch-flexible-layout-drop-area-inline-start);right:var(--ch-flexible-layout-drop-area-inline-end);background-color:color-mix(in srgb, currentColor 15%, transparent);-webkit-transition:inset 150ms ease-in-out;transition:inset 150ms ease-in-out;pointer-events:none}";const H=_;const z=t=>`[id="${t}"]`;const F="Escape";const K=class{constructor(s){t(this,s);this.viewItemClose=e(this,"viewItemClose",7);this.selectedViewItemChange=e(this,"selectedViewItemChange",7);this.viewItemReorder=e(this,"viewItemReorder",7);this.dragBarDisabled=false;this.closeButton=false;this.contain="none";this.dragOutside=false;this.itemsInfo=undefined;this.layoutSplitterParts=undefined;this.model=undefined;this.overflow="visible";this.sortable=false}#t;#e;#s=[];#i;#n;#o;#r;#a;#h;get el(){return s(this)}viewItemClose;selectedViewItemChange;viewItemReorder;async addSiblingView(t,e,s,n,o){const r=await this.#h.addSiblingLeaf(t,e,s,n,o);if(r.success){i(this)}return r.success}async refreshLeaf(t){const e=this.el.shadowRoot.querySelector(z(t));if(!e){return}i(e)}async removeView(t){const e=await this.#h.removeItem(t);if(e.success){i(this)}return{success:e.success,reconnectedSubtree:e.reconnectedSubtree}}async removeItemPageInView(t,e,s=true){const i=this.#c(t);if(!i){return}const n=this.el.shadowRoot.querySelector(z(i.id));await n.removePage(e,s)}handleItemClose(t){const e=t.composedPath()[0];if(e.tagName.toLowerCase()!=="ch-tab-render"||e.getRootNode()!==this.el.shadowRoot){return}t.stopPropagation();const s={...t.detail,viewId:e.id};const i=this.viewItemClose.emit(s);if(i.defaultPrevented){t.preventDefault()}}#c=t=>M(this.itemsInfo,t);#l=()=>{const t=[];this.itemsInfo.forEach((e=>{const s=e.leafInfo;if(s!=null){t.push(s)}}));return t};#d=t=>e=>{if(e.target.getRootNode()!==this.el.shadowRoot){return}e.stopPropagation();const s={...e.detail,viewId:t};this.selectedViewItemChange.emit(s)};#u=t=>async e=>{e.stopPropagation();this.#r=e.target;const s=[...this.el.shadowRoot.querySelectorAll("ch-tab-render")];this.#n={index:e.detail,viewId:t};const i=await Promise.allSettled(s.map((t=>t.getDraggableViews())));this.#i=[];i.forEach(((t,e)=>{if(t.status==="fulfilled"){const i=t.value;const n=new AbortController;const o={...i,viewId:s[e].id,abortController:n};this.#i.push(o);const r=c();i.mainView.addEventListener("mousemove",D(o,this.#a,r),{capture:true,passive:true,signal:n.signal});o.tabListView.style.pointerEvents="none";o.pageView.style.pointerEvents="none"}}));document.addEventListener("mouseup",this.#f,{passive:true});document.addEventListener("keydown",this.#p,{passive:true});this.#o=new AbortController;document.addEventListener("mousemove",(()=>T(this.#a)),{passive:true,signal:this.#o.signal});this.#a.showPopover();this.#r.promoteDragPreviewToTopLayer();this.dragBarDisabled=true};#p=t=>{if(t.code!==F){return}t.preventDefault();T(this.#a);this.#f();this.#r.endDragPreview()};#f=()=>{this.#i.forEach((t=>{t.abortController.abort();t.tabListView.style.pointerEvents=null;t.pageView.style.pointerEvents=null}));document.removeEventListener("mouseup",this.#f);document.removeEventListener("keydown",this.#p);this.#o.abort();const t=j();if(t){this.viewItemReorder.emit({...this.#n,...t})}this.#a.hidePopover();T(this.#a);this.#i=undefined;this.#n=undefined;this.dragBarDisabled=false};#g=()=>{const t=new Set([...Object.values(f)]);t.add(p.DROPPABLE_AREA);t.add(p.LEAF);t.add(g.BAR);this.layoutSplitterParts.forEach((e=>t.add(e)));this.#s.forEach((e=>{if(e.type==="tabbed"){t.add(e.id);t.add(e.tabListPosition??d);e.widgets.forEach((({id:e})=>t.add(e)))}}));this.#t=[...t.keys()].join(",");this.#e=[...this.layoutSplitterParts.keys(),g.BAR].join(",")};#m=t=>{const e=t.dragOutside??this.dragOutside;const s=t.sortable??this.sortable;const i=t.tabListPosition??d;const o=l(i);const r=u(i);return n("ch-tab-render",{id:t.id,key:t.id,slot:t.id,contain:this.contain,part:h({[t.id]:true,[p.LEAF]:true,[i]:true,[f.BLOCK]:o,[f.INLINE]:!o,[f.START]:r,[f.END]:!r}),exportparts:`${m},${i},${t.widgets.map((({id:t})=>t)).join(",")}`,closeButton:t.closeButton??this.closeButton,disabled:t.disabled,dragOutside:e,model:t.widgets,overflow:this.overflow,selectedId:t.selectedWidgetId,showCaptions:t.showCaptions,sortable:s,tabButtonHidden:t.tabButtonHidden,tabListPosition:i,onItemDragStart:e&&s?this.#u(t.id):undefined,onSelectedItemChange:this.#d(t.id)},t.widgets.map((t=>t.wasRendered&&n("slot",{name:t.id,slot:t.id}))))};#b=t=>t.type==="single-content"?n("slot",{key:t.id,slot:t.id,name:t.id}):this.#m(t);componentWillRender(){this.#s=this.#l();this.#g()}render(){const t=this.model;if(t==null){return""}return n(o,{exportparts:this.#t},n("ch-layout-splitter",{dragBarDisabled:this.dragBarDisabled,model:t,exportparts:this.#e,ref:t=>this.#h=t},this.#s.map(this.#b)),n("div",{"aria-hidden":"true",class:"droppable-area",part:p.DROPPABLE_AREA,popover:"manual",ref:t=>this.#a=t}))}};K.style=H;const Z=":host,.ch-flexible-layout-render-slot{display:contents}";const q=Z;const G=()=>{let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{let s=Math.random()*16;s=(t+s)%16|0;t=Math.floor(t/16);return(e==="x"?s:s&3|8).toString(16)}))};const J=class{constructor(s){t(this,s);this.widgetClose=e(this,"widgetClose",7);this.renderedWidgetsChange=e(this,"renderedWidgetsChange",7);this.closeButton=false;this.contain="none";this.dragOutside=false;this.model=undefined;this.overflow="visible";this.renders=undefined;this.sortable=false;this.slottedWidgets=false;this.theme=undefined}#w=new Set;#x=new Set;#y=new Map;#I=new Map;#v=new Set;#C;modelChanged(t){this.#S(t)}widgetClose;renderedWidgetsChange;async addSiblingView(t,e,s,n,o){const r=await this.#C.addSiblingView(t,e,s,n,o);if(!r){return false}$(n,this.#I.get(t).item,this.#I,this.#w,this.#y);i(this);return true}async addWidget(t,e,s=true){const n=this.#I.get(t);if(!n||n.leafInfo==null||n.leafInfo.type==="single-content"||this.#y.has(e.id)){return}n.leafInfo.widgets.push(e);this.#y.set(e.id,{parentLeafId:t,info:e});if(s){this.#W(n.leafInfo,e);i(this);i(this.#C)}else{this.#C.refreshLeaf(t)}}async removeView(t,e){const s=this.#I.get(t);if(!s){return{success:false,reconnectedSubtree:undefined}}const n=s.leafInfo;if(n==null||n.type==="single-content"){return{success:false,reconnectedSubtree:undefined}}const o=await this.#C.removeView(t);if(!o.success){return o}const r=o.reconnectedSubtree;if(r){const t=this.#I.get(r.nodeToRemove);if(t.leafInfo==null){const e=t.item.items;const s=this.#I.get(r.nodeToReconnect);e.forEach((t=>{this.#I.get(t.id).parentItem=s.item}))}else{const e=this.#I.get(r.nodeToReconnect);e.leafInfo=t.leafInfo;const s=e.leafInfo;s.id=r.nodeToReconnect;const i=s.type==="single-content"?[s.widget]:s.widgets;i.forEach((t=>{const e=this.#y.get(t.id);e.parentLeafId=s.id}))}this.#I.delete(r.nodeToRemove)}if(e){n.widgets.forEach(this.#k)}this.#I.delete(t);i(this);return o}async removeWidget(t){const e=this.#y.get(t);if(!e){return}const s=this.#c(e.parentLeafId);if(s.type==="single-content"){return}this.#V(s,e.info,s.widgets.findIndex((e=>e.id===t)))}async updateSelectedWidget(t,e){const s=this.#y.get(e);if(!s||s.parentLeafId!==t){return}const n=this.#c(s.parentLeafId);if(n.type==="single-content"||n.selectedWidgetId===e){return}this.#W(n,s.info);i(this);i(this.#C)}async updateViewInfo(t,e){const s=this.#I.get(t);if(!s||!s.leafInfo||s.item.type!==e.type){return}for(const t in e){s.item[t]=e[t];s.leafInfo[t]=e[t]}i(this);this.#C.refreshLeaf(s.item.id)}async updateWidgetInfo(t,e){const s=this.#y.get(t);if(!s){return}const n=s.info;Object.entries(e).forEach((([t,e])=>{n[t]=e}));i(this);this.#C.refreshLeaf(s.parentLeafId)}#S=t=>{this.#I.clear();this.#y.clear();if(t==null){this.#w.clear();return}this.#v.clear();const e=new Set;A(t,this.#I,this.#v,e,this.#y);this.#y.forEach((t=>{if(this.#w.has(t.info.id)){e.add(t.info.id)}}));this.#w=e};#c=t=>M(this.#I,t);#L=t=>{t.stopPropagation();const e=t.detail;const s=this.#c(e.viewId);const n=s.widgets[e.newSelectedIndex];this.#W(s,n);i(this);i(this.#C)};#R=t=>{t.stopPropagation();const e=t.detail;const s=this.widgetClose.emit({widgetId:e.itemId,viewId:e.viewId});if(s.defaultPrevented){t.preventDefault();return}const i=this.#c(e.viewId);const n=e.itemIndex;const o=i.widgets[n];this.#V(i,o,n)};#V=(t,e,s)=>{if(t.widgets.length===1){this.removeView(t.id,true);return}const n=t.widgets;const o=t.widgets.length;if(e.id===t.selectedWidgetId){const e=s===o-1?n[o-2]:n[s+1];this.#W(t,e)}this.#P(t,s);i(this);i(this.#C)};#P=(t,e,s=false)=>{const i=b(t.widgets,e);this.#C.removeItemPageInView(t.id,i.id);if(!s){this.#k(i)}};#k=t=>{if(t.conserveRenderState===true){return}this.#w.delete(t.id);this.#y.delete(t.id)};#W=(t,e)=>{this.#w.add(e.id);e.wasRendered=true;const s=this.#I.get(t.id).item;s.selectedWidgetId=e.id;t.selectedWidgetId=e.id};#D=async t=>{const e=t.detail;const s=e.viewId;const n=e.viewIdTarget;const o=e.dropAreaTarget;const r=this.#c(s);if(s===n&&(o==="center"||r.widgets.length===1)){return}const a=this.#c(n);const h=e.index;const c=r.widgets[h];this.#y.get(c.id).parentLeafId=n;this.#w.add(c.id);c.wasRendered=true;if(o==="center"){a.widgets.push(c);this.#W(a,c)}else{await this.#T(c,a,o)}if(r.widgets.length===1){await this.removeView(s,false)}else{if(r.selectedWidgetId===c.id){const t=h===0?1:h-1;const e=r.widgets[t];this.#W(r,e)}this.#P(r,h,true);i(this)}};#T=async(t,e,s)=>{const i=this.#I.get(e.id);const n=i.parentItem;const o=G();const r={id:o,selectedWidgetId:t.id,size:undefined,tabListPosition:i.leafInfo.tabListPosition,type:"tabbed",widgets:[t],dragBar:{size:i.item.dragBar?.size,part:i.item.dragBar?.part}};const a=n.direction==="rows"&&(s==="block-start"||s==="block-end")||n.direction==="columns"&&(s==="inline-start"||s==="inline-end");if(a){await this.addSiblingView(n.id,e.id,s==="block-start"||s==="inline-start"?"before":"after",r,true)}};#j=t=>{const e=this.#y.get(t).info;if(this.#B(e)){return n("slot",{key:t,name:t,slot:t})}const s=e.renderId??t;const i=this.renders[s];if(!i){console.error(`Could not find a render for the "${t}" widget. The render "${s}" does not exists in the "renders" property.`);return}return e.addWrapper?n("div",{key:t,slot:t,class:"ch-flexible-layout-render-slot"},i(e)):i(e)};#B=t=>t.slot??this.slottedWidgets;#O=()=>{if(this.#x.size===this.#w.size&&this.#x.size===0){return}let t=this.#x.size!==this.#w.size;const e=[];const s=[];this.#w.forEach((i=>{const n=this.#y.get(i).info;if(this.#B(n)){s.push(i)}else{e.push(i)}t||=!this.#x.has(i)}));if(t){this.renderedWidgetsChange.emit({rendered:e,slotted:s})}this.#x=new Set(this.#w)};componentWillLoad(){this.#S(this.model)}componentDidRender(){this.#O()}render(){if(this.model==null){return""}return n(o,null,this.theme&&n("ch-theme",{model:this.theme}),n("ch-flexible-layout",{closeButton:this.closeButton,contain:this.contain,dragOutside:this.dragOutside,model:this.model,layoutSplitterParts:this.#v,itemsInfo:this.#I,overflow:this.overflow,sortable:this.sortable,onViewItemClose:this.#R,onViewItemReorder:this.#D,onSelectedViewItemChange:this.#L,ref:t=>this.#C=t},[...this.#w.values()].map(this.#j)))}static get watchers(){return{model:["modelChanged"]}}};J.style=q;export{K as ch_flexible_layout,J as ch_flexible_layout_render};
//# sourceMappingURL=p-049f6dab.entry.js.map