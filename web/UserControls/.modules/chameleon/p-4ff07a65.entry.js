import{h as t,r as e,c as i,g as s,f as o,H as n}from"./p-7af91c05.js";import{g as r,a}from"./p-d881edd1.js";import{g as h}from"./p-ebac9feb.js";import{C as c,d as l}from"./p-9db16727.js";import{u as d,t as u,i as m}from"./p-2cf94d81.js";import{f as b}from"./p-5f934da7.js";import"./p-bb7b9247.js";const p=(t,e,i)=>i?t.includes(e):t.toLowerCase().includes(e.toLowerCase());const g=(t,e,i)=>i?.regularExpression?t.match(e)!==null:p(t,e,i?.matchCase);const f=(t,e)=>!e.filter||g(t.caption??t.value,e.filter,e.options);const x=(t,e)=>e.options?.hideMatchesAndShowNonMatches===true?!f(t,e):f(t,e);const v=(t,e,i)=>{let s=false;const o=t.items;if(o!=null){for(let t=0;t<o.length;t++){const n=o[t];const r=v(n,e,i);s||=r}}const n=s||x(t,e);if(n){i.add(t)}return n};const _=(t,e,i)=>{const s=i(t,e);return s?d(s,e):undefined};const k=(t,e,i)=>{for(let s=0;s<t.length;s++){const o=t[s];let n;if(o.startImgSrc){const t=_(o,"start",e);n={start:t}}if(o.endImgSrc){const t=_(o,"end",e);if(n){n.end=t}else{n={end:t}}}if(n){i.set(o.value,n)}if(o.items!=null){k(o.items,e,i)}}};const y=(t,e)=>{if(!t){return undefined}const i=new Map;k(t,e,i);return i};const w={type:"not-exists"};const C=(t,e)=>0<=e&&e<t.length;const z=(t,e)=>{if(!e){return w}return t.get(e.value)?.index??w};const I=(t,e,i,s,o)=>{if(e.type==="not-exists"){return w}const n=e.firstLevelIndex;if(e.type==="nested"){let r=e.secondLevelIndex+i;const a=t[n].items;while(C(a,r)&&(a[r].disabled||s&&!o.has(a[r]))){r+=i}if(C(a,r)){return{type:"nested",firstLevelIndex:n,secondLevelIndex:r}}}let r=n+i;while(C(t,r)&&(t[r].disabled||s&&!o.has(t[r]))){r+=i}if(!C(t,r)){return w}const a=t[r].items;if(a!=null){return I(t,{type:"nested",firstLevelIndex:r,secondLevelIndex:i===1?-1:a.length},i,s,o)}return{type:"first-level",firstLevelIndex:r}};const L="__";const $=(t,e,i)=>i?`${t}${L}${e}`:`${e}`;const E=(t,e)=>{const i=t.split(L);const s=e[Number(i[0])];if(i.length===2&&s.items!=null){return s.items[Number(i[1])]}return s};const A=t=>{if(!t){return undefined}if(t.start&&t.end){return{...t.start.styles,...t.end.styles}}return t.start?.styles??t.end.styles};const F=(e,i,s,o,n,r,a)=>(h,l)=>{if(s&&!n.has(h)){return}const d=!!h.startImgSrc||!!h.endImgSrc?r.get(h.value):undefined;const m=!!d?.start;const b=!!d?.end;const p=m?`img--start start-img-type--${h.startImgType??"background"} ${d.start.classes}`:undefined;const g=b?`img--end end-img-type--${h.endImgType??"background"} ${d.end.classes}`:undefined;const f=i||h.disabled;const x=h;const v=h.value===o?.value;const _=$(a,l,e);return x.items!=null?t("div",{key:`__group__${h.value}`,"aria-controls":x.expandable?`${l}__content`:null,"aria-expanded":x.expandable?(!!x.expanded).toString():null,"aria-labelledby":l.toString(),role:"group",class:"group",part:u({[h.value]:true,[c.GROUP]:true,[c.DISABLED]:f})},x.expandable?t("button",{id:_,class:{group__header:true,"group--expandable":true,"group--collapsed":!x.expanded,disabled:f},part:u({[h.value]:true,[c.GROUP_HEADER]:true,[c.EXPANDABLE]:true,[c.DISABLED]:f,[c.EXPANDED]:x.expanded,[c.COLLAPSED]:!x.expanded}),style:A(d),disabled:f,type:"button"},t("span",{class:{"group__header-caption":true,[p]:m,[g]:b},part:`${c.GROUP_HEADER_CAPTION} ${h.value}`},h.caption??h.value)):t("span",{id:l.toString(),class:{group__header:true,disabled:f,[p]:m,[g]:b},part:u({[h.value]:true,[c.GROUP_HEADER]:true,[c.DISABLED]:f}),style:A(d)},h.caption??h.value),t("div",{key:`__content__${h.value}`,id:x.expandable?`${l}__content`:null,class:{group__content:true,"group__content--collapsed":x.expandable&&!x.expanded},part:`${c.GROUP_CONTENT} ${h.value}`},(!x.expandable||x.expanded)&&x.items.map(F(true,f,s,o,n,r,_)))):t("button",{key:h.value,id:_,role:"option","aria-selected":v,tabindex:"-1",class:{leaf:true,disabled:f,selected:v,[p]:m,[g]:b},part:u({[h.value]:true,[c.ITEM]:true,[c.NESTED]:e,[c.DISABLED]:f,[c.SELECTED]:v}),style:A(d),disabled:f,type:"button"},h.caption??h.value)};const M=(e,i)=>e.items!=null?t("optgroup",{label:e.caption??e.value},e.items.map((t=>M(t,i)))):t("option",{key:e.value,value:e.value,disabled:e.disabled,selected:e.value===i},e.caption??e.value);const T=t=>{let e="";let i=0;t.forEach((t=>{const s=t.items;if(t.caption.length>i){e=t.caption;i=t.caption.length}if(s!=null){s.forEach((t=>{if(t.caption.length>i){e=t.caption;i=t.caption.length}}))}}));return e};const D=(t,e,i)=>{e.clear();i.clear();if(t==null){return}t.forEach(((t,s)=>{const o={item:t,index:{type:"first-level",firstLevelIndex:s}};e.set(t.value,o);if(t.caption){i.set(t.caption,o)}t.items?.forEach(((t,o)=>{const n={item:t,index:{type:"nested",firstLevelIndex:s,secondLevelIndex:o}};e.set(t.value,n);if(t.caption){i.set(t.caption,n)}}))}))};const N=t=>{const e=t.composedPath();for(let t=0;t<e.length;t++){const i=e[t];const s=i.tagName?.toLowerCase();if(s==="ch-popover"){return true}if(s==="ch-combo-box-render"){return false}}return false};const O=(t,e)=>{t.stopPropagation();let i=t.target;if(i.tagName?.toLowerCase()==="span"){i=i.parentElement}if(i.tagName?.toLowerCase()!=="button"){return undefined}const s=i.id;return E(s,e)};const V=(t,e)=>t&&(t.value===e.value||t.caption&&t.caption===e.caption);const j=(t,e)=>{for(let i=0;i<e.length;i++){const s=e[i];if(V(s,t)){return true}}return false};const B=(t,e)=>{if(!t||!e){return false}for(let i=0;i<e.length;i++){const s=e[i];if(V(s,t)){return true}if(s.items!=null&&j(t,s.items)){return true}}return false};const P='input,select,textarea{padding:0;margin:0;background-color:unset;border:unset;color:unset;font:unset;outline:unset}:where(button,a){all:unset;display:inline-flex;align-items:center;user-select:none;touch-action:manipulation;cursor:pointer}button:disabled{pointer-events:none}*,::after,::before{box-sizing:border-box}:host{--ch-combo-box-group__expandable-button-size:0.875em;--ch-combo-box-group__expandable-button-image-size:0.875em;--ch-combo-box-item__image-size:0.875em;--ch-combo-box-item__background-image-size:100%;--ch-combo-box__picker:url(\'data:image/svg+xml,<svg width="8" height="12" viewBox="0 0 8 12" xmlns="http://www.w3.org/2000/svg"><path d="M4.16669 0.666626L7.66669 4.66663H0.666687L4.16669 0.666626ZM4.16669 11.3333L0.666687 7.33329H7.66669L4.16669 11.3333Z"/></svg>\');--ch-combo-box__picker-collapsed:var(\n    --ch-combo-box__picker\n  );--ch-combo-box__picker-expanded:var(\n    --ch-combo-box__picker\n  );--ch-combo-box__picker-color:currentColor;--ch-combo-box__picker-size:0.875em;--ch-combo-box__picker-image-size:100%;--ch-combo-box__placeholder-color:currentColor;--ch-combo-box-item-gap:0px;--ch-combo-box-separation:0px;--ch-combo-box-separation-x:var(--ch-combo-box-separation);--ch-combo-box-separation-y:var(--ch-combo-box-separation);display:inline-grid;grid-template-columns:1fr max-content;grid-template-rows:max-content 1fr;align-items:center}:host::after{grid-row:1/3;grid-column:2;inline-size:var(--ch-combo-box__picker-size);block-size:var(--ch-combo-box__picker-size);-webkit-mask:var(--ch-combo-box__picker-collapsed) 50% 50%/var(--ch-combo-box__picker-image-size) var(--ch-combo-box__picker-image-size) no-repeat;margin-inline-start:var(--ch-combo-box-item-gap);background-color:var(--ch-combo-box__picker-color);pointer-events:none}:host(.ch-combo-box--expanded)::after{-webkit-mask-image:var(--ch-combo-box__picker-expanded)}:host(.ch-combo-box--normal){cursor:pointer;user-select:none}:host(.ch-combo-box--normal)::after{content:""}:host(.ch-combo-box--suggest){--ch-combo-box__picker-size:0px;cursor:text}:host(.ch-disabled){pointer-events:none}.input-container{grid-row:2/3;outline:unset}.invisible-text{visibility:hidden;pointer-events:none;block-size:0;overflow:hidden}select{all:unset;display:grid;overflow:hidden;grid-row:2/3}.value{display:inline-grid;align-items:center;inline-size:100%}.value--readonly{pointer-events:none;text-overflow:ellipsis}.value::placeholder{color:var(--ch-combo-box__placeholder-color)}ch-popover{--ch-popover-separation-x:var(--ch-combo-box-separation-x);--ch-popover-separation-y:var(--ch-combo-box-separation-y);cursor:auto}ch-popover:not(.hydrated){opacity:0}.leaf,.group__header,.group__header-caption,.input-container{display:flex;gap:var(--ch-combo-box-item-gap);align-items:center;flex:1}.group{display:grid;grid-template-rows:max-content 1fr}.group--expandable::before{content:"";inline-size:var(--ch-combo-box-group__expandable-button-size);block-size:var(--ch-combo-box-group__expandable-button-size);background-color:currentColor;-webkit-mask:url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" fill="none"><path d="M16.5 5L8.7 12.7L1 5" stroke="%23000" stroke-width="1.2" stroke-linecap="round"/></svg>\') 50% 50%/var(--ch-combo-box-group__expandable-button-image-size) var(--ch-combo-box-group__expandable-button-image-size) no-repeat}.group--collapsed::before{transform:rotate(-90deg)}.ch-popover-rtl .group--collapsed::before{transform:rotate(90deg)}.group__content{display:grid;grid-auto-rows:max-content}.group__content--collapsed{display:none}.img--start::before,.img--end::after{content:"";display:block;inline-size:var(--ch-combo-box-item__image-size);block-size:var(--ch-combo-box-item__image-size);min-inline-size:var(--ch-combo-box-item__image-size);pointer-events:none}.img--start{--ch-combo-box-item-start-img:var(--ch-start-img--base)}.img--start.selected.start-img--selected{--ch-combo-box-item-start-img:var(--ch-start-img--selected)}.group__header:hover>.img--start.start-img--hover{--ch-combo-box-item-start-img:var(--ch-start-img--hover)}.group__header:active>.img--start.start-img--active{--ch-combo-box-item-start-img:var(--ch-start-img--active)}:host(:focus) .img--start.input-container.start-img--focus{--ch-combo-box-item-start-img:var(--ch-start-img--focus)}:host(:not(.ch-disabled):hover) .img--start.input-container.start-img--hover{--ch-combo-box-item-start-img:var(--ch-start-img--hover)}.img--start.disabled.start-img--disabled,.disabled>.img--start.start-img--disabled,:host(.ch-disabled) .img--start.start-img--disabled{--ch-combo-box-item-start-img:var(--ch-start-img--disabled)}.img--end{--ch-combo-box-item-end-img:var(--ch-end-img--base)}.img--end::after{margin-inline-start:auto}.img--end.selected.end-img--selected{--ch-combo-box-item-end-img:var(--ch-end-img--selected)}.group__header:hover>.img--end.end-img--hover{--ch-combo-box-item-end-img:var(--ch-end-img--hover)}.group__header:active>.img--end.end-img--active{--ch-combo-box-item-end-img:var(--ch-end-img--active)}.img--end.disabled.end-img--disabled,.disabled>.img--end.end-img--disabled{--ch-combo-box-item-end-img:var(--ch-end-img--disabled)}.start-img-type--background::before{background:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-start-img)}.end-img-type--background::after{background:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-end-img)}.start-img-type--mask::before{-webkit-mask:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-start-img);background-color:currentColor}.end-img-type--mask::after{-webkit-mask:no-repeat center/var(--ch-combo-box-item__background-image-size) var(--ch-combo-box-item-end-img);background-color:currentColor}';const R=P;const W=`button[part*='${c.SELECTED}']`;const H=m();const S=(t,e)=>({base:e==="start"?t.startImgSrc:t.endImgSrc});const U=class{constructor(t){e(this,t);this.input=i(this,"input",7);this.change=i(this,"change",7);if(t.$hostElement$["s-ei"]){this.internals=t.$hostElement$["s-ei"]}else{this.internals=t.$hostElement$.attachInternals();t.$hostElement$["s-ei"]=this.internals}this.activeDescendant=undefined;this.expanded=false;this.accessibleName=undefined;this.disabled=false;this.getImagePathCallback=undefined;this.hostParts=undefined;this.model=[];this.multiple=false;this.name=undefined;this.placeholder=undefined;this.popoverInlineAlign="inside-start";this.readonly=false;this.resizable=false;this.suggest=false;this.suggestDebounce=250;this.suggestOptions={};this.value=undefined}#t;#e;#i;#s=new Map;#o=new Map;#n;#r=false;#a=false;#h;#c;#l=(t,e,i,s,o)=>{t.preventDefault();const n=e.type==="not-exists"?I(this.model,{type:"first-level",firstLevelIndex:i===1?-1:this.model.length},i,s,o):I(this.model,e,i,s,o);if(n.type==="not-exists"){return}const r=n.type==="first-level"?this.model[n.firstLevelIndex]:this.model[n.firstLevelIndex].items[n.secondLevelIndex];if(this.activeDescendant!==r){this.activeDescendant=r}};#d={ArrowUp:t=>this.#l(t,z(this.#s,this.activeDescendant),-1,this.suggest&&!this.#u(),this.#c),ArrowDown:t=>this.#l(t,z(this.#s,this.activeDescendant),1,this.suggest&&!this.#u(),this.#c),Home:t=>this.#l(t,{type:"first-level",firstLevelIndex:-1},1,this.suggest&&!this.#u(),this.#c),End:t=>this.#l(t,{type:"first-level",firstLevelIndex:this.model.length},-1,this.suggest&&!this.#u(),this.#c),Enter:()=>{if(this.expanded){this.#r=true}this.expanded=!this.expanded},NumpadEnter:()=>{if(this.expanded){this.#r=true}this.expanded=!this.expanded},Space:t=>{t.preventDefault();this.expanded||=true},Tab:t=>{if(this.expanded){t.preventDefault();this.#r=true;this.expanded=false}}};#m={ArrowUp:t=>{if(this.expanded){this.#d.ArrowUp(t)}else{this.expanded=true}},ArrowDown:t=>{if(this.expanded){this.#d.ArrowDown(t)}else{this.expanded=true}},Enter:t=>this.#b(t),NumpadEnter:t=>this.#b(t),Tab:t=>this.#b(t)};#p;#g;handleExpandedChange(t){if(t&&!H){this.#f();this.#x();if(this.suggest){this.#v()}}else{this.#n=undefined}}internals;get el(){return s(this)}modelChanged(t){this.#_(this.model);D(t,this.#s,this.#o);if(this.expanded){this.#f()}this.#k(this.value)}suggestChanged(){this.#v()}suggestDebounceChanged(){if(this.suggest){this.#v()}}suggestOptionsChanged(){this.#v()}valueChanged(t){this.#k(t);if(this.suggest){this.#v()}}input;change;#_=t=>{this.#e=T(t)};#y=()=>this.getImagePathCallback??h("getImagePathCallback","ch-combo-box-render")??S;#f=()=>{this.#n=y(this.model,this.#y())};#v=()=>{this.#a=true};#w=()=>{this.#c.clear();const t={filter:this.value,options:this.suggestOptions};for(let e=0;e<this.model.length;e++){const i=this.model[e];v(i,t,this.#c)}if(!this.#c.has(this.activeDescendant)){this.activeDescendant=undefined}};#C=()=>{if(!this.suggest){this.#c=undefined;return}const t=this.#u();if(!t){this.#c??=new Set;this.#w()}};#z=()=>this.#o.get(this.value)??this.#s.get(this.value);#I=()=>{const t=this.activeDescendant;if(t?.value!==this.value){clearTimeout(this.#h);this.value=this.suggest?t.caption??t.value:t.value;this.input.emit(this.value);this.#L()}};#b=t=>{if(!this.expanded){return}this.expanded=false;this.#r=true;t.preventDefault();if(this.activeDescendant){this.#I();return}if(!this.suggestOptions?.strict){clearTimeout(this.#h);this.value=this.#p.value;this.input.emit(this.value);this.#L();return}const e=this.#z();if(e){this.#L()}else{clearTimeout(this.#h);this.value=this.#i;this.input.emit(this.value);this.#L()}};#$=t=>{t.preventDefault();this.value=this.#g.value;this.activeDescendant=this.#s.get(this.activeDescendant.value)?.item;this.input.emit(this.value)};#E=t=>{if(!this.suggest){const e=this.#d[t.code];if(!e){return}e(t);if(!this.expanded){this.#I()}}else{const e=this.#m[t.code];if(e){e(t)}}};#A=t=>{t.stopPropagation();this.expanded=false;if(b().includes(this.el)){this.#r=true}if(this.suggest){if(this.suggestOptions.strict){clearTimeout(this.#h);this.value=this.#i;this.input.emit(this.value)}this.#L()}};#L=()=>this.change.emit(this.value);#F=t=>{t.stopPropagation();this.expanded=true;clearTimeout(this.#h);if(this.suggestDebounce>0){this.#h=setTimeout((()=>{this.value=this.#p.value;this.input.emit(this.value)}),this.suggestDebounce)}else{this.value=this.#p.value;this.input.emit(this.value)}};#M=t=>{const e=t.detail===0;if(e||this.expanded&&N(t)){return}t.stopPropagation();this.expanded=!this.expanded};#T=t=>{const e=O(t,this.model);if(!e){return}const i=e;if(i.items!=null){if(!i.expandable){return}i.expanded=!i.expanded}else{this.activeDescendant=e;this.expanded=false;this.#I()}o(this)};#D=t=>{const e=O(t,this.model);if(e&&e.items==null){this.activeDescendant=e;o(this)}};#u=()=>this.suggestOptions.alreadyProcessed===true;#N=()=>!this.suggest||!this.expanded||this.suggestOptions.renderActiveItemIconOnExpand;#k=t=>{if(!this.expanded){this.#i=t}this.#x();this.internals.setFormValue(t)};#x=()=>{if(!this.activeDescendant||!this.expanded){this.activeDescendant=this.#z()?.item}const t=this.suggest&&!this.#u();if(!t&&!B(this.activeDescendant,this.model)){this.activeDescendant=undefined}};#O=()=>t("select",{"aria-label":this.#t??this.accessibleName,disabled:this.disabled,onChange:!this.disabled&&this.#$,ref:t=>this.#g=t},!this.activeDescendant&&t("option",{disabled:true,selected:true,value:""},this.placeholder),this.model.map((t=>M(t,this.value))));connectedCallback(){this.#_(this.model);D(this.model,this.#s,this.#o);this.#k(this.value);const t=this.internals.labels;this.#t=r(t);a(this.el,"ch-combo-box-render",t,this.#t,this.accessibleName)}componentWillRender(){if(this.#a){this.#C();this.#a=false}}componentDidRender(){if(this.expanded){const t=this.el.shadowRoot.querySelector(W);if(t){requestAnimationFrame((()=>{t.focus();this.#p.focus()}))}}if(this.#r){this.#r=false;this.el.focus()}}render(){const e=this.suggest;const i=!this.disabled&&!e;const s=!this.readonly&&!this.disabled;const o=this.#z()?.item;const r=e?this.activeDescendant:o;const a=r?.startImgSrc&&this.#N()?_(r,"start",this.#y()):undefined;const h=a?`img--start start-img-type--${r.startImgType??"background"} ${a.classes}`:undefined;const c=o?.value;const d=e?this.value:o?.caption;return t(n,{key:"93b3338c510603ab8546988f697c9a266ab7a9ef",class:{"ch-disabled":this.disabled,"ch-combo-box--normal":!e,"ch-combo-box--suggest":e,"ch-combo-box--expanded":this.expanded},part:u({[c]:!!c,[l.PLACEHOLDER]:!d,[this.hostParts]:!!this.hostParts}),onKeyDown:!H&&s&&this.#E,onClickCapture:s&&(!e||!this.expanded)&&this.#M},H?this.#O():[t("span",{class:"invisible-text"},this.#e||this.placeholder),t("div",{key:"combobox",role:"combobox","aria-label":this.#t??this.accessibleName,tabindex:i?"0":null,class:{"input-container":true,disabled:this.disabled||r?.disabled,[h]:!!h},style:a?.styles},t("input",{"aria-controls":"popover","aria-disabled":i?"false":null,"aria-expanded":this.expanded.toString(),"aria-haspopup":"true",autocomplete:"off",class:{value:true,"value--readonly":!e},disabled:this.disabled||!e,placeholder:this.placeholder,readOnly:this.readonly||!e,value:d,onInputCapture:e&&s&&this.#F,ref:t=>this.#p=t})),this.expanded&&s&&t("ch-popover",{key:"popover",id:"popover",role:"listbox","aria-hidden":"false",part:"window",actionById:true,actionElement:this.el,blockAlign:"outside-end",inlineAlign:this.popoverInlineAlign,closeOnClickOutside:true,show:true,popover:"manual",resizable:this.resizable,inlineSizeMatch:"action-element-as-minimum",overflowBehavior:"add-scroll",positionTry:"flip-block",onClick:this.#T,onMouseOver:this.#D,onPopoverClosed:this.#A},this.model.map(F(false,this.disabled,e&&!this.#u(),this.activeDescendant,this.#c,this.#n,"")))])}static get delegatesFocus(){return true}static get formAssociated(){return true}static get watchers(){return{expanded:["handleExpandedChange"],model:["modelChanged"],suggest:["suggestChanged"],suggestDebounce:["suggestDebounceChanged"],suggestOptions:["suggestOptionsChanged"],value:["valueChanged"]}}};U.style=R;export{U as ch_combo_box_render};
//# sourceMappingURL=p-4ff07a65.entry.js.map