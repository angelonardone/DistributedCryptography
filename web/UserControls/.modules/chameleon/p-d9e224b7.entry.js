import{r as e,c as t,g as i,a as s,w as n,h as a,H as r,f as h}from"./p-7af91c05.js";import{f as o,m as c}from"./p-5f934da7.js";import{q as d,r as l,t as f,u}from"./p-9db16727.js";import{s as m,a as g,b as p,u as v,l as b,t as w,h as x}from"./p-2cf94d81.js";import{r as k,i as C}from"./p-23a9d308.js";import{g as y,a as I}from"./p-ebac9feb.js";import{f as _}from"./p-d161cf55.js";const z=(e,t,i,s)=>{const n=e.clientY-t.getBoundingClientRect().top;const a=t.clientHeight;const r=n<=s;const h=n>a-s;if(r||h){const e=r?n-s:n-(a-s);t.scrollTop+=e/i}};const S=":host{display:contents}:host(.rtl-direction)>.drag-info{--rtl-offset:-100%}.drag-info{--rtl-offset:16px;position:fixed;left:0;top:0;transform:translate(calc(var(--ch-tree-view-dragging-item-x) + var(--rtl-offset)), calc(var(--ch-tree-view-dragging-item-y) + 8px));pointer-events:none;z-index:1;animation:fade-in 10ms}.waiting-drop-processing{cursor:wait}.waiting-drop-processing ::slotted(*){pointer-events:none}@keyframes fade-in{0%,100%{opacity:0}}";const D=S;const T="ch-tree-view-item";const $="ch-tree-view-drop";const E="ch-tree-view";const O="checking";const L="invalid";const M="temporal-invalid";const A="valid";const P=e=>`${T}[id="${e}"]`;const F="text/plain";const R="ArrowDown";const V="ArrowUp";const j="F2";const Z=e=>e.tagName.toLowerCase()===$;const N=e=>e.tagName.toLowerCase()===T;const H=e=>e===T||e===$;const q=()=>o().find(N);const B=e=>e&&!e.editing;const K=(e,t,i)=>`"newContainerId":"${e}","metadata":"${JSON.stringify(t)}","dropType":"${i}"`;const J="--ch-tree-view-dragging-item-x";const U="--ch-tree-view-dragging-item-y";let W=0;const Y=class{constructor(i){e(this,i);this.droppableZoneEnter=t(this,"droppableZoneEnter",7);this.expandedItemChange=t(this,"expandedItemChange",7);this.itemContextmenu=t(this,"itemContextmenu",7);this.itemsDropped=t(this,"itemsDropped",7);this.selectedItemsChange=t(this,"selectedItemsChange",7);this.draggingInTheDocument=false;this.draggingInTree=false;this.rtlDirection=false;this.multiSelection=false;this.openSubTreeCountdown=750;this.selectedItemsCallback=undefined;this.scrollToEdgeOnDrag=true;this.waitDropProcessing=false}#e={[R]:e=>{const t=q();if(!B(t)){return}e.preventDefault();t.focusNextItem(c(e))},[V]:e=>{const t=q();if(!B(t)){return}e.preventDefault();t.focusPreviousItem(c(e))},[j]:e=>{const t=q();if(!t||!t.editable){return}e.preventDefault();t.editing=true}};#t=false;#i=true;#s;#n;#a=new Map;#r;#h;#o;#c;#d;#l;#f=[];#u=[];get el(){return i(this)}droppableZoneEnter;expandedItemChange;itemContextmenu;itemsDropped;selectedItemsChange;onContextMenu(e){const t=e.target.closest(T);if(!t){return}e.preventDefault();this.itemContextmenu.emit({id:t.id,itemRef:t,metadata:t.metadata,contextmenuEvent:e})}onKeyDown(e){const t=this.#e[e.key];if(t){t(e)}}onDragStart(e){this.#a.clear();const t=e.dataTransfer.getData(F);if(t===""){return}try{const e=JSON.parse(t);this.#h=e;this.draggingInTheDocument=true;this.#r=(new Date).getTime()}catch{}}onDragEnd(){this.draggingInTheDocument=false}onDragEnter(e){this.#m(null,true);e.stopPropagation();const t=e.target;const i=t.tagName.toLowerCase();if(!H(i)){return}const s=i===T;const n=this.#g(t,s);const a=n.treeItem;const r=n.dropType;this.#d=t;if(s){this.#p(a)}if(this.#v(e,a,r)===A){t.dragState="enter"}}onDragLeave(e){const t=e.target;if(!H(t.tagName.toLowerCase())){return}t.dragState="none";if(N(t)){this.#m(t)}}#g=(e,t)=>{if(t){return{treeItem:e,dropType:"above"}}const i=e.type;return{treeItem:i==="before"?e.nextElementSibling:e.previousElementSibling,dropType:e.type}};#m=(e,t=false)=>{if(this.#d===e||t){clearTimeout(this.#n);this.#d=null}};onDrop(e){e.stopPropagation();this.#m(null,true);const t=e.target;const i=t.tagName.toLowerCase();if(!H(i)){return}t.dragState="none";const s=i===T;const n=this.#g(t,s);const a=n.treeItem;const r=n.dropType;if(this.#v(e,a,r)!==A){return}const h=JSON.parse(e.dataTransfer.getData(F));this.itemsDropped.emit({newContainer:{id:a.id,metadata:a.metadata},draggingSelectedItems:this.#t,draggedItems:h,dropInTheSameTree:this.draggingInTree,dropType:r})}onItemDragStart(e){e.stopPropagation();document.addEventListener("dragover",this.#b,{capture:true});this.#c=e.target;const t=this.#w(e.detail);if(!t){e.detail.dragEvent.dataTransfer.effectAllowed="none";return}this.draggingInTree=true;if(this.scrollToEdgeOnDrag){this.#x()}}onItemDragEnd(){this.draggingInTree=false;document.removeEventListener("dragover",this.#b,{capture:true});this.#k()}onSelectedItemChange(e){e.stopPropagation();const t=e.detail;const i=this.selectedItemsCallback();if(!t.ctrlKeyPressed||!this.multiSelection){i.clear()}if(t.selected){i.set(t.id,t)}else{i.delete(t.id)}this.selectedItemsChange.emit(i)}async scrollIntoVisible(e){s((()=>{const t=this.el.querySelector(P(e));if(!t){return}n((()=>{t.scrollIntoView()}))}))}async updateValidDropZone(e,t,i,s,n){if(!this.draggingInTheDocument||e<=this.#r){return}const a=K(t,i,s);this.#a.set(a,n?A:L);if(!n||!this.#d){return}const r=Z(this.#d)?this.#d.treeItemId:this.#d.id;const h=r===t;if(h){this.#d.dragState="enter"}}#C=e=>this.el.querySelector(P(e));#v=(e,t,i)=>{const s=K(t.id,this.#h,i);let n=this.#a.get(s);if(n===M&&!t.lazyLoad&&!t.downloading){n=null}if(n!=null){return n}if(e.dataTransfer.effectAllowed==="none"||i==="above"&&t.dropDisabled||this.draggingInTree&&(this.#f.includes(t.id)||this.#u.includes(t.id))){this.#a.set(s,L);return L}if(i==="above"&&(t.lazyLoad||t.downloading)){this.#a.set(s,M);return M}this.#a.set(s,O);this.droppableZoneEnter.emit({newContainer:{id:t.id,metadata:t.metadata},draggedItems:this.#h,dropType:i});return O};#p=e=>{if(e.leaf||e.expanded){return}this.#n=setTimeout((()=>{e.expanded=true;this.expandedItemChange.emit({id:e.id,expanded:true})}),this.openSubTreeCountdown)};#b=e=>{const t=e.target.closest(E)!==null;if(t){e.stopImmediatePropagation()}e.preventDefault();this.#s=e;this.#y(e);if(!this.#i){return}this.#i=false;requestAnimationFrame((()=>{this.#i=true;this.el.style.setProperty(J,`${this.#s.clientX}px`);this.el.style.setProperty(U,`${this.#s.clientY}px`)}))};#y=e=>{if(!e.composedPath().includes(this.el)){return}const t=e.composedPath().find((e=>{if(!e.tagName){return false}return H(e.tagName.toLowerCase())&&e.closest(E)===this.el}));const i=t.tagName.toLowerCase()===T;const s=this.#g(t,i);const n=s.treeItem;const a=s.dropType;const r=this.#v(e,n,a);if(r===L||r===M){e.dataTransfer.dropEffect="none"}};#k=()=>{this.#f=[];this.#u=[]};#w=e=>{const t=e.elem;const i=this.selectedItemsCallback();const s=i.has(t.id);this.#t=s;let n=[];let a;if(s){const e=[...i.keys()];const s=[...i.values()];const r=e.length;a=s.every((e=>!this.#C(e.id).dragDisabled));this.#f=e;n=s.map((e=>({id:e.id,metadata:e.metadata})));this.#l=r===1?t.caption:r.toString()}else{a=!t.dragDisabled;n=[{id:t.id,metadata:t.metadata}];this.#f=[t.id];this.#l=t.caption}this.#I(s);const r=JSON.stringify(n);e.dragEvent.dataTransfer.setData(F,r);return a};#x=()=>{if(!this.draggingInTree||!this.#s){return}requestAnimationFrame((()=>{z(this.#s,this.el,10,30);requestAnimationFrame(this.#x)}))};#I=e=>{if(!e){const e=this.#c.parentElement;if(e.tagName.toLowerCase()===T){this.#u.push(e.id)}return}const t=this.selectedItemsCallback();t.forEach((e=>{const t=e.parentId;if(t!==""){this.#u.push(t)}}))};connectedCallback(){this.#o=`ch-tree-view-id-${W++}`;m(this.#o,(e=>{this.rtlDirection=e}));this.rtlDirection=g()}disconnectedCallback(){p(this.#o);this.#k();this.onItemDragEnd()}render(){return a(r,{key:"613b14c8ad31f9e6bd972d17b523aee1a6b34e32",class:{"dragging-item":this.draggingInTheDocument,"not-dragging-item":!this.draggingInTheDocument,"dragging-selected-items":this.draggingInTree&&this.#t,"rtl-direction":this.rtlDirection,"waiting-drop-processing":this.waitDropProcessing},exportparts:d.DRAG_PREVIEW},a("slot",{key:"443d19cf112af9319ad88ef7d1546d618213afee"}),this.draggingInTree&&a("span",{key:"5e6df493fee83549fdde90bcbf7d7c69e40bb2cf","aria-hidden":"true",class:"drag-info",part:d.DRAG_PREVIEW},this.#l))}};Y.style=D;const G=0;const Q=null;const X=e=>e?l.EVEN_LEVEL:l.ODD_LEVEL;const ee=e=>e?l.EXPANDED:l.COLLAPSED;const te=(e,t,i,s)=>{let n=false;let a=false;let r=false;e.forEach((e=>{const h=t.get(e);if(h){const o=h.item;const c=h.parentItem.items;if(o.leaf!==true&&o.items?.length>0){const e=o.items.map((e=>e.id));te(e,t,i,s)}n||=t.delete(e);a||=i.delete(e);r||=s.delete(e);k(c,c.findIndex((t=>t.id===e)))}}));return{atLeastOneElement:n,atLeastOneCheckbox:a,atLeastOneSelected:r}};const ie=e=>new Promise((t=>t(e)));const se=(e,t)=>{const i=t.get(e);if(!i){return ie(false)}let s=i.parentItem;while(s&&s.id!=null){s.expanded=true;const e=t.get(s.id);s=e.parentItem}return ie(true)};const ne=async(e,t,i,s,n)=>{const a=new Set(t).size!==t.length;if(a){return false}const r=t.length-1;let o=r;let c=i.get(t[o]);while(c===undefined&&o>0){o--;c=i.get(t[o])}if(!c){return false}const d=o;while(o>=0){if(i.get(t[o])===undefined){return false}o--}if(i.get(t[0]).parentItem!==s){return false}const l=d!==r;const f=l&&!n;if(f){return false}let u=i.get(t[d]).parentItem;while(u!==s){u.expanded=true;u=i.get(u.id).parentItem}h(e);let m=d;while(m<r){const s=t[m];const a=i.get(s);if(!a){return false}const r=a.item;if(r.leaf===true){return false}r.downloading=true;r.expanded=true;r.lazy=false;h(e);const o=await n(s);await e.loadLazyContent(s,o);m++}return true};const ae=':host{--ch-tree-view-drop--size:8px;display:grid;position:relative;transform:translateY(calc(var(--ch-tree-view-drop--size) * -0.5))}:host::before{content:"";display:flex;position:absolute;inset-inline:0;block-size:var(--ch-tree-view-drop--size)}:host::after{display:flex;position:absolute;align-self:center;inset-block-start:calc(var(--ch-tree-view-drop--size) * 0.25);inset-inline:0;block-size:calc(var(--ch-tree-view-drop--size) * 0.5);background-color:currentColor;opacity:0}:host(.ch-tree-view-drop--drag-enter)::after{content:"";opacity:1}';const re=ae;const he="ch-tree-view-drop";const oe=class{constructor(t){e(this,t);this.dragState="none";this.level=G;this.treeItemId=undefined;this.type="before"}render(){const e=this.level!==G;const t=X(this.level%2===0);return a(r,{key:"fe197aa7dc8caf5d81da95d44461f97d15dd35e7",class:{["gx-"+t]:e,[he+"--drag-enter"]:this.dragState==="enter"},style:{"--level":`${this.level}`}})}};oe.style=re;const ce='*,::after,::before{box-sizing:border-box}:where(button){all:unset;display:flex;user-select:none;touch-action:manipulation;-webkit-user-drag:element}:host{display:grid;grid-template-rows:min-content}.header{display:flex;gap:var(--ch-tree-view-item-gap);align-items:center}.header--disabled{pointer-events:none}.header--disabled>.action{--ch-start-img:var(--ch-start-img--disabled, var(--ch-start-img--base));--ch-end-img:var(--ch-end-img--disabled, var(--ch-end-img--base))}.header:hover>.action{--ch-start-img:var(--ch-start-img--hover, var(--ch-start-img--base));--ch-end-img:var(--ch-end-img--hover, var(--ch-end-img--base))}.header:active>.action{--ch-start-img:var(--ch-start-img--active, var(--ch-start-img--base));--ch-end-img:var(--ch-end-img--active, var(--ch-end-img--base))}.header:focus>.action{--ch-start-img:var(\n    --ch-start-img--focus,\n    var(--ch-start-img--active, var(--ch-start-img--base))\n  );--ch-end-img:var(\n    --ch-end-img--focus,\n    var(--ch-end-img--active, var(--ch-end-img--base))\n  )}.line{--inset-inline-start:calc(var(--ch-tree-tab-size) * (var(--level) - 1) - var(--parent-offset, 0px) + var(--ch-tree-view-item-custom-padding-inline-start) + var(--ch-tree-view-item__expandable-button-size) * 0.5 + var(--ch-tree-view-item__line--inset-inline-start));position:absolute;inset-inline-start:var(--inset-inline-start);inline-size:calc(var(--ch-tree-view-item-indentation) - var(--inset-inline-start) - var(--ch-tree-view-item__line--inset-inline-end));block-size:1px;border:0 dashed color-mix(in srgb, currentColor 65%, transparent);border-block-end-width:1px;pointer-events:none;content-visibility:hidden;z-index:1}.last-all-line{inset-block-start:0;height:calc(100% - var(--ch-tree-view-item-distance-to-checkbox));border-inline-start-width:1px;border-end-start-radius:2px}.last-line{inset-block-start:0;height:100%;border-inline-start-width:1px;border-inline-start-style:solid;border-block-end:unset}.expandable-button,.expandable-button-decorative::before{display:grid;place-items:center;inline-size:var(--ch-tree-view-item__expandable-button-size);block-size:var(--ch-tree-view-item__expandable-button-size);z-index:1;cursor:pointer}.expandable-button-decorative::before{content:"";background-color:currentColor;-webkit-mask:url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" fill="none"><path d="M16.5 5L8.7 12.7L1 5" stroke="%23000" stroke-width="1.2" stroke-linecap="round"/></svg>\') 50% 50%/calc(100% - 4px) calc(100% - 4px) no-repeat;cursor:unset}.expandable-button-decorative--collapsed::before{transform:rotate(-90deg)}.expandable-button::before{content:"";inline-size:calc(100% - 4px);block-size:calc(100% - 4px);background-color:currentColor;-webkit-mask-size:calc(var(--ch-tree-view-item__expandable-button-size) - 4px)}.expandable-button--collapsed::before{-webkit-mask-image:url(\'data:image/svg+xml,<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.15,8.5H8.54v5.61h-1V8.5H1.93v-1H7.54V1.89h1V7.5h5.61Z"/></svg>\')}.expandable-button--expanded::before{-webkit-mask-image:url(\'data:image/svg+xml,<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.15,8.5H1.93v-1H14.15Z"/></svg>\')}.checkbox{inline-size:var(--ch-tree-view-item__checkbox-size);--ch-checkbox__container-size:var(--ch-tree-view-item__checkbox-size)}.action{--ch-start-img:var(--ch-start-img--base);--ch-end-img:var(--ch-end-img--base);display:grid;grid-template:"start-img text"/max-content 1fr;gap:var(--ch-tree-view-item-gap);align-items:center;block-size:100%;flex:1;cursor:pointer}.action--end-img{grid-template:"start-img text end-img"/max-content 1fr max-content}.edit-caption{grid-area:text;inline-size:100%;block-size:100%;padding:0;margin:0;background-color:unset;border:unset;color:unset;font:unset;outline:unset}.pseudo-img--start::before,.pseudo-img--end::after,.img{display:block;inline-size:var(--ch-tree-view-item__image-size);block-size:var(--ch-tree-view-item__image-size);content-visibility:auto;contain-intrinsic-size:auto var(--ch-tree-view-item__image-size)}.pseudo-img--start::before,.start-img{content:"";grid-area:start-img}.pseudo-img--end::after,.end-img{content:"";grid-area:end-img}.start-img-type--background::before{background:no-repeat center/var(--ch-tree-view-item__background-image-size) var(--ch-start-img)}.end-img-type--background::after{background:no-repeat center/var(--ch-tree-view-item__background-image-size) var(--ch-end-img)}.start-img-type--mask::before{-webkit-mask:no-repeat center/var(--ch-tree-view-item__background-image-size) var(--ch-start-img);background-color:currentColor}.end-img-type--mask::after{-webkit-mask:no-repeat center/var(--ch-tree-view-item__background-image-size) var(--ch-end-img);background-color:currentColor}.downloading{inline-size:0.75em;block-size:0.75em;margin-inline:8px 2px;border:2px solid currentColor;border-inline-start-color:transparent;border-radius:50%;opacity:0.75;animation:spin 1s linear infinite, avoid-flickering 75ms}@keyframes avoid-flickering{0%,100%{display:none}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.expandable{display:grid;grid-auto-rows:min-content;position:relative}.expandable--lazy-loaded{content-visibility:auto;contain-intrinsic-size:auto 100px}.expandable--collapsed{display:none;overflow:hidden}';const de=ce;let le;const fe="--ch-tree-view-item-distance-to-checkbox";const ue="ch-tree-view-item";const me=`:scope>${ue}`;const ge=`${ue}:not([disabled])`;const pe=`:scope>${ue}:last-child`;const ve=`item-deny-drop`;const be=`${l.IMAGE} ${l.START_IMAGE}`;const we=`${l.IMAGE} ${l.END_IMAGE}`;const xe="expandable";const ke="Enter";const Ce="Escape";const ye=class{constructor(i){e(this,i);this.checkboxChange=t(this,"checkboxChange",7);this.checkboxToggleChange=t(this,"checkboxToggleChange",7);this.itemDragStart=t(this,"itemDragStart",7);this.itemDragEnd=t(this,"itemDragEnd",7);this.loadLazyContent=t(this,"loadLazyContent",7);this.modifyCaption=t(this,"modifyCaption",7);this.openReference=t(this,"openReference",7);this.selectedItemChange=t(this,"selectedItemChange",7);this.caption=undefined;this.checkbox=false;this.checked=false;this.customRender=false;this.disabled=false;this.dragDisabled=false;this.dropDisabled=false;this.dragState="none";this.downloading=false;this.editable=undefined;this.editing=false;this.endImgSrc=undefined;this.endImgType="background";this.expandableButton="decorative";this.expandOnClick=true;this.expanded=false;this.getImagePathCallback=undefined;this.lastItem=false;this.lazyLoad=false;this.leaf=false;this.level=G;this.indeterminate=false;this.metadata=undefined;this.model=undefined;this.parts=undefined;this.selected=false;this.showDownloadingSpinner=true;this.showLines="none";this.startImgSrc=undefined;this.startImgType="background";this.toggleCheckboxes=false}#_;#z=false;#S;#D;#T;#$;#E;#O;get el(){return i(this)}updateChildrenCheckedValue(e){if(!this.toggleCheckboxes||this.leaf||this.#z){this.#z=false;return}const t=this.#L();t.forEach((t=>{if(t.checked!==e||t.indeterminate!==false){t.updateChecked(e,false)}}))}editingChanged(e){if(!e){return}document.addEventListener("click",this.#M,{capture:true});n((()=>{requestAnimationFrame((()=>{if(this.#O){this.#O.focus()}}))}))}endImgSrcChanged(e){this.model.endImgSrc=e;this.#A("end")}expandedChanged(e){setTimeout((()=>{this.#P(e)}))}getImagePathCallbackChanged(){this.#A("start");this.#A("end")}lastItemChanged(e){if(e&&this.showLines){requestAnimationFrame((()=>{this.#F()}))}else{this.#R()}}partsChanged(e){this.#V(e)}showLinesChanged(e){if(e&&this.lastItem){this.#F()}else{this.#R()}}startImgSrcChanged(e){this.model.startImgSrc=e;this.#A("start")}handleToggleCheckboxesChange(e){if(e){this.el.addEventListener("checkboxChange",this.#j)}else{this.el.removeEventListener("checkboxChange",this.#j)}}checkboxChange;checkboxToggleChange;itemDragStart;itemDragEnd;loadLazyContent;modifyCaption;openReference;selectedItemChange;async focusNextItem(e){if(!this.leaf&&this.expanded){const t=this.el.querySelector(ge);if(t){t.setFocus(e);return}}this.focusNextSibling(e)}async focusNextSibling(e){const t=this.el.nextElementSibling;if(t){if(t.disabled){t.focusNextItem(e)}else{t.setFocus(e)}return}if(this.level===G){return}const i=this.el.parentElement;i.focusNextSibling(e)}async focusPreviousItem(e){const t=this.el.previousElementSibling;if(t){t.focusLastItem(e);return}if(this.level===G){return}const i=this.el.parentElement;if(i.disabled){i.focusPreviousItem(e);return}i.setFocus(e)}async focusLastItem(e){if(!this.leaf&&this.expanded){const t=this.el.querySelector(pe);if(t){t.focusLastItem(e);return}}if(this.disabled){this.focusPreviousItem(e);return}this.setFocus(e)}async setFocus(e){this.#E.focus();if(!e){this.#Z()}}async updateChecked(e,t){this.checked=e;this.indeterminate=t;this.checkboxToggleChange.emit({id:this.el.id,checked:e,indeterminate:t})}#A=e=>{if(e==="start"&&!this.startImgSrc||e==="end"&&!this.endImgSrc){return}const t=this.getImagePathCallback??le;const i=t(this.model,e);const s=typeof i==="string";const n=s?{base:i}:i?.default;if(e==="start"){if(!i){this.#S=null;this.#D=null;return}if(s&&this.startImgType!=="img"){n.base=`url("${n.base}")`}else{this.#D=this.startImgSrc?v(i.expanded,"start",this.startImgType):undefined}this.#S=this.startImgSrc?v(n,"start",this.startImgType):undefined}else{if(!i){this.#T=null;this.#$=null;return}if(s&&this.endImgType!=="img"){n.base=`url("${n.base}")`}else{this.#$=this.endImgSrc?v(i.expanded,"end",this.endImgType):undefined}this.#T=this.endImgSrc?v(n,"end",this.endImgType):undefined}};#N=(e,t)=>this.expanded?t??e:e;#L=()=>Array.from(this.el.querySelectorAll(me));#F=()=>{this.#_=new ResizeObserver((()=>{const e=this.el.getBoundingClientRect().height-this.#E.getBoundingClientRect().height/2;this.el.style.setProperty(fe,e+"px")}));this.#_.observe(this.el);this.#_.observe(this.#E)};#R=()=>{if(!this.#_){return}this.#_.disconnect();this.#_=null};#H=e=>{e.stopPropagation();if(e.code!==ke&&e.code!==Ce){return}e.preventDefault();const t=e.code===ke;this.#q(true,t)()};#M=e=>{if(!e.composedPath().includes(this.#O)&&e.pointerType){this.#q(false)()}};#q=(e,t=false)=>()=>{if(!this.editing){return}this.editing=false;document.removeEventListener("click",this.#M,{capture:true});const i=this.#O.value;if(t&&i.trim()!==""){this.modifyCaption.emit({id:this.el.id,caption:i})}if(e){this.#E.focus()}};#B=e=>{e.stopPropagation();if(!this.leaf){this.expanded=!this.expanded}this.selected=true;this.selectedItemChange.emit(this.#K(c(e),true))};#P=e=>{if(!this.lazyLoad||!e){return}this.lazyLoad=false;this.downloading=true;this.loadLazyContent.emit(this.el.id)};#J=()=>{const e=!this.selected;this.selected=e;this.selectedItemChange.emit(this.#K(true,e))};#Z=()=>{this.selected=true;this.selectedItemChange.emit(this.#K(false,true))};#U=e=>{if(c(e)){this.#J();return}if(e.detail>=2){return}if(this.expandOnClick){this.#B(e)}else{this.#Z()}};#K=(e,t)=>({ctrlKeyPressed:e,expanded:this.expanded,id:this.el.id,metadata:this.metadata,parentId:this.el.parentElement?.id,selected:t});#W=e=>{e.stopPropagation();if(c(e)){this.#J();return}this.#Y();if(!this.leaf&&!this.expandOnClick){this.#B(e)}};#G=e=>{e.stopPropagation();if(this.editing){return}e.preventDefault();if(e.pointerType){this.#U(e);return}this.#Y();this.#B(e)};#Q=e=>{if(c(e)&&e.code===ke){e.stopPropagation();this.#J()}};#Y=()=>{this.openReference.emit({id:this.el.id,leaf:this.leaf,metadata:this.metadata})};#X=e=>{e.stopPropagation();const t=e.target;const i=t.checkedValue===t.value;this.checked=i;this.indeterminate=false;this.checkboxChange.emit({id:this.el.id,checked:this.checked,indeterminate:false})};#j=e=>{if(this.el===e.target){return}const t=e.detail.checked;const i=this.#L();const s=i.every((e=>e.checked===t));const n=this.checked!==t||this.indeterminate!==!s;this.#z=this.checked!==t;this.checked=t;this.indeterminate=!s;if(n){this.checkboxToggleChange.emit({id:this.el.id,checked:t,indeterminate:!s})}};#ee=(e,t,i)=>i==="img"&&a("img",{"aria-hidden":"true",class:`img ${e}`,part:e,alt:"",src:t,loading:"lazy"});#te=e=>{if(this.editing){e.preventDefault();e.stopPropagation();return}b(e);e.dataTransfer.effectAllowed="move";this.dragState="start";this.itemDragStart.emit({elem:this.el,dragEvent:e})};#ie=()=>{this.dragState="none";this.itemDragEnd.emit()};#V=e=>{if(e){this.el.setAttribute("exportparts",`${f},${e.replace(/\s+/g,",")}`)}else{this.el.setAttribute("exportparts",f)}};connectedCallback(){le??=y("getImagePathCallback","ch-tree-view-render");if(this.toggleCheckboxes){this.el.addEventListener("checkboxChange",this.#j)}this.#A("start");this.#A("end");this.el.setAttribute("role","treeitem");this.el.setAttribute("aria-level",`${this.level+1}`);this.el.style.setProperty("--level",`${this.level}`);this.#V(this.parts)}componentWillLoad(){this.#P(this.expanded)}componentDidLoad(){if(this.lastItem&&this.showLines){this.#F()}}disconnectedCallback(){if(this.editing){this.#q(false)}this.#R();this.el.removeEventListener("checkboxChange",this.#j)}render(){const e=this.level%2===0;const t=!this.leaf&&!this.lazyLoad;const i=this.level!==G;const s=this.showLines==="all"&&i;const n=this.showLines==="last"&&i&&this.lastItem;const h=X(e);const o=ee(this.expanded);const c=x(this.startImgSrc,this.startImgType);const f=x(this.endImgSrc,this.endImgType);const m=!!this.parts;return a(r,{key:"340bbee2edc60b2d3978f049cd8cef83223b4724","aria-selected":this.selected?"true":null,class:this.leaf?ve:null,part:w({[d.ITEM]:true,[d.DRAG_ENTER]:this.dragState==="enter",[this.parts]:m})},a("button",{key:"48084c1d7fa56ff6b92903ea876a911b1931f17b","aria-controls":t?xe:null,"aria-expanded":t?this.expanded.toString():null,class:{header:true,"header--selected":this.selected,"header--disabled":this.disabled,"expandable-button-decorative":!this.leaf&&this.expandableButton==="decorative","expandable-button-decorative--collapsed":!this.leaf&&this.expandableButton==="decorative"&&!this.expanded},part:w({[l.HEADER]:true,[l.DISABLED]:this.disabled,[l.DRAG_ENTER]:this.dragState==="enter",[l.SELECTED]:this.selected,[l.NOT_SELECTED]:!this.selected,[l.EXPAND_BUTTON]:i&&!this.leaf&&this.expandableButton!=="no",[this.editing?l.EDITING:l.NOT_EDITING]:true,[h]:i,[l.LEVEL_0_LEAF]:!i&&this.leaf&&this.expandableButton!=="no",[this.parts]:m}),style:c&&(this.#S||this.#D)?this.#N(this.#S,this.#D).styles:undefined,type:"button",disabled:this.disabled,onClick:this.#G,onKeyDown:!this.editing?this.#Q:null,draggable:!this.dragDisabled,onDragStart:this.#te,onDragEnd:!this.dragDisabled&&this.dragState==="start"?this.#ie:null,ref:e=>this.#E=e},!this.leaf&&this.expandableButton==="action"&&a("button",{key:"expandable-button",type:"button",class:{"expandable-button":true,"expandable-button--expanded":this.expanded,"expandable-button--collapsed":!this.expanded},part:w({[l.EXPANDABLE_BUTTON]:true,[l.DISABLED]:this.disabled,[o]:true,[this.parts]:m}),disabled:this.disabled,onClick:this.#B}),this.checkbox&&a("ch-checkbox",{key:"checkbox",accessibleName:this.caption,class:"checkbox",exportparts:u,part:m?`${l.CHECKBOX} ${this.parts}`:l.CHECKBOX,checkedValue:"true",disabled:this.disabled,indeterminate:this.indeterminate,unCheckedValue:"false",value:`${this.checked}`,onInput:this.#X}),this.customRender?a("slot",{name:"custom-content"}):[a("div",{class:{action:true,"action--end-img":!!this.endImgSrc,[`start-img-type--${this.startImgType} pseudo-img--start`]:c,[`end-img-type--${this.endImgType} pseudo-img--end`]:f},part:w({[l.ACTION]:true,[this.editing?l.EDITING:l.NOT_EDITING]:true,[o]:!this.leaf,[this.parts]:m}),style:f&&(this.#T||this.#$)?this.#N(this.#T,this.#$).styles:undefined,onDblClick:!this.editing?this.#W:null},this.startImgSrc&&this.#S&&this.#ee(m?`${be} ${this.parts}`:be,this.#S.styles["--ch-start-img--base"],this.startImgType),this.editable&&this.editing?a("input",{key:"edit-caption",class:"edit-caption",part:m?`${l.EDIT_CAPTION} ${this.parts}`:l.EDIT_CAPTION,disabled:this.disabled,type:"text",value:this.caption,onBlur:this.#q(false),onKeyDown:this.#H,ref:e=>this.#O=e}):this.caption,this.endImgSrc&&this.#T&&this.#ee(m?`${we} ${this.parts}`:we,this.#T.styles["--ch-end-img--base"],this.endImgType)),this.showDownloadingSpinner&&!this.leaf&&this.downloading&&a("div",{class:"downloading",part:m?`${l.DOWNLOADING} ${this.parts}`:l.DOWNLOADING})],(s||n)&&a("div",{key:"line",class:{line:true,"last-all-line":s&&this.lastItem,"last-line":n},part:w({[l.LINE]:true,[l.LAST_LINE]:this.lastItem,[this.parts]:m})})),t&&a("div",{key:"5cee089a1ced332430aeeae48399109a566eff16",role:"group","aria-busy":(!!this.downloading).toString(),"aria-live":this.downloading?"polite":null,id:xe,class:{expandable:true,"expandable--collapsed":!this.expanded,"expandable--lazy-loaded":!this.downloading,"expandable--even":i&&e,"expandable--odd":i&&!e},part:w({[l.GROUP]:true,[l.LAZY_LOADED]:!this.downloading,[o]:true,[h]:i,[this.parts]:m})},a("slot",{key:"6a530f3e66150004aafac66f292393c476be263b"})))}static get watchers(){return{checked:["updateChildrenCheckedValue"],editing:["editingChanged"],endImgSrc:["endImgSrcChanged"],expanded:["expandedChanged"],getImagePathCallback:["getImagePathCallbackChanged"],lastItem:["lastItemChanged"],parts:["partsChanged"],showLines:["showLinesChanged"],startImgSrc:["startImgSrcChanged"],toggleCheckboxes:["handleToggleCheckboxesChange"]}}};ye.style=de;const Ie=(e,t)=>e.checkbox??t;const _e=(e,t,i)=>i?e.includes(t):e.toLowerCase().includes(t.toLowerCase());const ze=(e,t,i)=>typeof t==="object"?e.match(t)!==null:_e(e,t,i?.matchCase);const Se={caption:(e,t)=>t.filter?ze(e.caption??"",t.filter,t.filterOptions):true,checked:(e,t)=>Ie(e,t.defaultCheckbox)&&!e.indeterminate&&(e.checked??t.defaultChecked),list:(e,t)=>t.filterSet.has(e.id),metadata:(e,t)=>t.filter?ze(e.metadata??"",t.filter,t.filterOptions):true,none:()=>true,unchecked:(e,t)=>Ie(e,t.defaultCheckbox)&&!e.indeterminate&&!(e.checked??t.defaultChecked)};const De=(e,t,i)=>i.filterOptions?.hideMatchesAndShowNonMatches===true?!Se[e](t,i):Se[e](t,i);const Te=(e,t)=>{const i=t.get(e);if(!i){return null}const s=[i.item];let n=i;while(n.parentItem.id!==Q){s.push(n.parentItem);n=t.get(n.parentItem.id)}return s.reverse()};const $e=async(e,t,i,s,n,a,r,h)=>{const o=i.get(t);if(!s||!o||o.item.leaf===true){return false}const c=!r&&!h;if(c){r={downloading:true};h={downloading:false}}if(r){e.updateItemsProperties([t],r)}const d=await s(t);const l=new Set(o.item.items.map((e=>e.id)));const f=[];d.forEach((e=>{const t=i.get(e.id);if(t&&l.has(e.id)){const i=t.item;e.checked=i.checked;e.expanded=i.expanded;e.indeterminate=i.indeterminate;e.selected=i.selected;const s=e.lazy&&i.lazy===false;if(s){e.lazy=false;e.items=i.items;f.push(e.id)}l.delete(e.id)}}));if(l.size>0){a([...l.keys()])}await n(t,d);if(h){e.updateItemsProperties([t],h)}await Promise.allSettled(f.map((t=>$e(e,t,i,s,n,a))));return true};const Ee=(e,t,i,s,n,a)=>{const r=i.get(e);if(!r){return}const h=r.item;Object.keys(t).forEach((e=>{if(t[e]!==undefined){h[e]=t[e]}}));if(t.selected){s.add(e)}else if(t.selected===false){s.delete(e)}if(Ie(h,a)){n.set(e,r)}else{n.delete(e)}};const Oe=":host{--ch-tree-view-item-custom-padding-inline-start:0px;--ch-tree-view-item-gap:0px;--ch-tree-view-item__checkbox-size:0.875em;--ch-tree-view-item__expandable-button-size:0.875em;--ch-tree-view-item__image-size:0.875em;--ch-tree-view-item__background-image-size:100%;--ch-tree-view-item__line--inset-inline-start:0px;--ch-tree-view-item__line--inset-inline-end:0px;--ch-tree-tab-size:calc(\n    var(--ch-tree-view-item__image-size) +\n      var(--ch-tree-view-item__expandable-button-size) +\n      (var(--ch-tree-view-item-gap) * 2)\n  );display:grid;grid-auto-rows:max-content;block-size:100%;overflow:auto;contain:size}.dragging-item ch-tree-view-item{pointer-events:var(--ch-tree-view-pointer-events, all)}.dragging-item .item-deny-drop{pointer-events:none}.dragging-selected-items ch-tree-view-item[selected]{--ch-tree-view-pointer-events:none}::part(item__header),ch-tree-view-drop{--own-offset:0px;--ch-tree-view-item-indentation:calc(\n    var(--ch-tree-tab-size) * var(--level) - var(--own-offset) -\n      var(--parent-offset, 0px) +\n      var(--ch-tree-view-item-custom-padding-inline-start)\n  )}::part(item__header level-0-leaf){--ch-tree-view-item-indentation:calc(\n    var(--ch-tree-view-item__expandable-button-size) +\n      var(--ch-tree-view-item-gap) +\n      var(--ch-tree-view-item-custom-padding-inline-start)\n  )}::part(item__header expand-button),ch-tree-view-drop{--own-offset:calc(\n    var(--ch-tree-view-item__expandable-button-size) +\n      var(--ch-tree-view-item-gap)\n  )}::part(item__header even-level),ch-tree-view-drop.gx-even-level{--parent-offset:var(--parent-offset-odd)}::part(item__header odd-level),ch-tree-view-drop.gx-odd-level{--parent-offset:var(--parent-offset-even)}ch-tree-view-drop{margin-inline-start:var(--ch-tree-view-item-indentation)}::part(item__header){padding-inline-start:var(--ch-tree-view-item-indentation)}::part(item__group even-level){--parent-offset-even:calc(\n    var(--ch-tree-view-item__expandable-button-size) +\n      var(--ch-tree-view-item-gap) + var(--parent-offset-odd, 0px)\n  )}::part(item__group odd-level){--parent-offset-odd:calc(\n    var(--ch-tree-view-item__expandable-button-size) +\n      var(--ch-tree-view-item-gap) + var(--parent-offset-even, 0px)\n  )}ch-tree-view-item>ch-tree-view-drop:first-child{transform:translateY(0)}ch-tree-view-item>ch-tree-view-drop:first-child::after{inset-block-start:0px}ch-tree-view-item>ch-tree-view-drop:last-child{transform:translateY(calc(var(--ch-tree-view-drop--size) * -1))}ch-tree-view-item>ch-tree-view-drop:last-child::after{inset-block-start:calc(var(--ch-tree-view-drop--size) * 0.5)}";const Le=Oe;const Me=e=>I("getImagePathCallback","ch-tree-view-render",((t,i="start")=>{const s=i==="start"?t.startImgSrc:t.endImgSrc;return e.useGxRender?_(s,e.gxSettings,e.gxImageConstructor):s}));const Ae=false;const Pe=false;const Fe=false;const Re=0;const Ve=false;const je=(e,t)=>{if(e==="none"){return false}if(e!=="caption"&&e!=="metadata"){return true}if(!t){return false}return typeof t==="object"||t.trim()!==""};const Ze=(e,t)=>e.dragEnabled!=null?!e.dragEnabled:t.dragDisabled;const Ne=(e,t)=>e.dropEnabled!=null?!e.dropEnabled:t.dropDisabled;const He=(e,t,i)=>i?Ne(e,t):e.dropDisabled??t.dropDisabled;const qe=e=>`ch-tree-view-drop__${e}`;const Be=(e,t,i,s,n,r,h=false)=>(t.filterType==="none"||e.render!==false||t.filterType==="list"&&(t.filterList===undefined||t.filterList===null))&&[r&&a("ch-tree-view-drop",{id:qe(e.id),level:n,treeItemId:e.id,type:"before"}),a("ch-tree-view-item",{key:e.id,id:e.id,caption:e.caption,checkbox:e.checkbox??t.checkbox,checked:e.checked??t.checked,disabled:h?e.enabled===false:e.disabled,downloading:e.downloading,dragDisabled:h?Ze(e,t):e.dragDisabled??t.dragDisabled,dropDisabled:He(e,t,h),editable:e.editable??t.editableItems,endImgSrc:e.endImgSrc,endImgType:e.endImgType??"background",expanded:e.expanded,expandableButton:t.expandableButton,expandOnClick:t.expandOnClick,getImagePathCallback:t.getImagePathCallback,indeterminate:e.indeterminate,lastItem:s,lazyLoad:e.lazy,leaf:e.leaf,level:n,metadata:e.metadata,model:e,parts:e.parts,selected:e.selected,showLines:t.showLines,toggleCheckboxes:e.toggleCheckboxes??t.toggleCheckboxes,startImgSrc:e.startImgSrc,startImgType:e.startImgType??"background"},!e.leaf&&e.items!=null&&e.items.map(((s,a)=>t.renderItem(s,t,i,t.showLines!=="none"&&(i&&e.lastItemId!==undefined?s.id===e.lastItemId:a===e.items.length-1),n+1,t.dropMode!=="above"&&He(e,t,h)!==true,h)))),r&&s&&a("ch-tree-view-drop",{id:qe(e.id)+"-after",level:n,treeItemId:e.id,type:"after"})];const Ke=e=>{e.sort(((e,t)=>{const i=e.order??Re;const s=t.order??Re;if(i<s){return-1}if(i>s){return 0}return e.caption<=t.caption?-1:0}))};const Je=class{constructor(i){e(this,i);this.checkedItemsChange=t(this,"checkedItemsChange",7);this.itemContextmenu=t(this,"itemContextmenu",7);this.itemOpenReference=t(this,"itemOpenReference",7);this.selectedItemsChange=t(this,"selectedItemsChange",7);this.waitDropProcessing=false;this.checkbox=false;this.checked=false;this.checkDroppableZoneCallback=undefined;this.dragDisabled=true;this.dropDisabled=true;this.dropItemsCallback=undefined;this.dropMode="above";this.editableItems=false;this.expandableButton="decorative";this.expandOnClick=true;this.filter=undefined;this.filterDebounce=250;this.filterList=undefined;this.filterOptions={};this.filterType="none";this.gxImageConstructor=undefined;this.gxSettings=undefined;this.getImagePathCallback=undefined;this.lazyLoadTreeItemsCallback=undefined;this.modifyItemCaptionCallback=undefined;this.multiSelection=false;this.model=[];this.renderItem=Be;this.showLines="none";this.sortItemsCallback=Ke;this.toggleCheckboxes=false;this.useGxRender=false}#se=new Map;#ne=new Map;#ae=new Set;#re=false;#he=false;#oe;#ce=false;#de;#le;#fe;#ue;get el(){return i(this)}checkboxChange(){this.#me();this.#ge()}checkedChange(){this.#me();this.#ge()}filterChanged(){if(this.filterType==="caption"||this.filterType==="metadata"){this.#ge()}}filterDebounceChanged(){if(this.filterType==="caption"||this.filterType==="metadata"){this.#ge()}}filterListChanged(){this.#fe=new Set(this.filterList);if(this.filterType==="list"){this.#ge()}}filterOptionsChanged(){this.#ge()}filterTypeChanged(e){if(e==="list"){this.#fe=new Set(this.filterList)}else{this.#fe=undefined}this.#ge()}multiSelectionChanged(e){if(!e){this.#pe(this.#ae)}}modelChanged(){this.#ve()}checkedItemsChange;itemContextmenu;itemOpenReference;selectedItemsChange;async dropItems(e,t,i){if(!e){return}const s=t.newContainer.id;const n=this.#se.get(s);const a=t.dropType;const r=a==="above"?n.item:n.parentItem;if(t.dropInTheSameTree){let e=undefined;if(a!=="above"){e={index:r.items.findIndex((e=>e.id===t.newContainer.id))};if(a==="after"){e.index++}}t.draggedItems.forEach(this.#be(r,e));if(t.draggingSelectedItems){this.#we()}}else{if(i==null){return}r.items.push(...i);i.forEach(this.#xe(r))}this.#ke(r.items);r.expanded=true;this.#me();this.#ge();h(this)}async getItemPath(e){return Te(e,this.#se)}async getItemsInfo(e){return this.#Ce(e)}#Ce=e=>{const t=[];e.forEach((e=>{const i=this.#se.get(e);if(i){t.push(i)}}));return t};async loadLazyContent(e,t,i=false,s=false){const n=this.#se.get(e).item;n.downloading=i;n.lazy=s;if(t==null){return}n.items=t;this.#ke(n.items);this.#ye(n);this.#me();this.#ge("immediate");h(this)}async removeItems(e){const t=te(e,this.#se,this.#ne,this.#ae);if(!this.#Ie()){if(t.atLeastOneSelected){this.#_e()}if(t.atLeastOneCheckbox){this.#me()}}if(t.atLeastOneElement){h(this);this.#ge("immediate")}}async reloadItems(e,t,i){const s=await $e(this.el,e,this.#se,this.lazyLoadTreeItemsCallback,((e,t)=>this.loadLazyContent(e,t)),(e=>this.removeItems(e)),t,i);return s}async scrollIntoVisible(e,t){const i=typeof e==="string";const s=await(i?se(e,this.#se):ne(this.el,e,this.#se,this.#oe,this.lazyLoadTreeItemsCallback));if(!s){return false}const n=i?e:e[e.length-1];let a=this.#se.get(n).parentItem;while(a!==this.#oe){a.expanded=true;a=this.#se.get(a.id).parentItem}if(t){this.updateItemsProperties([n],t)}h(this);requestAnimationFrame((()=>{this.#ue.scrollIntoVisible(n)}));return true}async toggleItems(e,t){if(!e){return[]}const i=[];e.forEach((e=>{const s=this.#se.get(e).item;if(s){s.expanded=t??!s.expanded;i.push({id:s.id,expanded:s.expanded})}}));h(this);return i}async updateAllItemsProperties(e){[...this.#se.values()].forEach((t=>{if(e.expanded!=null){t.item.expanded=e.expanded}if(e.checked!=null){t.item.checked=e.checked;t.item.indeterminate=false}}));if(e.checked!=null){this.#ge()}h(this)}async updateItemsProperties(e,t){const i=new Set(this.#ae);const s=new Map(this.#ne);e.forEach((e=>{Ee(e,t,this.#se,i,s,this.checkbox)}));if(!this.multiSelection){this.#pe(i)}if(this.#Ie()){this.#ge()}else{this.#ze(s);this.#Se(i)}h(this)}async updateValidDropZone(e,t,i,s,n){this.#ue.updateValidDropZone(e,t,i,s,n)}onCheckboxChange(e){e.stopPropagation();const t=e.detail;const i=t.id;const s=this.#ne.get(i);if(!s){return}const n=s.item;n.checked=t.checked;n.indeterminate=t.indeterminate;this.#me();if(this.filterType==="checked"||this.filterType==="unchecked"){this.#ge()}h(this)}onLoadLazyContent(e){if(!this.lazyLoadTreeItemsCallback){return}e.stopPropagation();const t=e.detail;const i=this.lazyLoadTreeItemsCallback(t);e.target.downloading=true;i.then((e=>{this.loadLazyContent(t,e)}))}onModifyCaption(e){if(!this.modifyItemCaptionCallback){return}e.stopPropagation();const t=e.target;const i=e.detail.id;const s=this.#se.get(i);const n=s.item;const a=e.detail.caption;const r=n.caption;n.caption=a;t.caption=a;const o=this.modifyItemCaptionCallback(i,a);o.then((e=>{if(e.success){this.#ke(s.parentItem.items);this.#ge();h(this)}else{t.caption=r;n.caption=r}}))}onOpenReference(e){e.stopPropagation();this.itemOpenReference.emit(e.detail)}#De=e=>{if(!this.checkDroppableZoneCallback){return}e.stopPropagation();const t=(new Date).getTime();const i=e.detail;const s=this.checkDroppableZoneCallback(i);s.then((e=>{this.updateValidDropZone(t,i.newContainer.id,i.draggedItems,i.dropType,e)}))};#Te=e=>{e.stopPropagation();const t=new Map(e.detail);const i=this.#ae;i.forEach((e=>{const s=this.#se.get(e).item;const n=t.get(e);if(n){s.expanded=n.expanded;t.delete(e)}else{s.selected=false;i.delete(e)}}));t.forEach(((e,t)=>{const s=this.#se.get(t).item;s.selected=true;s.expanded=e.expanded;i.add(t)}));h(this);this.#_e()};#$e=e=>{const t=e.detail;const i=this.#se.get(t.id).item;i.expanded=t.expanded};#Ee=e=>{e.stopPropagation();this.itemContextmenu.emit(e.detail)};#Oe=e=>{const t=e.detail;const i=t.newContainer;const s=i.id;if(!this.#se.get(s)){return}const n=t.draggedItems;if(n.length===0||!this.dropItemsCallback){return}e.stopPropagation();const a=this.dropItemsCallback(t);this.waitDropProcessing=true;a.then((async e=>{this.dropItems(e.acceptDrop,t,e.model);this.waitDropProcessing=false}))};#pe=e=>{if(e.size>1){const t=[...e.values()];const i=e.size-1;for(let e=0;e<i;e++){const i=t[e];this.#se.get(i).item.selected=false}e.clear();e.add(t[i]);this.#we()}};#be=(e,t)=>(i,s)=>{const n=this.#se.get(i.id);const a=n.item;const r=n.parentItem;const h=r.items.findIndex((e=>e.id===a.id));k(r.items,h);if(t!==undefined){let i=t.index+s;if(r.id===e.id&&h<i){i--;t.index--}C(e.items,a,i)}else{e.items.push(a)}n.parentItem=e};#ye=e=>{const t=e.items;if(!t){if(e.leaf!==true){e.items=[]}return}this.#ke(t);t.forEach(this.#xe(e))};#xe=e=>t=>{this.#se.set(t.id,{parentItem:e,item:t});if(this.#Le(t)){this.#ne.set(t.id,{parentItem:e,item:t})}t.expanded??=Ae;t.indeterminate??=Pe;t.lazy??=Fe;t.order??=Re;t.selected??=Ve;if(t.selected){this.#ae.add(t.id)}this.#ye(t)};#Le=e=>Ie(e,this.checkbox);#Ie=()=>je(this.filterType,this.filter);#ke=e=>{if(this.dropMode==="above"&&this.sortItemsCallback){this.sortItemsCallback(e)}};#ve=()=>{this.#se.clear();this.#ne.clear();this.#ae.clear();this.#oe={id:Q,caption:Q,items:this.model};this.#ye(this.#oe);this.#ge("immediate");this.#we();this.#me()};#Me=(e,t,i,s)=>{let n=false;if(e.leaf!==true&&e.items!=null){let a=undefined;e.items.forEach((e=>{const r=this.#Me(e,t,i,s);n||=r;if(r){a=e.id}}));e.lastItemId=a}const a=n||De(this.filterType,e,t);e.render=a;if(a&&e.id!==Q){if(e.selected){i.add(e.id)}if(this.#Le(e)){const t=this.#se.get(e.id);s.set(e.id,t)}}return a};#me=()=>{this.#he=true};#we=()=>{this.#re=true};#_e=()=>{const e=this.#Ce([...this.#ae.keys()]);this.selectedItemsChange.emit(e)};#Ae=()=>{const e=new Map(this.#ne);e.forEach((e=>{e.item.checked??=this.checked}));this.checkedItemsChange.emit(e)};#ge=e=>{this.#ce=true;if(e!==undefined){this.#de??=e}};#ze=e=>{if(e.size!==this.#ne.size){this.#he=true}else{this.#ne.forEach(((t,i)=>{if(!e.has(i)){this.#he=true}}))}this.#ne=e};#Se=e=>{if(e.size!==this.#ae.size){this.#re=true}else{this.#ae.forEach((t=>{if(!e.has(t)){this.#se.get(t).item.selected=false;this.#re=true}}))}this.#ae=e};#Pe=()=>{if(this.filterType==="none"){const e=new Map;this.#se.forEach(((t,i)=>{if(this.#Le(t.item)){e.set(i,t)}}));this.#ze(e);this.#Fe();this.#de=undefined;return}clearTimeout(this.#le);const e=this.filterDebounce>0&&(this.filterType==="caption"||this.filterType==="metadata");const t=()=>{const e=new Set;const t=new Map;if(this.filterType==="list"){this.#fe??=new Set(this.filterList??[])}this.#Me({id:Q,caption:Q,items:this.model},{defaultCheckbox:this.checkbox,defaultChecked:this.checked,filter:this.filter,filterOptions:this.filterOptions,filterSet:this.#fe},e,t);this.#Se(e);this.#ze(t);this.#Fe()};if(e&&this.#de!=="immediate"){this.#le=setTimeout((()=>{this.#de=undefined;t();h(this)}),this.filterDebounce)}else{this.#de=undefined;t()}};#Fe=()=>{if(this.#he){this.#Ae();this.#he=false}if(this.#re){this.#re=false;this.#_e()}};#Re=()=>{const e=new Map;this.#ae.forEach((t=>{const i=this.#se.get(t);const s=i.item;e.set(t,{id:s.id,expanded:s.expanded,metadata:s.metadata,parentId:i.parentItem.id})}));return e};connectedCallback(){if(!y("getImagePathCallback","ch-tree-view-render")){Me(this)}this.el.setAttribute("role","tree");this.#ve()}componentWillRender(){if(!this.#re&&!this.#he&&!this.#ce){return}if(this.#ce){this.#Pe();this.#ce=false;return}this.#Fe()}render(){return a(r,{key:"e93a2392e4a053b3436a9547a8d9e12ff888f46f","aria-multiselectable":this.multiSelection.toString()},a("ch-tree-view",{key:"be4ce249b72f99580e27aeaed7aeaa1dec078b2f",multiSelection:this.multiSelection,selectedItemsCallback:this.#Re,waitDropProcessing:this.waitDropProcessing,onDroppableZoneEnter:this.#De,onExpandedItemChange:this.#$e,onItemContextmenu:this.#Ee,onItemsDropped:this.#Oe,onSelectedItemsChange:this.#Te,ref:e=>this.#ue=e},this.model.map(((e,t)=>this.renderItem(e,this,this.#Ie(),this.showLines!=="none"&&t===this.model.length-1,0,this.dropMode!=="above"&&this.dropDisabled!==true,this.useGxRender)))))}static get watchers(){return{checkbox:["checkboxChange"],checked:["checkedChange"],filter:["filterChanged"],filterDebounce:["filterDebounceChanged"],filterList:["filterListChanged"],filterOptions:["filterOptionsChanged"],filterType:["filterTypeChanged"],multiSelection:["multiSelectionChanged"],model:["modelChanged"]}}};Je.style=Le;export{Y as ch_tree_view,oe as ch_tree_view_drop,ye as ch_tree_view_item,Je as ch_tree_view_render};
//# sourceMappingURL=p-d9e224b7.entry.js.map