import{r as t,g as i,h as e,H as s,c as n}from"./p-7af91c05.js";import{S as h}from"./p-9db16727.js";import{a as r}from"./p-a859514b.js";import"./p-e7a788ef.js";const a=t=>{let i=t;while(i!==null&&i!==window.document.documentElement){const e=window.getComputedStyle(t).overflowY;if(e==="auto"||e==="scroll"){return[i.tagName==="ch-smart-grid"?"ch-smart-grid":"other",i]}i=i.parentElement}return["window",window.document.documentElement]};const l=":host{display:flex;align-items:center;justify-content:center;text-align:center;block-size:0;inline-size:100%;pointer-events:none}:host(.loading){block-size:auto}";const o=l;const d=2;const c=class{constructor(i){t(this,i);this.autoScroll="at-scroll-end";this.dataProvider=false;this.disabled=false;this.infiniteThresholdReachedCallback=undefined;this.loadingState=undefined;this.position="bottom";this.threshold="150px"}#t=0;#i=0;#e=0;#s;#n;#h;#r;#a;#l="other";get el(){return i(this)}dataProviderChanged(t){if(t){requestAnimationFrame(this.#o)}else{this.#d()}}disabledChanged(t){if(t){this.#d()}else{requestAnimationFrame(this.#o)}}loadingStateChanged(t){this.#c();if(t==="initial"){this.#t=0;this.#i=0;this.#e=0}}thresholdChanged(){this.#c()}#f=()=>this.loadingState==="more-data-to-fetch";#c=()=>{this.#d();requestAnimationFrame(this.#o)};#m=()=>{if(this.loadingState!=="loading"){this.loadingState="loading";this.infiniteThresholdReachedCallback()}};#o=()=>{if(!this.dataProvider||this.disabled){return}requestAnimationFrame((()=>{if(!this.#f()||this.#s){return}const t={root:this.#a,rootMargin:this.threshold};this.#s=new IntersectionObserver((t=>{if(t[0].isIntersecting){this.#m()}}),t);this.#s.observe(this.el)}))};#g=()=>{this.#h??=new AbortController;this.#a.addEventListener("scroll",this.#u,{capture:true,passive:true,signal:this.#h.signal})};#u=()=>{this.#e=this.#a.scrollTop;this.#i=this.#a.scrollHeight};#p=()=>{if(this.#l==="window"||this.position!=="top"){return}requestAnimationFrame(this.#g);const t=this.#r.querySelector("[slot='grid-content']");t.scrollTop=t.scrollHeight+d;this.#n=new ResizeObserver(this.#C);this.#n.observe(t);this.#n.observe(this.#a)};#C=()=>{const t=this.#a.clientHeight;const i=this.#a.scrollHeight;const e=this.#t===this.#i&&t<i;if(e){const e=i-t+d;this.#t=t;this.#i=i;this.#a.scrollTop=e;this.#e=e;return}const s=this.#i<=this.#t+this.#e+d;if(this.dataProvider||this.autoScroll==="at-scroll-end"&&s){const e=i-this.#i;const n=t<this.#t?this.#t-t:0;const h=this.#e+e+n+(s?d:0);this.#a.scrollTop=h;this.#e=h}this.#t=t;this.#i=i};#v=()=>{this.#n?.disconnect();this.#n=undefined;this.#h.abort()};#d=()=>{this.#s?.disconnect();this.#s=undefined};componentDidLoad(){this.#r=this.el.getRootNode().host;const t=a(this.#r);this.#l=t[0];this.#a=t[1];this.#p();requestAnimationFrame(this.#o)}disconnectedCallback(){this.#d();this.#v()}render(){return e(s,{key:"cb59e72d55b6f146c000bd7c964556dd55145c69",class:this.loadingState==="loading"?"loading":undefined,"aria-hidden":"true"},this.loadingState==="loading"&&e("slot",{key:"121ce2df05001ec9a288bba2220598eb72e4251e"}))}static get watchers(){return{dataProvider:["dataProviderChanged"],disabled:["disabledChanged"],loadingState:["loadingStateChanged"],threshold:["thresholdChanged"]}}};c.style=o;const f=(t,i,e)=>{if(i===e){return t.clientHeight}const s=e.offsetTop-i.offsetTop;return t.clientHeight-s};const m=":host{--ch-smart-grid-smart-cell-reserved-space-size:0px;display:grid;grid-template-rows:1fr;grid-template-columns:1fr}:host(.ch-smart-grid--loaded-render-delay){opacity:0;pointer-events:none}:host(.ch-smart-grid--inverse-loading){grid-template-rows:max-content 1fr}:host(.ch-smart-grid--data-provider){grid-template-rows:1fr max-content}:host(.ch-scrollable){contain:strict;overflow:auto;overflow-anchor:none}::slotted([slot=grid-content]){display:grid;grid-auto-rows:max-content}";const g=m;const u="ch-smart-grid--loaded-render-delay";const p="ch-smart-grid-cell";const C="ch-smart-grid-cell-reserve-space";const v="--ch-smart-grid-smart-cell-reserved-space-size";const b=class{constructor(i){t(this,i);this.infiniteThresholdReached=n(this,"infiniteThresholdReached",3);this.infiniteScrollEnabled=true;this.cellRefAlignedAtTheTop=null;this.accessibleName=undefined;this.autoGrow=false;this.autoScroll="at-scroll-end";this.dataProvider=false;this.inverseLoading=false;this.itemsCount=undefined;this.loadingState="initial";this.threshold="10px"}#b=null;cellRefAlignedAtTheTopChanged(t,i){this.#w();if(i===null){this.el.addEventListener("smartCellDidLoad",this.#w);this.el.addEventListener("smartCellDisconnectedCallback",this.#S)}else if(t===null){this.el.removeEventListener("smartCellDidLoad",this.#w);this.el.removeEventListener("smartCellDisconnectedCallback",this.#S)}}#A=false;get el(){return i(this)}infiniteThresholdReached;async scrollEndContentToPosition(t,i){const e=this.#k(t);this.cellRefAlignedAtTheTop=i.position==="start"?e:null;if(e){requestAnimationFrame((()=>setTimeout((()=>this.el.scrollBy({top:e.offsetTop,behavior:i.behavior??"auto"})))))}}async removeScrollEndContentReference(){this.cellRefAlignedAtTheTop=null}handleVirtualItemsChanged(t){const{startIndex:i,endIndex:e,totalItems:s}=t.detail;this.infiniteScrollEnabled=this.inverseLoading&&i===0||!this.inverseLoading&&e===s-1}#k=t=>this.el.querySelector(`${p}[cell-id="${t}"]`);#T=()=>{this.loadingState="loading";this.infiniteThresholdReached.emit()};#y=()=>{if(this.inverseLoading){this.#A=true;this.el.classList.add(u)}};#I=()=>{this.#A=false;this.el.removeEventListener("virtualScrollerDidLoad",this.#I);requestAnimationFrame((()=>this.el.classList.remove(u)))};#R=()=>{if(this.cellRefAlignedAtTheTop===null){this.el.style.removeProperty(v);this.#b=null;return true}return false};#w=()=>{if(this.#R()){return}setTimeout((()=>{if(this.#R()){return}const t=this.el.querySelector(`:scope > [slot="grid-content"] > ch-chat-lit > ${p}:last-child`);if(this.#b!==t){const i=t?f(this.el,this.cellRefAlignedAtTheTop,t):0;this.el.style.removeProperty(v);this.#b?.classList.remove(C);this.#b=t;if(t){t.classList.add(C);this.el.style.setProperty(v,i+"px")}}}))};#S=t=>{const i=t.detail;if(this.cellRefAlignedAtTheTop===i);else if(this.#b===i){this.#b=null;this.#w()}};connectedCallback(){r(this.el.shadowRoot.adoptedStyleSheets);this.#y();if(this.inverseLoading&&!this.autoGrow){this.el.addEventListener("virtualScrollerDidLoad",this.#I)}}componentDidRender(){if(!this.#A){return}if(this.inverseLoading&&this.autoGrow){this.#I()}}render(){const t=this.loadingState==="initial";const i=this.itemsCount>0;return e(s,{key:"ac2f43d8d22aed0a614c04dd9be9d1f956c3382b","aria-label":this.accessibleName||undefined,"aria-live":"polite","aria-busy":t||this.loadingState==="loading"?"true":"false",class:{"ch-smart-grid--inverse-loading":i&&this.inverseLoading,"ch-smart-grid--data-provider":i&&this.dataProvider&&!this.inverseLoading,[h]:!this.autoGrow}},t?e("slot",{name:"grid-initial-loading-placeholder"}):[i&&this.inverseLoading&&e("ch-infinite-scroll",{autoScroll:this.autoScroll,dataProvider:this.dataProvider,disabled:!this.infiniteScrollEnabled,infiniteThresholdReachedCallback:this.#T,loadingState:this.loadingState,position:"top",threshold:this.threshold}),e("slot",{name:i?"grid-content":"grid-content-empty"}),i&&this.dataProvider&&!this.inverseLoading&&e("ch-infinite-scroll",{dataProvider:true,disabled:!this.infiniteScrollEnabled,infiniteThresholdReachedCallback:this.#T,loadingState:this.loadingState,threshold:this.threshold})])}static get watchers(){return{cellRefAlignedAtTheTop:["cellRefAlignedAtTheTopChanged"]}}};b.style=g;const w='ch-smart-grid-cell.ch-smart-grid-cell-reserve-space{position:relative}ch-smart-grid-cell.ch-smart-grid-cell-reserve-space::before{content:"";position:absolute;inline-size:2px;block-size:var(--ch-smart-grid-smart-cell-reserved-space-size);visibility:hidden;pointer-events:none}';const S=w;const A=class{constructor(i){t(this,i);this.smartCellDidLoad=n(this,"smartCellDidLoad",7);this.cellId=undefined;this.smartGridRef=undefined}#L;get el(){return i(this)}smartCellDidLoad;connectedCallback(){this.el.setAttribute("role","gridcell");this.#L=this.smartGridRef??this.el.closest("ch-smart-grid")}componentDidLoad(){this.smartCellDidLoad.emit(this.cellId);this.el.setAttribute("data-did-load","true")}disconnectedCallback(){this.#L.dispatchEvent(new CustomEvent("smartCellDisconnectedCallback",{detail:this.el}))}};A.style=S;export{c as ch_infinite_scroll,b as ch_smart_grid,A as ch_smart_grid_cell};
//# sourceMappingURL=p-791154bf.entry.js.map