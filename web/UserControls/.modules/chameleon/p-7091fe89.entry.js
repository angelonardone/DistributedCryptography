import{r as t,c as s,g as i,h as e,H as n}from"./p-7af91c05.js";import{S as r}from"./p-2a2bca47.js";import{g as o}from"./p-2cf94d81.js";const l=t=>t.hasAttribute("data-did-load")&&t.style.display!=="none";const c=(t,s)=>{const i=t.getBoundingClientRect();const e=s.x;const n=s.x+s.width;const r=s.y;const l=s.y+s.height;const c=i.x;const h=i.x+i.width;const a=i.y;const d=i.y+i.height;return(o(e,c,n)||o(e,h,n))&&(o(r,a,l)||o(r,d,l))};const h=(t,s,i)=>{const e=s;const n=s+i.height;const r=t.offsetTop;const l=t.offsetTop+t.height;return o(e,r,n)||o(e,l,n)};const a=t=>t===undefined||t.length===0;const d=t=>[...t.querySelectorAll(":scope>ch-chat-lit>ch-smart-grid-cell")];const u=(t,s,i)=>{const e=d(t);const n=s.getBoundingClientRect();const r=e.length-1;let h=i?r:0;const a=i?-1:1;while(o(0,h,r)){const t=e[h];if(l(t)){if(!c(t,n)){return true}}else{return false}h+=a}return true};const f={type:"waiting-for-cells-to-render"};const v=(t,s,i,e,n,r,l)=>{let a="";let d=0;i.forEach(((t,s)=>{const i=t.offsetTop+t.height;const e=i<=n;if(e&&d<=i){d=i;a=s}}));const u=s.findIndex((t=>t.id===a));const f=Math.max(0,u+1-e);const v=s.length-1;let p=u+1;let m=0;let g=0;if(l){return{startIndex:f,endIndex:v,renderedCells:t,type:"index"}}while(o(0,p,v)&&g<e){const e=s[p].id;const o=i.get(e);if(o){const t=h(o,n,r);if(!t){g++}}else{const s=t[m];const i=c(s,r);if(!i){g++}m++}p++}p=Math.min(v,p+e-1);return{startIndex:f,endIndex:p,renderedCells:t,type:"index"}};const p=(t,s)=>s<=t;const m=(t,s)=>t<=s;const g=(t,s,i,e)=>{const n=i.length-1;const r=t===1?n-s:s;const o=t===1?m:p;let l=t===1?0:n;let h=s;while(o(l,r)){const s=i[l];if(c(s,e)){break}h--;l+=t}return h};const x=(t,s,i,e,n,r,o,c)=>{const h=d(t);const a=h.every(l);if(!a){return f}const u=s.getBoundingClientRect();const p=s.scrollTop;const m=h[1];const x=n>0&&m.style.display!=="none"&&p<m.offsetTop;if(x){return v(h,i,e,o,p,u,c)}const C=h.at(-2);const b=r>0&&C.style.display!=="none"&&C.offsetTop+C.getBoundingClientRect().height<p;if(b){return v(h,i,e,o,p,u,c)}const y=g(1,o,h,u);const _=c?i.length-1:g(-1,o,h,u);return{startShift:y,endShift:_,renderedCells:h,type:"shift"}};const C=(t,s,i)=>{const e=[];const n=new Set;for(let s=t.startIndex;s<=t.endIndex;s++){const t=i[s];n.add(t.id)}t.renderedCells.forEach((t=>{if(!n.has(t.cellId)&&l(t)&&t.style.display!=="none"){const{offsetTop:i,offsetLeft:n}=t;const r=t.getBoundingClientRect();e.push(t);s.set(t.cellId,{width:r.width,height:r.height,offsetTop:i,offsetLeft:n})}}));return e};const b=':host{--ch-virtual-scroll__scroll-start-size:0px;--ch-virtual-scroll__scroll-end-size:0px;--ch-virtual-scroll__scroll-end-reserved-size:0px;--ch-virtual-scroll__scroll-start-display:none;--ch-virtual-scroll__scroll-end-display:none;display:grid;grid-auto-rows:max-content}:host(.ch-virtual-scroller--content-not-loaded){opacity:0;pointer-events:none}:host(.ch-virtual-scroller--content-loaded) ::slotted(ch-smart-grid-cell:not([data-did-load])){position:absolute;pointer-events:none;visibility:hidden}:host(.ch-virtual-scroller--virtual-scroll)::before{content:"";display:var(--ch-virtual-scroll__scroll-start-display);block-size:var(--ch-virtual-scroll__scroll-start-size);inline-size:0px;pointer-events:none}:host(.ch-virtual-scroller--virtual-scroll)::after{content:"";display:var(--ch-virtual-scroll__scroll-end-display);block-size:calc(var(--ch-virtual-scroll__scroll-end-size) + var(--ch-virtual-scroll__scroll-end-reserved-size));inline-size:2px;pointer-events:none;background-color:red}';const y=b;const _="--ch-virtual-scroll__scroll-";const I=`${_}start-size`;const z=`${_}start-display`;const S=`${_}end-size`;const w=`${_}end-display`;const k=class{constructor(i){t(this,i);this.virtualItemsChanged=s(this,"virtualItemsChanged",7);this.virtualScrollerDidLoad=s(this,"virtualScrollerDidLoad",7);this.waitingForContent=true;this.bufferAmount=5;this.initialRenderViewportItems=10;this.inverseLoading=false;this.items=undefined;this.itemsCount=undefined;this.mode="virtual-scroll"}#t=0;#s=0;#i=0;#e=0;#n=true;#r=false;#o;#l=new r;#c;#h;#a;get el(){return i(this)}waitingForContentChanged(){this.#d()}itemsChanged(t){this.#u();this.#f(t)}virtualItemsChanged;virtualScrollerDidLoad;async addItems(t,...s){if(t==="start"){this.items.unshift(...s);const t=s.length;this.#t+=t;this.#s+=t}else{this.items.push(...s)}this.#v()}#p=()=>{const t=this.#e!==0;if(t){this.el.style.setProperty(w,"block")}else{this.el.style.removeProperty(w)}};#m=t=>{this.#i=0;this.#e=0;const s=this.items;const i=this.#c;const e=s.length-1;const n=Math.max(0,this.#t-1);const r=Math.min(e,this.#s+1);const o=i.get(s[n].id);const l=i.get(s[r].id);if(o){this.#i=o.offsetTop+o.height}const c=Math.max(1,this.#t);for(let t=c;t<this.#s;t++){const e=s[t].id;const n=i.get(e);if(n){this.#i+=n.height}}if(this.#s===e){const t=s[this.#s].id;const e=i.get(t);if(e){this.#i+=e.height}}else if(l){let t=0;i.forEach((s=>{t=Math.max(t,s.offsetTop+s.height)}));this.#e=t-l.offsetTop}t?.forEach((t=>{t.style.display="none"}));this.el.style.setProperty(I,`${this.#i}px`);this.el.style.setProperty(z,this.#i===0?"none":"block");this.el.style.setProperty(S,`${this.#e}px`);this.#p()};#v=()=>{if(this.#n){this.#l.perform(this.#g)}};#g=()=>{const t=x(this.el,this.#a,this.items,this.#c,this.#i,this.#e,this.bufferAmount,this.inverseLoading);if(t.type==="waiting-for-cells-to-render"){this.#r=true;return}this.#r=false;if(t.type==="shift"){if(t.startShift===0&&t.endShift===0){return}this.#x(t.startShift,t.endShift,t.renderedCells)}else{const{startIndex:s,endIndex:i}=t;if(this.#t===s&&this.#s===i){return}const e=C(t,this.#c,this.items);this.#t=s;this.#s=i;this.#C(e)}};#C=t=>{this.#m(t);const s=this.items.slice(this.#t,this.#s+1);this.virtualItemsChanged.emit({startIndex:this.#t,endIndex:this.#s,totalItems:this.items.length,virtualItems:s})};#u=()=>{this.#i=0;this.#e=0;if(this.inverseLoading){const t=this.items.length-1;this.#t=t;this.#s=t}else{this.#t=0;this.#s=0}if(this.mode==="virtual-scroll"){this.#c=new Map}};#f=t=>{if(a(t)){this.#C();return}const s=this.initialRenderViewportItems+this.bufferAmount;if(this.inverseLoading){this.#x(s,0)}else{this.#x(0,s)}};#x=(t,s,i)=>{const e=this.mode==="lazy-render"?Math.max(0,t):t;const n=this.mode==="lazy-render"?Math.max(0,s):s;if(e===0&&n===0){return}const r=Math.min(this.#s+n,this.items.length-1);const o=Math.max(0,this.#t-e);if(this.#t===o&&this.#s===r&&this.items.length>1){return}this.#t=o;this.#s=r;const l=this.mode==="virtual-scroll"&&i!==undefined&&i.length>0?C({endIndex:this.#s,startIndex:this.#t,renderedCells:i,type:"index"},this.#c,this.items):[];this.#C(l)};#d=()=>{this.#o=new AbortController;requestAnimationFrame((()=>{this.#a.addEventListener("scroll",this.#v,{passive:true,signal:this.#o.signal});this.#h=new ResizeObserver(this.#v);this.#h.observe(this.#a)}))};#b=t=>{if(this.waitingForContent){this.#y()}else{this.#_(t.detail)}};#y=()=>this.#l.perform((()=>{const t=!u(this.el,this.#a,this.inverseLoading);if(!t){requestAnimationFrame((()=>{this.virtualScrollerDidLoad.emit();this.waitingForContent=t}))}}));#_=t=>{this.#c.delete(t);this.#m();if(this.#r){this.#v()}};connectedCallback(){this.el.addEventListener("smartCellDidLoad",this.#b);this.#u()}componentDidLoad(){this.#a=this.el.closest("ch-smart-grid");this.#f(this.items)}disconnectedCallback(){this.#h?.disconnect();this.#h=undefined;this.#l.cancel();this.#l=undefined;this.#o.abort()}render(){return e(n,{key:"7e54ddd87bb70b0367fce7a9faf53a30a4a9ee66",class:{"ch-virtual-scroller--content-not-loaded":this.waitingForContent,"ch-virtual-scroller--content-loaded":!this.waitingForContent,"ch-virtual-scroller--virtual-scroll":!this.waitingForContent&&this.mode==="virtual-scroll"}},e("slot",{key:"5f7d6f6f18bb363386359f6228ed98b50098c643",onSlotchange:this.waitingForContent?this.#y:undefined}))}static get watchers(){return{waitingForContent:["waitingForContentChanged"],items:["itemsChanged"]}}};k.style=y;export{k as ch_virtual_scroller};
//# sourceMappingURL=p-7091fe89.entry.js.map